(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1219],{64335:function(ft,C,y){"use strict";var G=y(67294),b=(0,G.createContext)({});C.Z=b},21349:function(ft,C,y){"use strict";var G=y(84305),b=y(69224),p=y(17781),S=y.n(p),L=y(67294),X=y(94184),N=y.n(X),q=y(64335),K=function(xe){var se=(0,L.useContext)(q.Z),Ft=xe.children,zt=xe.contentWidth,Wt=xe.className,Mt=xe.style,wt=(0,L.useContext)(b.ZP.ConfigContext),ot=wt.getPrefixCls,tt=xe.prefixCls||ot("pro"),Yt=zt||se.contentWidth,ke="".concat(tt,"-grid-content");return L.createElement("div",{className:N()(ke,Wt,{wide:Yt==="Fixed"}),style:Mt},L.createElement("div",{className:"".concat(tt,"-grid-content-children")},Ft))};C.Z=K},46343:function(ft,C,y){"use strict";y.d(C,{zj:function(){return Se},oI:function(){return Yr},ni:function(){return Ae},gg:function(){return _r}});var G=y(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function b(tr,ne,be,De){function at(kt){return kt instanceof be?kt:new be(function(jt){jt(kt)})}return new(be||(be=Promise))(function(kt,jt){function w(Ue){try{de(De.next(Ue))}catch(Qe){jt(Qe)}}function F(Ue){try{de(De.throw(Ue))}catch(Qe){jt(Qe)}}function de(Ue){Ue.done?kt(Ue.value):at(Ue.value).then(w,F)}de((De=De.apply(tr,ne||[])).next())})}function p(tr,ne){var be={label:0,sent:function(){if(kt[0]&1)throw kt[1];return kt[1]},trys:[],ops:[]},De,at,kt,jt;return jt={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(jt[Symbol.iterator]=function(){return this}),jt;function w(de){return function(Ue){return F([de,Ue])}}function F(de){if(De)throw new TypeError("Generator is already executing.");for(;be;)try{if(De=1,at&&(kt=de[0]&2?at.return:de[0]?at.throw||((kt=at.return)&&kt.call(at),0):at.next)&&!(kt=kt.call(at,de[1])).done)return kt;switch(at=0,kt&&(de=[de[0]&2,kt.value]),de[0]){case 0:case 1:kt=de;break;case 4:return be.label++,{value:de[1],done:!1};case 5:be.label++,at=de[1],de=[0];continue;case 7:de=be.ops.pop(),be.trys.pop();continue;default:if(kt=be.trys,!(kt=kt.length>0&&kt[kt.length-1])&&(de[0]===6||de[0]===2)){be=0;continue}if(de[0]===3&&(!kt||de[1]>kt[0]&&de[1]<kt[3])){be.label=de[1];break}if(de[0]===6&&be.label<kt[1]){be.label=kt[1],kt=de;break}if(kt&&be.label<kt[2]){be.label=kt[2],be.ops.push(de);break}kt[2]&&be.ops.pop(),be.trys.pop();continue}de=ne.call(tr,be)}catch(Ue){de=[6,Ue],at=0}finally{De=kt=0}if(de[0]&5)throw de[1];return{value:de[0]?de[1]:void 0,done:!0}}}function S(tr,ne){var be=typeof Symbol=="function"&&tr[Symbol.iterator];if(!be)return tr;var De=be.call(tr),at,kt=[],jt;try{for(;(ne===void 0||ne-- >0)&&!(at=De.next()).done;)kt.push(at.value)}catch(w){jt={error:w}}finally{try{at&&!at.done&&(be=De.return)&&be.call(De)}finally{if(jt)throw jt.error}}return kt}function L(){for(var tr=[],ne=0;ne<arguments.length;ne++)tr=tr.concat(S(arguments[ne]));return tr}function X(tr){return tr&&tr.__esModule&&Object.prototype.hasOwnProperty.call(tr,"default")?tr.default:tr}function N(tr,ne){return ne={exports:{}},tr(ne,ne.exports),ne.exports}var q=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=be;function be(De){return De&&typeof De.length=="number"&&De.length>=0&&De.length%1==0}tr.exports=ne.default});X(q);var K=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=function(be){return function(){for(var De=[],at=arguments.length;at--;)De[at]=arguments[at];var kt=De.pop();return be.call(this,De,kt)}},tr.exports=ne.default});X(K);var ae=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.fallback=at,ne.wrap=kt;var be=ne.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,De=ne.hasNextTick=typeof G=="object"&&typeof G.nextTick=="function";function at(w){setTimeout(w,0)}function kt(w){return function(F){for(var de=[],Ue=arguments.length-1;Ue-- >0;)de[Ue]=arguments[Ue+1];return w(function(){return F.apply(void 0,de)})}}var jt;be?jt=setImmediate:De?jt=G.nextTick:jt=at,ne.default=kt(jt)});X(ae);var xe=ae.fallback,se=ae.wrap,Ft=ae.hasSetImmediate,zt=ae.hasNextTick,Wt=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=kt;var be=at(K),De=at(ae);function at(F){return F&&F.__esModule?F:{default:F}}function kt(F){return(0,Mt.isAsync)(F)?function(){for(var de=[],Ue=arguments.length;Ue--;)de[Ue]=arguments[Ue];var Qe=de.pop(),Tt=F.apply(this,de);return jt(Tt,Qe)}:(0,be.default)(function(de,Ue){var Qe;try{Qe=F.apply(this,de)}catch(Tt){return Ue(Tt)}if(Qe&&typeof Qe.then=="function")return jt(Qe,Ue);Ue(null,Qe)})}function jt(F,de){return F.then(function(Ue){w(de,null,Ue)},function(Ue){w(de,Ue&&Ue.message?Ue:new Error(Ue))})}function w(F,de,Ue){try{F(de,Ue)}catch(Qe){(0,De.default)(function(Tt){throw Tt},Qe)}}tr.exports=ne.default});X(Wt);var Mt=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.isAsyncIterable=ne.isAsyncGenerator=ne.isAsync=void 0;var be=De(Wt);function De(F){return F&&F.__esModule?F:{default:F}}function at(F){return F[Symbol.toStringTag]==="AsyncFunction"}function kt(F){return F[Symbol.toStringTag]==="AsyncGenerator"}function jt(F){return typeof F[Symbol.asyncIterator]=="function"}function w(F){if(typeof F!="function")throw new Error("expected a function");return at(F)?(0,be.default)(F):F}ne.default=w,ne.isAsync=at,ne.isAsyncGenerator=kt,ne.isAsyncIterable=jt});X(Mt);var wt=Mt.isAsyncIterable,ot=Mt.isAsyncGenerator,tt=Mt.isAsync,Yt=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=be;function be(De,at){if(at===void 0&&(at=De.length),!at)throw new Error("arity is undefined");function kt(){for(var jt=this,w=[],F=arguments.length;F--;)w[F]=arguments[F];return typeof w[at-1]=="function"?De.apply(this,w):new Promise(function(de,Ue){w[at-1]=function(Qe){for(var Tt=[],Dt=arguments.length-1;Dt-- >0;)Tt[Dt]=arguments[Dt+1];if(Qe)return Ue(Qe);de(Tt.length>1?Tt:Tt[0])},De.apply(jt,w)})}return Object.defineProperty(kt,"name",{configurable:!0,value:"awaitable("+De.name+")"}),kt}tr.exports=ne.default});X(Yt);var ke=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0});var be=kt(q),De=kt(Mt),at=kt(Yt);function kt(jt){return jt&&jt.__esModule?jt:{default:jt}}ne.default=(0,at.default)(function(jt,w,F){var de=(0,be.default)(w)?[]:{};jt(w,function(Ue,Qe,Tt){(0,De.default)(Ue)(function(Dt){for(var H,Qt=[],$t=arguments.length-1;$t-- >0;)Qt[$t]=arguments[$t+1];Qt.length<2&&(H=Qt,Qt=H[0]),de[Qe]=Qt,Tt(Dt)})},function(Ue){return F(Ue,de)})},3),tr.exports=ne.default});X(ke);var Ne=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=be;function be(De){function at(){for(var kt=[],jt=arguments.length;jt--;)kt[jt]=arguments[jt];if(De!==null){var w=De;De=null,w.apply(this,kt)}}return Object.assign(at,De),at}tr.exports=ne.default});X(Ne);var Be=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=function(be){return be[Symbol.iterator]&&be[Symbol.iterator]()},tr.exports=ne.default});X(Be);var Ie=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=F;var be=at(q),De=at(Be);function at(de){return de&&de.__esModule?de:{default:de}}function kt(de){var Ue=-1,Qe=de.length;return function(){return++Ue<Qe?{value:de[Ue],key:Ue}:null}}function jt(de){var Ue=-1;return function(){var Tt=de.next();return Tt.done?null:(Ue++,{value:Tt.value,key:Ue})}}function w(de){var Ue=de?Object.keys(de):[],Qe=-1,Tt=Ue.length;return function(){var H=Ue[++Qe];return Qe<Tt?{value:de[H],key:H}:null}}function F(de){if((0,be.default)(de))return kt(de);var Ue=(0,De.default)(de);return Ue?jt(Ue):w(de)}tr.exports=ne.default});X(Ie);var pt=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=be;function be(De){return function(){for(var at=[],kt=arguments.length;kt--;)at[kt]=arguments[kt];if(De===null)throw new Error("Callback was already called.");var jt=De;De=null,jt.apply(this,at)}}tr.exports=ne.default});X(pt);var oe=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0});var be={};ne.default=be,tr.exports=ne.default});X(oe);var re=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=at;var be=De(oe);function De(kt){return kt&&kt.__esModule?kt:{default:kt}}function at(kt,jt,w,F){var de=!1,Ue=!1,Qe=!1,Tt=0,Dt=0;function H(){Tt>=jt||Qe||de||(Qe=!0,kt.next().then(function(wr){var Tr=wr.value,Mr=wr.done;if(!(Ue||de)){if(Qe=!1,Mr){de=!0,Tt<=0&&F(null);return}Tt++,w(Tr,Dt,Qt),Dt++,H()}}).catch($t))}function Qt(wr,Tr){if(Tt-=1,!Ue){if(wr)return $t(wr);if(wr===!1){de=!0,Ue=!0;return}if(Tr===be.default||de&&Tt<=0)return de=!0,F(null);H()}}function $t(wr){Ue||(Qe=!1,de=!0,F(wr))}H()}tr.exports=ne.default});X(re);var ue=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0});var be=w(Ne),De=w(Ie),at=w(pt),kt=w(re),jt=w(oe);function w(F){return F&&F.__esModule?F:{default:F}}ne.default=function(F){return function(de,Ue,Qe){if(Qe=(0,be.default)(Qe),F<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!de)return Qe(null);if((0,Mt.isAsyncGenerator)(de))return(0,kt.default)(de,F,Ue,Qe);if((0,Mt.isAsyncIterable)(de))return(0,kt.default)(de[Symbol.asyncIterator](),F,Ue,Qe);var Tt=(0,De.default)(de),Dt=!1,H=!1,Qt=0,$t=!1;function wr(Mr,Or){if(!H)if(Qt-=1,Mr)Dt=!0,Qe(Mr);else if(Mr===!1)Dt=!0,H=!0;else{if(Or===jt.default||Dt&&Qt<=0)return Dt=!0,Qe(null);$t||Tr()}}function Tr(){for($t=!0;Qt<F&&!Dt;){var Mr=Tt();if(Mr===null){Dt=!0,Qt<=0&&Qe(null);return}Qt+=1,Ue(Mr.value,Mr.key,(0,at.default)(wr))}$t=!1}Tr()}},tr.exports=ne.default});X(ue);var it=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0});var be=kt(ue),De=kt(Mt),at=kt(Yt);function kt(w){return w&&w.__esModule?w:{default:w}}function jt(w,F,de,Ue){return(0,be.default)(F)(w,(0,De.default)(de),Ue)}ne.default=(0,at.default)(jt,4),tr.exports=ne.default});X(it);var Jt=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0});var be=at(it),De=at(Yt);function at(jt){return jt&&jt.__esModule?jt:{default:jt}}function kt(jt,w,F){return(0,be.default)(jt,1,w,F)}ne.default=(0,De.default)(kt,3),tr.exports=ne.default});X(Jt);var ce=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=kt;var be=at(ke),De=at(Jt);function at(jt){return jt&&jt.__esModule?jt:{default:jt}}function kt(jt,w){return(0,be.default)(De.default,jt,w)}tr.exports=ne.default}),$e=X(ce),Ae=function(){function tr(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];this.args=[],this.tasks=[]}return tr.prototype.call=function(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];return this.args=be,$e(this.tasks)},tr.prototype.tap=function(ne,be){var De=this;this.tasks.push(function(at){be.apply(void 0,L(De.args)),at(null,ne)})},tr}(),Ce=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0});var be=de(q),De=de(oe),at=de(it),kt=de(Ne),jt=de(pt),w=de(Mt),F=de(Yt);function de(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function Ue(Dt,H,Qt){Qt=(0,kt.default)(Qt);var $t=0,wr=0,Tr=Dt.length,Mr=!1;Tr===0&&Qt(null);function Or(Je,At){Je===!1&&(Mr=!0),Mr!==!0&&(Je?Qt(Je):(++wr===Tr||At===De.default)&&Qt(null))}for(;$t<Tr;$t++)H(Dt[$t],$t,(0,jt.default)(Or))}function Qe(Dt,H,Qt){return(0,at.default)(Dt,Infinity,H,Qt)}function Tt(Dt,H,Qt){var $t=(0,be.default)(Dt)?Ue:Qe;return $t(Dt,(0,w.default)(H),Qt)}ne.default=(0,F.default)(Tt,3),tr.exports=ne.default});X(Ce);var Pe=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=kt;var be=at(Ce),De=at(ke);function at(jt){return jt&&jt.__esModule?jt:{default:jt}}function kt(jt,w){return(0,De.default)(be.default,jt,w)}tr.exports=ne.default}),et=X(Pe),Se=function(){function tr(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];this.tasks=[]}return tr.prototype.promise=function(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];return et(this.tasks)},tr.prototype.tapPromise=function(ne,be){var De=this;this.tasks.push(function(at){return b(De,void 0,void 0,function(){return p(this,function(kt){switch(kt.label){case 0:return[4,be()];case 1:return kt.sent(),at(null,ne),[2]}})})})},tr}(),Pt=N(function(tr,ne){Object.defineProperty(ne,"__esModule",{value:!0});var be=jt(Ne),De=jt(pt),at=jt(Mt),kt=jt(Yt);function jt(F){return F&&F.__esModule?F:{default:F}}function w(F,de){if(de=(0,be.default)(de),!Array.isArray(F))return de(new Error("First argument to waterfall must be an array of functions"));if(!F.length)return de();var Ue=0;function Qe(Dt){var H=(0,at.default)(F[Ue++]);H.apply(void 0,Dt.concat([(0,De.default)(Tt)]))}function Tt(Dt){for(var H=[],Qt=arguments.length-1;Qt-- >0;)H[Qt]=arguments[Qt+1];if(Dt!==!1){if(Dt||Ue===F.length)return de.apply(void 0,[Dt].concat(H));Qe(H)}}Qe([])}ne.default=(0,kt.default)(w),tr.exports=ne.default}),vr=X(Pt),_r=function(){function tr(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];this.tasks=[]}return tr.prototype.call=function(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];return vr(this.tasks)},tr.prototype.tap=function(ne,be){this.tasks.length===0?this.tasks.push(function(De){var at=be();De(at?null:!1,at)}):this.tasks.push(function(De,at){var kt=be();at(kt?null:!1,ne)})},tr}(),Yr=function(){function tr(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];this.tasks=[]}return tr.prototype.call=function(){for(var ne=arguments,be=[],De=0;De<arguments.length;De++)be[De]=ne[De];return $e(this.tasks)},tr.prototype.tap=function(ne,be){this.tasks.push(function(De){var at=be();De(at,ne)})},tr}()},58881:function(ft,C,y){"use strict";y.d(C,{nC:function(){return G.ZP},Hp:function(){return G.Hp},e7:function(){return G.e7},yT:function(){return G.yT},vK:function(){return p.v},BlendType:function(){return L.h},AttributeType:function(){return X.GC},ScaleTypes:function(){return X.vY},StyleScaleType:function(){return X.ee},MapServiceEvent:function(){return K.I},CoordinateSystem:function(){return ae.l},CoordinateUniform:function(){return ae.k},CameraUniform:function(){return Ft.l},SceneEventList:function(){return Mt.P},PositionType:function(){return Be.d},gl:function(){return F.gl}});var G=y(85951),b=y(69530),p=y(72302),S=y(76915),L=y(77252),X=y(31251),N=y(8628),q=y.n(N);y.o(N,"CameraUniform")&&y.d(C,{CameraUniform:function(){return N.CameraUniform}}),y.o(N,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return N.CityBuildingLayer}}),y.o(N,"CoordinateSystem")&&y.d(C,{CoordinateSystem:function(){return N.CoordinateSystem}}),y.o(N,"CoordinateUniform")&&y.d(C,{CoordinateUniform:function(){return N.CoordinateUniform}}),y.o(N,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return N.HeatmapLayer}}),y.o(N,"ImageLayer")&&y.d(C,{ImageLayer:function(){return N.ImageLayer}}),y.o(N,"LineLayer")&&y.d(C,{LineLayer:function(){return N.LineLayer}}),y.o(N,"MapServiceEvent")&&y.d(C,{MapServiceEvent:function(){return N.MapServiceEvent}}),y.o(N,"Marker")&&y.d(C,{Marker:function(){return N.Marker}}),y.o(N,"PointLayer")&&y.d(C,{PointLayer:function(){return N.PointLayer}}),y.o(N,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return N.PolygonLayer}}),y.o(N,"Popup")&&y.d(C,{Popup:function(){return N.Popup}}),y.o(N,"PositionType")&&y.d(C,{PositionType:function(){return N.PositionType}}),y.o(N,"RasterLayer")&&y.d(C,{RasterLayer:function(){return N.RasterLayer}}),y.o(N,"Scene")&&y.d(C,{Scene:function(){return N.Scene}}),y.o(N,"SceneEventList")&&y.d(C,{SceneEventList:function(){return N.SceneEventList}}),y.o(N,"gl")&&y.d(C,{gl:function(){return N.gl}});var K=y(16606),ae=y(47282),xe=y(41906),se=y.n(xe);y.o(xe,"CameraUniform")&&y.d(C,{CameraUniform:function(){return xe.CameraUniform}}),y.o(xe,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return xe.CityBuildingLayer}}),y.o(xe,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return xe.HeatmapLayer}}),y.o(xe,"ImageLayer")&&y.d(C,{ImageLayer:function(){return xe.ImageLayer}}),y.o(xe,"LineLayer")&&y.d(C,{LineLayer:function(){return xe.LineLayer}}),y.o(xe,"Marker")&&y.d(C,{Marker:function(){return xe.Marker}}),y.o(xe,"PointLayer")&&y.d(C,{PointLayer:function(){return xe.PointLayer}}),y.o(xe,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return xe.PolygonLayer}}),y.o(xe,"Popup")&&y.d(C,{Popup:function(){return xe.Popup}}),y.o(xe,"PositionType")&&y.d(C,{PositionType:function(){return xe.PositionType}}),y.o(xe,"RasterLayer")&&y.d(C,{RasterLayer:function(){return xe.RasterLayer}}),y.o(xe,"Scene")&&y.d(C,{Scene:function(){return xe.Scene}}),y.o(xe,"SceneEventList")&&y.d(C,{SceneEventList:function(){return xe.SceneEventList}}),y.o(xe,"gl")&&y.d(C,{gl:function(){return xe.gl}});var Ft=y(4594),zt=y(1910),Wt=y.n(zt);y.o(zt,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return zt.CityBuildingLayer}}),y.o(zt,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return zt.HeatmapLayer}}),y.o(zt,"ImageLayer")&&y.d(C,{ImageLayer:function(){return zt.ImageLayer}}),y.o(zt,"LineLayer")&&y.d(C,{LineLayer:function(){return zt.LineLayer}}),y.o(zt,"Marker")&&y.d(C,{Marker:function(){return zt.Marker}}),y.o(zt,"PointLayer")&&y.d(C,{PointLayer:function(){return zt.PointLayer}}),y.o(zt,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return zt.PolygonLayer}}),y.o(zt,"Popup")&&y.d(C,{Popup:function(){return zt.Popup}}),y.o(zt,"PositionType")&&y.d(C,{PositionType:function(){return zt.PositionType}}),y.o(zt,"RasterLayer")&&y.d(C,{RasterLayer:function(){return zt.RasterLayer}}),y.o(zt,"Scene")&&y.d(C,{Scene:function(){return zt.Scene}}),y.o(zt,"SceneEventList")&&y.d(C,{SceneEventList:function(){return zt.SceneEventList}}),y.o(zt,"gl")&&y.d(C,{gl:function(){return zt.gl}});var Mt=y(19793),wt=y(93102),ot=y.n(wt);y.o(wt,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return wt.CityBuildingLayer}}),y.o(wt,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return wt.HeatmapLayer}}),y.o(wt,"ImageLayer")&&y.d(C,{ImageLayer:function(){return wt.ImageLayer}}),y.o(wt,"LineLayer")&&y.d(C,{LineLayer:function(){return wt.LineLayer}}),y.o(wt,"Marker")&&y.d(C,{Marker:function(){return wt.Marker}}),y.o(wt,"PointLayer")&&y.d(C,{PointLayer:function(){return wt.PointLayer}}),y.o(wt,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return wt.PolygonLayer}}),y.o(wt,"Popup")&&y.d(C,{Popup:function(){return wt.Popup}}),y.o(wt,"PositionType")&&y.d(C,{PositionType:function(){return wt.PositionType}}),y.o(wt,"RasterLayer")&&y.d(C,{RasterLayer:function(){return wt.RasterLayer}}),y.o(wt,"Scene")&&y.d(C,{Scene:function(){return wt.Scene}}),y.o(wt,"gl")&&y.d(C,{gl:function(){return wt.gl}});var tt=y(64532),Yt=y.n(tt);y.o(tt,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return tt.CityBuildingLayer}}),y.o(tt,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return tt.HeatmapLayer}}),y.o(tt,"ImageLayer")&&y.d(C,{ImageLayer:function(){return tt.ImageLayer}}),y.o(tt,"LineLayer")&&y.d(C,{LineLayer:function(){return tt.LineLayer}}),y.o(tt,"Marker")&&y.d(C,{Marker:function(){return tt.Marker}}),y.o(tt,"PointLayer")&&y.d(C,{PointLayer:function(){return tt.PointLayer}}),y.o(tt,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return tt.PolygonLayer}}),y.o(tt,"Popup")&&y.d(C,{Popup:function(){return tt.Popup}}),y.o(tt,"PositionType")&&y.d(C,{PositionType:function(){return tt.PositionType}}),y.o(tt,"RasterLayer")&&y.d(C,{RasterLayer:function(){return tt.RasterLayer}}),y.o(tt,"Scene")&&y.d(C,{Scene:function(){return tt.Scene}}),y.o(tt,"gl")&&y.d(C,{gl:function(){return tt.gl}});var ke=y(2811),Ne=y.n(ke);y.o(ke,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return ke.CityBuildingLayer}}),y.o(ke,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return ke.HeatmapLayer}}),y.o(ke,"ImageLayer")&&y.d(C,{ImageLayer:function(){return ke.ImageLayer}}),y.o(ke,"LineLayer")&&y.d(C,{LineLayer:function(){return ke.LineLayer}}),y.o(ke,"Marker")&&y.d(C,{Marker:function(){return ke.Marker}}),y.o(ke,"PointLayer")&&y.d(C,{PointLayer:function(){return ke.PointLayer}}),y.o(ke,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return ke.PolygonLayer}}),y.o(ke,"Popup")&&y.d(C,{Popup:function(){return ke.Popup}}),y.o(ke,"PositionType")&&y.d(C,{PositionType:function(){return ke.PositionType}}),y.o(ke,"RasterLayer")&&y.d(C,{RasterLayer:function(){return ke.RasterLayer}}),y.o(ke,"Scene")&&y.d(C,{Scene:function(){return ke.Scene}}),y.o(ke,"gl")&&y.d(C,{gl:function(){return ke.gl}});var Be=y(66690),Ie=y(81732),pt=y.n(Ie);y.o(Ie,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return Ie.CityBuildingLayer}}),y.o(Ie,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return Ie.HeatmapLayer}}),y.o(Ie,"ImageLayer")&&y.d(C,{ImageLayer:function(){return Ie.ImageLayer}}),y.o(Ie,"LineLayer")&&y.d(C,{LineLayer:function(){return Ie.LineLayer}}),y.o(Ie,"Marker")&&y.d(C,{Marker:function(){return Ie.Marker}}),y.o(Ie,"PointLayer")&&y.d(C,{PointLayer:function(){return Ie.PointLayer}}),y.o(Ie,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return Ie.PolygonLayer}}),y.o(Ie,"Popup")&&y.d(C,{Popup:function(){return Ie.Popup}}),y.o(Ie,"RasterLayer")&&y.d(C,{RasterLayer:function(){return Ie.RasterLayer}}),y.o(Ie,"Scene")&&y.d(C,{Scene:function(){return Ie.Scene}}),y.o(Ie,"gl")&&y.d(C,{gl:function(){return Ie.gl}});var oe=y(84007),re=y.n(oe);y.o(oe,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return oe.CityBuildingLayer}}),y.o(oe,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return oe.HeatmapLayer}}),y.o(oe,"ImageLayer")&&y.d(C,{ImageLayer:function(){return oe.ImageLayer}}),y.o(oe,"LineLayer")&&y.d(C,{LineLayer:function(){return oe.LineLayer}}),y.o(oe,"Marker")&&y.d(C,{Marker:function(){return oe.Marker}}),y.o(oe,"PointLayer")&&y.d(C,{PointLayer:function(){return oe.PointLayer}}),y.o(oe,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return oe.PolygonLayer}}),y.o(oe,"Popup")&&y.d(C,{Popup:function(){return oe.Popup}}),y.o(oe,"RasterLayer")&&y.d(C,{RasterLayer:function(){return oe.RasterLayer}}),y.o(oe,"Scene")&&y.d(C,{Scene:function(){return oe.Scene}}),y.o(oe,"gl")&&y.d(C,{gl:function(){return oe.gl}});var ue=y(79042),it=y.n(ue);y.o(ue,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return ue.CityBuildingLayer}}),y.o(ue,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return ue.HeatmapLayer}}),y.o(ue,"ImageLayer")&&y.d(C,{ImageLayer:function(){return ue.ImageLayer}}),y.o(ue,"LineLayer")&&y.d(C,{LineLayer:function(){return ue.LineLayer}}),y.o(ue,"Marker")&&y.d(C,{Marker:function(){return ue.Marker}}),y.o(ue,"PointLayer")&&y.d(C,{PointLayer:function(){return ue.PointLayer}}),y.o(ue,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return ue.PolygonLayer}}),y.o(ue,"Popup")&&y.d(C,{Popup:function(){return ue.Popup}}),y.o(ue,"RasterLayer")&&y.d(C,{RasterLayer:function(){return ue.RasterLayer}}),y.o(ue,"Scene")&&y.d(C,{Scene:function(){return ue.Scene}}),y.o(ue,"gl")&&y.d(C,{gl:function(){return ue.gl}});var Jt=y(89648),ce=y(90919),$e=y.n(ce);y.o(ce,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return ce.CityBuildingLayer}}),y.o(ce,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return ce.HeatmapLayer}}),y.o(ce,"ImageLayer")&&y.d(C,{ImageLayer:function(){return ce.ImageLayer}}),y.o(ce,"LineLayer")&&y.d(C,{LineLayer:function(){return ce.LineLayer}}),y.o(ce,"Marker")&&y.d(C,{Marker:function(){return ce.Marker}}),y.o(ce,"PointLayer")&&y.d(C,{PointLayer:function(){return ce.PointLayer}}),y.o(ce,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return ce.PolygonLayer}}),y.o(ce,"Popup")&&y.d(C,{Popup:function(){return ce.Popup}}),y.o(ce,"RasterLayer")&&y.d(C,{RasterLayer:function(){return ce.RasterLayer}}),y.o(ce,"Scene")&&y.d(C,{Scene:function(){return ce.Scene}}),y.o(ce,"gl")&&y.d(C,{gl:function(){return ce.gl}});var Ae=y(75925),Ce=y.n(Ae);y.o(Ae,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return Ae.CityBuildingLayer}}),y.o(Ae,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return Ae.HeatmapLayer}}),y.o(Ae,"ImageLayer")&&y.d(C,{ImageLayer:function(){return Ae.ImageLayer}}),y.o(Ae,"LineLayer")&&y.d(C,{LineLayer:function(){return Ae.LineLayer}}),y.o(Ae,"Marker")&&y.d(C,{Marker:function(){return Ae.Marker}}),y.o(Ae,"PointLayer")&&y.d(C,{PointLayer:function(){return Ae.PointLayer}}),y.o(Ae,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return Ae.PolygonLayer}}),y.o(Ae,"Popup")&&y.d(C,{Popup:function(){return Ae.Popup}}),y.o(Ae,"RasterLayer")&&y.d(C,{RasterLayer:function(){return Ae.RasterLayer}}),y.o(Ae,"Scene")&&y.d(C,{Scene:function(){return Ae.Scene}}),y.o(Ae,"gl")&&y.d(C,{gl:function(){return Ae.gl}});var Pe=y(85040),et=y.n(Pe);y.o(Pe,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return Pe.CityBuildingLayer}}),y.o(Pe,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return Pe.HeatmapLayer}}),y.o(Pe,"ImageLayer")&&y.d(C,{ImageLayer:function(){return Pe.ImageLayer}}),y.o(Pe,"LineLayer")&&y.d(C,{LineLayer:function(){return Pe.LineLayer}}),y.o(Pe,"Marker")&&y.d(C,{Marker:function(){return Pe.Marker}}),y.o(Pe,"PointLayer")&&y.d(C,{PointLayer:function(){return Pe.PointLayer}}),y.o(Pe,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return Pe.PolygonLayer}}),y.o(Pe,"Popup")&&y.d(C,{Popup:function(){return Pe.Popup}}),y.o(Pe,"RasterLayer")&&y.d(C,{RasterLayer:function(){return Pe.RasterLayer}}),y.o(Pe,"Scene")&&y.d(C,{Scene:function(){return Pe.Scene}}),y.o(Pe,"gl")&&y.d(C,{gl:function(){return Pe.gl}});var Se=y(8594),Pt=y.n(Se);y.o(Se,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return Se.CityBuildingLayer}}),y.o(Se,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return Se.HeatmapLayer}}),y.o(Se,"ImageLayer")&&y.d(C,{ImageLayer:function(){return Se.ImageLayer}}),y.o(Se,"LineLayer")&&y.d(C,{LineLayer:function(){return Se.LineLayer}}),y.o(Se,"Marker")&&y.d(C,{Marker:function(){return Se.Marker}}),y.o(Se,"PointLayer")&&y.d(C,{PointLayer:function(){return Se.PointLayer}}),y.o(Se,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return Se.PolygonLayer}}),y.o(Se,"Popup")&&y.d(C,{Popup:function(){return Se.Popup}}),y.o(Se,"RasterLayer")&&y.d(C,{RasterLayer:function(){return Se.RasterLayer}}),y.o(Se,"Scene")&&y.d(C,{Scene:function(){return Se.Scene}}),y.o(Se,"gl")&&y.d(C,{gl:function(){return Se.gl}});var vr=y(67571),_r=y.n(vr);y.o(vr,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return vr.CityBuildingLayer}}),y.o(vr,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return vr.HeatmapLayer}}),y.o(vr,"ImageLayer")&&y.d(C,{ImageLayer:function(){return vr.ImageLayer}}),y.o(vr,"LineLayer")&&y.d(C,{LineLayer:function(){return vr.LineLayer}}),y.o(vr,"Marker")&&y.d(C,{Marker:function(){return vr.Marker}}),y.o(vr,"PointLayer")&&y.d(C,{PointLayer:function(){return vr.PointLayer}}),y.o(vr,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return vr.PolygonLayer}}),y.o(vr,"Popup")&&y.d(C,{Popup:function(){return vr.Popup}}),y.o(vr,"RasterLayer")&&y.d(C,{RasterLayer:function(){return vr.RasterLayer}}),y.o(vr,"Scene")&&y.d(C,{Scene:function(){return vr.Scene}}),y.o(vr,"gl")&&y.d(C,{gl:function(){return vr.gl}});var Yr=y(66718),tr=y.n(Yr);y.o(Yr,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return Yr.CityBuildingLayer}}),y.o(Yr,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return Yr.HeatmapLayer}}),y.o(Yr,"ImageLayer")&&y.d(C,{ImageLayer:function(){return Yr.ImageLayer}}),y.o(Yr,"LineLayer")&&y.d(C,{LineLayer:function(){return Yr.LineLayer}}),y.o(Yr,"Marker")&&y.d(C,{Marker:function(){return Yr.Marker}}),y.o(Yr,"PointLayer")&&y.d(C,{PointLayer:function(){return Yr.PointLayer}}),y.o(Yr,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return Yr.PolygonLayer}}),y.o(Yr,"Popup")&&y.d(C,{Popup:function(){return Yr.Popup}}),y.o(Yr,"RasterLayer")&&y.d(C,{RasterLayer:function(){return Yr.RasterLayer}}),y.o(Yr,"Scene")&&y.d(C,{Scene:function(){return Yr.Scene}}),y.o(Yr,"gl")&&y.d(C,{gl:function(){return Yr.gl}});var ne=y(92364),be=y(78010),De=y.n(be);y.o(be,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return be.CityBuildingLayer}}),y.o(be,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return be.HeatmapLayer}}),y.o(be,"ImageLayer")&&y.d(C,{ImageLayer:function(){return be.ImageLayer}}),y.o(be,"LineLayer")&&y.d(C,{LineLayer:function(){return be.LineLayer}}),y.o(be,"Marker")&&y.d(C,{Marker:function(){return be.Marker}}),y.o(be,"PointLayer")&&y.d(C,{PointLayer:function(){return be.PointLayer}}),y.o(be,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return be.PolygonLayer}}),y.o(be,"Popup")&&y.d(C,{Popup:function(){return be.Popup}}),y.o(be,"RasterLayer")&&y.d(C,{RasterLayer:function(){return be.RasterLayer}}),y.o(be,"Scene")&&y.d(C,{Scene:function(){return be.Scene}}),y.o(be,"gl")&&y.d(C,{gl:function(){return be.gl}});var at=y(68116),kt=y.n(at);y.o(at,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return at.CityBuildingLayer}}),y.o(at,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return at.HeatmapLayer}}),y.o(at,"ImageLayer")&&y.d(C,{ImageLayer:function(){return at.ImageLayer}}),y.o(at,"LineLayer")&&y.d(C,{LineLayer:function(){return at.LineLayer}}),y.o(at,"Marker")&&y.d(C,{Marker:function(){return at.Marker}}),y.o(at,"PointLayer")&&y.d(C,{PointLayer:function(){return at.PointLayer}}),y.o(at,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return at.PolygonLayer}}),y.o(at,"Popup")&&y.d(C,{Popup:function(){return at.Popup}}),y.o(at,"RasterLayer")&&y.d(C,{RasterLayer:function(){return at.RasterLayer}}),y.o(at,"Scene")&&y.d(C,{Scene:function(){return at.Scene}}),y.o(at,"gl")&&y.d(C,{gl:function(){return at.gl}});var jt=y(23067),w=y.n(jt);y.o(jt,"CityBuildingLayer")&&y.d(C,{CityBuildingLayer:function(){return jt.CityBuildingLayer}}),y.o(jt,"HeatmapLayer")&&y.d(C,{HeatmapLayer:function(){return jt.HeatmapLayer}}),y.o(jt,"ImageLayer")&&y.d(C,{ImageLayer:function(){return jt.ImageLayer}}),y.o(jt,"LineLayer")&&y.d(C,{LineLayer:function(){return jt.LineLayer}}),y.o(jt,"Marker")&&y.d(C,{Marker:function(){return jt.Marker}}),y.o(jt,"PointLayer")&&y.d(C,{PointLayer:function(){return jt.PointLayer}}),y.o(jt,"PolygonLayer")&&y.d(C,{PolygonLayer:function(){return jt.PolygonLayer}}),y.o(jt,"Popup")&&y.d(C,{Popup:function(){return jt.Popup}}),y.o(jt,"RasterLayer")&&y.d(C,{RasterLayer:function(){return jt.RasterLayer}}),y.o(jt,"Scene")&&y.d(C,{Scene:function(){return jt.Scene}}),y.o(jt,"gl")&&y.d(C,{gl:function(){return jt.gl}});var F=y(7648)},85951:function(ft,C,y){"use strict";y.d(C,{e7:function(){return wc},Hp:function(){return ac},ZP:function(){return lf},yT:function(){return oo}});var G=y(28660),b=y(26729),p=y.n(b),S=y(86700),L=y(84879),X=y(72302),N=y(96156),q=y(6610),K=y(5991),ae=y(82887),xe=y(49296),se=y.n(xe);function Ft(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function zt(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?Ft(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):Ft(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function Wt(z,B){var M;if(typeof Symbol=="undefined"||z[Symbol.iterator]==null){if(Array.isArray(z)||(M=Mt(z))||B&&z&&typeof z.length=="number"){M&&(z=M);var O=0,J=function(){};return{s:J,n:function(){return O>=z.length?{done:!0}:{done:!1,value:z[O++]}},e:function(yr){throw yr},f:J}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var me=!0,qe=!1,Et;return{s:function(){M=z[Symbol.iterator]()},n:function(){var yr=M.next();return me=yr.done,yr},e:function(yr){qe=!0,Et=yr},f:function(){try{!me&&M.return!=null&&M.return()}finally{if(qe)throw Et}}}}function Mt(z,B){if(!!z){if(typeof z=="string")return wt(z,B);var M=Object.prototype.toString.call(z).slice(8,-1);if(M==="Object"&&z.constructor&&(M=z.constructor.name),M==="Map"||M==="Set")return Array.from(z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return wt(z,B)}}function wt(z,B){(B==null||B>z.length)&&(B=z.length);for(var M=0,O=new Array(B);M<B;M++)O[M]=z[M];return O}var ot=30;function tt(z){var B=z.characterSet,M=z.getFontWidth,O=z.fontHeight,J=z.buffer,me=z.maxCanvasWidth,qe=z.mapping,Et=qe===void 0?{}:qe,St=z.xOffset,yr=St===void 0?0:St,Br=z.yOffset,Mn=Br===void 0?0:Br,Bn=0,ci=yr;Array.from(B).forEach(function(Ci,va){if(!Et[Ci]){var Pi=M(Ci,va);ci+ot>me&&(ci=0,Bn++),Et[Ci]={x:ci,y:Mn+Bn*ot,width:ot,height:ot,advance:Pi},ci+=ot}});var Si=O+J*2;return{mapping:Et,xOffset:ci,yOffset:Mn+Bn*Si,canvasHeight:Ne(Mn+(Bn+1)*Si)}}function Yt(z,B,M){var O=0,J=0,me=0,qe=[],Et={},St=Wt(z),yr;try{for(St.s();!(yr=St.n()).done;){var Br=yr.value;if(!Et[Br.id]){var Mn=Br.size;O+Mn+B>M&&(ke(Et,qe,J),O=0,J=me+J+B,me=0,qe=[]),qe.push({icon:Br,xOffset:O}),O=O+Mn+B,me=Math.max(me,Mn)}}}catch(ci){St.e(ci)}finally{St.f()}qe.length>0&&ke(Et,qe,J);var Bn=Ne(me+J+B);return{mapping:Et,canvasHeight:Bn}}function ke(z,B,M){var O=Wt(B),J;try{for(O.s();!(J=O.n()).done;){var me=J.value,qe=me.icon,Et=me.xOffset;z[qe.id]=zt(zt({},qe),{},{x:Et,y:M,image:qe.image,width:qe.width,height:qe.height})}}catch(St){O.e(St)}finally{O.f()}}function Ne(z){return Math.pow(2,Math.ceil(Math.log2(z)))}var Be,Ie,pt;function oe(z,B){var M;if(typeof Symbol=="undefined"||z[Symbol.iterator]==null){if(Array.isArray(z)||(M=re(z))||B&&z&&typeof z.length=="number"){M&&(z=M);var O=0,J=function(){};return{s:J,n:function(){return O>=z.length?{done:!0}:{done:!1,value:z[O++]}},e:function(yr){throw yr},f:J}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var me=!0,qe=!1,Et;return{s:function(){M=z[Symbol.iterator]()},n:function(){var yr=M.next();return me=yr.done,yr},e:function(yr){qe=!0,Et=yr},f:function(){try{!me&&M.return!=null&&M.return()}finally{if(qe)throw Et}}}}function re(z,B){if(!!z){if(typeof z=="string")return ue(z,B);var M=Object.prototype.toString.call(z).slice(8,-1);if(M==="Object"&&z.constructor&&(M=z.constructor.name),M==="Map"||M==="Set")return Array.from(z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return ue(z,B)}}function ue(z,B){(B==null||B>z.length)&&(B=z.length);for(var M=0,O=new Array(B);M<B;M++)O[M]=z[M];return O}function it(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function Jt(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?it(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):it(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}var ce=ne(),$e="sans-serif",Ae="normal",Ce=24,Pe=3,et=.25,Se=8,Pt=1024,vr=1,_r=1,Yr=3,tr=null;function ne(){for(var z=[],B=32;B<128;B++)z.push(String.fromCharCode(B));return z}function be(z,B,M,O){z.font="".concat(O," ").concat(M,"px ").concat(B),z.fillStyle="black",z.textBaseline="middle"}function De(z,B){for(var M=0;M<z.length;M++)B.data[4*M+3]=z[M]}var at=(Be=(0,S.b2)(),Be(Ie=(pt=function(){function z(){(0,q.Z)(this,z),this.fontAtlas=void 0,this.iconFontMap=void 0,this.iconFontGlyphs={},this.fontOptions=void 0,this.key=void 0,this.cache=new ae.LRUCache(Yr)}return(0,K.Z)(z,[{key:"scale",get:function(){return _r}},{key:"canvas",get:function(){var M=this.cache.get(this.key);return M&&M.data}},{key:"mapping",get:function(){var M=this.cache.get(this.key);return M&&M.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:$e,fontWeight:Ae,characterSet:ce,fontSize:Ce,buffer:Pe,sdf:!0,cutoff:et,radius:Se,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(M){var O=this;M.forEach(function(J){O.iconFontGlyphs[J.name]=J.unicode})}},{key:"addIconFont",value:function(M,O){this.iconFontMap.set(M,O)}},{key:"getIconFontKey",value:function(M){return this.iconFontMap.get(M)||M}},{key:"getGlyph",value:function(M){return this.iconFontGlyphs[M]?String.fromCharCode(parseInt(this.iconFontGlyphs[M],16)):""}},{key:"setFontOptions",value:function(M){this.fontOptions=Jt(Jt({},this.fontOptions),M),this.key=this.getKey();var O=this.getNewChars(this.key,this.fontOptions.characterSet),J=this.cache.get(this.key);if(!(J&&O.length===0)){var me=this.generateFontAtlas(this.key,O,J);this.fontAtlas=me,this.cache.set(this.key,me)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(M,O,J){var me=this.fontOptions,qe=me.fontFamily,Et=me.fontWeight,St=me.fontSize,yr=me.buffer,Br=me.sdf,Mn=me.radius,Bn=me.cutoff,ci=me.iconfont,Si=J&&J.data;Si||(Si=document.createElement("canvas"),Si.width=Pt);var Ci=Si.getContext("2d");be(Ci,qe,St,Et);var va=tt(Jt({getFontWidth:function(Xs){return Ci.measureText(Xs).width},fontHeight:St*_r,buffer:yr,characterSet:O,maxCanvasWidth:Pt},J&&{mapping:J.mapping,xOffset:J.xOffset,yOffset:J.yOffset})),Pi=va.mapping,Ja=va.canvasHeight,Zo=va.xOffset,Vo=va.yOffset,ys=Ci.getImageData(0,0,Si.width,Si.height);if(Si.height=Ja,Ci.putImageData(ys,0,0),be(Ci,qe,St,Et),Br){var bo=new(se())(St,yr,Mn,Bn,qe,Et),Aa=Ci.getImageData(0,0,bo.size,bo.size),Ea=oe(O),Lo;try{for(Ea.s();!(Lo=Ea.n()).done;){var Qa=Lo.value;if(ci){var qa=String.fromCharCode(parseInt(Qa.replace("&#x","").replace(";",""),16)),Jo=bo.draw(qa);De(Jo,Aa)}else De(bo.draw(Qa),Aa);Ci.putImageData(Aa,Pi[Qa].x,Pi[Qa].y)}}catch(Cs){Ea.e(Cs)}finally{Ea.f()}}else{var ss=oe(O),Tc;try{for(ss.s();!(Tc=ss.n()).done;){var oc=Tc.value;Ci.fillText(oc,Pi[oc].x,Pi[oc].y+St*vr)}}catch(Cs){ss.e(Cs)}finally{ss.f()}}return{xOffset:Zo,yOffset:Vo,mapping:Pi,data:Si,width:Si.width,height:Si.height}}},{key:"getKey",value:function(){return"key";var M,O,J,me,qe,Et,St,yr}},{key:"getNewChars",value:function(M,O){var J=this.cache.get(M);if(!J)return O;var me=[],qe=J.mapping,Et=new Set(Object.keys(qe)),St=new Set(O);return St.forEach(function(yr){Et.has(yr)||me.push(yr)}),me}}]),z}(),pt))||Ie),kt=y(10379),jt=y(46070),w=y(77608),F,de,Ue;function Qe(z){var B=Tt();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function Tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Dt=3,H=1024,Qt=64,$t=(F=(0,S.b2)(),F(de=(Ue=function(z){(0,kt.Z)(M,z);var B=Qe(M);function M(){var O;(0,q.Z)(this,M);for(var J=arguments.length,me=new Array(J),qe=0;qe<J;qe++)me[qe]=arguments[qe];return O=B.call.apply(B,[this].concat(me)),O.canvasHeight=128,O.texture=void 0,O.canvas=void 0,O.iconData=void 0,O.iconMap=void 0,O.ctx=void 0,O.loadingImageCount=0,O}return(0,K.Z)(M,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(J,me){var qe=this,Et=new Image;if(this.loadingImageCount++,this.hasImage(J))throw new Error("Image Id already exists");this.iconData.push({id:J,size:Qt}),this.updateIconMap(),this.loadImage(me).then(function(St){Et=St;var yr=qe.iconData.find(function(Br){return Br.id===J});yr&&(yr.image=Et,yr.width=Et.width,yr.height=Et.height),qe.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(J){return this.iconMap.hasOwnProperty(J)}},{key:"removeImage",value:function(J){this.hasImage(J)&&(this.iconData=this.iconData.filter(function(me){return me.id!==J}),delete this.iconMap[J],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var J=this;this.canvas.width=H,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(me){var qe=J.iconMap[me],Et=qe.x,St=qe.y,yr=qe.image,Br=qe.width,Mn=Br===void 0?64:Br,Bn=qe.height,ci=Bn===void 0?64:Bn,Si=Math.max(Mn,ci),Ci=Si/Qt,va=ci/Ci,Pi=Mn/Ci;yr&&J.ctx.drawImage(yr,Et+(Qt-Pi)/2,St+(Qt-va)/2,Pi,va)})}},{key:"updateIconMap",value:function(){var J=Yt(this.iconData,Dt,H),me=J.mapping,qe=J.canvasHeight;this.iconMap=me,this.canvasHeight=qe}},{key:"loadImage",value:function(J){return new Promise(function(me,qe){if(J instanceof HTMLImageElement){me(J);return}var Et=new Image;Et.crossOrigin="anonymous",Et.onload=function(){me(Et)},Et.onerror=function(){qe(new Error("Could not load image at "+J))},Et.src=J instanceof File?URL.createObjectURL(J):J})}}]),M}(b.EventEmitter),Ue))||de),wr=y(28481),Tr=y(85975),Mr,Or,Je,At=(Mr=(0,S.b2)(),Mr(Or=(Je=function(){function z(){(0,q.Z)(this,z),this.viewport=void 0,this.overridedViewProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0,this.jitteredProjectionMatrix=void 0,this.viewMatrixInverse=void 0,this.cameraPosition=void 0}return(0,K.Z)(z,[{key:"init",value:function(){}},{key:"update",value:function(M){this.viewport=M,this.viewMatrixInverse=Tr.create(),Tr.invert(this.viewMatrixInverse,M.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var M=this.viewport.getCenter(),O=(0,wr.Z)(M,2),J=O[0],me=O[1];return[J,me]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(M,O){return this.viewport.projectFlat(M,O)}},{key:"setViewProjectionMatrix",value:function(M){this.overridedViewProjectionMatrix=M}},{key:"jitterProjectionMatrix",value:function(M,O){var J=Tr.fromTranslation(Tr.create(),[M,O,0]);this.jitteredProjectionMatrix=Tr.multiply(Tr.create(),J,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Tr.multiply(Tr.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),z}(),Je))||Or),_t,pr,en;function mt(z,B){var M;if(typeof Symbol=="undefined"||z[Symbol.iterator]==null){if(Array.isArray(z)||(M=Nt(z))||B&&z&&typeof z.length=="number"){M&&(z=M);var O=0,J=function(){};return{s:J,n:function(){return O>=z.length?{done:!0}:{done:!1,value:z[O++]}},e:function(yr){throw yr},f:J}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var me=!0,qe=!1,Et;return{s:function(){M=z[Symbol.iterator]()},n:function(){var yr=M.next();return me=yr.done,yr},e:function(yr){qe=!0,Et=yr},f:function(){try{!me&&M.return!=null&&M.return()}finally{if(qe)throw Et}}}}function Nt(z,B){if(!!z){if(typeof z=="string")return ar(z,B);var M=Object.prototype.toString.call(z).slice(8,-1);if(M==="Object"&&z.constructor&&(M=z.constructor.name),M==="Map"||M==="Set")return Array.from(z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return ar(z,B)}}function ar(z,B){(B==null||B>z.length)&&(B=z.length);for(var M=0,O=new Array(B);M<B;M++)O[M]=z[M];return O}var xr=(_t=(0,S.b2)(),_t(pr=(en=function(){function z(){(0,q.Z)(this,z),this.container=void 0,this.controlCorners=void 0,this.controlContainer=void 0,this.scene=void 0,this.mapsService=void 0,this.controls=[],this.unAddControls=[]}return(0,K.Z)(z,[{key:"init",value:function(M,O){this.container=M.container,this.scene=O,this.mapsService=O.get(X.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(M,O){var J=O.get(X.v.IMapService);J.map?(M.addTo(this.scene),this.controls.push(M)):this.unAddControls.push(M)}},{key:"getControlByName",value:function(M){return this.controls.find(function(O){return O.controlOption.name===M})}},{key:"removeControl",value:function(M){var O=this.controls.indexOf(M);return O>-1&&this.controls.splice(O,1),M.remove(),this}},{key:"addControls",value:function(){var M=this;this.unAddControls.forEach(function(O){O.addTo(M.scene),M.controls.push(O)}),this.unAddControls=[]}},{key:"destroy",value:function(){var M=mt(this.controls),O;try{for(M.s();!(O=M.n()).done;){var J=O.value;J.remove()}}catch(me){M.e(me)}finally{M.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var M=this.controlCorners={},O="l7-",J=this.controlContainer=ae.DOM.create("div",O+"control-container",this.container);function me(qe,Et){var St=O+qe+" "+O+Et;M[qe+Et]=ae.DOM.create("div",St,J)}me("top","left"),me("top","right"),me("bottom","left"),me("bottom","right")}},{key:"clearControlPos",value:function(){for(var M in this.controlCorners)this.controlCorners[M]&&ae.DOM.remove(this.controlCorners[M]);this.controlContainer&&ae.DOM.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),z}(),en))||pr),xn,In,Ei,Ai=(xn=(0,S.b2)(),xn(In=(Ei=function(){function z(){(0,q.Z)(this,z),this.container=void 0,this.scene=void 0,this.mapsService=void 0,this.markers=[],this.markerLayers=[],this.unAddMarkers=[],this.unAddMarkerLayers=[]}return(0,K.Z)(z,[{key:"addMarkerLayer",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(M),M.addTo(this.scene)):this.unAddMarkerLayers.push(M)}},{key:"removeMarkerLayer",value:function(M){M.destroy(),this.markerLayers.indexOf(M);var O=this.markerLayers.indexOf(M);O>-1&&this.markerLayers.splice(O,1)}},{key:"addMarker",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(M),M.addTo(this.scene)):this.unAddMarkers.push(M)}},{key:"addMarkers",value:function(){var M=this;this.unAddMarkers.forEach(function(O){O.addTo(M.scene),M.markers.push(O)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var M=this;this.unAddMarkerLayers.forEach(function(O){M.markerLayers.push(O),O.addTo(M.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(M){M.remove(),this.markers.indexOf(M);var O=this.markers.indexOf(M);O>-1&&this.markers.splice(O,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(X.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(M){M.remove()}),this.markers=[],this.markerLayers.forEach(function(M){M.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(M){M.destroy()}}]),z}(),Ei))||In),Bi,aa,hi,V=(Bi=(0,S.b2)(),Bi(aa=(hi=function(){function z(){(0,q.Z)(this,z),this.scene=void 0,this.popup=void 0,this.mapsService=void 0,this.unAddPopup=void 0}return(0,K.Z)(z,[{key:"removePopup",value:function(M){M.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(M){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(M.addTo(this.scene),this.popup=M):this.unAddPopup=M}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(X.v.IMapService)}}]),z}(),hi))||aa),te=y(82492),le=y.n(te),we={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},je=we,ht,xt,ge;function Ke(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function Ut(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?Ke(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):Ke(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}var Fr={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},jr={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Xt=(ht=(0,S.b2)(),ht(xt=(ge=function(){function z(){(0,q.Z)(this,z),this.sceneConfigCache={},this.layerConfigCache={}}return(0,K.Z)(z,[{key:"getSceneConfig",value:function(M){return this.sceneConfigCache[M]}},{key:"getSceneWarninfo",value:function(M){return je[M]}},{key:"setSceneConfig",value:function(M,O){this.sceneConfigCache[M]=Ut(Ut({},Fr),O)}},{key:"getLayerConfig",value:function(M){return this.layerConfigCache[M]}},{key:"setLayerConfig",value:function(M,O,J){this.layerConfigCache[O]=Ut({},le()({},this.sceneConfigCache[M],jr,J))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),z}(),ge))||xt),mr=y(55770),Hr=y(3473),gn=y(98333),gr=Math.PI/180,vn=512,$r=4003e4;function cn(z){var B=z.latitude,M=B===void 0?0:B,O=z.zoom,J=O===void 0?0:O,me=z.scale,qe=z.highPrecision,Et=qe===void 0?!1:qe,St=z.flipY,yr=St===void 0?!1:St;me=me!==void 0?me:Math.pow(2,J);var Br={},Mn=vn*me,Bn=Math.cos(M*gr),ci=Mn/360,Si=ci/Bn,Ci=Mn/$r/Bn;if(Br.pixelsPerMeter=[Ci,-Ci,Ci],Br.metersPerPixel=[1/Ci,-1/Ci,1/Ci],Br.pixelsPerDegree=[ci,-Si,Ci],Br.degreesPerPixel=[1/ci,-1/Si,1/Ci],Et){var va=gr*Math.tan(M*gr)/Bn,Pi=ci*va/2,Ja=Mn/$r*va,Zo=Ja/Si*Ci;Br.pixelsPerDegree2=[0,-Pi,Ja],Br.pixelsPerMeter2=[Zo,0,Zo],yr&&(Br.pixelsPerDegree2[1]=-Br.pixelsPerDegree2[1],Br.pixelsPerMeter2[1]=-Br.pixelsPerMeter2[1])}return yr&&(Br.pixelsPerMeter[1]=-Br.pixelsPerMeter[1],Br.metersPerPixel[1]=-Br.metersPerPixel[1],Br.pixelsPerDegree[1]=-Br.pixelsPerDegree[1],Br.degreesPerPixel[1]=-Br.degreesPerPixel[1]),Br}var pi=y(47282),fn,gi,Wi,vi,Ri,Ii,go=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ji=(fn=(0,S.b2)(),gi=(0,S.f3)(X.v.ICameraService),fn(Wi=(vi=(Ii=function(){function z(){(0,q.Z)(this,z),this.needRefresh=!0,(0,mr.Z)(this,"cameraService",Ri,this),this.coordinateSystem=void 0,this.viewportCenter=void 0,this.viewportCenterProjection=void 0,this.pixelsPerDegree=void 0,this.pixelsPerDegree2=void 0,this.pixelsPerMeter=void 0}return(0,K.Z)(z,[{key:"refresh",value:function(){var M=this.cameraService.getZoom(),O=this.cameraService.getZoomScale(),J=this.cameraService.getCenter(),me=cn({latitude:J[1],zoom:M}),qe=me.pixelsPerMeter,Et=me.pixelsPerDegree;this.viewportCenter=J,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=qe,this.pixelsPerDegree=Et,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===pi.l.LNGLAT||this.coordinateSystem===pi.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===pi.l.LNGLAT_OFFSET?this.calculateLnglatOffset(J,M):this.coordinateSystem===pi.l.P20_OFFSET&&this.calculateLnglatOffset(J,M,O,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(M){this.coordinateSystem=M}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(M,O,J,me){var qe=cn({latitude:M[1],zoom:O,scale:J,flipY:me,highPrecision:!0}),Et=qe.pixelsPerMeter,St=qe.pixelsPerDegree,yr=qe.pixelsPerDegree2,Br=this.cameraService.getViewMatrix(),Mn=this.cameraService.getProjectionMatrix(),Bn=Tr.multiply([],Mn,Br),ci=this.cameraService.projectFlat([Math.fround(M[0]),Math.fround(M[1])],Math.pow(2,O));this.viewportCenterProjection=gn.fF([],[ci[0],ci[1],0,1],Bn),Br=this.cameraService.getViewMatrixUncentered()||Br,Bn=Tr.multiply([],Mn,Br),Bn=Tr.multiply([],Bn,go),this.cameraService.setViewProjectionMatrix(Bn),this.pixelsPerMeter=Et,this.pixelsPerDegree=St,this.pixelsPerDegree2=yr}}]),z}(),Ii),Ri=(0,Hr.Z)(vi.prototype,"cameraService",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vi))||Wi),Rn=y(63349),Dn=y(50840),ui=y.n(Dn),Vn=y(89648),za,ds,Di,Na,Eu,fu,ya,lo;function Ga(z){var B=Ha();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function Ha(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Xo={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancle"},oa=(za=(0,S.b2)(),ds=(0,S.f3)(X.v.IMapService),Di=(0,S.f3)(X.v.ILogService),za(Na=(Eu=(lo=function(z){(0,kt.Z)(M,z);var B=Ga(M);function M(){var O;(0,q.Z)(this,M);for(var J=arguments.length,me=new Array(J),qe=0;qe<J;qe++)me[qe]=arguments[qe];return O=B.call.apply(B,[this].concat(me)),(0,mr.Z)(O,"mapService",fu,(0,Rn.Z)(O)),(0,mr.Z)(O,"logger",ya,(0,Rn.Z)(O)),O.hammertime=void 0,O.lastClickTime=0,O.lastClickXY=[-1,-1],O.clickTimer=void 0,O.$containter=void 0,O.onDrag=function(Et){var St=O.interactionEvent(Et);St.type=Xo[St.type],O.emit(Vn.s.Drag,St)},O.onHammer=function(Et){Et.srcEvent.stopPropagation();var St=O.interactionEvent(Et);O.emit(Vn.s.Hover,St)},O.onTouch=function(Et){var St=Et.touches[0];O.onHover({x:St.pageX,y:St.pageY,type:"touch"})},O.onHover=function(Et){var St=Et.clientX,yr=Et.clientY,Br=St,Mn=yr,Bn=Et.type,ci=O.mapService.getMapContainer();if(ci){var Si=ci.getBoundingClientRect(),Ci=Si.top,va=Si.left;Br=Br-va-ci.clientLeft,Mn=Mn-Ci-ci.clientTop}var Pi=O.mapService.containerToLngLat([Br,Mn]);if(Bn==="click"){if("ontouchstart"in document.documentElement)return;O.isDoubleTap(Br,Mn,Pi);return}if(Bn==="touch"){O.isDoubleTap(Br,Mn,Pi);return}Bn!=="click"&&Bn!=="dblclick"&&O.emit(Vn.s.Hover,{x:Br,y:Mn,lngLat:Pi,type:Bn,target:Et})},O}return(0,K.Z)(M,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Vn.s.Hover)}},{key:"triggerHover",value:function(J){var me=J.x,qe=J.y;this.emit(Vn.s.Hover,{x:me,y:qe})}},{key:"triggerSelect",value:function(J){this.emit(Vn.s.Select,{featureId:J})}},{key:"triggerActive",value:function(J){this.emit(Vn.s.Active,{featureId:J})}},{key:"addEventListenerOnMap",value:function(){var J=this.mapService.getMapContainer();if(J){var me=new(ui()).Manager(J);me.add(new(ui()).Tap({event:"dblclick",taps:2})),me.add(new(ui()).Tap({event:"click"})),me.add(new(ui()).Pan({threshold:0,pointers:0})),me.add(new(ui()).Press({})),me.on("dblclick click",this.onHammer),me.on("panstart panmove panend pancancel",this.onDrag),J.addEventListener("mousemove",this.onHover),J.addEventListener("mousedown",this.onHover,!0),J.addEventListener("mouseup",this.onHover),J.addEventListener("contextmenu",this.onHover),this.hammertime=me,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var J=this.mapService.getMapContainer();J&&(J.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),J.removeEventListener("mousedown",this.onHover),J.removeEventListener("mouseup",this.onHover),J.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(J){var me=J.type,qe=J.pointerType,Et,St;qe==="touch"?(St=Math.floor(J.pointers[0].clientY),Et=Math.floor(J.pointers[0].clientX)):(St=Math.floor(J.srcEvent.y),Et=Math.floor(J.srcEvent.x));var yr=this.mapService.getMapContainer();if(yr){var Br=yr.getBoundingClientRect(),Mn=Br.top,Bn=Br.left;Et-=Bn,St-=Mn}var ci=this.mapService.containerToLngLat([Et,St]);return{x:Et,y:St,lngLat:ci,type:me,target:J.srcEvent}}},{key:"isDoubleTap",value:function(J,me,qe){var Et=this,St=new Date().getTime(),yr="click";St-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-J)<10&&Math.abs(this.lastClickXY[1]-me)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),yr="dblclick",this.emit(Vn.s.Hover,{x:J,y:me,lngLat:qe,type:yr})):(this.lastClickTime=St,this.lastClickXY=[J,me],this.clickTimer=setTimeout(function(){yr="click",Et.emit(Vn.s.Hover,{x:J,y:me,lngLat:qe,type:yr})},400))}}]),M}(p()),lo),fu=(0,Hr.Z)(Eu.prototype,"mapService",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya=(0,Hr.Z)(Eu.prototype,"logger",[Di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eu))||Na),Wa=y(92137),wa=y(87757),_a=y.n(wa),ra=y(7648),sl,ts,to,Oa,fa,he,Oe,gt,fr,tn,kn,Zi;function Xi(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function Xa(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?Xi(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):Xi(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}var Ya=(sl=(0,S.b2)(),ts=(0,S.f3)(X.v.IRendererService),to=(0,S.f3)(X.v.IGlobalConfigService),Oa=(0,S.f3)(X.v.IInteractionService),fa=(0,S.f3)(X.v.ILayerService),sl(he=(Oe=(Zi=function(){function z(){var B=this;(0,q.Z)(this,z),(0,mr.Z)(this,"rendererService",gt,this),(0,mr.Z)(this,"configService",fr,this),(0,mr.Z)(this,"interactionService",tn,this),(0,mr.Z)(this,"layerService",kn,this),this.pickingFBO=void 0,this.width=0,this.height=0,this.alreadyInPicking=!1,this.pickBufferScale=1,this.pickFromPickingFBO=function(M,O){var J,me=O.x,qe=O.y,Et=O.lngLat,St=O.type,yr=O.target,Br=!1,Mn=B.rendererService,Bn=Mn.getViewportSize,ci=Mn.readPixels,Si=Mn.getContainer,Ci=Si().getBoundingClientRect(),va=Ci.width,Pi=Ci.height;va*=ae.DOM.DPR,Pi*=ae.DOM.DPR;var Ja=M.getLayerConfig(),Zo=Ja.enableHighlight,Vo=Ja.enableSelect,ys=me*ae.DOM.DPR,bo=qe*ae.DOM.DPR;if(ys>va-1*ae.DOM.DPR||ys<0||bo>Pi-1*ae.DOM.DPR||bo<0)return!1;var Aa;if(Aa=ci({x:Math.floor(ys/B.pickBufferScale),y:Math.floor((Pi-(qe+1)*ae.DOM.DPR)/B.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:B.pickingFBO}),Aa[0]!==0||Aa[1]!==0||Aa[2]!==0){var Ea=(0,ae.decodePickingColor)(Aa),Lo=M.getSource().getFeatureById(Ea);Ea!==M.getCurrentPickId()&&St==="mousemove"&&(St="mouseenter");var Qa={x:me,y:qe,type:St,lngLat:Et,featureId:Ea,feature:Lo,target:yr};Lo&&(Br=!0,M.setCurrentPickId(Ea),B.triggerHoverOnLayer(M,Qa))}else{var qa={x:me,y:qe,lngLat:Et,type:M.getCurrentPickId()!==null&&St==="mousemove"?"mouseout":"un"+St,featureId:null,target:yr,feature:null};B.triggerHoverOnLayer(M,Xa(Xa({},qa),{},{type:"unpick"})),B.triggerHoverOnLayer(M,qa),M.setCurrentPickId(null)}if(Zo&&B.highlightPickedFeature(M,Aa),Vo&&St==="click"&&((J=Aa)===null||J===void 0?void 0:J.toString())!==[0,0,0,0].toString()){var Jo=(0,ae.decodePickingColor)(Aa);M.getCurrentSelectedId()===null||Jo!==M.getCurrentSelectedId()?(B.selectFeature(M,Aa),M.setCurrentSelectedId(Jo)):(B.selectFeature(M,new Uint8Array([0,0,0,0])),M.setCurrentSelectedId(null))}return Br}}return(0,K.Z)(z,[{key:"init",value:function(M){var O=this.rendererService,J=O.createTexture2D,me=O.createFramebuffer,qe=O.getViewportSize,Et=O.getContainer,St=Et().getBoundingClientRect(),yr=St.width,Br=St.height;yr*=ae.DOM.DPR,Br*=ae.DOM.DPR,this.pickBufferScale=this.configService.getSceneConfig(M).pickBufferScale||1,this.pickingFBO=me({color:J({width:Math.round(yr/this.pickBufferScale),height:Math.round(Br/this.pickBufferScale),wrapS:ra.gl.CLAMP_TO_EDGE,wrapT:ra.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Vn.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var B=(0,Wa.Z)(_a().mark(function O(J,me,qe){var Et=this,St,yr,Br,Mn;return _a().wrap(function(ci){for(;;)switch(ci.prev=ci.next){case 0:St=this.rendererService,yr=St.useFramebuffer,Br=St.clear,Mn=St.getContainer,this.resizePickingFBO(),yr(this.pickingFBO,function(){Br({framebuffer:Et.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),J.hooks.beforePickingEncode.call(),J.renderModels(),J.hooks.afterPickingEncode.call();var Si=Et.pickBox(J,me);qe(Si)});case 3:case"end":return ci.stop()}},O,this)}));function M(O,J,me){return B.apply(this,arguments)}return M}()},{key:"pickBox",value:function(M,O){var J=this,me=O.map(function(qa){var Jo=qa<0?0:qa;return Math.floor(Jo*ae.DOM.DPR/J.pickBufferScale)}),qe=(0,wr.Z)(me,4),Et=qe[0],St=qe[1],yr=qe[2],Br=qe[3],Mn=this.rendererService,Bn=Mn.getViewportSize,ci=Mn.readPixels,Si=Mn.getContainer,Ci=Si().getBoundingClientRect(),va=Ci.width,Pi=Ci.height;if(va*=ae.DOM.DPR,Pi*=ae.DOM.DPR,Et>(va-1)*ae.DOM.DPR/this.pickBufferScale||yr<0||St>(Pi-1)*ae.DOM.DPR/this.pickBufferScale||Br<0)return[];var Ja,Zo=Math.min(va/this.pickBufferScale,yr)-Et,Vo=Math.min(Pi/this.pickBufferScale,Br)-St;Ja=ci({x:Et,y:Math.floor(Pi/this.pickBufferScale-(Br+1)),width:Zo,height:Vo,data:new Uint8Array(Zo*Vo*4),framebuffer:this.pickingFBO});for(var ys=[],bo={},Aa=0;Aa<Ja.length/4;Aa=Aa+1){var Ea=Ja.slice(Aa*4,Aa*4+4),Lo=(0,ae.decodePickingColor)(Ea);if(Lo!==-1&&!bo[Lo]){var Qa=M.getSource().getFeatureById(Lo);ys.push(Qa),bo[Lo]=!0}}return ys}},{key:"pickingAllLayer",value:function(){var B=(0,Wa.Z)(_a().mark(function O(J){return _a().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){qe.next=2;break}return qe.abrupt("return");case 2:return this.alreadyInPicking=!0,qe.next=5,this.pickingLayers(J);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return qe.stop()}},O,this)}));function M(O){return B.apply(this,arguments)}return M}()},{key:"resizePickingFBO",value:function(){var M=this.rendererService.getContainer,O=M().getBoundingClientRect(),J=O.width,me=O.height;J*=ae.DOM.DPR,me*=ae.DOM.DPR,(this.width!==J||this.height!==me)&&(this.pickingFBO.resize({width:Math.round(J/this.pickBufferScale),height:Math.round(me/this.pickBufferScale)}),this.width=J,this.height=me)}},{key:"pickingLayers",value:function(){var B=(0,Wa.Z)(_a().mark(function O(J){var me=this,qe,Et,St,yr,Br;return _a().wrap(function(Bn){for(;;)switch(Bn.prev=Bn.next){case 0:qe=this.rendererService,Et=qe.getViewportSize,St=qe.useFramebuffer,yr=qe.clear,Br=qe.getContainer,this.resizePickingFBO(),St(this.pickingFBO,function(){var ci=me.layerService.getLayers();ci.filter(function(Si){return Si.needPick(J.type)}).reverse().some(function(Si){yr({framebuffer:me.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Si.hooks.beforePickingEncode.call(),Si.renderModels(),Si.hooks.afterPickingEncode.call();var Ci=me.pickFromPickingFBO(Si,J);return Ci&&!Si.getLayerConfig().enablePropagation})});case 3:case"end":return Bn.stop()}},O,this)}));function M(O){return B.apply(this,arguments)}return M}()},{key:"triggerHoverOnLayer",value:function(M,O){M.emit(O.type,O)}},{key:"isEventCrash",value:function(M){var O=!0;return M.target.path.map(function(J){J.classList&&J.classList.forEach(function(me){(me==="l7-marker"||me==="l7-popup")&&(O=!1)})}),O}},{key:"highlightPickedFeature",value:function(M,O){var J=(0,wr.Z)(O,3),me=J[0],qe=J[1],Et=J[2];M.hooks.beforeHighlight.call([me,qe,Et])}},{key:"selectFeature",value:function(M,O){var J=(0,wr.Z)(O,3),me=J[0],qe=J[1],Et=J[2];M.hooks.beforeSelect.call([me,qe,Et])}}]),z}(),Zi),gt=(0,Hr.Z)(Oe.prototype,"rendererService",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fr=(0,Hr.Z)(Oe.prototype,"configService",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=(0,Hr.Z)(Oe.prototype,"interactionService",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn=(0,Hr.Z)(Oe.prototype,"layerService",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oe))||he),Yo=function(){function z(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,q.Z)(this,z),this.autoStart=void 0,this.startTime=0,this.oldTime=0,this.running=!1,this.elapsedTime=0,this.autoStart=B}return(0,K.Z)(z,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var M=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var O=(typeof performance=="undefined"?Date:performance).now();M=(O-this.oldTime)/1e3,this.oldTime=O,this.elapsedTime+=M}return M}}]),z}(),Ss,Hl,Xu,ko,Ls,co,Rs,La,li=(Ss=(0,S.b2)(),Hl=(0,S.f3)(X.v.IRendererService),Xu=(0,S.f3)(X.v.IGlobalConfigService),Ss(ko=(Ls=(La=function(){function z(){(0,q.Z)(this,z),this.clock=new Yo,this.alreadyInRendering=!1,this.layers=[],this.layerRenderID=void 0,this.sceneInited=!1,this.animateInstanceCount=0,(0,mr.Z)(this,"renderService",co,this),(0,mr.Z)(this,"configService",Rs,this)}return(0,K.Z)(z,[{key:"add",value:function(M){this.sceneInited&&M.init(),this.layers.push(M)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(M){M.inited||M.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(M){return this.layers.find(function(O){return O.id===M})}},{key:"getLayerByName",value:function(M){return this.layers.find(function(O){return O.name===M})}},{key:"remove",value:function(M){var O=this.layers.indexOf(M);O>-1&&this.layers.splice(O,1),M.emit("remove",null),M.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(M){return M.inited}).filter(function(M){return M.isVisible()}).forEach(function(M){M.hooks.beforeRenderData.call(),M.hooks.beforeRender.call(),M.render(),M.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(M,O){return M.zIndex-O.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(M){return M.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),z}(),La),co=(0,Hr.Z)(Ls.prototype,"renderService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rs=(0,Hr.Z)(Ls.prototype,"configService",[Xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ls))||ko),ul=y(81253),xa=y(85061),Nn=y(14293),Ys=y.n(Nn),Wl=function(){function z(B){var M=this;(0,q.Z)(this,z),this.name=void 0,this.type=void 0,this.scale=void 0,this.descriptor=void 0,this.featureBufferLayout=[],this.needRescale=!1,this.needRemapping=!1,this.needRegenerateVertices=!1,this.featureRange={startIndex:0,endIndex:Infinity},this.vertexAttribute=void 0,this.defaultCallback=function(O){if(O.length===0){var J;return((J=M.scale)===null||J===void 0?void 0:J.defaultValues)||[]}return O.map(function(me,qe){var Et,St=(Et=M.scale)===null||Et===void 0?void 0:Et.scalers[qe].func,yr=St(me);return yr})},this.setProps(B)}return(0,K.Z)(z,[{key:"setProps",value:function(M){Object.assign(this,M)}},{key:"mapping",value:function(M){var O;if((O=this.scale)!==null&&O!==void 0&&O.callback){var J,me=(J=this.scale)===null||J===void 0?void 0:J.callback.apply(J,(0,xa.Z)(M));if(!Ys()(me))return[me]}return this.defaultCallback(M)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),z}(),fo,Ze,Ot,br,On,Hi,ba;function Za(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function na(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?Za(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):Za(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function Ra(z){return new Promise(function(B){return setTimeout(B,z)})}var Fo=(fo={},(0,N.Z)(fo,ra.gl.FLOAT,4),(0,N.Z)(fo,ra.gl.UNSIGNED_BYTE,1),(0,N.Z)(fo,ra.gl.UNSIGNED_SHORT,2),fo),Mo=(Ze=(0,S.b2)(),Ot=(0,S.f3)(X.v.IRendererService),Ze(br=(On=(ba=function(){function z(){(0,q.Z)(this,z),this.attributesAndIndices=void 0,(0,mr.Z)(this,"rendererService",Hi,this),this.attributes=[],this.triangulation=void 0,this.featureLayout={sizePerElement:0,elements:[]}}return(0,K.Z)(z,[{key:"registerStyleAttribute",value:function(M){var O=this.getLayerStyleAttribute(M.name||"");return O?O.setProps(M):(O=new Wl(M),this.attributes.push(O)),O}},{key:"updateStyleAttribute",value:function(M,O,J){var me=this.getLayerStyleAttribute(M);me||(me=this.registerStyleAttribute(na(na({},O),{},{name:M})));var qe=O.scale;qe&&me&&(me.scale=qe,me.needRescale=!0,me.needRemapping=!0,me.needRegenerateVertices=!0,J&&J.featureRange&&(me.featureRange=J.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(M){return this.attributes.find(function(O){return O.name===M})}},{key:"getLayerAttributeScale",value:function(M){var O,J=this.getLayerStyleAttribute(M),me=J==null||(O=J.scale)===null||O===void 0?void 0:O.scalers;return me&&me[0]?me[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(M,O){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,me=arguments.length>3?arguments[3]:void 0,qe=this.attributes.find(function(Vo){return Vo.name===M});if(qe&&qe.descriptor){var Et=qe.descriptor,St=Et.update,yr=Et.buffer,Br=Et.size,Mn=Br===void 0?0:Br,Bn=Fo[yr.type||ra.gl.FLOAT];if(St){var ci=this.featureLayout,Si=ci.elements,Ci=ci.sizePerElement,va=Si.slice(J,me);if(!va.length)return;var Pi=va[0].offset,Ja=Pi*Mn*Bn,Zo=va.map(function(Vo,ys){for(var bo=Vo.featureIdx,Aa=Vo.vertices,Ea=Vo.normals,Lo=Aa.length/Ci,Qa=[],qa=0;qa<Lo;qa++){var Jo=Ea?Ea.slice(qa*3,qa*3+3):[];Qa.push.apply(Qa,(0,xa.Z)(St(O[bo],bo,Aa.slice(qa*Ci,qa*Ci+Ci),ys,Jo)))}return Qa}).reduce(function(Vo,ys){return Vo.push.apply(Vo,(0,xa.Z)(ys)),Vo},[]);qe.vertexAttribute.updateBuffer({data:Zo,offset:Ja})}}}},{key:"createAttributesAndIndices",value:function(M,O){var J=this;this.featureLayout={sizePerElement:0,elements:[]},O&&(this.triangulation=O);var me=this.attributes.map(function(Pi){return Pi.resetDescriptor(),Pi.descriptor}),qe=0,Et=[],St=[],yr=[],Br=3;M.forEach(function(Pi,Ja){var Zo=J.triangulation(Pi),Vo=Zo.indices,ys=Zo.vertices,bo=Zo.normals,Aa=Zo.size;Vo.forEach(function(qa){St.push(qa+qe)}),Br=Aa;var Ea=ys.length/Aa;J.featureLayout.sizePerElement=Br,J.featureLayout.elements.push({featureIdx:Ja,vertices:ys,normals:bo,offset:qe}),qe+=Ea;for(var Lo=function(Jo){var ss=(bo==null?void 0:bo.slice(Jo*3,Jo*3+3))||[],Tc=ys.slice(Jo*Aa,Jo*Aa+Aa);me.forEach(function(oc,Cs){if(oc&&oc.update){var Xs;(Xs=oc.buffer.data).push.apply(Xs,(0,xa.Z)(oc.update(Pi,Ja,Tc,Jo,ss)))}})},Qa=0;Qa<Ea;Qa++)Lo(Qa)});var Mn=this.rendererService,Bn=Mn.createAttribute,ci=Mn.createBuffer,Si=Mn.createElements,Ci={};me.forEach(function(Pi,Ja){if(Pi){var Zo=Pi.buffer,Vo=Pi.update,ys=Pi.name,bo=(0,ul.Z)(Pi,["buffer","update","name"]),Aa=Bn(na({buffer:ci(Zo)},bo));Ci[Pi.name||""]=Aa,J.attributes[Ja].vertexAttribute=Aa}});var va=Si({data:St,type:ra.gl.UNSIGNED_INT,count:St.length});return this.attributesAndIndices={attributes:Ci,elements:va},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var M;this.attributes.forEach(function(O){O.vertexAttribute&&O.vertexAttribute.destroy()}),(M=this.attributesAndIndices)===null||M===void 0||M.elements.destroy(),this.attributes=[]}}]),z}(),ba),Hi=(0,Hr.Z)(On.prototype,"rendererService",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On))||br),yi=y(90484),Yu=y(34155);function hu(z){if(typeof window!="undefined"&&(0,yi.Z)(window.process)==="object"&&window.process.type==="renderer"||typeof Yu!="undefined"&&(0,yi.Z)(Yu.versions)==="object"&&Boolean(Yu.versions.electron))return!0;var B=(typeof navigator=="undefined"?"undefined":(0,yi.Z)(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,M=z||B;return!!(M&&M.indexOf("Electron")>=0)}var Ko=y(34155);function ll(){var z=(typeof Ko=="undefined"?"undefined":(0,yi.Z)(Ko))==="object"&&String(Ko)==="[object process]"&&!Ko.browser;return!z||hu()}function Eo(){return ll()&&typeof document!="undefined"}var Es=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source",Io=ll();function pu(z){try{var B=window[z],M="__storage_test__";return B.setItem(M,M),B.removeItem(M),B}catch(O){return null}}var Ds=function(){function z(B,M){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";(0,q.Z)(this,z),this.storage=pu(O),this.id=B,this.config={},Object.assign(this.config,M),this._loadConfiguration()}return(0,K.Z)(z,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(M){return this.config={},this.updateConfiguration(M)}},{key:"updateConfiguration",value:function(M){if(Object.assign(this.config,M),this.storage){var O=JSON.stringify(this.config);this.storage.setItem(this.id,O)}return this}},{key:"_loadConfiguration",value:function(){var M={};if(this.storage){var O=this.storage.getItem(this.id);M=O?JSON.parse(O):{}}return Object.assign(this.config,M),this}}]),z}();function lc(z){var B;return z<10?B="".concat(z.toFixed(2),"ms"):z<100?B="".concat(z.toFixed(1),"ms"):z<1e3?B="".concat(z.toFixed(0),"ms"):B="".concat((z/1e3).toFixed(2),"s"),B}function qc(z){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,M=Math.max(B-z.length,0);return"".concat(" ".repeat(M)).concat(z)}function Ta(z){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,M=Math.max(B-z.length,0);return"".concat(z).concat(" ".repeat(M))}function bf(z){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=1e-16,O=B.isInteger,J=O===void 0?!1:O;if(Array.isArray(z)||ArrayBuffer.isView(z))return ku(z,B);if(!Number.isFinite(z))return String(z);if(Math.abs(z)<M)return J?"0":"0.";if(J||Math.abs(z)>100&&Math.abs(z)<1e4)return z.toFixed(0);var me=z.toPrecision(2),qe=me.indexOf(".0");return qe===me.length-2?me.slice(0,-1):me}function ku(z,B){for(var M=B.maxElts,O=M===void 0?16:M,J=B.size,me=J===void 0?1:J,qe="[",Et=0;Et<z.length&&Et<O;++Et)Et>0&&(qe+=",".concat(Et%me==0?" ":"")),qe+=bf(z[Et],B);var St=z.length>O?"...":"]";return"".concat(qe).concat(St)}function Cl(z,B,M){var O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,J=z.src.replace(/\(/g,"%28").replace(/\)/g,"%29");z.width>O&&(M=Math.min(M,O/z.width));var me=z.width*M,qe=z.height*M,Et=["font-size:1px;","padding:".concat(Math.floor(qe/2),"px ").concat(Math.floor(me/2),"px;"),"line-height:".concat(qe,"px;"),"background:url(".concat(J,");"),"background-size:".concat(me,"px ").concat(qe,"px;"),"color:transparent;"].join("");return["".concat(B," %c+"),Et]}var Lc={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function cc(z){return typeof z=="string"?Lc[z.toUpperCase()]||Lc.WHITE:z}function ro(z,B,M){return!Io&&typeof z=="string"&&(B&&(B=cc(B),z="[".concat(B,"m").concat(z,"[39m")),M&&(B=cc(M),z="[".concat(M+10,"m").concat(z,"[49m"))),z}function cl(z){if(typeof Symbol=="undefined"||z[Symbol.iterator]==null){if(Array.isArray(z)||(z=fl(z))){var B=0,M=function(){};return{s:M,n:function(){return B>=z.length?{done:!0}:{done:!1,value:z[B++]}},e:function(St){throw St},f:M}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var O,J=!0,me=!1,qe;return{s:function(){O=z[Symbol.iterator]()},n:function(){var St=O.next();return J=St.done,St},e:function(St){me=!0,qe=St},f:function(){try{!J&&O.return!=null&&O.return()}finally{if(me)throw qe}}}}function fl(z,B){if(!!z){if(typeof z=="string")return rs(z,B);var M=Object.prototype.toString.call(z).slice(8,-1);if(M==="Object"&&z.constructor&&(M=z.constructor.name),M==="Map"||M==="Set")return Array.from(M);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return rs(z,B)}}function rs(z,B){(B==null||B>z.length)&&(B=z.length);for(var M=0,O=new Array(B);M<B;M++)O[M]=z[M];return O}function fc(z){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],M=Object.getPrototypeOf(z),O=Object.getOwnPropertyNames(M),J=cl(O),me;try{var qe=function(){var St=me.value;typeof z[St]=="function"&&(B.find(function(yr){return St===yr})||(z[St]=z[St].bind(z)))};for(J.s();!(me=J.n()).done;)qe()}catch(Et){J.e(Et)}finally{J.f()}}function Ku(z,B){if(!z)throw new Error(B||"Assertion failed")}var Ks=y(34155),$o={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof y.g!="undefined"&&y.g,document:typeof document!="undefined"&&document,process:(typeof Ks=="undefined"?"undefined":(0,yi.Z)(Ks))==="object"&&Ks},Rc=$o.self||$o.window||$o.global,wu=$o.window||$o.self||$o.global,$u=$o.global||$o.self||$o.window,Df=$o.document||{},hl=$o.process||{},Sa=console;function Ju(){var z;if(Io&&wu.performance)z=wu.performance.now();else if(hl.hrtime){var B=hl.hrtime();z=B[0]*1e3+B[1]/1e6}else z=Date.now();return z}var Xl={debug:Io&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Yl={enabled:!0,level:0};function $s(){}var Dc={},Kl={once:!0};function $l(z){for(var B in z)for(var M in z[B])return M||"untitled";return"empty"}var Qu=function(){function z(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=B.id;(0,q.Z)(this,z),this.id=M,this.VERSION=Es,this._startTs=Ju(),this._deltaTs=Ju(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new Ds("__probe-".concat(this.id,"__"),Yl),this.userData={},this.timeStamp("".concat(this.id," started")),fc(this),Object.seal(this)}return(0,K.Z)(z,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((Ju()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((Ju()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:M}),this}},{key:"setLevel",value:function(M){return this._storage.updateConfiguration({level:M}),this}},{key:"assert",value:function(M,O){Ku(M,O)}},{key:"warn",value:function(M){return this._getLogFunction(0,M,Xl.warn,arguments,Kl)}},{key:"error",value:function(M){return this._getLogFunction(0,M,Xl.error,arguments)}},{key:"deprecated",value:function(M,O){return this.warn("`".concat(M,"` is deprecated and will be removed in a later version. Use `").concat(O,"` instead"))}},{key:"removed",value:function(M,O){return this.error("`".concat(M,"` has been removed. Use `").concat(O,"` instead"))}},{key:"probe",value:function(M,O){return this._getLogFunction(M,O,Xl.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(M,O){return this._getLogFunction(M,O,Xl.debug,arguments)}},{key:"info",value:function(M,O){return this._getLogFunction(M,O,console.info,arguments)}},{key:"once",value:function(M,O){return this._getLogFunction(M,O,Xl.debug||Xl.info,arguments,Kl)}},{key:"table",value:function(M,O,J){return O?this._getLogFunction(M,O,console.table||$s,J&&[J],{tag:$l(O)}):$s}},{key:"image",value:function(M){var O=M.logLevel,J=M.priority,me=M.image,qe=M.message,Et=qe===void 0?"":qe,St=M.scale,yr=St===void 0?1:St;return this._shouldLog(O||J)?Io?kc({image:me,message:Et,scale:yr}):pl({image:me,message:Et,scale:yr}):$s}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(M){return this._storage.config[M]}},{key:"set",value:function(M,O){this._storage.updateConfiguration((0,N.Z)({},M,O))}},{key:"time",value:function(M,O){return this._getLogFunction(M,O,console.time?console.time:console.info)}},{key:"timeEnd",value:function(M,O){return this._getLogFunction(M,O,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(M,O){return this._getLogFunction(M,O,console.timeStamp||$s)}},{key:"group",value:function(M,O){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};J=Pl({logLevel:M,message:O,opts:J});var me=J,qe=me.collapsed;return J.method=(qe?console.groupCollapsed:console.group)||console.info,this._getLogFunction(J)}},{key:"groupCollapsed",value:function(M,O){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(M,O,Object.assign({},J,{collapsed:!0}))}},{key:"groupEnd",value:function(M){return this._getLogFunction(M,"",console.groupEnd||$s)}},{key:"withGroup",value:function(M,O,J){this.group(M,O)();try{J()}finally{this.groupEnd(M)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(M){return this.isEnabled()&&this.getLevel()>=Tu(M)}},{key:"_getLogFunction",value:function(M,O,J){var me=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],qe=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(M)){var Et;qe=Pl({logLevel:M,message:O,args:me,opts:qe}),J=J||qe.method,Ku(J),qe.total=this.getTotal(),qe.delta=this.getDelta(),this._deltaTs=Ju();var St=qe.tag||qe.message;if(qe.once)if(!Dc[St])Dc[St]=Ju();else return $s;return O=Ml(this.id,qe.message,qe),(Et=J).bind.apply(Et,[console,O].concat((0,xa.Z)(qe.args)))}return $s}},{key:"level",set:function(M){this.setLevel(M)},get:function(){return this.getLevel()}},{key:"priority",set:function(M){this.level=M},get:function(){return this.level}}]),z}();Qu.VERSION=Es;function Tu(z){if(!z)return 0;var B;switch((0,yi.Z)(z)){case"number":B=z;break;case"object":B=z.logLevel||z.priority||0;break;default:return 0}return Ku(Number.isFinite(B)&&B>=0),B}function Pl(z){var B=z.logLevel,M=z.message;z.logLevel=Tu(B);for(var O=z.args?Array.from(z.args):[];O.length&&O.shift()!==M;);switch(z.args=O,(0,yi.Z)(B)){case"string":case"function":M!==void 0&&O.unshift(M),z.message=B;break;case"object":Object.assign(z,B);break;default:}typeof z.message=="function"&&(z.message=z.message());var J=(0,yi.Z)(z.message);return Ku(J==="string"||J==="object"),Object.assign(z,z.opts)}function Ml(z,B,M){if(typeof B=="string"){var O=M.time?qc(lc(M.total)):"";B=M.time?"".concat(z,": ").concat(O,"  ").concat(B):"".concat(z,": ").concat(B),B=ro(B,M.color,M.background)}return B}function pl(z){var B=z.image,M=z.message,O=M===void 0?"":M,J=z.scale,me=J===void 0?1:J,qe=null;try{qe=y(75307)}catch(Et){}return qe?function(){return qe(B,{fit:"box",width:"".concat(Math.round(80*me),"%")}).then(function(Et){return console.log(Et)})}:$s}function kc(z){var B=z.image,M=z.message,O=M===void 0?"":M,J=z.scale,me=J===void 0?1:J;if(typeof B=="string"){var qe=new Image;return qe.onload=function(){var Br,Mn=Cl(qe,O,me);(Br=console).log.apply(Br,(0,xa.Z)(Mn))},qe.src=B,$s}var Et=B.nodeName||"";if(Et.toLowerCase()==="img"){var St;return(St=console).log.apply(St,(0,xa.Z)(Cl(B,O,me))),$s}if(Et.toLowerCase()==="canvas"){var yr=new Image;return yr.onload=function(){var Br;return(Br=console).log.apply(Br,(0,xa.Z)(Cl(yr,O,me)))},yr.src=B.toDataURL(),$s}return $s}var dl,Js,Il=new Qu({id:"L7"}).enable(!1);Il.priority=5;var ef=(dl=(0,S.b2)(),dl(Js=function(){function z(){(0,q.Z)(this,z)}return(0,K.Z)(z,[{key:"error",value:function(M){Il.error(M)()}},{key:"warn",value:function(M){Il.probe(1,M)()}},{key:"info",value:function(M){Il.info(3,M)()}},{key:"debug",value:function(M){Il.probe(4,M)()}}]),z}())||Js),tf=y(46343),pa=y(67709),Jl=y.n(pa),hc=window.document.documentElement.style,qu=0;function Ol(z){var B=z;if(typeof z=="string"&&(B=document.getElementById(z)),B){var M=document.createElement("div");return M.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,M.id="l7-scene-".concat(qu++),M.classList.add("l7-scene"),B.appendChild(M),M}return null}var pc,Fu,Fc,rf,nf,Ll,zc,Nc,Bc,vl,Uc,zu,Da,Ql,Nu,el,zi,Pa,Ma,ql,Rl,ec,Sf,Ef,Dl,Bu,Uu,no,vs,ml,ho,En,ks,tc,gl,Qs;function Zs(z){var B=yl();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function yl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Jr=(pc=(0,S.b2)(),Fu=(0,S.f3)(X.v.SceneID),Fc=(0,S.f3)(X.v.IIconService),rf=(0,S.f3)(X.v.IFontService),nf=(0,S.f3)(X.v.IControlService),Ll=(0,S.f3)(X.v.ILogService),zc=(0,S.f3)(X.v.IGlobalConfigService),Nc=(0,S.f3)(X.v.IMapService),Bc=(0,S.f3)(X.v.ICoordinateSystemService),vl=(0,S.f3)(X.v.IRendererService),Uc=(0,S.f3)(X.v.ILayerService),zu=(0,S.f3)(X.v.ICameraService),Da=(0,S.f3)(X.v.IInteractionService),Ql=(0,S.f3)(X.v.IPickingService),Nu=(0,S.f3)(X.v.IShaderModuleService),el=(0,S.f3)(X.v.IMarkerService),zi=(0,S.f3)(X.v.IPopupService),pc(Pa=(Ma=(Qs=function(z){(0,kt.Z)(M,z);var B=Zs(M);function M(){var O;return(0,q.Z)(this,M),O=B.call(this),O.destroyed=!1,O.loaded=!1,O.loadFont=!1,O.fontFamily="",(0,mr.Z)(O,"id",ql,(0,Rn.Z)(O)),(0,mr.Z)(O,"iconService",Rl,(0,Rn.Z)(O)),(0,mr.Z)(O,"fontService",ec,(0,Rn.Z)(O)),(0,mr.Z)(O,"controlService",Sf,(0,Rn.Z)(O)),(0,mr.Z)(O,"logger",Ef,(0,Rn.Z)(O)),(0,mr.Z)(O,"configService",Dl,(0,Rn.Z)(O)),(0,mr.Z)(O,"map",Bu,(0,Rn.Z)(O)),(0,mr.Z)(O,"coordinateSystemService",Uu,(0,Rn.Z)(O)),(0,mr.Z)(O,"rendererService",no,(0,Rn.Z)(O)),(0,mr.Z)(O,"layerService",vs,(0,Rn.Z)(O)),(0,mr.Z)(O,"cameraService",ml,(0,Rn.Z)(O)),(0,mr.Z)(O,"interactionService",ho,(0,Rn.Z)(O)),(0,mr.Z)(O,"pickingService",En,(0,Rn.Z)(O)),(0,mr.Z)(O,"shaderModuleService",ks,(0,Rn.Z)(O)),(0,mr.Z)(O,"markerService",tc,(0,Rn.Z)(O)),(0,mr.Z)(O,"popupService",gl,(0,Rn.Z)(O)),O.inited=!1,O.initPromise=void 0,O.rendering=!1,O.$container=void 0,O.canvas=void 0,O.markerContainer=void 0,O.hooks=void 0,O.handleWindowResized=function(){O.emit("resize"),O.$container&&(O.initContainer(),ae.DOM.triggerResize(),O.coordinateSystemService.needRefresh=!0,O.render())},O.handleMapCameraChanged=function(J){O.cameraService.update(J),O.render()},O.hooks={init:new tf.zj},O}return(0,K.Z)(M,[{key:"init",value:function(J){var me=this;this.configService.setSceneConfig(this.id,J),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Wa.Z)(_a().mark(function qe(){return _a().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:return St.next=2,new Promise(function(yr){me.map.onCameraChanged(function(Br){me.cameraService.init(),me.cameraService.update(Br),me.map.version!=="GAODE2.x"&&yr()}),me.map.version!=="GAODE2.x"?me.map.init():yr()});case 2:if(!(me.map.version==="GAODE2.x"&&me.map.initViewPort)){St.next=6;break}return St.next=5,me.map.init();case 5:me.map.initViewPort();case 6:me.map.onCameraChanged(me.handleMapCameraChanged),me.map.addMarkerContainer(),me.markerService.addMarkers(),me.markerService.addMarkerLayers(),me.popupService.initPopup(),me.interactionService.init(),me.interactionService.on(Vn.s.Drag,me.addSceneEvent.bind(me)),me.logger.debug("map ".concat(me.id," loaded"));case 14:case"end":return St.stop()}},qe)}))),this.hooks.init.tapPromise("initRenderer",(0,Wa.Z)(_a().mark(function qe(){var Et;return _a().wrap(function(yr){for(;;)switch(yr.prev=yr.next){case 0:if(Et=Ol(me.configService.getSceneConfig(me.id).id||""),me.$container=Et,!Et){yr.next=11;break}return me.canvas=ae.DOM.create("canvas","",Et),me.setCanvas(),yr.next=7,me.rendererService.init(me.canvas,me.configService.getSceneConfig(me.id));case 7:Jl()(me.$container,me.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(me.handleWindowResized),yr.next=12;break;case 11:me.logger.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:me.pickingService.init(me.id),me.logger.debug("scene ".concat(me.id," renderer loaded"));case 14:case"end":return yr.stop()}},qe)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(J){this.logger.debug("add layer ".concat(J.name," to scene ").concat(this.id)),this.layerService.add(J),this.render()}},{key:"render",value:function(){var O=(0,Wa.Z)(_a().mark(function me(){return _a().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:if(!(this.rendering||this.destroyed)){Et.next=2;break}return Et.abrupt("return");case 2:if(this.rendering=!0,this.inited){Et.next=16;break}return Et.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Et.next=10;break}return Et.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 16:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 19:case"end":return Et.stop()}},me,this)}));function J(){return O.apply(this,arguments)}return J}()},{key:"addFontFace",value:function(J,me){this.fontFamily=J;var qe=document.createElement("style");qe.type="text/css",qe.innerText=`
        @font-face{
            font-family: '`.concat(J,`';
            src: url('`).concat(me,`') format('woff2'),
            url('`).concat(me,`') format('woff'),
            url('`).concat(me,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(qe),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(J){var me,qe=(me=this.$container)===null||me===void 0?void 0:me.getElementsByTagName("canvas")[0];this.render();var Et=J==="jpg"?qe==null?void 0:qe.toDataURL("image/jpeg"):qe==null?void 0:qe.toDataURL("image/png");return Et}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var J=this.$container.parentElement;J!==null&&(this.markerContainer=ae.DOM.create("div","l7-marker-container",J))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,pa.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var J,me,qe=ae.DOM.DPR,Et=((J=this.$container)===null||J===void 0?void 0:J.clientWidth)||400,St=((me=this.$container)===null||me===void 0?void 0:me.clientHeight)||300,yr=this.canvas;yr&&(yr.width=Et*qe,yr.height=St*qe,yr.style.width="".concat(Et,"px"),yr.style.height="".concat(St,"px")),this.rendererService.viewport({x:0,y:0,width:qe*Et,height:qe*St})}},{key:"setCanvas",value:function(){var J,me,qe=ae.DOM.DPR,Et=((J=this.$container)===null||J===void 0?void 0:J.clientWidth)||400,St=((me=this.$container)===null||me===void 0?void 0:me.clientHeight)||300,yr=this.canvas;yr.width=Et*qe,yr.height=St*qe,yr.style.width="".concat(Et,"px"),yr.style.height="".concat(St,"px")}},{key:"addSceneEvent",value:function(J){this.emit(J.type,J)}}]),M}(b.EventEmitter),Qs),ql=(0,Hr.Z)(Ma.prototype,"id",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rl=(0,Hr.Z)(Ma.prototype,"iconService",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=(0,Hr.Z)(Ma.prototype,"fontService",[rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sf=(0,Hr.Z)(Ma.prototype,"controlService",[nf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ef=(0,Hr.Z)(Ma.prototype,"logger",[Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=(0,Hr.Z)(Ma.prototype,"configService",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bu=(0,Hr.Z)(Ma.prototype,"map",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uu=(0,Hr.Z)(Ma.prototype,"coordinateSystemService",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no=(0,Hr.Z)(Ma.prototype,"rendererService",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vs=(0,Hr.Z)(Ma.prototype,"layerService",[Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ml=(0,Hr.Z)(Ma.prototype,"cameraService",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho=(0,Hr.Z)(Ma.prototype,"interactionService",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En=(0,Hr.Z)(Ma.prototype,"pickingService",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ks=(0,Hr.Z)(Ma.prototype,"shaderModuleService",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc=(0,Hr.Z)(Ma.prototype,"markerService",[el],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gl=(0,Hr.Z)(Ma.prototype,"popupService",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma))||Pa),jc=y(44908),dc=y.n(jc);function tl(z){var B=0;switch(z){case"vec2":case"ivec2":B=2;break;case"vec3":case"ivec3":B=3;break;case"vec4":case"ivec4":case"mat2":B=4;break;case"mat3":B=9;break;case"mat4":B=16;break;default:}return B}var qs=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ws(z){var B={};return z=z.replace(qs,function(M,O,J){var me=J.split(":"),qe=me[0].trim(),Et="";switch(me.length>1&&(Et=me[1].trim()),O){case"bool":Et=Et==="true";break;case"float":case"int":Et=Number(Et);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Et?Et=Et.replace("[","").replace("]","").split(",").reduce(function(St,yr){return St.push(Number(yr.trim())),St},[]):Et=new Array(tl(O)).fill(0);break;default:}return B[qe]=Et,"uniform ".concat(O," ").concat(qe,`;
`)}),{content:z,uniforms:B}}var vc,mc,Fs;function ju(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function _l(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?ju(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):ju(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}var kl="#define PI 3.14159265359",af=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Zc=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Au=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,eu=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,ki=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Zu=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,ns=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Oo=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,xl=/precision\s+(high|low|medium)p\s+float/,rl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,du=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,ms=(vc=(0,S.b2)(),vc(mc=(Fs=function(){function z(){(0,q.Z)(this,z),this.moduleCache={},this.rawContentCache={}}return(0,K.Z)(z,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:kl,fs:kl}),this.registerModule("decode",{vs:af,fs:""}),this.registerModule("projection",{vs:ns,fs:""}),this.registerModule("project",{vs:Zu,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Oo}),this.registerModule("lighting",{vs:Au,fs:""}),this.registerModule("light",{vs:Zc,fs:""}),this.registerModule("picking",{vs:ki,fs:eu})}},{key:"registerModule",value:function(M,O){if(!this.rawContentCache[M]){var J=O.vs,me=O.fs,qe=O.uniforms,Et=ws(J),St=Et.content,yr=Et.uniforms,Br=ws(me),Mn=Br.content,Bn=Br.uniforms;this.rawContentCache[M]={fs:Mn,uniforms:_l(_l(_l({},yr),Bn),qe),vs:St}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(M){var O=this;if(this.moduleCache[M])return this.moduleCache[M];var J=this.rawContentCache[M].vs,me=this.rawContentCache[M].fs,qe=this.processModule(J,[],"vs"),Et=qe.content,St=qe.includeList,yr=this.processModule(me,[],"fs"),Br=yr.content,Mn=yr.includeList,Bn=Br,ci=dc()(St.concat(Mn).concat(M)).reduce(function(Si,Ci){return _l(_l({},Si),O.rawContentCache[Ci].uniforms)},{});return xl.test(Br)||(Bn=rl+Br),this.moduleCache[M]={fs:Bn.trim(),uniforms:ci,vs:Et.trim()},this.moduleCache[M]}},{key:"processModule",value:function(M,O,J){var me=this,qe=M.replace(du,function(Et,St){var yr=St.split(" "),Br=yr[0].replace(/"/g,"");if(O.indexOf(Br)>-1)return"";var Mn=me.rawContentCache[Br][J];O.push(Br);var Bn=me.processModule(Mn,O,J),ci=Bn.content;return ci});return{content:qe,includeList:O}}}]),z}(),Fs))||mc),nl=y(66213),Un=y(92364),Pn,rc,is,yo,zo,vu,Vs=(Pn=(0,S.b2)(),rc=(0,S.f3)(X.v.IShaderModuleService),Pn(is=(yo=(vu=function(){function z(){(0,q.Z)(this,z),(0,mr.Z)(this,"shaderModuleService",zo,this),this.rendererService=void 0,this.cameraService=void 0,this.mapService=void 0,this.interactionService=void 0,this.layerService=void 0,this.config=void 0}return(0,K.Z)(z,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Un.G.Normal}},{key:"init",value:function(M,O){this.config=O,this.rendererService=M.getContainer().get(X.v.IRendererService),this.cameraService=M.getContainer().get(X.v.ICameraService),this.mapService=M.getContainer().get(X.v.IMapService),this.interactionService=M.getContainer().get(X.v.IInteractionService),this.layerService=M.getContainer().get(X.v.ILayerService)}},{key:"render",value:function(M){}}]),z}(),vu),zo=(0,Hr.Z)(yo.prototype,"shaderModuleService",[rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yo))||is),Fl,Yi;function wo(z){var B=of();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function of(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var bl=(Fl=(0,S.b2)(),Fl(Yi=function(z){(0,kt.Z)(M,z);var B=wo(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(J,me){(0,nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,J,me)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),M}(Vs))||Yi),gc,Cu,Ts,il,Pu,yc;function nc(z,B){var M;if(typeof Symbol=="undefined"||z[Symbol.iterator]==null){if(Array.isArray(z)||(M=_c(z))||B&&z&&typeof z.length=="number"){M&&(z=M);var O=0,J=function(){};return{s:J,n:function(){return O>=z.length?{done:!0}:{done:!1,value:z[O++]}},e:function(yr){throw yr},f:J}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var me=!0,qe=!1,Et;return{s:function(){M=z[Symbol.iterator]()},n:function(){var yr=M.next();return me=yr.done,yr},e:function(yr){qe=!0,Et=yr},f:function(){try{!me&&M.return!=null&&M.return()}finally{if(qe)throw Et}}}}function _c(z,B){if(!!z){if(typeof z=="string")return Vc(z,B);var M=Object.prototype.toString.call(z).slice(8,-1);if(M==="Object"&&z.constructor&&(M=z.constructor.name),M==="Map"||M==="Set")return Array.from(z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Vc(z,B)}}function Vc(z,B){(B==null||B>z.length)&&(B=z.length);for(var M=0,O=new Array(B);M<B;M++)O[M]=z[M];return O}var zl=(gc=(0,S.b2)(),Cu=(0,S.f3)(X.v.IPostProcessor),gc(Ts=(il=(yc=function(){function z(){(0,q.Z)(this,z),this.passes=[],(0,mr.Z)(this,"postProcessor",Pu,this),this.layer=void 0,this.renderFlag=void 0,this.width=0,this.height=0}return(0,K.Z)(z,[{key:"setLayer",value:function(M){this.layer=M}},{key:"setRenderFlag",value:function(M){this.renderFlag=M}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var B=(0,Wa.Z)(_a().mark(function O(){var J,me,qe;return _a().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:J=nc(this.passes),St.prev=1,J.s();case 3:if((me=J.n()).done){St.next=9;break}return qe=me.value,St.next=7,qe.render(this.layer);case 7:St.next=3;break;case 9:St.next=14;break;case 11:St.prev=11,St.t0=St.catch(1),J.e(St.t0);case 14:return St.prev=14,J.f(),St.finish(14);case 17:this.layer.renderModels();case 18:case"end":return St.stop()}},O,this,[[1,11,14,17]])}));function M(){return B.apply(this,arguments)}return M}()},{key:"resize",value:function(M,O){(this.width!==M||this.height!==O)&&(this.width=M,this.height=O)}},{key:"add",value:function(M,O){M.getType()===Un.G.PostProcessing?this.postProcessor.add(M,this.layer,O):(M.init(this.layer,O),this.passes.push(M))}},{key:"insert",value:function(M,O,J){M.init(this.layer,O),this.passes.splice(J,0,M)}},{key:"destroy",value:function(){this.passes.length=0}}]),z}(),yc),Pu=(0,Hr.Z)(il.prototype,"postProcessor",[Cu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il))||Ts),tu,xc,al,Mu,Nl,mu;function ru(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function bc(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?ru(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):ru(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function Sc(z){var B=Gc();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function Gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Ec=(tu=(0,S.b2)(),xc=(0,S.f3)(X.v.ILogService),tu(al=(Mu=(mu=function(z){(0,kt.Z)(M,z);var B=Sc(M);function M(){var O;(0,q.Z)(this,M);for(var J=arguments.length,me=new Array(J),qe=0;qe<J;qe++)me[qe]=arguments[qe];return O=B.call.apply(B,[this].concat(me)),(0,mr.Z)(O,"logger",Nl,(0,Rn.Z)(O)),O.pickingFBO=void 0,O.layer=void 0,O.width=0,O.height=0,O.alreadyInRendering=!1,O.pickFromPickingFBO=function(Et){var St=Et.x,yr=Et.y,Br=Et.lngLat,Mn=Et.type;if(!(!O.layer.isVisible()||!O.layer.needPick(Mn))){var Bn=O.rendererService,ci=Bn.getViewportSize,Si=Bn.readPixels,Ci=Bn.useFramebuffer,va=ci(),Pi=va.width,Ja=va.height,Zo=O.layer.getLayerConfig(),Vo=Zo.enableHighlight,ys=Zo.enableSelect,bo=St*ae.DOM.DPR,Aa=yr*ae.DOM.DPR;if(!(bo>Pi||bo<0||Aa>Ja||Aa<0)){var Ea;Ci(O.pickingFBO,function(){var Lo;if(Ea=Si({x:Math.round(bo),y:Math.round(Ja-(yr+1)*ae.DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:O.pickingFBO}),Ea[0]!==0||Ea[1]!==0||Ea[2]!==0){O.logger.debug("picked");var Qa=(0,ae.decodePickingColor)(Ea),qa=O.layer.getSource().getFeatureById(Qa),Jo={x:St,y:yr,type:Mn,lngLat:Br,featureId:Qa,feature:qa};qa&&(O.layer.setCurrentPickId(Qa),O.triggerHoverOnLayer(Jo))}else{var ss={x:St,y:yr,lngLat:Br,type:O.layer.getCurrentPickId()===null?"un"+Mn:"mouseout",featureId:null,feature:null};O.triggerHoverOnLayer(bc(bc({},ss),{},{type:"unpick"})),O.triggerHoverOnLayer(ss),O.layer.setCurrentPickId(null)}Vo&&O.highlightPickedFeature(Ea),ys&&Mn==="click"&&((Lo=Ea)===null||Lo===void 0?void 0:Lo.toString())!==[0,0,0,0].toString()&&O.selectFeature(Ea)})}}},O}return(0,K.Z)(M,[{key:"getType",value:function(){return Un.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(J,me){(0,nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,J,me),this.layer=J;var qe=this.rendererService,Et=qe.createTexture2D,St=qe.createFramebuffer,yr=qe.getViewportSize,Br=yr(),Mn=Br.width,Bn=Br.height;this.pickingFBO=St({color:Et({width:Mn,height:Bn,wrapS:ra.gl.CLAMP_TO_EDGE,wrapT:ra.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Vn.s.Hover,this.pickFromPickingFBO),this.interactionService.on(Vn.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Vn.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(J){var me=this;if(!this.alreadyInRendering){var qe=this.rendererService,Et=qe.getViewportSize,St=qe.useFramebuffer,yr=qe.clear,Br=Et(),Mn=Br.width,Bn=Br.height;this.alreadyInRendering=!0,(this.width!==Mn||this.height!==Bn)&&(this.pickingFBO.resize({width:Mn,height:Bn}),this.width=Mn,this.height=Bn),St(this.pickingFBO,function(){yr({framebuffer:me.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var ci=me.layer.multiPassRenderer.getRenderFlag();me.layer.multiPassRenderer.setRenderFlag(!1),J.hooks.beforePickingEncode.call(),J.render(),J.hooks.afterPickingEncode.call(),me.layer.multiPassRenderer.setRenderFlag(ci),me.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(J){this.layer.emit(J.type,J)}},{key:"highlightPickedFeature",value:function(J){var me=(0,wr.Z)(J,3),qe=me[0],Et=me[1],St=me[2];this.layer.hooks.beforeHighlight.call([qe,Et,St]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(J){var me=(0,wr.Z)(J,3),qe=me[0],Et=me[1],St=me[2];this.layer.hooks.beforeSelect.call([qe,Et,St]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(J){var me=J.featureId,qe=(0,ae.encodePickingColor)(me);this.selectFeature(new Uint8Array(qe))}},{key:"highlightFeatureHandle",value:function(J){var me=J.featureId,qe=(0,ae.encodePickingColor)(me);this.highlightPickedFeature(new Uint8Array(qe))}}]),M}(Vs),mu),Nl=(0,Hr.Z)(Mu.prototype,"logger",[xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mu))||al),n=y(69530),u,a;function h(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function g(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?h(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):h(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function E(z){var B=T();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function T(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var R=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Z=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ee=(u=(0,S.b2)(),u(a=function(z){(0,kt.Z)(M,z);var B=E(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Z,fs:R});var J=this.shaderModuleService.getModule("blur-pass"),me=J.vs,qe=J.fs,Et=J.uniforms,St=this.rendererService.getViewportSize(),yr=St.width,Br=St.height;return{vs:me,fs:qe,uniforms:g(g({},Et),{},{u_ViewportSize:[yr,Br]})}}},{key:"convertOptionsToUniforms",value:function(J){var me={};return Ys()(J.blurRadius)||(me.u_BlurDir=[J.blurRadius,0]),me}}]),M}(n.Z))||a),ve,_e;function Ee(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function We(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?Ee(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):Ee(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function He(z){var B=lt();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function lt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Fe=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,st=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bt=(ve=(0,S.b2)(),ve(_e=function(z){(0,kt.Z)(M,z);var B=He(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:st,fs:Fe});var J=this.shaderModuleService.getModule("blur-pass"),me=J.vs,qe=J.fs,Et=J.uniforms,St=this.rendererService.getViewportSize(),yr=St.width,Br=St.height;return{vs:me,fs:qe,uniforms:We(We({},Et),{},{u_ViewportSize:[yr,Br]})}}},{key:"convertOptionsToUniforms",value:function(J){var me={};return Ys()(J.blurRadius)||(me.u_BlurDir=[0,J.blurRadius]),me}}]),M}(n.Z))||_e),Gt,ur;function or(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function lr(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?or(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):or(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function Rr(z){var B=nn();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function nn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Qr=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,yn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jn=(Gt=(0,S.b2)(),Gt(ur=function(z){(0,kt.Z)(M,z);var B=Rr(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:yn,fs:Qr});var J=this.shaderModuleService.getModule("colorhalftone-pass"),me=J.vs,qe=J.fs,Et=J.uniforms,St=this.rendererService.getViewportSize(),yr=St.width,Br=St.height;return{vs:me,fs:qe,uniforms:lr(lr({},Et),{},{u_ViewportSize:[yr,Br]})}}}]),M}(n.Z))||ur),Xn,Hn;function Ki(z){var B=bn();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function bn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var ai=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,_i=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ii=(Xn=(0,S.b2)(),Xn(Hn=function(z){(0,kt.Z)(M,z);var B=Ki(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:_i,fs:ai}),this.shaderModuleService.getModule("copy-pass")}}]),M}(n.Z))||Hn),ri,xi;function ei(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function Qn(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?ei(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):ei(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function _o(z){var B=Ka();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function Ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var as=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,No=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$a=(ri=(0,S.b2)(),ri(xi=function(z){(0,kt.Z)(M,z);var B=_o(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:No,fs:as});var J=this.shaderModuleService.getModule("hexagonalpixelate-pass"),me=J.vs,qe=J.fs,Et=J.uniforms,St=this.rendererService.getViewportSize(),yr=St.width,Br=St.height;return{vs:me,fs:qe,uniforms:Qn(Qn({},Et),{},{u_ViewportSize:[yr,Br]})}}}]),M}(n.Z))||xi),io,gs;function Bo(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function Iu(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?Bo(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):Bo(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function os(z){var B=Gs();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function Gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Hs=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Sl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,El=(io=(0,S.b2)(),io(gs=function(z){(0,kt.Z)(M,z);var B=os(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Sl,fs:Hs});var J=this.shaderModuleService.getModule("ink-pass"),me=J.vs,qe=J.fs,Et=J.uniforms,St=this.rendererService.getViewportSize(),yr=St.width,Br=St.height;return{vs:me,fs:qe,uniforms:Iu(Iu({},Et),{},{u_ViewportSize:[yr,Br]})}}}]),M}(n.Z))||gs),zs,Vu;function Bl(z){var B=gu();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function gu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var wl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,nu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ao=(zs=(0,S.b2)(),zs(Vu=function(z){(0,kt.Z)(M,z);var B=Bl(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:nu,fs:wl}),this.shaderModuleService.getModule("noise-pass")}}]),M}(n.Z))||Vu),Ou,yu;function As(z){var B=$i();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function $i(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Uo=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xo=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Lu=(Ou=(0,S.b2)(),Ou(yu=function(z){(0,kt.Z)(M,z);var B=As(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Uo,fs:xo}),this.shaderModuleService.getModule("sepia-pass")}}]),M}(n.Z))||yu),iu,_u,Gu,Ru,Ws,au,Tl,sf=(iu=(0,S.b2)(),_u=(0,S.f3)(X.v.IRendererService),Gu=(0,S.zY)(),iu(Ru=(Ws=(Tl=function(){function z(){(0,q.Z)(this,z),(0,mr.Z)(this,"rendererService",au,this),this.passes=[],this.readFBO=void 0,this.writeFBO=void 0}return(0,K.Z)(z,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var B=(0,Wa.Z)(_a().mark(function O(J){var me,qe;return _a().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:me=0;case 1:if(!(me<this.passes.length)){St.next=10;break}return qe=this.passes[me],qe.setRenderToScreen(this.isLastEnabledPass(me)),St.next=6,qe.render(J);case 6:me!==this.passes.length-1&&this.swap();case 7:me++,St.next=1;break;case 10:case"end":return St.stop()}},O,this)}));function M(O){return B.apply(this,arguments)}return M}()},{key:"resize",value:function(M,O){this.readFBO.resize({width:M,height:O}),this.writeFBO.resize({width:M,height:O})}},{key:"add",value:function(M,O,J){M.init(O,J),this.passes.push(M)}},{key:"insert",value:function(M,O,J,me){M.init(J,me),this.passes.splice(O,0,M)}},{key:"getPostProcessingPassByName",value:function(M){return this.passes.find(function(O){return O.getName()===M})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(M){for(var O=M+1;O<this.passes.length;O++)if(this.passes[O].isEnabled())return!1;return!0}},{key:"swap",value:function(){var M=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=M}}]),z}(),Tl),au=(0,Hr.Z)(Ws.prototype,"rendererService",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Hr.Z)(Ws.prototype,"init",[Gu],Object.getOwnPropertyDescriptor(Ws.prototype,"init"),Ws.prototype),Ws))||Ru),xu,da;function vh(z){var B=Hf();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function Hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var Wf=(xu=(0,S.b2)(),xu(da=function(z){(0,kt.Z)(M,z);var B=vh(M);function M(){return(0,q.Z)(this,M),B.apply(this,arguments)}return(0,K.Z)(M,[{key:"getType",value:function(){return Un.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(J,me){(0,nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,J,me)}},{key:"render",value:function(J){var me=this.rendererService,qe=me.useFramebuffer,Et=me.clear;qe(null,function(){Et({color:[0,0,0,0],depth:1,stencil:0}),J.multiPassRenderer.setRenderFlag(!1),J.render(),J.multiPassRenderer.setRenderFlag(!0)})}}]),M}(Vs))||da),Ul,kf,mh,ic,Ff,wf,Xf,jl;function Hc(z,B){var M=Object.keys(z);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(z);B&&(O=O.filter(function(J){return Object.getOwnPropertyDescriptor(z,J).enumerable})),M.push.apply(M,O)}return M}function zf(z){for(var B=1;B<arguments.length;B++){var M=arguments[B]!=null?arguments[B]:{};B%2?Hc(Object(M),!0).forEach(function(O){(0,N.Z)(z,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(M)):Hc(Object(M)).forEach(function(O){Object.defineProperty(z,O,Object.getOwnPropertyDescriptor(M,O))})}return z}function Yf(z){var B=Kf();return function(){var O=(0,w.Z)(z),J;if(B){var me=(0,w.Z)(this).constructor;J=Reflect.construct(O,arguments,me)}else J=O.apply(this,arguments);return(0,jt.Z)(this,J)}}function Kf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var $f=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Jf=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ou=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Nf(z,B){for(var M=0,O=1/B,J=z;J>0;)M=M+O*(J%B),J=Math.floor(J/B),O=O/B;return M}var Qf=1,qf=(Ul=(0,S.b2)(),kf=(0,S.f3)(X.v.IShaderModuleService),mh=(0,S.f3)(X.v.ILogService),Ul(ic=(Ff=(jl=function(z){(0,kt.Z)(M,z);var B=Yf(M);function M(){var O;(0,q.Z)(this,M);for(var J=arguments.length,me=new Array(J),qe=0;qe<J;qe++)me[qe]=arguments[qe];return O=B.call.apply(B,[this].concat(me)),(0,mr.Z)(O,"shaderModuleService",wf,(0,Rn.Z)(O)),(0,mr.Z)(O,"logger",Xf,(0,Rn.Z)(O)),O.haltonSequence=[],O.accumulatingId=0,O.frame=0,O.timer=void 0,O.sampleRenderTarget=void 0,O.prevRenderTarget=void 0,O.outputRenderTarget=void 0,O.copyRenderTarget=void 0,O.blendModel=void 0,O.outputModel=void 0,O.copyModel=void 0,O}return(0,K.Z)(M,[{key:"getType",value:function(){return Un.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(J,me){(0,nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,J,me);var qe=this.rendererService,Et=qe.createFramebuffer,St=qe.createTexture2D;this.sampleRenderTarget=Et({color:St({width:1,height:1,wrapS:ra.gl.CLAMP_TO_EDGE,wrapT:ra.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Et({color:St({width:1,height:1,wrapS:ra.gl.CLAMP_TO_EDGE,wrapT:ra.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Et({color:St({width:1,height:1,wrapS:ra.gl.CLAMP_TO_EDGE,wrapT:ra.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Et({color:St({width:1,height:1,wrapS:ra.gl.CLAMP_TO_EDGE,wrapT:ra.gl.CLAMP_TO_EDGE})});for(var yr=0;yr<30;yr++)this.haltonSequence.push([Nf(yr,2),Nf(yr,3)]);this.blendModel=this.createTriangleModel("blend-pass",$f),this.outputModel=this.createTriangleModel("copy-pass",Jf,{blend:{enable:!0,func:{srcRGB:ra.gl.ONE,dstRGB:ra.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:ra.gl.ONE,dstAlpha:ra.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:ra.gl.FUNC_ADD,alpha:ra.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Jf)}},{key:"render",value:function(J){var me=this,qe=this.rendererService,Et=qe.clear,St=qe.getViewportSize,yr=qe.useFramebuffer,Br=St(),Mn=Br.width,Bn=Br.height;this.sampleRenderTarget.resize({width:Mn,height:Bn}),this.prevRenderTarget.resize({width:Mn,height:Bn}),this.outputRenderTarget.resize({width:Mn,height:Bn}),this.copyRenderTarget.resize({width:Mn,height:Bn}),this.resetFrame(),this.stopAccumulating();var ci=J.multiPassRenderer.getPostProcessor().getReadFBO();yr(ci,function(){Et({color:[0,0,0,0],depth:1,stencil:0,framebuffer:ci}),J.multiPassRenderer.setRenderFlag(!1),J.render(),J.multiPassRenderer.setRenderFlag(!0)});var Si=function Ci(va){!me.accumulatingId||va!==me.accumulatingId||me.isFinished()||(me.doRender(J),requestAnimationFrame(function(){Ci(va)}))};this.accumulatingId=Qf++,this.timer=window.setTimeout(function(){Si(me.accumulatingId)},50)}},{key:"doRender",value:function(J){var me=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var qe=this.rendererService,Et=qe.clear,St=qe.getViewportSize,yr=qe.useFramebuffer,Br=St(),Mn=Br.width,Bn=Br.height,ci=J.getLayerConfig(),Si=ci.jitterScale,Ci=Si===void 0?1:Si,va=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((va[0]*2-1)/Mn*Ci,(va[1]*2-1)/Bn*Ci),J.multiPassRenderer.setRenderFlag(!1),J.hooks.beforeRender.call(),yr(this.sampleRenderTarget,function(){Et({color:[0,0,0,0],depth:1,stencil:0,framebuffer:me.sampleRenderTarget}),J.render()}),J.hooks.afterRender.call(),J.multiPassRenderer.setRenderFlag(!0);var Pi=J.getLayerConfig();yr(this.outputRenderTarget,function(){me.blendModel.draw({uniforms:{u_opacity:Pi.opacity||1,u_MixRatio:me.frame===0?1:.9,u_Diffuse1:me.sampleRenderTarget,u_Diffuse2:me.frame===0?J.multiPassRenderer.getPostProcessor().getReadFBO():me.prevRenderTarget}})}),this.frame===0&&Et({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(yr(this.copyRenderTarget,function(){me.outputModel.draw({uniforms:{u_Texture:me.outputRenderTarget}})}),yr(J.multiPassRenderer.getPostProcessor().getReadFBO(),function(){me.copyModel.draw({uniforms:{u_Texture:me.copyRenderTarget}})}),J.multiPassRenderer.getPostProcessor().render(J));var Ja=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ja,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(J,me,qe){this.shaderModuleService.registerModule(J,{vs:ou,fs:me});var Et=this.shaderModuleService.getModule(J),St=Et.vs,yr=Et.fs,Br=Et.uniforms,Mn=this.rendererService,Bn=Mn.createAttribute,ci=Mn.createBuffer,Si=Mn.createModel;return Si(zf({vs:St,fs:yr,attributes:{a_Position:Bn({buffer:ci({data:[-4,-4,4,-4,0,4],type:ra.gl.FLOAT}),size:2})},uniforms:zf({},Br),depth:{enable:!1},count:3},qe))}}]),M}(Vs),jl),wf=(0,Hr.Z)(Ff.prototype,"shaderModuleService",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=(0,Hr.Z)(Ff.prototype,"logger",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff))||ic),jo=new S.W2;jo.bind(X.v.IGlobalConfigService).to(Xt).inSingletonScope(),jo.bind(X.v.IShaderModuleService).to(ms).inSingletonScope(),jo.bind(X.v.ILogService).to(ef).inSingletonScope(),(0,S.GW)((0,S.b2)(),b.EventEmitter),jo.bind(X.v.IEventEmitter).to(b.EventEmitter);var Tf=(0,L.Z)(jo,!1),oo=function(B){var M=Tf.lazyInject(B);return function(O,J,me){M.call(this,O,J),me&&(me.initializer=function(){return O[J]})}},uf=function(B){var M=Tf.lazyMultiInject(B);return function(O,J,me){M.call(this,O,J),me&&(me.initializer=function(){return O[J]})}},lf=jo,Wc=0;function ac(){var z=new S.W2;return z.parent=jo,z.bind(X.v.SceneID).toConstantValue("".concat(Wc++)),z.bind(X.v.ILayerService).to(li).inSingletonScope(),z.bind(X.v.ISceneService).to(Jr).inSingletonScope(),z.bind(X.v.ICameraService).to(At).inSingletonScope(),z.bind(X.v.ICoordinateSystemService).to(ji).inSingletonScope(),z.bind(X.v.IInteractionService).to(oa).inSingletonScope(),z.bind(X.v.IPickingService).to(Ya).inSingletonScope(),z.bind(X.v.IControlService).to(xr).inSingletonScope(),z.bind(X.v.IMarkerService).to(Ai).inSingletonScope(),z.bind(X.v.IIconService).to($t).inSingletonScope(),z.bind(X.v.IFontService).to(at).inSingletonScope(),z.bind(X.v.IPopupService).to(V).inSingletonScope(),z.bind(X.v.INormalPass).to(bl).whenTargetNamed("clear"),z.bind(X.v.INormalPass).to(Ec).whenTargetNamed("pixelPicking"),z.bind(X.v.INormalPass).to(Wf).whenTargetNamed("render"),z.bind(X.v.INormalPass).to(qf).whenTargetNamed("taa"),z.bind(X.v.IFactoryNormalPass).toFactory(function(B){return function(M){return B.container.getNamed(X.v.INormalPass,M)}}),z.bind(X.v.IPostProcessingPass).to(ii).whenTargetNamed("copy"),z.bind(X.v.IPostProcessingPass).to(ee).whenTargetNamed("blurH"),z.bind(X.v.IPostProcessingPass).to(bt).whenTargetNamed("blurV"),z.bind(X.v.IPostProcessingPass).to(ao).whenTargetNamed("noise"),z.bind(X.v.IPostProcessingPass).to(Lu).whenTargetNamed("sepia"),z.bind(X.v.IPostProcessingPass).to(jn).whenTargetNamed("colorHalftone"),z.bind(X.v.IPostProcessingPass).to($a).whenTargetNamed("hexagonalPixelate"),z.bind(X.v.IPostProcessingPass).to(El).whenTargetNamed("ink"),z.bind(X.v.IFactoryPostProcessingPass).toFactory(function(B){return function(M){var O=B.container.getNamed(X.v.IPostProcessingPass,M);return O.setName(M),O}}),z}function wc(z){var B=new S.W2;return B.parent=z,B.bind(X.v.IStyleAttributeService).to(Mo).inSingletonScope(),B.bind(X.v.IMultiPassRenderer).to(zl).inSingletonScope(),B.bind(X.v.IPostProcessor).to(sf).inSingletonScope(),B}},2811:function(){},64532:function(){},4594:function(ft,C,y){"use strict";y.d(C,{l:function(){return G}});var G={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(ft,C,y){"use strict";y.d(C,{d:function(){return G}});var G;(function(b){b.TOPRIGHT="topright",b.TOPLEFT="topleft",b.BOTTOMRIGHT="bottomright",b.BOTTOMLEFT="bottomleft"})(G||(G={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(ft,C,y){"use strict";y.d(C,{l:function(){return G},k:function(){return b}});var G;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(G||(G={}));var b={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(ft,C,y){"use strict";y.d(C,{s:function(){return G}});var G;(function(b){b.Hover="hover",b.Click="click",b.Select="select",b.Active="active",b.Drag="drag"})(G||(G={}))},90919:function(){},77252:function(ft,C,y){"use strict";y.d(C,{h:function(){return G}});var G;(function(b){b.normal="normal",b.additive="additive",b.subtractive="subtractive",b.min="min",b.max="max",b.none="none"})(G||(G={}))},31251:function(ft,C,y){"use strict";y.d(C,{vY:function(){return G},ee:function(){return b},GC:function(){return p}});var G;(function(S){S.LINEAR="linear",S.POWER="power",S.LOG="log",S.IDENTITY="identity",S.TIME="time",S.QUANTILE="quantile",S.QUANTIZE="quantize",S.THRESHOLD="threshold",S.CAT="cat"})(G||(G={}));var b;(function(S){S.CONSTANT="constant",S.VARIABLE="variable"})(b||(b={}));var p;(function(S){S[S.Attribute=0]="Attribute",S[S.InstancedAttribute=1]="InstancedAttribute",S[S.Uniform=2]="Uniform"})(p||(p={}))},79042:function(){},16606:function(ft,C,y){"use strict";y.d(C,{I:function(){return G}});var G=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(ft,C,y){"use strict";y.d(C,{G:function(){return G}});var G;(function(b){b.Normal="normal",b.PostProcessing="post-processing"})(G||(G={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(ft,C,y){"use strict";y.d(C,{gl:function(){return G}});var G;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",b[b.POINTS=0]="POINTS",b[b.LINES=1]="LINES",b[b.LINE_LOOP=2]="LINE_LOOP",b[b.LINE_STRIP=3]="LINE_STRIP",b[b.TRIANGLES=4]="TRIANGLES",b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN",b[b.ZERO=0]="ZERO",b[b.ONE=1]="ONE",b[b.SRC_COLOR=768]="SRC_COLOR",b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",b[b.SRC_ALPHA=770]="SRC_ALPHA",b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",b[b.DST_ALPHA=772]="DST_ALPHA",b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",b[b.DST_COLOR=774]="DST_COLOR",b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",b[b.FUNC_ADD=32774]="FUNC_ADD",b[b.BLEND_EQUATION=32777]="BLEND_EQUATION",b[b.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",b[b.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",b[b.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",b[b.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",b[b.MAX_EXT=32776]="MAX_EXT",b[b.MIN_EXT=32775]="MIN_EXT",b[b.BLEND_DST_RGB=32968]="BLEND_DST_RGB",b[b.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",b[b.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",b[b.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR",b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",b[b.BLEND_COLOR=32773]="BLEND_COLOR",b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER",b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",b[b.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",b[b.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",b[b.STREAM_DRAW=35040]="STREAM_DRAW",b[b.STATIC_DRAW=35044]="STATIC_DRAW",b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",b[b.BUFFER_SIZE=34660]="BUFFER_SIZE",b[b.BUFFER_USAGE=34661]="BUFFER_USAGE",b[b.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",b[b.FRONT=1028]="FRONT",b[b.BACK=1029]="BACK",b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK",b[b.CULL_FACE=2884]="CULL_FACE",b[b.BLEND=3042]="BLEND",b[b.DITHER=3024]="DITHER",b[b.STENCIL_TEST=2960]="STENCIL_TEST",b[b.DEPTH_TEST=2929]="DEPTH_TEST",b[b.SCISSOR_TEST=3089]="SCISSOR_TEST",b[b.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",b[b.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",b[b.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",b[b.NO_ERROR=0]="NO_ERROR",b[b.INVALID_ENUM=1280]="INVALID_ENUM",b[b.INVALID_VALUE=1281]="INVALID_VALUE",b[b.INVALID_OPERATION=1282]="INVALID_OPERATION",b[b.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",b[b.CW=2304]="CW",b[b.CCW=2305]="CCW",b[b.LINE_WIDTH=2849]="LINE_WIDTH",b[b.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",b[b.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",b[b.CULL_FACE_MODE=2885]="CULL_FACE_MODE",b[b.FRONT_FACE=2886]="FRONT_FACE",b[b.DEPTH_RANGE=2928]="DEPTH_RANGE",b[b.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",b[b.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",b[b.DEPTH_FUNC=2932]="DEPTH_FUNC",b[b.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",b[b.STENCIL_FUNC=2962]="STENCIL_FUNC",b[b.STENCIL_FAIL=2964]="STENCIL_FAIL",b[b.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",b[b.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",b[b.STENCIL_REF=2967]="STENCIL_REF",b[b.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",b[b.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",b[b.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",b[b.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",b[b.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",b[b.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",b[b.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",b[b.VIEWPORT=2978]="VIEWPORT",b[b.SCISSOR_BOX=3088]="SCISSOR_BOX",b[b.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",b[b.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",b[b.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",b[b.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",b[b.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",b[b.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",b[b.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",b[b.RED_BITS=3410]="RED_BITS",b[b.GREEN_BITS=3411]="GREEN_BITS",b[b.BLUE_BITS=3412]="BLUE_BITS",b[b.ALPHA_BITS=3413]="ALPHA_BITS",b[b.DEPTH_BITS=3414]="DEPTH_BITS",b[b.STENCIL_BITS=3415]="STENCIL_BITS",b[b.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",b[b.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",b[b.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",b[b.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",b[b.SAMPLES=32937]="SAMPLES",b[b.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",b[b.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",b[b.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",b[b.DONT_CARE=4352]="DONT_CARE",b[b.FASTEST=4353]="FASTEST",b[b.NICEST=4354]="NICEST",b[b.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",b[b.BYTE=5120]="BYTE",b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",b[b.SHORT=5122]="SHORT",b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",b[b.INT=5124]="INT",b[b.UNSIGNED_INT=5125]="UNSIGNED_INT",b[b.FLOAT=5126]="FLOAT",b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",b[b.ALPHA=6406]="ALPHA",b[b.RGB=6407]="RGB",b[b.RGBA=6408]="RGBA",b[b.LUMINANCE=6409]="LUMINANCE",b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",b[b.VERTEX_SHADER=35633]="VERTEX_SHADER",b[b.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",b[b.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",b[b.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",b[b.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",b[b.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",b[b.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",b[b.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",b[b.SHADER_TYPE=35663]="SHADER_TYPE",b[b.DELETE_STATUS=35712]="DELETE_STATUS",b[b.LINK_STATUS=35714]="LINK_STATUS",b[b.VALIDATE_STATUS=35715]="VALIDATE_STATUS",b[b.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",b[b.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",b[b.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",b[b.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",b[b.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",b[b.NEVER=512]="NEVER",b[b.LESS=513]="LESS",b[b.EQUAL=514]="EQUAL",b[b.LEQUAL=515]="LEQUAL",b[b.GREATER=516]="GREATER",b[b.NOTEQUAL=517]="NOTEQUAL",b[b.GEQUAL=518]="GEQUAL",b[b.ALWAYS=519]="ALWAYS",b[b.KEEP=7680]="KEEP",b[b.REPLACE=7681]="REPLACE",b[b.INCR=7682]="INCR",b[b.DECR=7683]="DECR",b[b.INVERT=5386]="INVERT",b[b.INCR_WRAP=34055]="INCR_WRAP",b[b.DECR_WRAP=34056]="DECR_WRAP",b[b.VENDOR=7936]="VENDOR",b[b.RENDERER=7937]="RENDERER",b[b.VERSION=7938]="VERSION",b[b.NEAREST=9728]="NEAREST",b[b.LINEAR=9729]="LINEAR",b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",b[b.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",b[b.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",b[b.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",b[b.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",b[b.TEXTURE_2D=3553]="TEXTURE_2D",b[b.TEXTURE=5890]="TEXTURE",b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",b[b.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",b[b.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",b[b.TEXTURE0=33984]="TEXTURE0",b[b.TEXTURE1=33985]="TEXTURE1",b[b.TEXTURE2=33986]="TEXTURE2",b[b.TEXTURE3=33987]="TEXTURE3",b[b.TEXTURE4=33988]="TEXTURE4",b[b.TEXTURE5=33989]="TEXTURE5",b[b.TEXTURE6=33990]="TEXTURE6",b[b.TEXTURE7=33991]="TEXTURE7",b[b.TEXTURE8=33992]="TEXTURE8",b[b.TEXTURE9=33993]="TEXTURE9",b[b.TEXTURE10=33994]="TEXTURE10",b[b.TEXTURE11=33995]="TEXTURE11",b[b.TEXTURE12=33996]="TEXTURE12",b[b.TEXTURE13=33997]="TEXTURE13",b[b.TEXTURE14=33998]="TEXTURE14",b[b.TEXTURE15=33999]="TEXTURE15",b[b.TEXTURE16=34e3]="TEXTURE16",b[b.TEXTURE17=34001]="TEXTURE17",b[b.TEXTURE18=34002]="TEXTURE18",b[b.TEXTURE19=34003]="TEXTURE19",b[b.TEXTURE20=34004]="TEXTURE20",b[b.TEXTURE21=34005]="TEXTURE21",b[b.TEXTURE22=34006]="TEXTURE22",b[b.TEXTURE23=34007]="TEXTURE23",b[b.TEXTURE24=34008]="TEXTURE24",b[b.TEXTURE25=34009]="TEXTURE25",b[b.TEXTURE26=34010]="TEXTURE26",b[b.TEXTURE27=34011]="TEXTURE27",b[b.TEXTURE28=34012]="TEXTURE28",b[b.TEXTURE29=34013]="TEXTURE29",b[b.TEXTURE30=34014]="TEXTURE30",b[b.TEXTURE31=34015]="TEXTURE31",b[b.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",b[b.REPEAT=10497]="REPEAT",b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",b[b.FLOAT_VEC2=35664]="FLOAT_VEC2",b[b.FLOAT_VEC3=35665]="FLOAT_VEC3",b[b.FLOAT_VEC4=35666]="FLOAT_VEC4",b[b.INT_VEC2=35667]="INT_VEC2",b[b.INT_VEC3=35668]="INT_VEC3",b[b.INT_VEC4=35669]="INT_VEC4",b[b.BOOL=35670]="BOOL",b[b.BOOL_VEC2=35671]="BOOL_VEC2",b[b.BOOL_VEC3=35672]="BOOL_VEC3",b[b.BOOL_VEC4=35673]="BOOL_VEC4",b[b.FLOAT_MAT2=35674]="FLOAT_MAT2",b[b.FLOAT_MAT3=35675]="FLOAT_MAT3",b[b.FLOAT_MAT4=35676]="FLOAT_MAT4",b[b.SAMPLER_2D=35678]="SAMPLER_2D",b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE",b[b.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",b[b.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",b[b.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",b[b.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",b[b.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",b[b.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",b[b.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",b[b.COMPILE_STATUS=35713]="COMPILE_STATUS",b[b.LOW_FLOAT=36336]="LOW_FLOAT",b[b.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",b[b.HIGH_FLOAT=36338]="HIGH_FLOAT",b[b.LOW_INT=36339]="LOW_INT",b[b.MEDIUM_INT=36340]="MEDIUM_INT",b[b.HIGH_INT=36341]="HIGH_INT",b[b.FRAMEBUFFER=36160]="FRAMEBUFFER",b[b.RENDERBUFFER=36161]="RENDERBUFFER",b[b.RGBA4=32854]="RGBA4",b[b.RGB5_A1=32855]="RGB5_A1",b[b.RGB565=36194]="RGB565",b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",b[b.STENCIL_INDEX=6401]="STENCIL_INDEX",b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8",b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL",b[b.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",b[b.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",b[b.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",b[b.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",b[b.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",b[b.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",b[b.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",b[b.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",b[b.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",b[b.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",b[b.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",b[b.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",b[b.NONE=0]="NONE",b[b.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",b[b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",b[b.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",b[b.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",b[b.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",b[b.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",b[b.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",b[b.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",b[b.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",b[b.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",b[b.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",b[b.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(G||(G={}))},69530:function(ft,C,y){"use strict";y.d(C,{Z:function(){return pt}});var G=y(96156),b=y(55770),p=y(6610),S=y(5991),L=y(3473),X=y(11700),N=y.n(X),q=y(14293),K=y.n(q),ae=y(68929),xe=y.n(ae),se=y(86700),Ft=y(58881),zt=y(72302),Wt=y(92364),Mt,wt,ot,tt,Yt,ke;function Ne(oe,re){var ue=Object.keys(oe);if(Object.getOwnPropertySymbols){var it=Object.getOwnPropertySymbols(oe);re&&(it=it.filter(function(Jt){return Object.getOwnPropertyDescriptor(oe,Jt).enumerable})),ue.push.apply(ue,it)}return ue}function Be(oe){for(var re=1;re<arguments.length;re++){var ue=arguments[re]!=null?arguments[re]:{};re%2?Ne(Object(ue),!0).forEach(function(it){(0,G.Z)(oe,it,ue[it])}):Object.getOwnPropertyDescriptors?Object.defineProperties(oe,Object.getOwnPropertyDescriptors(ue)):Ne(Object(ue)).forEach(function(it){Object.defineProperty(oe,it,Object.getOwnPropertyDescriptor(ue,it))})}return oe}var Ie=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,pt=(Mt=(0,se.b2)(),wt=(0,se.f3)(zt.v.IShaderModuleService),Mt(ot=(tt=(ke=function(){function oe(){(0,p.Z)(this,oe),(0,b.Z)(this,"shaderModuleService",Yt,this),this.rendererService=void 0,this.config=void 0,this.quad=Ie,this.enabled=!0,this.renderToScreen=!1,this.model=void 0,this.name=void 0,this.optionsToUpdate={}}return(0,S.Z)(oe,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(ue){this.name=ue}},{key:"getType",value:function(){return Wt.G.PostProcessing}},{key:"init",value:function(ue,it){this.config=it,this.rendererService=ue.getContainer().get(zt.v.IRendererService);var Jt=this.rendererService,ce=Jt.createAttribute,$e=Jt.createBuffer,Ae=Jt.createModel,Ce=this.setupShaders(),Pe=Ce.vs,et=Ce.fs,Se=Ce.uniforms;this.model=Ae({vs:Pe,fs:et,attributes:{a_Position:ce({buffer:$e({data:[-4,-4,4,-4,0,4],type:Ft.gl.FLOAT}),size:2})},uniforms:Be(Be({u_Texture:null},Se),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(ue){var it=this,Jt=ue.multiPassRenderer.getPostProcessor(),ce=this.rendererService,$e=ce.useFramebuffer,Ae=ce.getViewportSize,Ce=ce.clear,Pe=Ae(),et=Pe.width,Se=Pe.height;$e(this.renderToScreen?null:Jt.getWriteFBO(),function(){Ce({framebuffer:Jt.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),it.model.draw({uniforms:Be({u_Texture:Jt.getReadFBO(),u_ViewportSize:[et,Se]},it.convertOptionsToUniforms(it.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(ue){this.enabled=ue}},{key:"setRenderToScreen",value:function(ue){this.renderToScreen=ue}},{key:"updateOptions",value:function(ue){this.optionsToUpdate=Be(Be({},this.optionsToUpdate),ue)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(ue){var it={};return Object.keys(ue).forEach(function(Jt){K()(ue[Jt])||(it["u_".concat(N()(xe()(Jt)))]=ue[Jt])}),it}}]),oe}(),ke),Yt=(0,L.Z)(tt.prototype,"shaderModuleService",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt))||ot)},19793:function(ft,C,y){"use strict";y.d(C,{P:function(){return G}});var G=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(ft,C,y){"use strict";y.d(C,{v:function(){return G}});var G={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(ft,C,y){"use strict";var G=y(74691),b=null;function p(oe){return b.indexOf(oe)}var S=2,L=4,X=64,N=128,q=256,K=512,ae=8192,xe=16384,se=32768,Ft=null,zt=131072,Wt=262144,Mt=524288,wt=1048576,ot=2097152,tt=4194304,Yt=8388608,ke=16777216,Ne=null;function Be(oe,re){return oe=_clamp(Math.floor(oe),0,255),re=_clamp(Math.floor(re),0,255),256*oe+re}function Ie(oe){var re=oe.color,ue=oe.radius,it=oe.tileX,Jt=oe.tileY,ce=oe.shape,$e=oe.opacity,Ae=oe.stroke,Ce=oe.strokeWidth,Pe=oe.strokeOpacity,et=[],Se=[],Pt=[],vr=[Be(re[0],re[1]),Be(re[2],re[3])],_r=[Be(Ae[0],Ae[1]),Be(Ae[2],Ae[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Yr){var tr=_slicedToArray(Yr,2),ne=tr[0],be=tr[1];et.push([].concat(vr,[(ne+1)*Yt+(be+1)*ot+getShapeIndex(ce)*zt+ue,(it+512)*Mt+(Jt+512)*X])),Se.push([].concat(_r,[Ce,Pe])),Pt.push([$e,0,0,0])}),{packedBuffer:et,packedBuffer2:Se,packedBuffer3:Pt}}function pt(oe,re){if(oe===0&&!re)return 0;if(oe===1&&re)return 4294967295;var ue=re?1:0,it=Math.floor(oe*127);return it*Ne+ue*ke+it*zt+ue*Ft+it*K+ue*q+it*S+ue}},94936:function(ft,C,y){"use strict";y.d(C,{zP:function(){return l0},JE:function(){return ly},ns:function(){return u0}});var G=y(67294),b=(0,G.createContext)({});function p(){return(0,G.useContext)(b)}var S=y(58881),L=y(96156),X=y(28481),N=y(6610),q=y(5991),K=y(10379),ae=y(46070),xe=y(77608),se=y(82887),Ft=y(26729);function zt(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Wt(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?zt(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):zt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Mt(i){var l=wt();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ot;(function(i){i.TOPRIGHT="topright",i.TOPLEFT="topleft",i.BOTTOMRIGHT="bottomright",i.BOTTOMLEFT="bottomleft"})(ot||(ot={}));var tt=0,Yt=function(i){(0,K.Z)(o,i);var l=Mt(o);function o(s){var c;return(0,N.Z)(this,o),c=l.call(this),c.controlOption=void 0,c.container=void 0,c.sceneContainer=void 0,c.mapsService=void 0,c.renderService=void 0,c.layerService=void 0,c.controlService=void 0,c.isShow=void 0,c.controlOption=Wt(Wt({},c.getDefault()),s||{}),c}return(0,q.Z)(o,[{key:"getDefault",value:function(){return{position:ot.TOPRIGHT,name:"".concat(tt++)}}},{key:"setPosition",value:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=c,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(c){this.mapsService=c.get(S.vK.IMapService),this.renderService=c.get(S.vK.IRendererService),this.layerService=c.get(S.vK.ILayerService),this.controlService=c.get(S.vK.IControlService),this.sceneContainer=c,this.isShow=!0,this.container=this.onAdd();var d=this.container,_=this.controlOption.position,A=this.controlService.controlCorners[_];return se.DOM.addClass(d,"l7-control"),_.indexOf("bottom")!==-1?A.insertBefore(d,A.firstChild):A.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var c=this.container;se.DOM.addClass(c,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var c=this.container;se.DOM.removeClass(c,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;se.DOM.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(c){if(this.mapsService&&c&&c.screenX>0&&c.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),o}(Ft.EventEmitter),ke=y(63349);function Ne(i){var l=Be();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Be(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ie=function(i){(0,K.Z)(o,i);var l=Ne(o);function o(s){var c;return(0,N.Z)(this,o),c=l.call(this,s),c.layerControlInputs=void 0,c.layers=void 0,c.lastZIndex=void 0,c.handlingClick=void 0,c.layersLink=void 0,c.baseLayersList=void 0,c.separator=void 0,c.overlaysList=void 0,c.form=void 0,c.layerControlInputs=[],c.layers=[],c.lastZIndex=0,c.handlingClick=!1,c.initLayers(),(0,se.bindAll)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ke.Z)(c)),c}return(0,q.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:S.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var c=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",c.onLayerChange),d.layer.on("add",c.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(c,d){return this.addLayer(c,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var c=this.renderService.getViewportSize(),d=c.height;se.DOM.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=d-(this.container.offsetTop+50);return _<this.form.clientHeight?(se.DOM.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):se.DOM.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return se.DOM.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var c=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",c.onLayerChange),d.layer.off("add",c.onLayerChange)}))}},{key:"initLayout",value:function(){var c="l7-control-layers",d=this.container=se.DOM.create("div",c),_=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var A=this.form=se.DOM.create("form",c+"-list");_&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=se.DOM.create("a",c+"-toggle",d);var I=this.layersLink;I.title="Layers",_||this.expand(),this.baseLayersList=se.DOM.create("div",c+"-base",A),this.separator=se.DOM.create("div",c+"-separator",A),this.overlaysList=se.DOM.create("div",c+"-overlays",A),d.appendChild(A)}},{key:"initLayers",value:function(){var c=this,d=this.controlOption,_=d.baseLayers,A=_===void 0?{}:_,I=d.overlayers,D=I===void 0?{}:I;Object.keys(A).forEach(function(Q,Y){c.addLayer(A[Q],Q,!1)}),Object.keys(D).forEach(function(Q,Y){c.addLayer(D[Q],Q,!0)})}},{key:"update",value:function(){if(!this.container)return this;se.DOM.empty(this.baseLayersList),se.DOM.empty(this.overlaysList),this.layerControlInputs=[];var c,d,_,A,I=0;for(_=0;_<this.layers.length;_++)A=this.layers[_],this.addItem(A),d=d||A.overlay,c=c||!A.overlay,I+=A.overlay?0:1;return this.controlOption.hideSingleBase&&(c=c&&I>1,this.baseLayersList.style.display=c?"":"none"),this.separator.style.display=d&&c?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var c=this.layerControlInputs,d,_,A=this.mapsService.getZoom(),I=c.length-1;I>=0;I--)if(d=c[I],_=this.layerService.getLayer(d.layerId),_&&_.inited){var D=_.getMinZoom(),Q=_.getMaxZoom();d.disabled=A<D||A>Q}}},{key:"addLayer",value:function(c,d,_){this.mapsService&&(c.on("add",this.onLayerChange),c.on("remove",this.onLayerChange)),this.layers.push({layer:c,name:d,overlay:_});var A=this.controlOption,I=A.sortLayers,D=A.sortFunction,Q=A.autoZIndex;I&&this.layers.sort(function(Y,fe){return D(Y.layer,fe.layer,Y.name,fe.name)}),Q&&c.setZIndex&&(this.lastZIndex++,c.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(c){this.handlingClick||this.update();var d=this.layerService.getLayer(c.target.layerId),_=d!=null&&d.overlay?c.type==="add"?"overlayadd":"overlayremove":c.type==="add"?"baselayerchange":null;_&&this.emit(_,d)}},{key:"createRadioElement",value:function(c,d){var _='<input type="radio" class="l7-control-layers-selector" name="'+c+'"'+(d?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=_,A.firstChild}},{key:"addItem",value:function(c){var d=document.createElement("label"),_=this.layerService.getLayer(c.layer.id),A=_&&_.inited&&c.layer.isVisible(),I;c.overlay?(I=document.createElement("input"),I.type="checkbox",I.className="l7-control-layers-selector",I.defaultChecked=A):I=this.createRadioElement("l7-base-layers",A),this.layerControlInputs.push(I),I.layerId=c.layer.id,I.addEventListener("click",this.onInputClick);var D=document.createElement("span");D.innerHTML=" "+c.name;var Q=document.createElement("div");d.appendChild(Q),Q.appendChild(I),Q.appendChild(D);var Y=c.overlay?this.overlaysList:this.baseLayersList;return Y.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var c=this.layerControlInputs,d,_,A=[],I=[];this.handlingClick=!0;for(var D=c.length-1;D>=0;D--)d=c[D],_=this.layerService.getLayer(d.layerId),d.checked?A.push(_):d.checked||I.push(_);I.forEach(function(Q){Q.hide()}),A.forEach(function(Q){Q.show()}),this.handlingClick=!1}}]),o}(Yt);function pt(i){var l=oe();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function oe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var re=function(i){(0,K.Z)(o,i);var l=pt(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getDefault",value:function(){return{position:ot.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var c="l7-control-logo",d=se.DOM.create("div",c),_=se.DOM.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),d.appendChild(_),d}},{key:"onRemove",value:function(){return null}}]),o}(Yt);function ue(i){var l=it();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function it(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Jt=function(i){(0,K.Z)(o,i);var l=ue(o);function o(s){var c;return(0,N.Z)(this,o),c=l.call(this,s),c.mScale=void 0,c.iScale=void 0,(0,se.bindAll)(["update"],(0,ke.Z)(c)),c}return(0,q.Z)(o,[{key:"getDefault",value:function(){return{position:ot.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var c="l7-control-scale",d=se.DOM.create("div",c);this.addScales(c+"-line",d);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var c=this.controlOption.updateWhenIdle;this.mapsService.off(c?"zoomend":"zoomchange",this.update),this.mapsService.off(c?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var c=this.mapsService,d=this.controlOption.maxWidth,_=c.getSize()[1]/2,A=c.containerToLngLat([0,_]),I=c.containerToLngLat([d,_]),D=(0,se.lnglatDistance)([A.lng,A.lat],[I.lng,I.lat]);this.updateScales(D)}},{key:"updateScales",value:function(c){var d=this.controlOption,_=d.metric,A=d.imperial;_&&c&&this.updateMetric(c),A&&c&&this.updateImperial(c)}},{key:"updateMetric",value:function(c){var d=this.getRoundNum(c),_=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,_,d/c)}},{key:"updateImperial",value:function(c){var d=c*3.2808399,_,A,I;d>5280?(_=d/5280,A=this.getRoundNum(_),this.updateScale(this.iScale,A+" mi",A/_)):(I=this.getRoundNum(d),this.updateScale(this.iScale,I+" ft",I/d))}},{key:"updateScale",value:function(c,d,_){var A=this.controlOption.maxWidth;c.style.width=Math.round(A*_)+"px",c.innerHTML=d}},{key:"getRoundNum",value:function(c){var d=Math.pow(10,(Math.floor(c)+"").length-1),_=c/d;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,d*_}},{key:"addScales",value:function(c,d){var _=this.controlOption,A=_.metric,I=_.imperial;A&&(this.mScale=se.DOM.create("div",c,d)),I&&(this.iScale=se.DOM.create("div",c,d))}}]),o}(Yt);function ce(i){var l=$e();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function $e(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ae=function(i){(0,K.Z)(o,i);var l=ce(o);function o(s){var c;return(0,N.Z)(this,o),c=l.call(this,s),c.disabled=void 0,c.zoomInButton=void 0,c.zoomOutButton=void 0,(0,se.bindAll)(["updateDisabled","zoomIn","zoomOut"],(0,ke.Z)(c)),c}return(0,q.Z)(o,[{key:"getDefault",value:function(){return{position:ot.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var c="l7-control-zoom",d=se.DOM.create("div",c+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,c+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,c+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(c,d,_,A,I){var D=se.DOM.create("a",_,A);return D.innerHTML=c,D.title=d,D.href="javascript:void(0)",D.addEventListener("click",I),D}},{key:"updateDisabled",value:function(){var c=this.mapsService,d="l7-disabled";se.DOM.removeClass(this.zoomInButton,d),se.DOM.removeClass(this.zoomOutButton,d),(this.disabled||c.getZoom()<=c.getMinZoom())&&se.DOM.addClass(this.zoomOutButton,d),(this.disabled||c.getZoom()>=c.getMaxZoom())&&se.DOM.addClass(this.zoomInButton,d)}}]),o}(Yt);function Ce(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Pe(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Ce(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ce(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function et(i){var l=Se();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Se(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Pt=function(i){(0,K.Z)(o,i);var l=et(o);function o(s){var c;return(0,N.Z)(this,o),c=l.call(this),c.markerOption=void 0,c.defaultMarker=void 0,c.popup=void 0,c.mapsService=void 0,c.sceneSerive=void 0,c.lngLat=void 0,c.scene=void 0,c.added=!1,c.eventHandle=function(d){c.emit(d.type,{target:d,data:c.markerOption.extData,lngLat:c.lngLat})},c.markerOption=Pe(Pe({},c.getDefault()),s),(0,se.bindAll)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ke.Z)(c)),c.init(),c}return(0,q.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:se.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(c){this.scene=c,this.mapsService=c.get(S.vK.IMapService),this.sceneSerive=c.get(S.vK.ISceneService);var d=this.markerOption,_=d.element,A=d.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var c=this.markerOption.element;return c&&se.DOM.remove(c),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(c){return this.lngLat=c,Array.isArray(c)&&(this.lngLat={lng:c[0],lat:c[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(c){var d=this;if(!this.added)return this.once("added",function(){d.setElement(c)}),this;var _=this.markerOption.element;return _&&se.DOM.remove(_),this.markerOption.element=c,this.init(),this.mapsService.getMarkerContainer().appendChild(c),this.registerMarkerEvent(c),this.update(),this}},{key:"openPopup",value:function(){var c=this;if(!this.added)return this.once("added",function(){c.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var c=this;this.added||this.once("added",function(){c.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(c){return this.popup=c,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var c=this.popup;if(c)c.isOpen()?c.remove():c.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(c){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(c){this.markerOption.extData=c}},{key:"update",value:function(){if(!!this.mapsService){var c=this.markerOption,d=c.element,_=c.anchor;this.updatePosition(),se.DOM.setTransform(d,"".concat(se.anchorTranslate[_]))}}},{key:"onMapClick",value:function(c){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var c=this.markerOption,d=c.element,_=c.offsets,A=this.lngLat,I=A.lng,D=A.lat,Q=this.mapsService.getBounds(),Y=this.mapsService.lngLatToContainer([I,D]);if(d){d.style.display="block";var fe=this.mapsService.getContainer(),Ye=0,ct=0;if(fe&&(Ye=fe.scrollWidth,ct=fe.scrollHeight),Math.abs(Q[0][0])>180||Math.abs(Q[1][0])>180){if(Y.x>Ye){var Bt=this.mapsService.lngLatToContainer([I-360,D]);Y.x=Bt.x}if(Y.x<0){var Sr=this.mapsService.lngLatToContainer([I+360,D]);Y.x=Sr.x}}(Y.x>Ye||Y.x<0||Y.y>ct||Y.y<0)&&(d.style.display="none"),d.style.left=Y.x+_[0]+"px",d.style.top=Y.y-_[1]+"px"}}}},{key:"init",value:function(){var c=this,d=this.markerOption.element,_=this.markerOption,A=_.color,I=_.anchor;if(!d){this.defaultMarker=!0,d=se.DOM.create("div"),this.markerOption.element=d;var D=document.createElementNS("http://www.w3.org/2000/svg","svg");D.setAttributeNS(null,"display","block"),D.setAttributeNS(null,"height","48px"),D.setAttributeNS(null,"width","48px"),D.setAttributeNS(null,"viewBox","0 0 1024 1024");var Q=document.createElementNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),Q.setAttributeNS(null,"fill",A),D.appendChild(Q),d.appendChild(D)}se.DOM.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(Y){var fe,Ye,ct=((fe=c.markerOption)===null||fe===void 0?void 0:fe.style)&&((Ye=c.markerOption)===null||Ye===void 0?void 0:Ye.style[Y]);d&&(d.style[Y]=ct)}),d.addEventListener("click",function(Y){c.onMapClick(Y)}),d.addEventListener("click",this.eventHandle),(0,se.applyAnchorClass)(d,I,"marker")}},{key:"registerMarkerEvent",value:function(c){c.addEventListener("mousemove",this.eventHandle),c.addEventListener("click",this.eventHandle),c.addEventListener("mousedown",this.eventHandle),c.addEventListener("mouseup",this.eventHandle),c.addEventListener("dblclick",this.eventHandle),c.addEventListener("contextmenu",this.eventHandle),c.addEventListener("mouseover",this.eventHandle),c.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var c=this.getElement();c.removeEventListener("mousemove",this.eventHandle),c.removeEventListener("click",this.eventHandle),c.removeEventListener("mousedown",this.eventHandle),c.removeEventListener("mouseup",this.eventHandle),c.removeEventListener("dblclick",this.eventHandle),c.removeEventListener("contextmenu",this.eventHandle),c.removeEventListener("mouseover",this.eventHandle),c.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(c){throw new Error("Method not implemented.")}},{key:"onUp",value:function(c){throw new Error("Method not implemented.")}}]),o}(Ft.EventEmitter),vr=y(82492),_r=y.n(vr),Yr=y(69848),tr=y.n(Yr);function ne(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function be(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?ne(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ne(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function De(i){var l=at();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function at(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var kt=function(i){(0,K.Z)(o,i);var l=De(o);function o(s){var c,d;return(0,N.Z)(this,o),d=l.call(this),d.markers=[],d.markerLayerOption=void 0,d.clusterIndex=void 0,d.points=[],d.clusterMarkers=[],d.mapsService=void 0,d.scene=void 0,d.zoom=void 0,d.bbox=void 0,d.markerLayerOption=_r()(d.getDefault(),s),(0,se.bindAll)(["update"],(0,ke.Z)(d)),d.zoom=((c=d.markerLayerOption.clusterOption)===null||c===void 0?void 0:c.zoom)||-99,d}return(0,q.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(c){return this.scene=c,this.mapsService=c.get(S.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(c){var d=this.markerLayerOption.cluster;d&&this.addPoint(c,this.markers.length),this.markers.push(c)}},{key:"removeMarker",value:function(c){this.markers.indexOf(c);var d=this.markers.indexOf(c);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(c){c.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(c){c.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var c=this.markerLayerOption.cluster;return c?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var c=this;this.getMarkers().forEach(function(d){d.addTo(c.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(c){c.remove()}),this.clusterMarkers.forEach(function(c){c.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(c,d){var _=c.getLnglat(),A=_.lng,I=_.lat,D={geometry:{type:"Point",coordinates:[A,I]},properties:be(be({},c.getExtData()),{},{marker_id:d})};this.points.push(D)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var c=this.markerLayerOption.clusterOption,d=c.radius,_=c.minZoom,A=_===void 0?0:_,I=c.maxZoom;this.clusterIndex=new(tr())({radius:d,minZoom:A,maxZoom:I}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(c,d){var _=this,A=c[0].concat(c[1]),I=this.clusterIndex.getClusters(A,d);this.clusterMarkers.forEach(function(D){D.remove()}),this.clusterMarkers=[],I.forEach(function(D){var Q,Y=_.markerLayerOption.clusterOption,fe=Y.field,Ye=Y.method;if(D.properties&&(Q=D.properties)!==null&&Q!==void 0&&Q.cluster_id){var ct,Bt=_.getLeaves((ct=D.properties)===null||ct===void 0?void 0:ct.cluster_id);if(D.properties.clusterData=Bt,fe&&Ye){var Sr=Bt==null?void 0:Bt.map(function(Gn){var Li=(0,L.Z)({},fe,Gn.properties[fe]);return Li}),Pr=se.Satistics.getColumn(Sr,fe),Ur=se.Satistics.getSatByColumn(Ye,Pr),dn="point_"+Ye;D.properties[dn]=Ur.toFixed(2)}}var _n=_.clusterMarker(D);_.clusterMarkers.push(_n),_n.addTo(_.scene)})}},{key:"getLeaves",value:function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return c?this.clusterIndex.getLeaves(c,d,_):null}},{key:"clusterMarker",value:function(c){var d=this.markerLayerOption.clusterOption,_=d,A=_.element,I=A===void 0?this.generateElement.bind(this):A,D=new Pt({element:I(c)}).setLnglat({lng:c.geometry.coordinates[0],lat:c.geometry.coordinates[1]});return D}},{key:"normalMarker",value:function(c){var d=c.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var c=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(c-this.zoom)>=1||!(0,se.boundsContains)(this.bbox,d))&&(this.bbox=(0,se.padBounds)(d,.5),this.zoom=Math.floor(c),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(c){var d=se.DOM.create("div","l7-marker-cluster"),_=se.DOM.create("div","",d),A=se.DOM.create("span","",_),I=this.markerLayerOption.clusterOption,D=I.field,Q=I.method;c.properties.point_count=c.properties.point_count||1;var Y=D&&Q?c.properties["point_"+Q]||c.properties[D]:c.properties.point_count;return A.textContent=Y,d}}]),o}(Ft.EventEmitter);function jt(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function w(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?jt(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):jt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function F(i){var l=de();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function de(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ue=function(i){(0,K.Z)(o,i);var l=F(o);function o(s){var c;return(0,N.Z)(this,o),c=l.call(this),c.popupOption=void 0,c.mapsService=void 0,c.sceneSerive=void 0,c.lngLat=void 0,c.content=void 0,c.closeButton=void 0,c.timeoutInstance=void 0,c.container=void 0,c.tip=void 0,c.scene=void 0,c.popupOption=w(w({},c.getdefault()),s),(0,se.bindAll)(["update","onClickClose","remove"],(0,ke.Z)(c)),c}return(0,q.Z)(o,[{key:"addTo",value:function(c){var d=this;return this.mapsService=c.get(S.vK.IMapService),this.sceneSerive=c.get(S.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=c,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(c){var d=window.document.createDocumentFragment(),_=window.document.createElement("body"),A;for(_.innerHTML=c;A=_.firstChild,!!A;)d.appendChild(A);return this.setDOMContent(d)}},{key:"setLnglat",value:function(c){return this.lngLat=c,Array.isArray(c)&&(this.lngLat={lng:c[0],lat:c[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(c){return this.setDOMContent(window.document.createTextNode(c))}},{key:"setMaxWidth",value:function(c){return this.popupOption.maxWidth=c,this.update(),this}},{key:"setDOMContent",value:function(c){return this.createContent(),this.content.appendChild(c),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&se.DOM.remove(this.content),this.content=se.DOM.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=se.DOM.create("button","l7-popup-close-button",this.content),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(c,d,_){var A=window.document.createElement(c);return d!==void 0&&(A.className=d),_&&_.appendChild(A),A}},{key:"removeDom",value:function(c){c.parentNode&&c.parentNode.removeChild(c)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:se.anchorType.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(c){c.stopPropagation&&c.stopPropagation(),this.remove()}},{key:"update",value:function(){var c=this,d=this.lngLat,_=this.popupOption,A=_.className,I=_.maxWidth,D=_.anchor;if(!(!this.mapsService||!d||!this.content)){var Q=this.mapsService.getMarkerContainer();if(!this.container&&Q){this.container=this.creatDom("div","l7-popup",Q),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&A.split(" ").forEach(function(fe){return c.container.classList.add(fe)});var Y=this.popupOption.stopPropagation;Y&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(fe){c.container.addEventListener(fe,function(Ye){Ye.stopPropagation()})})}I&&this.container.style.maxWidth!==I&&(this.container.style.maxWidth=I),this.updatePosition(),se.DOM.setTransform(this.container,"".concat(se.anchorTranslate[D])),(0,se.applyAnchorClass)(this.container,D,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var c=this.lngLat,d=c.lng,_=c.lat,A=this.popupOption.offsets,I=this.mapsService.lngLatToContainer([d,_]);this.container.style.left=I.x+A[0]+"px",this.container.style.top=I.y-A[1]+"px"}}}]),o}(Ft.EventEmitter);y(68982)(`/* @antv/l7-component */
.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-flex-direction: column-reverse;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-flex-direction: column;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-flex-direction: row;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-flex-direction: row-reverse;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-flex;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var Qe=y(92137),Tt=y(87757),Dt=y.n(Tt),H=y(86700),Qt=y(81550),$t=y.n(Qt),wr=function(){function i(l,o){(0,N.Z)(this,i),this.attribute=void 0,this.buffer=void 0;var s=o.buffer,c=o.offset,d=o.stride,_=o.normalized,A=o.size,I=o.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:c||0,stride:d||0,normalized:_||!1,divisor:I||0},A&&(this.attribute.size=A)}return(0,q.Z)(i,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Tr,Mr,Or,Je,At,_t,pr,en,mt,Nt,ar,xr,xn,In,Ei=(Tr={},(0,L.Z)(Tr,S.gl.POINTS,"points"),(0,L.Z)(Tr,S.gl.LINES,"lines"),(0,L.Z)(Tr,S.gl.LINE_LOOP,"line loop"),(0,L.Z)(Tr,S.gl.LINE_STRIP,"line strip"),(0,L.Z)(Tr,S.gl.TRIANGLES,"triangles"),(0,L.Z)(Tr,S.gl.TRIANGLE_FAN,"triangle fan"),(0,L.Z)(Tr,S.gl.TRIANGLE_STRIP,"triangle strip"),Tr),Ai=(Mr={},(0,L.Z)(Mr,S.gl.STATIC_DRAW,"static"),(0,L.Z)(Mr,S.gl.DYNAMIC_DRAW,"dynamic"),(0,L.Z)(Mr,S.gl.STREAM_DRAW,"stream"),Mr),Bi=(Or={},(0,L.Z)(Or,S.gl.BYTE,"int8"),(0,L.Z)(Or,S.gl.UNSIGNED_INT,"int16"),(0,L.Z)(Or,S.gl.INT,"int32"),(0,L.Z)(Or,S.gl.UNSIGNED_BYTE,"uint8"),(0,L.Z)(Or,S.gl.UNSIGNED_SHORT,"uint16"),(0,L.Z)(Or,S.gl.UNSIGNED_INT,"uint32"),(0,L.Z)(Or,S.gl.FLOAT,"float"),Or),aa=(Je={},(0,L.Z)(Je,S.gl.ALPHA,"alpha"),(0,L.Z)(Je,S.gl.LUMINANCE,"luminance"),(0,L.Z)(Je,S.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,L.Z)(Je,S.gl.RGB,"rgb"),(0,L.Z)(Je,S.gl.RGBA,"rgba"),(0,L.Z)(Je,S.gl.RGBA4,"rgba4"),(0,L.Z)(Je,S.gl.RGB5_A1,"rgb5 a1"),(0,L.Z)(Je,S.gl.RGB565,"rgb565"),(0,L.Z)(Je,S.gl.DEPTH_COMPONENT,"depth"),(0,L.Z)(Je,S.gl.DEPTH_STENCIL,"depth stencil"),Je),hi=(At={},(0,L.Z)(At,S.gl.DONT_CARE,"dont care"),(0,L.Z)(At,S.gl.NICEST,"nice"),(0,L.Z)(At,S.gl.FASTEST,"fast"),At),V=(_t={},(0,L.Z)(_t,S.gl.NEAREST,"nearest"),(0,L.Z)(_t,S.gl.LINEAR,"linear"),(0,L.Z)(_t,S.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,L.Z)(_t,S.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,L.Z)(_t,S.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,L.Z)(_t,S.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),_t),te=(pr={},(0,L.Z)(pr,S.gl.REPEAT,"repeat"),(0,L.Z)(pr,S.gl.CLAMP_TO_EDGE,"clamp"),(0,L.Z)(pr,S.gl.MIRRORED_REPEAT,"mirror"),pr),le=(en={},(0,L.Z)(en,S.gl.NONE,"none"),(0,L.Z)(en,S.gl.BROWSER_DEFAULT_WEBGL,"browser"),en),we=(mt={},(0,L.Z)(mt,S.gl.NEVER,"never"),(0,L.Z)(mt,S.gl.ALWAYS,"always"),(0,L.Z)(mt,S.gl.LESS,"less"),(0,L.Z)(mt,S.gl.LEQUAL,"lequal"),(0,L.Z)(mt,S.gl.GREATER,"greater"),(0,L.Z)(mt,S.gl.GEQUAL,"gequal"),(0,L.Z)(mt,S.gl.EQUAL,"equal"),(0,L.Z)(mt,S.gl.NOTEQUAL,"notequal"),mt),je=(Nt={},(0,L.Z)(Nt,S.gl.FUNC_ADD,"add"),(0,L.Z)(Nt,S.gl.MIN_EXT,"min"),(0,L.Z)(Nt,S.gl.MAX_EXT,"max"),(0,L.Z)(Nt,S.gl.FUNC_SUBTRACT,"subtract"),(0,L.Z)(Nt,S.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Nt),ht=(ar={},(0,L.Z)(ar,S.gl.ZERO,"zero"),(0,L.Z)(ar,S.gl.ONE,"one"),(0,L.Z)(ar,S.gl.SRC_COLOR,"src color"),(0,L.Z)(ar,S.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,L.Z)(ar,S.gl.SRC_ALPHA,"src alpha"),(0,L.Z)(ar,S.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,L.Z)(ar,S.gl.DST_COLOR,"dst color"),(0,L.Z)(ar,S.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,L.Z)(ar,S.gl.DST_ALPHA,"dst alpha"),(0,L.Z)(ar,S.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,L.Z)(ar,S.gl.CONSTANT_COLOR,"constant color"),(0,L.Z)(ar,S.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,L.Z)(ar,S.gl.CONSTANT_ALPHA,"constant alpha"),(0,L.Z)(ar,S.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,L.Z)(ar,S.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),ar),xt=(xr={},(0,L.Z)(xr,S.gl.NEVER,"never"),(0,L.Z)(xr,S.gl.ALWAYS,"always"),(0,L.Z)(xr,S.gl.LESS,"less"),(0,L.Z)(xr,S.gl.LEQUAL,"lequal"),(0,L.Z)(xr,S.gl.GREATER,"greater"),(0,L.Z)(xr,S.gl.GEQUAL,"gequal"),(0,L.Z)(xr,S.gl.EQUAL,"equal"),(0,L.Z)(xr,S.gl.NOTEQUAL,"notequal"),xr),ge=(xn={},(0,L.Z)(xn,S.gl.ZERO,"zero"),(0,L.Z)(xn,S.gl.KEEP,"keep"),(0,L.Z)(xn,S.gl.REPLACE,"replace"),(0,L.Z)(xn,S.gl.INVERT,"invert"),(0,L.Z)(xn,S.gl.INCR,"increment"),(0,L.Z)(xn,S.gl.DECR,"decrement"),(0,L.Z)(xn,S.gl.INCR_WRAP,"increment wrap"),(0,L.Z)(xn,S.gl.DECR_WRAP,"decrement wrap"),xn),Ke=(In={},(0,L.Z)(In,S.gl.FRONT,"front"),(0,L.Z)(In,S.gl.BACK,"back"),In),Ut=function(){function i(l,o){(0,N.Z)(this,i),this.buffer=void 0;var s=o.data,c=o.usage,d=o.type;this.buffer=l.buffer({data:s,usage:Ai[c||S.gl.STATIC_DRAW],type:Bi[d||S.gl.UNSIGNED_BYTE]})}return(0,q.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var s=o.data,c=o.offset;this.buffer.subdata(s,c)}}]),i}(),Fr=function(){function i(l,o){(0,N.Z)(this,i),this.elements=void 0;var s=o.data,c=o.usage,d=o.type,_=o.count;this.elements=l.elements({data:s,usage:Ai[c||S.gl.STATIC_DRAW],type:Bi[d||S.gl.UNSIGNED_BYTE],count:_})}return(0,q.Z)(i,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var s=o.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),i}(),jr=function(){function i(l,o){(0,N.Z)(this,i),this.framebuffer=void 0;var s=o.width,c=o.height,d=o.color,_=o.colors,A=o.depth,I=o.stencil,D={width:s,height:c};Array.isArray(_)&&(D.colors=_.map(function(Q){return Q.get()})),d&&typeof d!="boolean"&&(D.color=d.get()),this.framebuffer=l.framebuffer(D)}return(0,q.Z)(i,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var s=o.width,c=o.height;this.framebuffer.resize(s,c)}}]),i}(),Xt=y(90484),mr=y(36719),Hr=y.n(mr),gn=y(68630),gr=y.n(gn);function vn(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function $r(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?vn(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):vn(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var cn=function(){function i(l,o){(0,N.Z)(this,i),this.reGl=void 0,this.destroyed=!1,this.drawCommand=void 0,this.drawParams=void 0,this.options=void 0,this.uniforms={},this.reGl=l;var s=o.vs,c=o.fs,d=o.attributes,_=o.uniforms,A=o.primitive,I=o.count,D=o.elements,Q=o.depth,Y=o.blend,fe=o.stencil,Ye=o.cull,ct=o.instances,Bt={};this.options=o,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(Ur){Bt[Ur]=l.prop(Ur)}));var Sr={};Object.keys(d).forEach(function(Ur){Sr[Ur]=d[Ur].get()});var Pr={attributes:Sr,frag:c,uniforms:Bt,vert:s,primitive:Ei[A===void 0?S.gl.TRIANGLES:A]};ct&&(Pr.instances=ct),I&&(Pr.count=I),D&&(Pr.elements=D.get()),this.initDepthDrawParams({depth:Q},Pr),this.initBlendDrawParams({blend:Y},Pr),this.initStencilDrawParams({stencil:fe},Pr),this.initCullDrawParams({cull:Ye},Pr),this.drawCommand=l(Pr),this.drawParams=Pr}return(0,q.Z)(i,[{key:"addUniforms",value:function(o){this.uniforms=$r($r({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=$r($r({},this.uniforms),this.extractUniforms(o.uniforms||{})),c={};Object.keys(s).forEach(function(d){var _=(0,Xt.Z)(s[d]);_==="boolean"||_==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?c[d]=s[d]:c[d]=s[d].get()}),this.drawCommand(c)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,s){var c=o.depth;c&&(s.depth={enable:c.enable===void 0?!0:!!c.enable,mask:c.mask===void 0?!0:!!c.mask,func:we[c.func||S.gl.LESS],range:c.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,s){var c=o.blend;if(c){var d=c.enable,_=c.func,A=c.equation,I=c.color,D=I===void 0?[0,0,0,0]:I;s.blend={enable:!!d,func:{srcRGB:ht[_&&_.srcRGB||S.gl.SRC_ALPHA],srcAlpha:ht[_&&_.srcAlpha||S.gl.SRC_ALPHA],dstRGB:ht[_&&_.dstRGB||S.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:ht[_&&_.dstAlpha||S.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:je[A&&A.rgb||S.gl.FUNC_ADD],alpha:je[A&&A.alpha||S.gl.FUNC_ADD]},color:D}}}},{key:"initStencilDrawParams",value:function(o,s){var c=o.stencil;if(c){var d=c.enable,_=c.mask,A=_===void 0?-1:_,I=c.func,D=I===void 0?{cmp:S.gl.ALWAYS,ref:0,mask:-1}:I,Q=c.opFront,Y=Q===void 0?{fail:S.gl.KEEP,zfail:S.gl.KEEP,zpass:S.gl.KEEP}:Q,fe=c.opBack,Ye=fe===void 0?{fail:S.gl.KEEP,zfail:S.gl.KEEP,zpass:S.gl.KEEP}:fe;s.stencil={enable:!!d,mask:A,func:$r($r({},D),{},{cmp:xt[D.cmp]}),opFront:{fail:ge[Y.fail],zfail:ge[Y.zfail],zpass:ge[Y.zpass]},opBack:{fail:ge[Ye.fail],zfail:ge[Ye.zfail],zpass:ge[Ye.zpass]}}}}},{key:"initCullDrawParams",value:function(o,s){var c=o.cull;if(c){var d=c.enable,_=c.face,A=_===void 0?S.gl.BACK:_;s.cull={enable:!!d,face:Ke[A]}}}},{key:"extractUniforms",value:function(o){var s=this,c={};return Object.keys(o).forEach(function(d){s.extractUniformsRecursively(d,o[d],c,"")}),c}},{key:"extractUniformsRecursively",value:function(o,s,c,d){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||Hr()(s)||s===""||"resize"in s){c["".concat(d&&d+".").concat(o)]=s;return}gr()(s)&&Object.keys(s).forEach(function(A){_.extractUniformsRecursively(A,s[A],c,"".concat(d&&d+".").concat(o))}),Array.isArray(s)&&s.forEach(function(A,I){Object.keys(A).forEach(function(D){_.extractUniformsRecursively(D,A[D],c,"".concat(d&&d+".").concat(o,"[").concat(I,"]"))})})}}]),i}(),pi=function(){function i(l,o){(0,N.Z)(this,i),this.texture=void 0,this.width=void 0,this.height=void 0;var s=o.data,c=o.type,d=c===void 0?S.gl.UNSIGNED_BYTE:c,_=o.width,A=o.height,I=o.flipY,D=I===void 0?!1:I,Q=o.format,Y=Q===void 0?S.gl.RGBA:Q,fe=o.mipmap,Ye=fe===void 0?!1:fe,ct=o.wrapS,Bt=ct===void 0?S.gl.CLAMP_TO_EDGE:ct,Sr=o.wrapT,Pr=Sr===void 0?S.gl.CLAMP_TO_EDGE:Sr,Ur=o.aniso,dn=Ur===void 0?0:Ur,_n=o.alignment,Gn=_n===void 0?1:_n,Li=o.premultiplyAlpha,qn=Li===void 0?!1:Li,qi=o.mag,Fa=qi===void 0?S.gl.NEAREST:qi,Ua=o.min,di=Ua===void 0?S.gl.NEAREST:Ua,Ca=o.colorSpace,uo=Ca===void 0?S.gl.BROWSER_DEFAULT_WEBGL:Ca;this.width=_,this.height=A;var Wu={width:_,height:A,type:Bi[d],format:aa[Y],wrapS:te[Bt],wrapT:te[Pr],mag:V[Fa],min:V[di],alignment:Gn,flipY:D,colorSpace:le[uo],premultiplyAlpha:qn,aniso:dn};s&&(Wu.data=s),typeof Ye=="number"?Wu.mipmap=hi[Ye]:typeof Ye=="boolean"&&(Wu.mipmap=Ye),this.texture=l.texture(Wu)}return(0,q.Z)(i,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var s=o.width,c=o.height;this.texture.resize(s,c),this.width=s,this.height=c}},{key:"destroy",value:function(){this.texture.destroy()}}]),i}(),fn,gi,Wi,vi=(fn=(0,H.b2)(),fn(gi=(Wi=function(){function i(){var l=this;(0,N.Z)(this,i),this.gl=void 0,this.$container=void 0,this.canvas=void 0,this.width=void 0,this.height=void 0,this.isDirty=void 0,this.createModel=function(o){return new cn(l.gl,o)},this.createAttribute=function(o){return new wr(l.gl,o)},this.createBuffer=function(o){return new Ut(l.gl,o)},this.createElements=function(o){return new Fr(l.gl,o)},this.createTexture2D=function(o){return new pi(l.gl,o)},this.createFramebuffer=function(o){return new jr(l.gl,o)},this.useFramebuffer=function(o,s){l.gl({framebuffer:o?o.get():null})(s)},this.clear=function(o){var s=o.color,c=o.depth,d=o.stencil,_=o.framebuffer,A=_===void 0?null:_,I={color:s,depth:c,stencil:d};I.framebuffer=A===null?A:A.get(),l.gl.clear(I)},this.viewport=function(o){var s=o.x,c=o.y,d=o.width,_=o.height;l.gl._gl.viewport(s,c,d,_),l.width=d,l.height=_,l.gl._refresh()},this.readPixels=function(o){var s=o.framebuffer,c=o.x,d=o.y,_=o.width,A=o.height,I={x:c,y:d,width:_,height:A};return s&&(I.framebuffer=s.get()),l.gl.read(I)},this.getViewportSize=function(){return{width:l.gl._gl.drawingBufferWidth,height:l.gl._gl.drawingBufferHeight}},this.getContainer=function(){var o;return(o=l.canvas)===null||o===void 0?void 0:o.parentElement},this.getCanvas=function(){return l.canvas},this.getGLContext=function(){return l.gl._gl},this.destroy=function(){l.gl.destroy()}}return(0,q.Z)(i,[{key:"init",value:function(){var l=(0,Qe.Z)(Dt().mark(function s(c,d){var _=this;return Dt().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.canvas=c,I.next=3,new Promise(function(D,Q){$t()({canvas:_.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(fe,Ye){(fe||!Ye)&&Q(fe),D(Ye)}})});case 3:this.gl=I.sent;case 4:case"end":return I.stop()}},s,this)}));function o(s,c){return l.apply(this,arguments)}return o}()},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),i}(),Wi))||gi);function Ri(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Ii(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Ri(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ri(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var go=function(){function i(l){(0,N.Z)(this,i),this.sceneService=void 0,this.mapService=void 0,this.controlService=void 0,this.layerService=void 0,this.iconService=void 0,this.markerService=void 0,this.popupService=void 0,this.fontService=void 0,this.interactionService=void 0,this.container=void 0;var o=l.id,s=l.map,c=(0,S.Hp)();this.container=c,s.setContainer(c,o),c.bind(S.vK.IRendererService).to(vi).inSingletonScope(),this.sceneService=c.get(S.vK.ISceneService),this.mapService=c.get(S.vK.IMapService),this.iconService=c.get(S.vK.IIconService),this.fontService=c.get(S.vK.IFontService),this.controlService=c.get(S.vK.IControlService),this.layerService=c.get(S.vK.ILayerService),this.markerService=c.get(S.vK.IMarkerService),this.interactionService=c.get(S.vK.IInteractionService),this.popupService=c.get(S.vK.IPopupService),this.initComponent(o),this.sceneService.init(l),this.initControl()}return(0,q.Z)(i,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var s=this;if(this.sceneService.loaded){var c=new o(this);c.init()}else this.on("loaded",function(){var d=new o(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var s=(0,S.e7)(this.container);o.setContainer(s),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,s){this.fontService.addIconFont(o,s)}},{key:"addIconFonts",value:function(o){var s=this;o.forEach(function(c){var d=(0,X.Z)(c,2),_=d[0],A=d[1];s.fontService.addIconFont(_,A)})}},{key:"addFontFace",value:function(o,s){this.sceneService.addFontFace(o,s)}},{key:"addImage",value:function(o,s){this.iconService.addImage(o,s)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,s){S.SceneEventList.indexOf(o)===-1?this.mapService.on(o,s):this.sceneService.on(o,s)}},{key:"off",value:function(o,s){S.SceneEventList.indexOf(o)===-1?this.mapService.off(o,s):this.sceneService.off(o,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,s){return this.mapService.setCenter(o,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,s){var c=this.sceneService.getSceneConfig(),d=c.fitBoundsOptions,_=c.animate;this.mapService.fitBounds(o,s||Ii(Ii({},d),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(o,s){this.mapService.setZoomAndCenter(o,s)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,s){this.container.bind(S.vK.IPostProcessingPass).to(o).whenTargetNamed(s)}},{key:"initComponent",value:function(o){this.controlService.init({container:se.DOM.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),s=o.logoVisible,c=o.logoPosition;s&&this.addControl(new re({position:c}))}}]),i}(),ji=y(81253),Rn=y(55770),Dn=y(3473),ui=y(13218),Vn=y.n(ui),za=y(23560),ds=y.n(za),Di=y(46343),Na=y(86387),Eu=y.n(Na),fu,ya,lo,Ga,Ha,Xo;function oa(i){return i.map(function(l){return typeof l=="string"&&(l=[l,{}]),l})}var Wa=(fu=(0,H.b2)(),ya=(0,H.f3)(S.vK.IGlobalConfigService),fu(lo=(Ga=(Xo=function(){function i(){(0,N.Z)(this,i),(0,Rn.Z)(this,"configService",Ha,this),this.enabled=void 0}return(0,q.Z)(i,[{key:"apply",value:function(o,s){var c=this,d=s.rendererService,_=s.postProcessingPassFactory,A=s.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var I=o.getLayerConfig(),D=I.enableMultiPassRenderer,Q=I.passes,Y=Q===void 0?[]:Q;c.enabled=!!D&&o.getLayerConfig().enableMultiPassRenderer!==!1,c.enabled&&(o.multiPassRenderer=c.createMultiPassRenderer(o,Y,_,A),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,s,c,d){var _=o.multiPassRenderer,A=o.getLayerConfig(),I=A.enablePicking,D=A.enableTAA;return I&&_.add(d("pixelPicking")),_}}]),i}(),Xo),Ha=(0,Dn.Z)(Ga.prototype,"configService",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ga))||lo),wa,_a=(wa={},(0,L.Z)(wa,S.BlendType.additive,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(wa,S.BlendType.none,{enable:!1}),(0,L.Z)(wa,S.BlendType.normal,{enable:!0,func:{srcRGB:S.gl.SRC_ALPHA,dstRGB:S.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(wa,S.BlendType.subtractive,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE,srcAlpha:S.gl.ZERO,dstAlpha:S.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:S.gl.FUNC_SUBTRACT,alpha:S.gl.FUNC_SUBTRACT}}),(0,L.Z)(wa,S.BlendType.max,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE},equation:{rgb:S.gl.MAX_EXT}}),(0,L.Z)(wa,S.BlendType.min,{enable:!0,func:{srcRGB:S.gl.ONE,dstRGB:S.gl.ONE},equation:{rgb:S.gl.MIN_EXT}}),wa),ra={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},sl,ts,to,Oa,fa,he,Oe,gt;function fr(i,l){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=tn(i))||l&&i&&typeof i.length=="number"){o&&(i=o);var s=0,c=function(){};return{s:c,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){_=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw A}}}}function tn(i,l){if(!!i){if(typeof i=="string")return kn(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return kn(i,l)}}function kn(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function Zi(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Xi(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Zi(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Zi(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Xa(i){var l=Ya();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Yo=0,Ss=(sl=(0,S.yT)(S.vK.ILogService),ts=(0,S.yT)(S.vK.IGlobalConfigService),to=(0,S.yT)(S.vK.IShaderModuleService),Oa=(gt=function(i){(0,K.Z)(o,i);var l=Xa(o);function o(){var s,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,N.Z)(this,o),s=l.call(this),s.id="".concat(Yo++),s.name="".concat(Yo),s.type=void 0,s.visible=!0,s.zIndex=0,s.minZoom=void 0,s.maxZoom=void 0,s.inited=!1,s.layerModelNeedUpdate=!1,s.pickedFeatureID=null,s.selectedFeatureID=null,s.styleNeedUpdate=!1,s.dataState={dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1},s.hooks={init:new Di.oI,afterInit:new Di.oI,beforeRender:new Di.oI,beforeRenderData:new Di.gg,afterRender:new Di.ni,beforePickingEncode:new Di.ni,afterPickingEncode:new Di.ni,beforeHighlight:new Di.ni(["pickedColor"]),afterHighlight:new Di.ni,beforeSelect:new Di.ni(["pickedColor"]),afterSelect:new Di.ni,beforeDestroy:new Di.ni,afterDestroy:new Di.ni},s.models=[],s.multiPassRenderer=void 0,s.plugins=void 0,s.sourceOption=void 0,s.layerModel=void 0,(0,Rn.Z)(s,"logger",fa,(0,ke.Z)(s)),(0,Rn.Z)(s,"configService",he,(0,ke.Z)(s)),(0,Rn.Z)(s,"shaderModuleService",Oe,(0,ke.Z)(s)),s.cameraService=void 0,s.coordinateService=void 0,s.iconService=void 0,s.fontService=void 0,s.pickingService=void 0,s.rendererService=void 0,s.layerService=void 0,s.interactionService=void 0,s.mapService=void 0,s.styleAttributeService=void 0,s.layerSource=void 0,s.postProcessingPassFactory=void 0,s.normalPassFactory=void 0,s.animateOptions={enable:!1},s.container=void 0,s.encodedData=void 0,s.configSchema=void 0,s.currentPickId=null,s.rawConfig=void 0,s.needUpdateConfig=void 0,s.pendingStyleAttributes=[],s.scaleOptions={},s.animateStartTime=void 0,s.aniamateStatus=!1,s.sourceEvent=function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),_=d.autoFit,A=d.fitBoundsOptions;_&&s.fitBounds(A),s.emit("dataUpdate"),s.reRender()},s.name=c.name||s.id,s.zIndex=c.zIndex||0,s.rawConfig=c,s}return(0,q.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(c){if(!this.inited)this.needUpdateConfig=Xi(Xi({},this.needUpdateConfig),c);else{var d=this.container.get(S.vK.SceneID);this.configService.setLayerConfig(d,this.id,Xi(Xi(Xi({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),c)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(c){this.container=c}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(c){return this.plugins.push(c),this}},{key:"init",value:function(){var c=this,d=this.container.get(S.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,A=_===void 0?!1:_;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:A}),this.iconService=this.container.get(S.vK.IIconService),this.fontService=this.container.get(S.vK.IFontService),this.rendererService=this.container.get(S.vK.IRendererService),this.layerService=this.container.get(S.vK.ILayerService),this.interactionService=this.container.get(S.vK.IInteractionService),this.pickingService=this.container.get(S.vK.IPickingService),this.mapService=this.container.get(S.vK.IMapService),this.cameraService=this.container.get(S.vK.ICameraService),this.coordinateService=this.container.get(S.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(S.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(S.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(S.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(S.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(Y){var fe=Y.attributeName,Ye=Y.attributeField,ct=Y.attributeValues,Bt=Y.updateOptions;c.styleAttributeService.updateStyleAttribute(fe,{scale:Xi({field:Ye},c.splitValuesAndCallbackInAttribute(ct,c.getLayerConfig()[fe]))},Bt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(S.vK.ILayerPlugin);var I=fr(this.plugins),D;try{for(I.s();!(D=I.n()).done;){var Q=D.value;Q.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(Y){I.e(Y)}finally{I.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Xi(Xi({},this.getDefaultConfig()),this.rawConfig));var c=this.getLayerConfig(),d=c.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(c,d,_){return this.updateStyleAttribute("color",c,d,_),this}},{key:"texture",value:function(c,d,_){return this.updateStyleAttribute("texture",c,d,_),this}},{key:"rotate",value:function(c,d,_){return this.updateStyleAttribute("rotate",c,d,_),this}},{key:"size",value:function(c,d,_){return this.updateStyleAttribute("size",c,d,_),this}},{key:"filter",value:function(c,d,_){return this.updateStyleAttribute("filter",c,d,_),this}},{key:"shape",value:function(c,d,_){return this.updateStyleAttribute("shape",c,d,_),this}},{key:"label",value:function(c,d,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:c,attributeValues:d,updateOptions:_}),this}},{key:"animate",value:function(c){var d={};return Vn()(c)?(d.enable=!0,d=Xi(Xi({},d),c)):d.enable=c,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(c,d){return this.sourceOption={data:c,options:d},this}},{key:"setData",value:function(c,d){var _=this;return this.inited?this.layerSource.setData(c,d):this.on("inited",function(){_.layerSource.setData(c,d)}),this}},{key:"style",value:function(c){var d=this,_=c.passes,A=(0,ji.Z)(c,["passes"]);return _&&oa(_).forEach(function(I){var D=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(I[0]);D&&D.updateOptions(I[1])}),this.rawConfig=Xi(Xi({},this.rawConfig),A),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(c,d){return Vn()(c)?this.scaleOptions=Xi(Xi({},this.scaleOptions),c):this.scaleOptions[c]=d,this}},{key:"render",value:function(){return this.renderModels(),this}},{key:"active",value:function(c){var d={};return d.enableHighlight=Vn()(c)?!0:c,Vn()(c)?(d.enableHighlight=!0,c.color&&(d.highlightColor=c.color)):d.enableHighlight=!!c,this.updateLayerConfig(d),this}},{key:"setActive",value:function(c,d){var _=this;if(Vn()(c)){var A=c.x,I=A===void 0?0:A,D=c.y,Q=D===void 0?0:D;this.updateLayerConfig({highlightColor:Vn()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:I,y:Q})}else this.updateLayerConfig({pickedFeatureID:c,highlightColor:Vn()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,se.encodePickingColor)(c)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(c){var d={};return d.enableSelect=Vn()(c)?!0:c,Vn()(c)?(d.enableSelect=!0,c.color&&(d.selectColor=c.color)):d.enableSelect=!!c,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(c,d){var _=this;if(Vn()(c)){var A=c.x,I=A===void 0?0:A,D=c.y,Q=D===void 0?0:D;this.updateLayerConfig({selectColor:Vn()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:I,y:Q})}else this.updateLayerConfig({pickedFeatureID:c,selectColor:Vn()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,se.encodePickingColor)(c)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(c){this.updateLayerConfig({blend:c}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(c){return this.zIndex=c,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(c){this.currentPickId=c}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(c){this.selectedFeatureID=c}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var c=this.mapService.getZoom(),d=this.getLayerConfig(),_=d.visible,A=d.minZoom,I=A===void 0?-Infinity:A,D=d.maxZoom,Q=D===void 0?Infinity:D;return!!_&&c>=I&&c<=Q}},{key:"setMinZoom",value:function(c){return this.updateLayerConfig({minZoom:c}),this}},{key:"getMinZoom",value:function(){var c=this.getLayerConfig(),d=c.minZoom;return d}},{key:"getMaxZoom",value:function(){var c=this.getLayerConfig(),d=c.maxZoom;return d}},{key:"get",value:function(c){var d=this.getLayerConfig();return d[c]}},{key:"setMaxZoom",value:function(c){return this.updateLayerConfig({maxZoom:c}),this}},{key:"fitBounds",value:function(c){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),_=d.extent,A=_.some(function(I){return Math.abs(I)===Infinity});return A?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],c),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(c){return c.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(c){return c.needRescale||c.needRemapping||c.needRegenerateVertices}).length}},{key:"setSource",value:function(c){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=c,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(c){this.encodedData=c}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=Eu()([ra,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(c){var d=this.styleAttributeService.getLayerAttributeScale(c);if(d){if(d.ticks){var _=d.ticks().map(function(I){return(0,L.Z)({value:I},c,d(I))});return _}else if(d.invertExtent){var A=d.range().map(function(I){return(0,L.Z)({value:d.invertExtent(I)},c,I)});return A}}else return[]}},{key:"pick",value:function(c){var d=c.x,_=c.y;this.interactionService.triggerHover({x:d,y:_})}},{key:"boxSelect",value:function(c,d){this.pickingService.boxPickLayer(this,c,d)}},{key:"buildLayerModel",value:function(c){var d=c.moduleName,_=c.vertexShader,A=c.fragmentShader,I=c.triangulation,D=(0,ji.Z)(c,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(d,{vs:_,fs:A});var Q=this.shaderModuleService.getModule(d),Y=Q.vs,fe=Q.fs,Ye=Q.uniforms,ct=this.rendererService.createModel,Bt=this.styleAttributeService.createAttributesAndIndices(this.encodedData,I),Sr=Bt.attributes,Pr=Bt.elements;return ct(Xi({attributes:Sr,uniforms:Ye,fs:fe,vs:Y,elements:Pr,blend:_a[S.BlendType.normal]},D))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(c){var d=this.getLayerConfig(),_=d.enableHighlight,A=_===void 0?!0:_,I=d.enableSelect,D=I===void 0?!0:I,Q=this.eventNames().indexOf(c)!==-1||this.eventNames().indexOf("un"+c)!==-1;return(c==="click"||c==="dblclick")&&D&&(Q=!0),c==="mousemove"&&(A||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(Q=!0),this.isVisible()&&Q}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var c=this;return this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:c.layerModel.getUninforms()})}),this}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(c,d){return{values:ds()(c)?void 0:c||d,callback:ds()(c)?c:void 0}}},{key:"updateStyleAttribute",value:function(c,d,_,A){this.inited?this.styleAttributeService.updateStyleAttribute(c,{scale:Xi({field:d},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[d]))},A):this.pendingStyleAttributes.push({attributeName:c,attributeField:d,attributeValues:_,updateOptions:A})}}]),o}(Ft.EventEmitter),gt),fa=(0,Dn.Z)(Oa.prototype,"logger",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=(0,Dn.Z)(Oa.prototype,"configService",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oe=(0,Dn.Z)(Oa.prototype,"shaderModuleService",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa),Hl,Xu,ko,Ls,co,Rs,La=(Hl=(0,S.yT)(S.vK.IGlobalConfigService),Xu=(0,S.yT)(S.vK.IShaderModuleService),ko=(Rs=function(){function i(l){(0,N.Z)(this,i),this.triangulation=void 0,this.layer=void 0,(0,Rn.Z)(this,"configService",Ls,this),(0,Rn.Z)(this,"shaderModuleService",co,this),this.rendererService=void 0,this.iconService=void 0,this.fontService=void 0,this.styleAttributeService=void 0,this.mapService=void 0,this.cameraService=void 0,this.layerService=void 0,this.layer=l,this.rendererService=l.getContainer().get(S.vK.IRendererService),this.styleAttributeService=l.getContainer().get(S.vK.IStyleAttributeService),this.mapService=l.getContainer().get(S.vK.IMapService),this.iconService=l.getContainer().get(S.vK.IIconService),this.fontService=l.getContainer().get(S.vK.IFontService),this.cameraService=l.getContainer().get(S.vK.ICameraService),this.layerService=l.getContainer().get(S.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate()}return(0,q.Z)(i,[{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),s=o.blend,c=s===void 0?"normal":s;return _a[S.BlendType[c]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),i}(),Rs),Ls=(0,Dn.Z)(ko.prototype,"configService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),co=(0,Dn.Z)(ko.prototype,"shaderModuleService",[Xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko),li=y(85061),ul=y(9187),xa=y.n(ul),Nn=y(31437),Ys=Nn.create(),Wl=Nn.create(),fo=Nn.create(),Ze=Nn.create(),Ot=Nn.create();function br(i,l,o,s,c){Nn.add(i,o,s),Nn.normalize(i,i),l=Nn.fromValues(-i[1],i[0]);var d=Nn.fromValues(-o[1],o[0]);return[c/Nn.dot(l,d),l]}function On(i,l){return Nn.set(i,-l[1],l[0])}function Hi(i,l,o){return Nn.sub(i,l,o),Nn.normalize(i,i),i}function ba(i,l){return i[0]===l[0]&&i[1]===l[1]}function Za(i){for(var l=new Map,o=0;o<i.length;o++){var s=i[0].toString()+"-"+i[1].toString();l.get(s)?(i.splice(o,1),o++):l.set(s,s)}return i}var na=function(){function i(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,N.Z)(this,i),this.complex=void 0,this.join=void 0,this.cap=void 0,this.miterLimit=void 0,this.thickness=void 0,this.normal=void 0,this.lastFlip=-1,this.miter=Nn.fromValues(0,0),this.started=!1,this.dash=!1,this.totalDistance=0,this.join=l.join||"miter",this.cap=l.cap||"butt",this.miterLimit=l.miterLimit||10,this.thickness=l.thickness||1,this.dash=l.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,q.Z)(i,[{key:"extrude_gaode2",value:function(o,s){var c=this.complex;if(o.length<=1)return c;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=o.length,_=c.startIndex,A=1;A<d;A++){var I=o[A-1],D=s[A-1],Q=o[A],Y=s[A],fe=A<o.length-1?o[A+1]:null,Ye=A<s.length-1?s[A+1]:null,ct=this.segment_gaode2(c,_,I,Q,fe,D,Y,Ye);_+=ct}if(this.dash)for(var Bt=0;Bt<c.positions.length/6;Bt++)c.positions[Bt*6+5]=this.totalDistance;return c.startIndex=c.positions.length/6,c}},{key:"extrude",value:function(o){var s=this.complex;if(o.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var c=o.length,d=s.startIndex,_=1;_<c;_++){var A=o[_-1],I=o[_],D=_<o.length-1?o[_+1]:null,Q=this.segment(s,d,A,I,D);d+=Q}if(this.dash)for(var Y=0;Y<s.positions.length/6;Y++)s.positions[Y*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(o,s,c,d,_,A,I,D){var Q=0,Y=o.indices,fe=o.positions,Ye=o.normals,ct=this.cap==="square",Bt=this.join==="bevel",Sr=(0,se.aProjectFlat)([I[0],I[1]]),Pr=(0,se.aProjectFlat)([A[0],A[1]]);Hi(fo,d,c);var Ur=0;if(this.dash&&(Ur=this.lineSegmentDistance(Sr,Pr),this.totalDistance+=Ur),this.normal||(this.normal=Nn.create(),On(this.normal,fo)),!this.started)if(this.started=!0,ct){var dn=Nn.create(),_n=Nn.create();Nn.add(dn,this.normal,fo),Nn.add(_n,this.normal,fo),Ye.push(_n[0],_n[1],0),Ye.push(dn[0],dn[1],0),fe.push(c[0],c[1],0,this.totalDistance-Ur,-this.thickness,0),fe.push(c[0],c[1],0,this.totalDistance-Ur,this.thickness,0)}else this.extrusions(fe,Ye,c,this.normal,this.thickness,this.totalDistance-Ur);if(Y.push(s+0,s+1,s+2),_){ba(d,_)&&Nn.add(_,d,Nn.normalize(_,Nn.subtract(_,d,c))),Hi(Ze,_,d);var qn=br(Ot,Nn.create(),fo,Ze,this.thickness),qi=(0,X.Z)(qn,2),Fa=qi[0],Ua=qi[1],di=Nn.dot(Ot,this.normal)<0?-1:1,Ca=Bt;if(!Ca&&this.join==="miter"){var uo=Fa;uo>this.miterLimit&&(Ca=!0)}Ca?(Ye.push(this.normal[0],this.normal[1],0),Ye.push(Ua[0],Ua[1],0),fe.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness*di,0),Y.push.apply(Y,(0,li.Z)(this.lastFlip!==-di?[s,s+2,s+3]:[s+2,s+1,s+3])),Y.push(s+2,s+3,s+4),On(Ys,Ze),Nn.copy(this.normal,Ys),Ye.push(this.normal[0],this.normal[1],0),fe.push(d[0],d[1],0,this.totalDistance,-this.thickness*di,0),Q+=3):(this.extrusions(fe,Ye,d,Ua,Fa,this.totalDistance),Y.push.apply(Y,(0,li.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),di=-1,Nn.copy(this.normal,Ua),Q+=2),this.lastFlip=di}else{if(On(this.normal,fo),ct){var Gn=Nn.create(),Li=Nn.create();Nn.sub(Li,fo,this.normal),Nn.add(Gn,fo,this.normal),Ye.push(Li[0],Li[1],0),Ye.push(Gn[0],Gn[1],0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness,0),fe.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(fe,Ye,d,this.normal,this.thickness,this.totalDistance);Y.push.apply(Y,(0,li.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Q+=2}return Q}},{key:"segment",value:function(o,s,c,d,_){var A=0,I=o.indices,D=o.positions,Q=o.normals,Y=this.cap==="square",fe=this.join==="bevel",Ye=(0,se.aProjectFlat)([d[0],d[1]]),ct=(0,se.aProjectFlat)([c[0],c[1]]);Hi(fo,Ye,ct);var Bt=0;if(this.dash&&(Bt=this.lineSegmentDistance(Ye,ct),this.totalDistance+=Bt),this.normal||(this.normal=Nn.create(),On(this.normal,fo)),!this.started)if(this.started=!0,Y){var Sr=Nn.create(),Pr=Nn.create();Nn.add(Sr,this.normal,fo),Nn.add(Pr,this.normal,fo),Q.push(Pr[0],Pr[1],0),Q.push(Sr[0],Sr[1],0),D.push(c[0],c[1],0,this.totalDistance-Bt,-this.thickness,0),D.push(c[0],c[1],0,this.totalDistance-Bt,this.thickness,0)}else this.extrusions(D,Q,c,this.normal,this.thickness,this.totalDistance-Bt);if(I.push(s+0,s+1,s+2),_){var _n=(0,se.aProjectFlat)([_[0],_[1]]);ba(Ye,_n)&&Nn.add(_n,Ye,Nn.normalize(_n,Nn.subtract(_n,Ye,ct))),Hi(Ze,_n,Ye);var Gn=br(Ot,Nn.create(),fo,Ze,this.thickness),Li=(0,X.Z)(Gn,2),qn=Li[0],qi=Li[1],Fa=Nn.dot(Ot,this.normal)<0?-1:1,Ua=fe;if(!Ua&&this.join==="miter"){var di=qn;di>this.miterLimit&&(Ua=!0)}Ua?(Q.push(this.normal[0],this.normal[1],0),Q.push(qi[0],qi[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*Fa,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness*Fa,0),I.push.apply(I,(0,li.Z)(this.lastFlip!==-Fa?[s,s+2,s+3]:[s+2,s+1,s+3])),I.push(s+2,s+3,s+4),On(Ys,Ze),Nn.copy(this.normal,Ys),Q.push(this.normal[0],this.normal[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*Fa,0),A+=3):(this.extrusions(D,Q,d,qi,qn,this.totalDistance),I.push.apply(I,(0,li.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Fa=-1,Nn.copy(this.normal,qi),A+=2),this.lastFlip=Fa}else{if(On(this.normal,fo),Y){var Ur=Nn.create(),dn=Nn.create();Nn.sub(dn,fo,this.normal),Nn.add(Ur,fo,this.normal),Q.push(dn[0],dn[1],0),Q.push(Ur[0],Ur[1],0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(D,Q,d,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,li.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),A+=2}return A}},{key:"extrusions",value:function(o,s,c,d,_,A){s.push(d[0],d[1],0),s.push(d[0],d[1],0),o.push(c[0],c[1],0,A,-_,0),o.push(c[0],c[1],0,A,_,0)}},{key:"lineSegmentDistance",value:function(o,s){var c=s[0]-o[0],d=s[1]-o[1];return Math.sqrt(c*c+d*d)}}]),i}(),Ra=y(81763),Fo=y.n(Ra);function Mo(i){if(Fo()(i[0]))return i;if(Fo()(i[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Fo()(i[0][0][0])){var l=i,o=0,s=0,c=0;return l.forEach(function(d){d.forEach(function(_){o+=_[0],s+=_[1],c++})}),[o/c,s/c,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var yi=y(77160);function Yu(i){var l=i[0][0],o=i[0][i[0].length-1];l[0]===o[0]&&l[1]===o[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var s=i[0].length,c=xa().flatten(i),d=c.vertices,_=c.dimensions,A=[],I=[],D=0;D<d.length/_;D++)_===2?A.push(d[D*2],d[D*2+1],1):A.push(d[D*3],d[D*3+1],1);var Q=xa()(c.vertices,c.holes,c.dimensions);I.push.apply(I,(0,li.Z)(Q));for(var Y=function(ct){var Bt=c.vertices.slice(ct*_,(ct+1)*_),Sr=c.vertices.slice((ct+1)*_,(ct+2)*_);Sr.length===0&&(Sr=c.vertices.slice(0,_));var Pr=A.length/3;A.push(Bt[0],Bt[1],1,Sr[0],Sr[1],1,Bt[0],Bt[1],0,Sr[0],Sr[1],0),I.push.apply(I,(0,li.Z)([0,2,1,2,3,1].map(function(Ur){return Ur+Pr})))},fe=0;fe<s;fe++)Y(fe);return{positions:A,index:I}}function hu(i){var l=xa().flatten(i),o=xa()(l.vertices,l.holes,l.dimensions);return{positions:l.vertices,index:o}}function Ko(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=i[0][0],s=i[0][i[0].length-1];o[0]===s[0]&&o[1]===s[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var c=i[0].length,d=xa().flatten(i),_=d.vertices,A=d.dimensions,I=[],D=[],Q=[],Y=0;Y<_.length/A;Y++)A===2?I.push(_[Y*2],_[Y*2+1],1,-1,-1):I.push(_[Y*3],_[Y*3+1],1,-1,-1),Q.push(0,0,1);var fe=xa()(d.vertices,d.holes,d.dimensions);D.push.apply(D,(0,li.Z)(fe));for(var Ye=function(Sr){var Pr=d.vertices.slice(Sr*A,(Sr+1)*A),Ur=d.vertices.slice((Sr+1)*A,(Sr+2)*A);Ur.length===0&&(Ur=d.vertices.slice(0,A));var dn=I.length/5;I.push(Pr[0],Pr[1],1,0,0,Ur[0],Ur[1],1,.1,0,Pr[0],Pr[1],0,0,.8,Ur[0],Ur[1],0,.1,.8);var _n=ll([Ur[0],Ur[1],1],[Pr[0],Pr[1],0],[Pr[0],Pr[1],1],l);Q.push.apply(Q,(0,li.Z)(_n).concat((0,li.Z)(_n),(0,li.Z)(_n),(0,li.Z)(_n))),D.push.apply(D,(0,li.Z)([1,2,0,3,2,1].map(function(Gn){return Gn+dn})))},ct=0;ct<c;ct++)Ye(ct);return{positions:I,index:D,normals:Q}}function ll(i,l,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,c=yi.create(),d=yi.create(),_=yi.create();s&&(i=(0,se.lngLatToMeters)(i),l=(0,se.lngLatToMeters)(l),o=(0,se.lngLatToMeters)(o));var A=yi.fromValues.apply(yi,(0,li.Z)(i)),I=yi.fromValues.apply(yi,(0,li.Z)(l)),D=yi.fromValues.apply(yi,(0,li.Z)(o));yi.sub(c,D,I),yi.sub(d,A,I),yi.cross(_,c,d);var Q=yi.create();return yi.normalize(Q,_),Q}var Eo,Es;(function(i){i.CYLINDER="cylinder",i.SQUARECOLUMN="squareColumn",i.TRIANGLECOLUMN="triangleColumn",i.HEXAGONCOLUMN="hexagonColumn",i.PENTAGONCOLUMN="pentagonColumn"})(Es||(Es={}));var Io;(function(i){i.CIRCLE="circle",i.SQUARE="square",i.TRIANGLE="triangle",i.HEXAGON="hexagon",i.PENTAGON="pentagon"})(Io||(Io={}));function pu(i){for(var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/i,s=[],c=0;c<i;c++)s.push(o*c+l*Math.PI/12);var d=s.map(function(_){var A=Math.sin(_+Math.PI/4),I=Math.cos(_+Math.PI/4);return[A,I,0]});return d}function Ds(){return pu(30)}function lc(){return pu(4)}function qc(){return pu(3)}function Ta(){return pu(6,1)}function bf(){return pu(5)}var ku=(Eo={},(0,L.Z)(Eo,Io.CIRCLE,Ds),(0,L.Z)(Eo,Io.HEXAGON,Ta),(0,L.Z)(Eo,Io.TRIANGLE,qc),(0,L.Z)(Eo,Io.SQUARE,lc),(0,L.Z)(Eo,Io.PENTAGON,bf),(0,L.Z)(Eo,Es.CYLINDER,Ds),(0,L.Z)(Eo,Es.HEXAGONCOLUMN,Ta),(0,L.Z)(Eo,Es.TRIANGLECOLUMN,qc),(0,L.Z)(Eo,Es.SQUARECOLUMN,lc),(0,L.Z)(Eo,Es.PENTAGONCOLUMN,bf),Eo),Cl={};function Lc(i){var l=Mo(i.coordinates);return{vertices:[].concat((0,li.Z)(l),(0,li.Z)(l),(0,li.Z)(l),(0,li.Z)(l)),indices:[0,1,2,2,3,0],size:l.length}}function cc(i){var l=i.shape,o=Rc(l,!1),s=o.positions,c=o.index,d=o.normals;return{vertices:s,indices:c,normals:d,size:5}}function ro(i){var l=Mo(i.coordinates);return{vertices:(0,li.Z)(l),indices:[0],size:l.length}}function cl(i){var l=i.coordinates,o=i.originCoordinates,s=i.version,c=new na({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=l;Array.isArray(d[0][0])||(d=[l]);var _=o;Array.isArray(_[0][0])||(_=[o]);for(var A=0;A<d.length;A++){var I=d[A],D=_[A];c.extrude_gaode2(I,D)}}else{var Q=l;Array.isArray(Q[0][0])||(Q=[l]),Q.forEach(function(fe){c.extrude(fe)})}var Y=c.complex;return{vertices:Y.positions,indices:Y.indices,normals:Y.normals,size:6}}function fl(i){var l=i.coordinates,o=xa().flatten(l),s=o.vertices,c=o.dimensions,d=o.holes;return{indices:xa()(s,d,c),vertices:s,size:c}}function rs(i){var l=i.coordinates,o=Ko(l,!0),s=o.positions,c=o.index,d=o.normals;return{vertices:s,indices:c,normals:d,size:5}}function fc(i){var l=i.shape,o=hl(l),s=o.positions,c=o.index;return{vertices:s,indices:c,size:3}}function Ku(i){var l=i.coordinates,o=[].concat((0,li.Z)(l[0]),[0,0,1,l[1][0],l[0][1],0,1,1],(0,li.Z)(l[1]),[0,1,0],(0,li.Z)(l[0]),[0,0,1],(0,li.Z)(l[1]),[0,1,0,l[0][0],l[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:o,indices:s,size:5}}function Ks(i){for(var l=30,o=i.coordinates,s=[],c=[],d=function(I){s.push(I,1,I,o[0][0],o[0][1],o[1][0],o[1][1],I,-1,I,o[0][0],o[0][1],o[1][0],o[1][1]),I!==l-1&&c.push.apply(c,(0,li.Z)([0,1,2,1,3,2].map(function(D){return I*2+D})))},_=0;_<l;_++)d(_);return{vertices:s,indices:c,size:7}}function $o(i){var l=i.coordinates;l.length===2&&l.push(0);var o=i.size,s=Sa(-1,1),c=Sa(1,1),d=Sa(-1,-1),_=Sa(1,-1),A=[].concat((0,li.Z)(l),(0,li.Z)(s),(0,li.Z)(l),(0,li.Z)(d),(0,li.Z)(l),(0,li.Z)(_),(0,li.Z)(l),(0,li.Z)(c)),I=[0,1,2,3,0,2];return{vertices:A,indices:I,size:5}}function Rc(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Cl&&Cl[i])return Cl[i];var o=ku[i]?ku[i]():ku.cylinder(),s=Ko([o],l);return Cl[i]=s,s}function wu(i,l){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,c=new Float32Array(i.length/o*3),d,_,A,I=vec3.create(),D=vec3.create(),Q=vec3.create(),Y=0,fe=l.length;Y<fe;Y+=3){d=l[Y+0]*3,_=l[Y+1]*3,A=l[Y+2]*3;var Ye=[i[d],i[d+1]],ct=[i[_],i[_+1]],Bt=[i[A],i[A+1]];s&&(Ye=lngLatToMeters(Ye),ct=lngLatToMeters(ct),Bt=lngLatToMeters(Bt));var Sr=Ye,Pr=_slicedToArray(Sr,2),Ur=Pr[0],dn=Pr[1],_n=vec3.fromValues(Ur,dn,i[d+2]),Gn=ct,Li=_slicedToArray(Gn,2),qn=Li[0],qi=Li[1],Fa=vec3.fromValues(qn,qi,i[_+2]),Ua=Bt,di=_slicedToArray(Ua,2),Ca=di[0],uo=di[1],Wu=vec3.fromValues(Ca,uo,i[A+2]);vec3.sub(I,Wu,Fa),vec3.sub(D,_n,Fa),vec3.cross(Q,I,D),c[d]+=I[0],c[d+1]+=I[1],c[d+2]+=I[2],c[_]+=I[0],c[_+1]+=I[1],c[_+2]+=I[2],c[A]+=I[0],c[A+1]+=I[1],c[A+2]+=I[2]}return $u(c),c}function $u(i){for(var l=0,o=i.length;l<o;l+=3){var s=vec3.fromValues(i[l],i[l+1],i[l+2]),c=vec3.create();vec3.normalize(c,s),i.set(c,l)}}function Df(i){var l=i[0][0],o=i[0][i[0].length-1];return l[0]===o[0]&&l[1]===o[1]}function hl(i){var l=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=ku[i]?ku[i]():ku.circle(),s=l.indexOf(i)===-1?hu([o]):Yu([o]);return s}function Sa(i,l){var o=(i+1)/2,s=(l+1)/2;return[o,s]}function Ju(i){var l=Xl();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Xl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Yl=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$s=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Dc=function(i){(0,K.Z)(o,i);var l=Ju(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=d===void 0?1:d,A=c.baseColor,I=A===void 0?"rgb(16,16,16)":A,D=c.brightColor,Q=D===void 0?"rgb(255,176,38)":D,Y=c.windowColor,fe=Y===void 0?"rgb(30,60,89)":Y,Ye=c.time,ct=Ye===void 0?0:Ye;return{u_opacity:_,u_baseColor:(0,se.rgb2arr)(I),u_brightColor:(0,se.rgb2arr)(Q),u_windowColor:(0,se.rgb2arr)(fe),u_time:this.layer.getLayerAnimateTime()||ct}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:$s,fragmentShader:Yl,triangulation:rs})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,A,I,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,A,I){var D=d.size,Q=D===void 0?10:D;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,A,I){var D=d.size;return[A[3],A[4]]}}})}}]),o}(La);function Kl(i){var l=$l();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function $l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Qu=function(i){(0,K.Z)(o,i);var l=Kl(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.type="PolygonLayer",s}return(0,q.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Dc(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(c){this.updateLayerConfig({time:c})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(Ss);function Tu(i){var l=Pl();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ml=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,pl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,kc=function(i){(0,K.Z)(o,i);var l=Tu(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.coverage,A=c.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Ml,fragmentShader:pl,triangulation:fc,depth:{enable:!1},primitive:S.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(La);function dl(i){var l=Js();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Js(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Il=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,ef=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,tf=function(i){(0,K.Z)(o,i);var l=dl(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.coverage,A=c.angle;return{u_opacity:d||1,u_coverage:_||1,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Il,fragmentShader:ef,triangulation:cc,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,A,I){var D=d.size;return Array.isArray(D)?[D[0]]:[D]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,A,I,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(La),pa=y(85975);function Jl(i,l){for(var o=[],s=[],c=[],d=i+1,_=l+1,A=i/2,I=l/2,D=0;D<_;D++)for(var Q=D-I,Y=0;Y<d;Y++){var fe=Y-A;s.push(fe/A,-Q/I,0),c.push(Y/i),c.push(1-D/l)}for(var Ye=0;Ye<l;Ye++)for(var ct=0;ct<i;ct++){var Bt=ct+d*Ye,Sr=ct+d*(Ye+1),Pr=ct+1+d*(Ye+1),Ur=ct+1+d*Ye;o.push(Bt,Sr,Ur),o.push(Sr,Pr,Ur)}return{vertices:s,indices:o,uvs:c}}var hc,qu,Ol;function pc(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Fu(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?pc(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):pc(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Fc(i){var l=rf();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var nf=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Ll=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,zc=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Nc=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,Bc=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,vl=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Uc=(hc=(0,H.b2)(),hc(qu=(Ol=function(i){(0,K.Z)(o,i);var l=Fc(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s.colorTexture=void 0,s.heatmapFramerBuffer=void 0,s.intensityModel=void 0,s.colorModel=void 0,s.shapeType=void 0,s}return(0,q.Z)(o,[{key:"render",value:function(){var c=this,d=this.rendererService,_=d.clear,A=d.useFramebuffer;A(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c.heatmapFramerBuffer}),c.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var c,d=this.rendererService,_=d.createFramebuffer,A=d.clear,I=d.getViewportSize,D=d.createTexture2D,Q=d.useFramebuffer,Y=this.styleAttributeService.getLayerStyleAttribute("shape"),fe=(Y==null||(c=Y.scale)===null||c===void 0?void 0:c.field)||"heatmap";this.shapeType=fe,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=fe==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Ye=this.layer.getLayerConfig(),ct=Ye.rampColors,Bt=(0,se.generateColorRamp)(ct),Sr=I(),Pr=Sr.width,Ur=Sr.height;return this.heatmapFramerBuffer=_({color:D({width:Math.floor(Pr/4),height:Math.floor(Ur/4),wrapS:S.gl.CLAMP_TO_EDGE,wrapT:S.gl.CLAMP_TO_EDGE,min:S.gl.LINEAR,mag:S.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:S.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,A,I){return[A[3],A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,A,I){var D=d.size,Q=D===void 0?1:D;return[Q]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:Bc,fragmentShader:Nc,triangulation:$o,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:S.gl.ONE,srcAlpha:1,dstRGB:S.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:vl,fs:zc});var c=this.shaderModuleService.getModule("heatmapColor"),d=c.vs,_=c.fs,A=c.uniforms,I=this.rendererService,D=I.createAttribute,Q=I.createElements,Y=I.createBuffer,fe=I.createModel;return fe({vs:d,fs:_,attributes:{a_Position:D({buffer:Y({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:S.gl.FLOAT}),size:3}),a_Uv:D({buffer:Y({data:[0,1,1,1,0,0,1,0],type:S.gl.FLOAT}),size:2})},uniforms:Fu({},A),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Q({data:[0,2,1,2,3,1],type:S.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.intensity,A=_===void 0?10:_,I=c.radius,D=I===void 0?5:I;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:D,u_intensity:A}})}},{key:"drawColorMode",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=pa.create();pa.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,li.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var c=this.rendererService.getViewportSize,d=c(),_=d.width,A=d.height,I=Jl(_/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Ll,fs:nf});var D=this.shaderModuleService.getModule("heatmap3dColor"),Q=D.vs,Y=D.fs,fe=D.uniforms,Ye=this.rendererService,ct=Ye.createAttribute,Bt=Ye.createElements,Sr=Ye.createBuffer,Pr=Ye.createModel;return Pr({vs:Q,fs:Y,attributes:{a_Position:ct({buffer:Sr({data:I.vertices,type:S.gl.FLOAT}),size:3}),a_Uv:ct({buffer:Sr({data:I.uvs,type:S.gl.FLOAT}),size:2})},primitive:S.gl.TRIANGLES,uniforms:Fu({},fe),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:S.gl.SRC_ALPHA,srcAlpha:1,dstRGB:S.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Bt({data:I.indices,type:S.gl.UNSIGNED_INT,count:I.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var c=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),_=d.rampColors,A=(0,se.generateColorRamp)(_);this.colorTexture=c({data:new Uint8Array(A.data),width:A.width,height:A.height,wrapS:S.gl.CLAMP_TO_EDGE,wrapT:S.gl.CLAMP_TO_EDGE,min:S.gl.NEAREST,mag:S.gl.NEAREST,flipY:!1})}}]),o}(La),Ol))||qu);function zu(i){var l=Da();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Da(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ql=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Nu=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,el=function(i){(0,K.Z)(o,i);var l=zu(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.coverage,A=c.angle;return{u_opacity:d||1,u_coverage:_||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Nu,fragmentShader:Ql,triangulation:fc,depth:{enable:!1},primitive:S.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(La),zi={heatmap:Uc,heatmap3d:Uc,grid:kc,grid3d:tf,hexagon:el},Pa=zi;function Ma(i){var l=ql();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Rl=function(i){(0,K.Z)(o,i);var l=Ma(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.type="HeatMapLayer",s}return(0,q.Z)(o,[{key:"buildModels",value:function(){var c=this.getModelType();this.layerModel=new Pa[c](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var c=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:c.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var c,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),A=_.shape3d,I=this.getSource(),D=I.data.type,Q=(d==null||(c=d.scale)===null||c===void 0?void 0:c.field)||"heatmap";return Q==="heatmap"||Q==="heatmap3d"?"heatmap":D==="hexagon"?(A==null?void 0:A.indexOf(Q))===-1?"hexagon":"grid3d":D==="grid"?(A==null?void 0:A.indexOf(Q))===-1?"grid":"grid3d":"heatmap"}}]),o}(Ss);function ec(i){var l=Sf();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ef=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Dl=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Bu=function(i){(0,K.Z)(o,i);var l=ec(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var c=this,d=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),d.data.images.then(function(A){c.texture=_({data:A[0],width:A[0].width,height:A[0].height}),c.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Dl,fragmentShader:Ef,triangulation:Ku,primitive:S.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,A,I){return[A[3],A[4]]}}})}}]),o}(La),Uu={image:Bu},no=Uu;function vs(i){var l=ml();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ho=function(i){(0,K.Z)(o,i);var l=vs(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.type="ImageLayer",s}return(0,q.Z)(o,[{key:"buildModels",value:function(){var c=this.getModelType();this.layerModel=new no[c](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var c=this.getModelType(),d={image:{}};return d[c]}},{key:"getModelType",value:function(){return"image"}}]),o}(Ss);function En(i){var l=ks();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function ks(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var tc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,gl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Qs={solid:0,dash:1},Zs=function(i){(0,K.Z)(o,i);var l=En(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.sourceColor,A=c.targetColor,I=c.textureBlend,D=I===void 0?"normal":I,Q=c.lineType,Y=Q===void 0?"solid":Q,fe=c.dashArray,Ye=fe===void 0?[10,5]:fe,ct=c.forward,Bt=ct===void 0?!0:ct,Sr=c.lineTexture,Pr=Sr===void 0?!1:Sr,Ur=c.iconStep,dn=Ur===void 0?100:Ur;Ye.length===2&&Ye.push(0,0);var _n=0,Gn=[0,0,0,0],Li=[0,0,0,0];return _&&A&&(Gn=(0,se.rgb2arr)(_),Li=(0,se.rgb2arr)(A),_n=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:Qs[Y||"solid"],u_dash_array:Ye,u_blur:.9,u_lineDir:Bt?1:-1,u_texture:this.texture,u_line_texture:Pr?1:0,u_icon_step:dn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_n,u_sourceColor:Gn,u_targetColor:Li}}},{key:"getAnimateUniforms",value:function(){var c=this.layer.getLayerConfig(),d=c.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:gl,fragmentShader:tc,triangulation:Ks,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var c=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,A,I,D){var Q=_.size,Y=Q===void 0?1:Q;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:S.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(_,A,I,D){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,A,I,D){var Q=c.iconService.getIconMap(),Y=_.texture,fe=Q[Y]||{x:0,y:0},Ye=fe.x,ct=fe.y;return[Ye,ct]}}})}}]),o}(La);function yl(i){var l=Jr();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Jr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var jc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    

    // gl_FragColor = filterColor(gl_FragColor + pattern);

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,dc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,tl={solid:0,dash:1},qs=function(i){(0,K.Z)(o,i);var l=yl(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.sourceColor,A=c.targetColor,I=c.textureBlend,D=I===void 0?"normal":I,Q=c.lineType,Y=Q===void 0?"solid":Q,fe=c.dashArray,Ye=fe===void 0?[10,5]:fe,ct=c.lineTexture,Bt=ct===void 0?!1:ct,Sr=c.iconStep,Pr=Sr===void 0?100:Sr;Ye.length===2&&Ye.push(0,0);var Ur=0,dn=[0,0,0,0],_n=[0,0,0,0];return _&&A&&(dn=(0,se.rgb2arr)(_),_n=(0,se.rgb2arr)(A),Ur=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:tl[Y]||0,u_dash_array:Ye,u_texture:this.texture,u_line_texture:Bt?1:0,u_icon_step:Pr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ur,u_sourceColor:dn,u_targetColor:_n}}},{key:"getAnimateUniforms",value:function(){var c=this.layer.getLayerConfig(),d=c.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:dc,fragmentShader:jc,triangulation:Ks,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var c=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,A,I,D){var Q=_.size,Y=Q===void 0?1:Q;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:S.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(_,A,I,D){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,A,I,D){var Q=c.iconService.getIconMap(),Y=_.texture,fe=Q[Y]||{x:0,y:0},Ye=fe.x,ct=fe.y;return[Ye,ct]}}})}}]),o}(La);function ws(i){var l=vc();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function vc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var mc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
      // float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      // alpha = clamp(alpha, 0.1, 1.0);
      // if(alpha < 0.01) alpha = 0.0;
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    // float u = fract(arcRadio * count);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = filterColor(gl_FragColor + pattern);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Fs=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,ju={solid:0,dash:1},_l=function(i){(0,K.Z)(o,i);var l=ws(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.sourceColor,A=c.targetColor,I=c.textureBlend,D=I===void 0?"normal":I,Q=c.lineType,Y=Q===void 0?"solid":Q,fe=c.dashArray,Ye=fe===void 0?[10,5]:fe,ct=c.lineTexture,Bt=ct===void 0?!1:ct,Sr=c.iconStep,Pr=Sr===void 0?100:Sr;Ye.length===2&&Ye.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ur=0,dn=[0,0,0,0],_n=[0,0,0,0];return _&&A&&(dn=(0,se.rgb2arr)(_),_n=(0,se.rgb2arr)(A),Ur=1),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:ju[Y]||0,u_dash_array:Ye,u_texture:this.texture,u_line_texture:Bt?1:0,u_icon_step:Pr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ur,u_sourceColor:dn,u_targetColor:_n}}},{key:"getAnimateUniforms",value:function(){var c=this.layer.getLayerConfig(),d=c.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Fs,fragmentShader:mc,triangulation:Ks,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var c=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,A,I,D){var Q=_.size,Y=Q===void 0?1:Q;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:S.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(_,A,I,D){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,A,I,D){var Q=c.iconService.getIconMap(),Y=_.texture,fe=Q[Y]||{x:0,y:0},Ye=fe.x,ct=fe.y;return[Ye,ct]}}})}}]),o}(La);function kl(i){var l=af();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
varying float v_strokeWidth;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // float r = max(smoothstep( 0.95, 1.0, v_strokeWidth/(v_a*2.0)), v_strokeWidth/(v_a*2.0));
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Au=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;
// varying float v_strokeWidth;

void main() {
  
  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);
  // v_strokeWidth = project_pixel(2.0);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 10.0, 1.0)); // \u989D\u5916\u9664 10.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,eu={solid:0,dash:1},ki=function(i){(0,K.Z)(o,i);var l=kl(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.sourceColor,A=c.targetColor,I=c.textureBlend,D=I===void 0?"normal":I,Q=c.lineType,Y=Q===void 0?"solid":Q,fe=c.dashArray,Ye=fe===void 0?[10,5,0,0]:fe,ct=c.lineTexture,Bt=ct===void 0?!1:ct,Sr=c.iconStep,Pr=Sr===void 0?100:Sr;Ye.length===2&&Ye.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ur=0,dn=[0,0,0,0],_n=[0,0,0,0];return _&&A&&(dn=(0,se.rgb2arr)(_),_n=(0,se.rgb2arr)(A),Ur=1),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,u_line_type:eu[Y],u_dash_array:Ye,u_texture:this.texture,u_line_texture:Bt?1:0,u_icon_step:Pr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ur,u_sourceColor:dn,u_targetColor:_n}}},{key:"getAnimateUniforms",value:function(){var c=this.layer.getLayerConfig(),d=c.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Au,fragmentShader:Zc,triangulation:cl,primitive:S.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var c=this,d=this.layer.getLayerConfig(),_=d.lineType,A=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:S.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(D,Q,Y,fe){return[Y[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:S.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(D,Q,Y,fe){return[Y[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(D,Q,Y,fe){var Ye=D.size,ct=Ye===void 0?1:Ye;return Array.isArray(ct)?[ct[0],ct[1]]:[ct,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(D,Q,Y,fe,Ye){return Ye}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:S.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(D,Q,Y,fe){return[Y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(D,Q,Y,fe){var Ye=c.iconService.getIconMap(),ct=D.texture,Bt=Ye[ct]||{x:0,y:0},Sr=Bt.x,Pr=Bt.y;return[Sr,Pr]}}})}},{key:"loadImage",value:function(c){return new Promise(function(d,_){if(c instanceof HTMLImageElement){d(c);return}var A=new Image;A.crossOrigin="anonymous",A.onload=function(){d(A)},A.onerror=function(){_(new Error("Could not load image at "+c))},A.src=c instanceof File?URL.createObjectURL(c):c})}}]),o}(La),Zu={arc:Zs,arc3d:qs,greatcircle:_l,line:ki},ns=Zu;function Oo(i){var l=xl();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function xl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var rl=function(i){(0,K.Z)(o,i);var l=Oo(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.type="LineLayer",s}return(0,q.Z)(o,[{key:"buildModels",value:function(){var c=this.getModelType();this.layerModel=new ns[c](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var c=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[c]}},{key:"getModelType",value:function(){var c,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(c=d.scale)===null||c===void 0?void 0:c.field;return _||"line"}}]),o}(Ss);function du(i){var l=ms();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var nl=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Un=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Pn=function(i){(0,K.Z)(o,i);var l=du(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.offsets;return{u_opacity:d||1,u_offsets:_||[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Un,fragmentShader:nl,triangulation:cc,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,A,I){var D=d.size;if(D){var Q=[];return Array.isArray(D)&&(Q=D.length===2?[D[0],D[0],D[1]]:D),Array.isArray(D)||(Q=[D]),Q}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,A,I,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:S.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_){var A=Mo(d.coordinates);return[A[0],A[1],0]}}})}}]),o}(La);function rc(i){var l=is();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var yo=`#define Animate 0.0

uniform float u_blur : 0;
uniform float u_opacity : 1;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [0, 0, 0, 0];
uniform float u_stroke_opacity : 1;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  // gl_FragColor = v_color * color_t;
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,zo=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_stroke_width : 2;
uniform vec2 u_offsets;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,vu=function(i){(0,K.Z)(o,i);var l=rc(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=d===void 0?1:d,A=c.stroke,I=A===void 0?"rgb(0,0,0,0)":A,D=c.strokeWidth,Q=D===void 0?1:D,Y=c.strokeOpacity,fe=Y===void 0?1:Y,Ye=c.offsets,ct=Ye===void 0?[0,0]:Ye;return{u_opacity:_,u_stroke_width:Q,u_stroke_color:(0,se.rgb2arr)(I),u_stroke_opacity:fe,u_offsets:[-ct[0],ct[1]]}}},{key:"getAnimateUniforms",value:function(){var c=this.layer.getLayerConfig(),d=c.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lc)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:zo,fragmentShader:yo,triangulation:Lc,depth:{enable:!1},blend:this.getBlend()})]}},{key:"animateOption2Array",value:function(c){return[c.enable?0:1,c.speed||1,c.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var c=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:S.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,A,I,D){var Q=[1,1,-1,1,-1,-1,1,-1],Y=D%4*2;return[Q[Y],Q[Y+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,A,I,D){var Q=_.size,Y=Q===void 0?5:Q;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:S.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,A,I,D){var Q=_.shape,Y=Q===void 0?2:Q,fe=c.layer.getLayerConfig().shape2d,Ye=fe.indexOf(Y);return[Ye]}}})}}]),o}(La);function Vs(i){var l=Fl();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function Fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Yi=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,wo=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,of=function(i){(0,K.Z)(o,i);var l=Vs(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var c=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){c.updateTexture(),c.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:wo,fragmentShader:Yi,triangulation:ro,primitive:S.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var c=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,A,I,D){var Q=_.size;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,A,I,D){var Q=c.fontService.mapping,Y=_.shape,fe=c.fontService.getGlyph(Y),Ye=Q[fe],ct=Ye.x,Bt=Ye.y;return[ct,Bt]}}})}},{key:"updateTexture",value:function(){var c=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=c({data:d,mag:S.gl.LINEAR,min:S.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var c=this,d=this.layer.getLayerConfig(),_=d.fontWeight,A=_===void 0?"normal":_,I=d.fontFamily,D=I===void 0?"sans-serif":I,Q=this.layer.getEncodedData(),Y=[];Q.forEach(function(fe){var Ye=fe.shape,ct=Ye===void 0?"":Ye;ct=ct.toString();var Bt=c.fontService.getGlyph(ct);Y.indexOf(Bt)===-1&&Y.push(Bt)}),this.fontService.setFontOptions({characterSet:Y,fontWeight:A,fontFamily:D,fontSize:48})}}]),o}(La);function bl(i){var l=gc();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Cu=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Ts=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,il=function(i){(0,K.Z)(o,i);var l=bl(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=c.offsets,A=_===void 0?[0,0]:_;return this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_offsets:[-A[0],A[1]]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Ts,fragmentShader:Cu,triangulation:ro,primitive:S.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var c=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(_,A,I,D){var Q=_.size,Y=Q===void 0?5:Q;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(_,A,I,D){var Q=c.iconService.getIconMap(),Y=_.shape,fe=Q[Y]||{x:0,y:0},Ye=fe.x,ct=fe.y;return[Ye,ct]}}})}}]),o}(La);function Pu(i){var l=yc();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var nc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "picking"
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a =gl_FragColor.a * u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,_c=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform vec2 u_offsets;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  // vec2 offset = project_pixel(u_offsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Vc(i){var l=i.coordinates;return{vertices:(0,li.Z)(l),indices:[0],size:l.length}}var zl=function(i){(0,K.Z)(o,i);var l=Pu(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=d===void 0?1:d,A=c.stroke,I=A===void 0?"rgb(0,0,0,0)":A,D=c.strokeWidth,Q=D===void 0?1:D,Y=c.offsets,fe=Y===void 0?[0,0]:Y;return{u_opacity:_,u_stroke_width:Q,u_stroke_color:(0,se.rgb2arr)(I),u_offsets:[-fe[0],fe[1]]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:_c,fragmentShader:nc,triangulation:Vc,depth:{enable:!1},primitive:S.gl.POINTS,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,A,I){var D=d.size,Q=D===void 0?1:D;return Array.isArray(Q)?[Q[0]]:[Q]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:S.BlendType.additive}}}]),o}(La),tu=y(98333);function xc(i,l){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=al(i))||l&&i&&typeof i.length=="number"){o&&(i=o);var s=0,c=function(){};return{s:c,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){_=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw A}}}}function al(i,l){if(!!i){if(typeof i=="string")return Mu(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Mu(i,l)}}function Mu(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}var Nl=function(){function i(l,o,s){(0,N.Z)(this,i),this.boxCells=[],this.xCellCount=void 0,this.yCellCount=void 0,this.boxKeys=void 0,this.bboxes=void 0,this.width=void 0,this.height=void 0,this.xScale=void 0,this.yScale=void 0,this.boxUid=void 0;var c=this.boxCells;this.xCellCount=Math.ceil(l/s),this.yCellCount=Math.ceil(o/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)c.push([]);this.boxKeys=[],this.bboxes=[],this.width=l,this.height=o,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,q.Z)(i,[{key:"insert",value:function(o,s,c,d,_){this.forEachCell(s,c,d,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(_)}},{key:"query",value:function(o,s,c,d,_){return this.queryHitTest(o,s,c,d,!1,_)}},{key:"hitTest",value:function(o,s,c,d,_){return this.queryHitTest(o,s,c,d,!0,_)}},{key:"insertBoxCell",value:function(o,s,c,d,_,A){this.boxCells[_].push(A)}},{key:"queryHitTest",value:function(o,s,c,d,_,A){if(c<0||o>this.width||d<0||s>this.height)return _?!1:[];var I=[];if(o<=0&&s<=0&&this.width<=c&&this.height<=d){if(_)return!0;for(var D=0;D<this.boxKeys.length;D++)I.push({key:this.boxKeys[D],x1:this.bboxes[D*4],y1:this.bboxes[D*4+1],x2:this.bboxes[D*4+2],y2:this.bboxes[D*4+3]});return A?I.filter(A):I}var Q={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(o,s,c,d,this.queryCell,I,Q,A),_?I.length>0:I}},{key:"queryCell",value:function(o,s,c,d,_,A,I,D){var Q=I.seenUids,Y=this.boxCells[_];if(Y!==null){var fe=this.bboxes,Ye=xc(Y),ct;try{for(Ye.s();!(ct=Ye.n()).done;){var Bt=ct.value;if(!Q.box[Bt]){Q.box[Bt]=!0;var Sr=Bt*4;if(o<=fe[Sr+2]&&s<=fe[Sr+3]&&c>=fe[Sr+0]&&d>=fe[Sr+1]&&(!D||D(this.boxKeys[Bt]))){if(I.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Bt],x1:fe[Sr],y1:fe[Sr+1],x2:fe[Sr+2],y2:fe[Sr+3]})}}}}catch(Pr){Ye.e(Pr)}finally{Ye.f()}}return!1}},{key:"forEachCell",value:function(o,s,c,d,_,A,I,D){for(var Q=this.convertToXCellCoord(o),Y=this.convertToYCellCoord(s),fe=this.convertToXCellCoord(c),Ye=this.convertToYCellCoord(d),ct=Q;ct<=fe;ct++)for(var Bt=Y;Bt<=Ye;Bt++){var Sr=this.xCellCount*Bt+ct;if(_.call(this,o,s,c,d,Sr,A,I,D))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),i}(),mu=Nl,ru=function(){function i(l,o){(0,N.Z)(this,i),this.width=void 0,this.height=void 0,this.grid=void 0,this.viewportPadding=100,this.screenRightBoundary=void 0,this.screenBottomBoundary=void 0,this.gridRightBoundary=void 0,this.gridBottomBoundary=void 0,this.width=l,this.height=o,this.viewportPadding=Math.max(l,o),this.grid=new mu(l+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=l+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=l+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,q.Z)(i,[{key:"placeCollisionBox",value:function(o){var s=o.x1+o.anchorPointX+this.viewportPadding,c=o.y1+o.anchorPointY+this.viewportPadding,d=o.x2+o.anchorPointX+this.viewportPadding,_=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,c,d,_)||this.grid.hitTest(s,c,d,_)?{box:[]}:{box:[s,c,d,_]}}},{key:"insertCollisionBox",value:function(o,s){var c={featureIndex:s};this.grid.insert(c,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,s,c){var d=tu.al(s,c,0,1),_=tu.Ue(),A=pa.fromValues.apply(pa,(0,li.Z)(o));return tu.fF(_,d,A),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,s,c,d){return c>=0&&o<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),i}();function bc(i,l){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=Sc(i))||l&&i&&typeof i.length=="number"){o&&(i=o);var s=0,c=function(){};return{s:c,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){_=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw A}}}}function Sc(i,l){if(!!i){if(typeof i=="string")return Gc(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Gc(i,l)}}function Gc(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function Ec(i){var l=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0;break;default:l=.5}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:l,verticalAlign:o}}function n(i,l,o,s,c){if(!!c){var d=i[s],_=d.glyph;if(_)for(var A=l[_].advance*d.scale,I=(i[s].x+A)*c,D=o;D<=s;D++)i[D].x-=I}}function u(i,l,o,s,c,d,_){var A=(l-o)*c,I=(-s*_+.5)*d,D=bc(i),Q;try{for(D.s();!(Q=D.n()).done;){var Y=Q.value;Y.x+=A,Y.y+=I}}catch(fe){D.e(fe)}finally{D.f()}}function a(i,l,o,s,c,d,_){var A=-8,I=0,D=A,Q=0,Y=i.positionedGlyphs,fe=d==="right"?1:d==="left"?0:.5,Ye=Y.length;o.forEach(function(Ur){if(Ur.split("").forEach(function(_n){var Gn=l[_n],Li=0;Gn&&(Y.push({glyph:_n,x:I,y:D+Li,vertical:!1,scale:1,metrics:Gn}),I+=Gn.advance+_)}),Y.length!==Ye){var dn=I-_;Q=Math.max(dn,Q),n(Y,l,Ye,Y.length-1,fe)}I=0,D+=s});var ct=Ec(c),Bt=ct.horizontalAlign,Sr=ct.verticalAlign;u(Y,fe,Bt,Sr,Q,s,o.length);var Pr=D-A;i.top+=-Sr*Pr,i.bottom=i.top+Pr,i.left+=-Bt*Q,i.right=i.left+Q}function h(i,l,o,s,c,d,_){var A=-8,I=0,D=A,Q=0,Y=i.positionedGlyphs,fe=d==="right"?1:d==="left"?0:.5,Ye=Y.length;o.forEach(function(Ur){var dn=l[Ur],_n=0;if(dn&&(Y.push({glyph:Ur,x:I,y:D+_n,vertical:!1,scale:1,metrics:dn}),I+=dn.advance+_),Y.length!==Ye){var Gn=I-_;Q=Math.max(Gn,Q),n(Y,l,Ye,Y.length-1,fe)}I=0,D+=s});var ct=Ec(c),Bt=ct.horizontalAlign,Sr=ct.verticalAlign;u(Y,fe,Bt,Sr,Q,s,o.length);var Pr=D-A;i.top+=-Sr*Pr,i.bottom=i.top+Pr,i.left+=-Bt*Q,i.right=i.left+Q}function g(i,l,o,s,c,d){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],A=arguments.length>7?arguments[7]:void 0,I=i.split(`
`),D=[],Q={positionedGlyphs:D,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:I.length,text:i};return A?h(Q,l,I,o,s,c,d):a(Q,l,I,o,s,c,d),D.length?Q:!1}function E(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,s=i.positionedGlyphs,c=s===void 0?[]:s,d=[],_=bc(c),A;try{for(_.s();!(A=_.n()).done;){var I=A.value,D=I.metrics,Q=4,Y=D.advance*I.scale/2,fe=o?[I.x+Y,I.y]:[0,0],Ye=o?[0,0]:[I.x+Y+l[0],I.y+l[1]],ct=(0-Q)*I.scale-Y+Ye[0],Bt=(0-Q)*I.scale+Ye[1],Sr=ct+D.width*I.scale,Pr=Bt+D.height*I.scale,Ur={x:ct,y:Bt},dn={x:Sr,y:Bt},_n={x:ct,y:Pr},Gn={x:Sr,y:Pr};d.push({tl:Ur,tr:dn,bl:_n,br:Gn,tex:D,glyphOffset:fe})}}catch(Li){_.e(Li)}finally{_.f()}return d}function T(i,l){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=R(i))||l&&i&&typeof i.length=="number"){o&&(i=o);var s=0,c=function(){};return{s:c,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){_=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw A}}}}function R(i,l){if(!!i){if(typeof i=="string")return Z(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Z(i,l)}}function Z(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function ee(i){var l=ve();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function ve(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var _e=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform float u_stroke_opacity: 1.0;
uniform vec4 u_stroke : [0, 0, 0, 1];
uniform float u_strokeWidth : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  lowp float buff = (6.0 - u_strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke.rgb, u_stroke.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ee=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function We(i){var l=this,o=i.id,s=[],c=[];if(!l.glyphInfoMap||!l.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var d=l.glyphInfoMap[o].centroid,_=d.length===2?[d[0],d[1],0]:d;return l.glyphInfoMap[o].glyphQuads.forEach(function(A,I){s.push.apply(s,(0,li.Z)(_).concat([A.tex.x,A.tex.y+A.tex.height,A.tl.x,A.tl.y],(0,li.Z)(_),[A.tex.x+A.tex.width,A.tex.y+A.tex.height,A.tr.x,A.tr.y],(0,li.Z)(_),[A.tex.x+A.tex.width,A.tex.y,A.br.x,A.br.y],(0,li.Z)(_),[A.tex.x,A.tex.y,A.bl.x,A.bl.y])),c.push(0+I*4,1+I*4,2+I*4,2+I*4,3+I*4,0+I*4)}),{vertices:s,indices:c,size:7}}var He=function(i){(0,K.Z)(o,i);var l=ee(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.glyphInfo=void 0,s.glyphInfoMap={},s.texture=void 0,s.currentZoom=-1,s.extent=void 0,s.textureHeight=0,s.textCount=0,s.preTextStyle={},s.buildModels=function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ee,fragmentShader:_e,triangulation:We.bind((0,ke.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]},s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=d===void 0?1:d,A=c.stroke,I=A===void 0?"#fff":A,D=c.strokeWidth,Q=D===void 0?0:D,Y=c.strokeOpacity,fe=Y===void 0?1:Y,Ye=c.textAnchor,ct=Ye===void 0?"center":Ye,Bt=c.textAllowOverlap,Sr=Bt===void 0?!1:Bt,Pr=c.halo,Ur=Pr===void 0?.5:Pr,dn=c.gamma,_n=dn===void 0?2:dn,Gn=this.fontService,Li=Gn.canvas,qn=Gn.mapping;return Object.keys(qn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(qn).length),this.preTextStyle={textAnchor:ct,textAllowOverlap:Sr},{u_opacity:_,u_stroke_opacity:fe,u_sdf_map:this.texture,u_stroke:(0,se.rgb2arr)(I),u_halo_blur:Ur,u_gamma_scale:_n,u_sdf_map_size:[Li.width,Li.height],u_strokeWidth:Q}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var c=this.layer.getLayerConfig(),d=c.textAnchor,_=d===void 0?"center":d,A=c.textAllowOverlap,I=A===void 0?!0:A;return this.preTextStyle={textAnchor:_,textAllowOverlap:I},this.buildModels()}},{key:"needUpdate",value:function(){var c=this.layer.getLayerConfig(),d=c.textAllowOverlap,_=d===void 0?!1:d,A=this.mapService.getZoom(),I=this.mapService.getBounds(),D=(0,se.boundsContains)(this.extent,I);return!_&&(Math.abs(this.currentZoom-A)>1||!D)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:S.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,A,I){var D=d.rotate,Q=D===void 0?0:D;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:S.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,A,I){return[A[5],A[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,A,I){var D=d.size,Q=D===void 0?12:D;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:S.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,A,I){return[A[3],A[4]]}}})}},{key:"textExtent",value:function(){var c=this.mapService.getBounds();return(0,se.padBounds)(c,.5)}},{key:"initTextFont",value:function(){var c=this.layer.getLayerConfig(),d=c.fontWeight,_=d===void 0?"400":d,A=c.fontFamily,I=A===void 0?"sans-serif":A,D=this.layer.getEncodedData(),Q=[];D.forEach(function(Y){var fe=Y.shape,Ye=fe===void 0?"":fe;Ye=Ye.toString();var ct=T(Ye),Bt;try{for(ct.s();!(Bt=ct.n()).done;){var Sr=Bt.value;Q.indexOf(Sr)===-1&&Q.push(Sr)}}catch(Pr){ct.e(Pr)}finally{ct.f()}}),this.fontService.setFontOptions({characterSet:Q,fontWeight:_,fontFamily:I,iconfont:!1})}},{key:"initIconFontTex",value:function(){var c=this.layer.getLayerConfig(),d=c.fontWeight,_=d===void 0?"400":d,A=c.fontFamily,I=A===void 0?"sans-serif":A,D=this.layer.getEncodedData(),Q=[];D.forEach(function(Y){var fe=Y.shape,Ye=fe===void 0?"":fe;Ye=Ye.toString(),Q.indexOf(Ye)===-1&&Q.push(Ye)}),this.fontService.setFontOptions({characterSet:Q,fontWeight:_,fontFamily:I,iconfont:!0})}},{key:"generateGlyphLayout",value:function(c){var d=this,_=this.fontService.mapping,A=this.layer.getLayerConfig(),I=A.spacing,D=I===void 0?2:I,Q=A.textAnchor,Y=Q===void 0?"center":Q,fe=A.textOffset,Ye=this.layer.getEncodedData();this.glyphInfo=Ye.map(function(ct){var Bt=ct.shape,Sr=Bt===void 0?"":Bt,Pr=ct.id,Ur=ct.size,dn=Ur===void 0?1:Ur,_n=g(Sr.toString(),_,dn,Y,"center",D,fe,c),Gn=E(_n,fe,!1);return ct.shaping=_n,ct.glyphQuads=Gn,ct.centroid=Mo(ct.coordinates),ct.originCentroid=ct.version==="GAODE2.x"?Mo(ct.originCoordinates):ct.originCentroid=ct.centroid,d.glyphInfoMap[Pr]={shaping:_n,glyphQuads:Gn,centroid:Mo(ct.coordinates)},ct})}},{key:"filterGlyphs",value:function(){var c=this,d=this.layer.getLayerConfig(),_=d.padding,A=_===void 0?[4,4]:_,I=d.textAllowOverlap,D=I===void 0?!1:I;if(!D){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var Q=this.rendererService.getViewportSize(),Y=Q.width,fe=Q.height,Ye=new ru(Y,fe),ct=this.glyphInfo.filter(function(Bt){var Sr=Bt.shaping,Pr=Bt.id,Ur=Pr===void 0?0:Pr,dn=Bt.version==="GAODE2.x"?Bt.originCentroid:Bt.centroid,_n=Bt.size,Gn=_n/24,Li=c.mapService.lngLatToContainer(dn),qn=Ye.placeCollisionBox({x1:Sr.left*Gn-A[0],x2:Sr.right*Gn+A[0],y1:Sr.top*Gn-A[1],y2:Sr.bottom*Gn+A[1],anchorPointX:Li.x,anchorPointY:Li.y}),qi=qn.box;return qi&&qi.length?(Ye.insertCollisionBox(qi,Ur),!0):!1});ct.forEach(function(Bt){c.glyphInfoMap[Bt.id]=Bt})}}},{key:"initGlyph",value:function(){var c=this.layer.getLayerConfig(),d=c.iconfont,_=d===void 0?!1:d;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var c=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=c({data:d,mag:S.gl.LINEAR,min:S.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ee,fragmentShader:_e,triangulation:We.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(La),lt={fill:vu,image:il,normal:zl,extrude:Pn,text:He,icon:of},Fe=lt;function st(i){var l=bt();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Gt=function(i){(0,K.Z)(o,i);var l=st(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.type="PointLayer",s}return(0,q.Z)(o,[{key:"buildModels",value:function(){var c=this.getModelType();this.layerModel=new Fe[c](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var c=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[c]}},{key:"getModelType",value:function(){var c=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,A=d.shape3d,I=this.iconService.getIconMap(),D=c.find(function(Y){return Y.hasOwnProperty("shape")});if(D){var Q=D.shape;return Q==="dot"?"normal":(_==null?void 0:_.indexOf(Q))!==-1?"fill":(A==null?void 0:A.indexOf(Q))!==-1?"extrude":I.hasOwnProperty(Q)?"image":this.fontService.getGlyph(Q)!==""?"icon":"text"}else return"normal"}}]),o}(Ss);function ur(i){var l=or();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function or(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var lr=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Rr=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,nn=function(i){(0,K.Z)(o,i);var l=ur(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=d===void 0?1:d;return{u_opacity:_}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Rr,fragmentShader:lr,triangulation:rs})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(d,_,A,I,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(d,_,A,I){var D=d.size,Q=D===void 0?10:D;return Array.isArray(Q)?[Q[0]]:[Q]}}})}}]),o}(La);function Qr(i){var l=yn();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function yn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var jn=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Xn=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Hn=function(i){(0,K.Z)(o,i);var l=Qr(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=d===void 0?1:d;return{u_opacity:_}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Xn,fragmentShader:jn,triangulation:fl,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(La),Ki={fill:Hn,line:ki,extrude:nn,text:He,point_fill:vu,point_image:il,point_normal:zl,point_extrude:Pn},bn=Ki;function ai(i){var l=_i();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function _i(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ii=function(i){(0,K.Z)(o,i);var l=ai(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.type="PolygonLayer",s}return(0,q.Z)(o,[{key:"buildModels",value:function(){var c=this.getModelType();this.layerModel=new bn[c](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var c,d=this.styleAttributeService.getLayerStyleAttribute("shape"),_=d==null||(c=d.scale)===null||c===void 0?void 0:c.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var c=this.getEncodedData(),d=this.getLayerConfig(),_=d.shape2d,A=d.shape3d,I=this.iconService.getIconMap(),D=c.find(function(Y){return Y.hasOwnProperty("shape")});if(D){var Q=D.shape;return Q==="dot"?"point_normal":(_==null?void 0:_.indexOf(Q))!==-1?"point_fill":(A==null?void 0:A.indexOf(Q))!==-1?"point_extrude":I.hasOwnProperty(Q)?"point_image":"text"}else return"fill"}}]),o}(Ss);function ri(i){var l=xi();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function xi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ei=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Qn=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,_o=function(i){(0,K.Z)(o,i);var l=ri(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.texture=void 0,s.colorTexture=void 0,s}return(0,q.Z)(o,[{key:"getUninforms",value:function(){var c=this.layer.getLayerConfig(),d=c.opacity,_=d===void 0?1:d,A=c.clampLow,I=A===void 0?!0:A,D=c.clampHigh,Q=D===void 0?!0:D,Y=c.noDataValue,fe=Y===void 0?-9999999:Y,Ye=c.domain,ct=Ye===void 0?[0,1]:Ye;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:ct,u_clampLow:I,u_clampHigh:typeof Q!="undefined"?Q:I,u_noDataValue:fe,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var c=this.layer.getSource(),d=this.rendererService.createTexture2D,_=c.data.dataArray[0];this.texture=d({data:_.data,width:_.width,height:_.height,format:S.gl.LUMINANCE,type:S.gl.FLOAT});var A=this.layer.getLayerConfig(),I=A.rampColors,D=(0,se.generateColorRamp)(I);return this.colorTexture=d({data:D.data,width:D.width,height:D.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Qn,fragmentShader:ei,triangulation:Ku,primitive:S.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(d,_,A,I){return[A[3],A[4]]}}})}},{key:"updateColorTexure",value:function(){var c=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),_=d.rampColors,A=(0,se.generateColorRamp)(_);this.colorTexture=c({data:A.data,width:A.width,height:A.height,flipY:!1})}}]),o}(La),Ka={raster:_o,raster3d:_o},as=Ka;function No(i){var l=$a();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function $a(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var io=function(i){(0,K.Z)(o,i);var l=No(o);function o(){var s;(0,N.Z)(this,o);for(var c=arguments.length,d=new Array(c),_=0;_<c;_++)d[_]=arguments[_];return s=l.call.apply(l,[this].concat(d)),s.type="RasterLayer",s}return(0,q.Z)(o,[{key:"buildModels",value:function(){var c=this.getModelType();this.layerModel=new as[c](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var c=this.getModelType(),d={raster:{},raster3d:{}};return d[c]}},{key:"getModelType",value:function(){return"raster"}}]),o}(Ss),gs=y(50361),Bo=y.n(gs),Iu,os,Gs,Hs,Sl,El,zs,Vu,Bl,gu,wl,nu;function ao(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Ou(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?ao(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ao(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var yu=(Iu=(0,H.b2)(),os=(0,H.f3)(S.vK.IGlobalConfigService),Gs=(0,H.f3)(S.vK.ILogService),Hs=(0,H.f3)(S.vK.IMapService),Sl=(0,H.f3)(S.vK.IFontService),Iu(El=(zs=(nu=function(){function i(){(0,N.Z)(this,i),(0,Rn.Z)(this,"configService",Vu,this),(0,Rn.Z)(this,"logger",Bl,this),(0,Rn.Z)(this,"mapService",gu,this),(0,Rn.Z)(this,"fontService",wl,this)}return(0,q.Z)(i,[{key:"apply",value:function(o,s){var c=this,d=s.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){c.generateMaping(o,{styleAttributeService:d})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,c.generateMaping(o,{styleAttributeService:d}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var _=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),I=o.getSource().data.dataArray,D=_.filter(function(Y){return Y.needRemapping}),Q=I;A!=null&&A.needRemapping&&A!==null&&A!==void 0&&A.scale&&(Q=I.filter(function(Y){return c.applyAttributeMapping(A,Y)[0]})),D.length&&(A!=null&&A.needRemapping?(o.setEncodedData(c.mapping(_,Q)),A.needRemapping=!1):o.setEncodedData(c.mapping(D,Q,o.getEncodedData())),c.logger.debug("remapping finished"),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,s){var c=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),I=o.getSource().data.dataArray,D=I;A!=null&&A.scale&&(D=I.filter(function(Q){return c.applyAttributeMapping(A,Q)[0]})),o.setEncodedData(this.mapping(_,D))}},{key:"mapping",value:function(o,s,c){var d=this,_=s.map(function(A,I){var D=c?c[I]:{},Q=Ou({id:A._id,coordinates:A.coordinates},D);return o.filter(function(Y){return Y.scale!==void 0}).forEach(function(Y){var fe=d.applyAttributeMapping(Y,A);Y.needRemapping=!1,Y.name==="color"&&(fe=fe.map(function(Ye){return(0,se.rgb2arr)(Ye)})),Q[Y.name]=Array.isArray(fe)&&fe.length===1?fe[0]:fe,Y.name==="shape"&&(Q.shape=d.fontService.getIconFontKey(Q[Y.name]))}),Q});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.map(function(A){A.version="GAODE2.x",A.originCoordinates=Bo()(A.coordinates),A.coordinates=d.mapService.lngLatToCoord(A.coordinates)}):_.map(function(A){A.version="GAODE2.x",A.originCoordinates=Bo()(A.coordinates),A.coordinates=d.mapService.lngLatToCoords(A.coordinates)})),_}},{key:"applyAttributeMapping",value:function(o,s){var c;if(!o.scale)return[];var d=(o==null||(c=o.scale)===null||c===void 0?void 0:c.scalers)||[],_=[];return d.forEach(function(A){var I,D=A.field;(s.hasOwnProperty(D)||((I=o.scale)===null||I===void 0?void 0:I.type)==="variable")&&_.push(s[D])}),o.mapping?o.mapping(_):[]}}]),i}(),nu),Vu=(0,Dn.Z)(zs.prototype,"configService",[os],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bl=(0,Dn.Z)(zs.prototype,"logger",[Gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gu=(0,Dn.Z)(zs.prototype,"mapService",[Hs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=(0,Dn.Z)(zs.prototype,"fontService",[Sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zs))||El),As={},$i={},Uo=function(l){return $i[l]},xo=function(l,o){$i[l]=o},Lu=function(l){return As[l]},iu=function(l,o){As[l]=o},_u={},Gu={},Ru=34,Ws=10,au=13;function Tl(i){return new Function("d","return {"+i.map(function(l,o){return JSON.stringify(l)+": d["+o+'] || ""'}).join(",")+"}")}function sf(i,l){var o=Tl(i);return function(s,c){return l(o(s),c,i)}}function xu(i){var l=Object.create(null),o=[];return i.forEach(function(s){for(var c in s)c in l||o.push(l[c]=c)}),o}function da(i,l){var o=i+"",s=o.length;return s<l?new Array(l-s+1).join(0)+o:o}function vh(i){return i<0?"-"+da(-i,6):i>9999?"+"+da(i,6):da(i,4)}function Hf(i){var l=i.getUTCHours(),o=i.getUTCMinutes(),s=i.getUTCSeconds(),c=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":vh(i.getUTCFullYear(),4)+"-"+da(i.getUTCMonth()+1,2)+"-"+da(i.getUTCDate(),2)+(c?"T"+da(l,2)+":"+da(o,2)+":"+da(s,2)+"."+da(c,3)+"Z":s?"T"+da(l,2)+":"+da(o,2)+":"+da(s,2)+"Z":o||l?"T"+da(l,2)+":"+da(o,2)+"Z":"")}function Wf(i){var l=new RegExp('["'+i+`
\r]`),o=i.charCodeAt(0);function s(Y,fe){var Ye,ct,Bt=c(Y,function(Sr,Pr){if(Ye)return Ye(Sr,Pr-1);ct=Sr,Ye=fe?sf(Sr,fe):Tl(Sr)});return Bt.columns=ct||[],Bt}function c(Y,fe){var Ye=[],ct=Y.length,Bt=0,Sr=0,Pr,Ur=ct<=0,dn=!1;Y.charCodeAt(ct-1)===Ws&&--ct,Y.charCodeAt(ct-1)===au&&--ct;function _n(){if(Ur)return Gu;if(dn)return dn=!1,_u;var Li,qn=Bt,qi;if(Y.charCodeAt(qn)===Ru){for(;Bt++<ct&&Y.charCodeAt(Bt)!==Ru||Y.charCodeAt(++Bt)===Ru;);return(Li=Bt)>=ct?Ur=!0:(qi=Y.charCodeAt(Bt++))===Ws?dn=!0:qi===au&&(dn=!0,Y.charCodeAt(Bt)===Ws&&++Bt),Y.slice(qn+1,Li-1).replace(/""/g,'"')}for(;Bt<ct;){if((qi=Y.charCodeAt(Li=Bt++))===Ws)dn=!0;else if(qi===au)dn=!0,Y.charCodeAt(Bt)===Ws&&++Bt;else if(qi!==o)continue;return Y.slice(qn,Li)}return Ur=!0,Y.slice(qn,ct)}for(;(Pr=_n())!==Gu;){for(var Gn=[];Pr!==_u&&Pr!==Gu;)Gn.push(Pr),Pr=_n();fe&&(Gn=fe(Gn,Sr++))==null||Ye.push(Gn)}return Ye}function d(Y,fe){return Y.map(function(Ye){return fe.map(function(ct){return Q(Ye[ct])}).join(i)})}function _(Y,fe){return fe==null&&(fe=xu(Y)),[fe.map(Q).join(i)].concat(d(Y,fe)).join(`
`)}function A(Y,fe){return fe==null&&(fe=xu(Y)),d(Y,fe).join(`
`)}function I(Y){return Y.map(D).join(`
`)}function D(Y){return Y.map(Q).join(i)}function Q(Y){return Y==null?"":Y instanceof Date?Hf(Y):l.test(Y+="")?'"'+Y.replace(/"/g,'""')+'"':Y}return{parse:s,parseRows:c,format:_,formatBody:A,formatRows:I,formatRow:D,formatValue:Q}}var Ul=Wf(","),kf=Ul.parse,mh=Ul.parseRows,ic=Ul.format,Ff=Ul.formatBody,wf=Ul.formatRows,Xf=Ul.formatRow,jl=Ul.formatValue,Hc=y(6563),zf=y.n(Hc);function Yf(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Kf(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Yf(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Yf(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function $f(i,l){var o=l.x,s=l.y,c=l.x1,d=l.y1,_=l.coordinates,A=[];return i.forEach(function(I,D){var Q=[];if(o&&s&&(Q=[parseFloat(I[o]),parseFloat(I[s])]),o&&s&&c&&d){var Y=[parseFloat(I[o]),parseFloat(I[s])],fe=[parseFloat(I[c]),parseFloat(I[d])];Q=[Y,fe]}if(_){var Ye="Polygon";Array.isArray(_[0])||(Ye="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(Ye="LineString");var ct={type:Ye,coordinates:(0,li.Z)(I[_])};zf()(ct,!0),Q=ct.coordinates}var Bt=Kf(Kf({},I),{},{_id:D,coordinates:Q});A.push(Bt)}),{dataArray:A}}function Jf(i,l){var o=kf(i);return $f(o,l)}var ou=63710088e-1,Nf={centimeters:ou*100,centimetres:ou*100,degrees:ou/111325,feet:ou*3.28084,inches:ou*39.37,kilometers:ou/1e3,kilometres:ou/1e3,meters:ou,metres:ou,miles:ou/1609.344,millimeters:ou*1e3,millimetres:ou*1e3,nauticalmiles:ou/1852,radians:1,yards:ou*1.0936},Qf={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ou,yards:1.0936133},qf={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function jo(i,l,o){o===void 0&&(o={});var s={type:"Feature"};return(o.id===0||o.id)&&(s.id=o.id),o.bbox&&(s.bbox=o.bbox),s.properties=l||{},s.geometry=i,s}function Tf(i,l,o){switch(o===void 0&&(o={}),i){case"Point":return oo(l).geometry;case"LineString":return ac(l).geometry;case"Polygon":return lf(l).geometry;case"MultiPoint":return M(l).geometry;case"MultiLineString":return B(l).geometry;case"MultiPolygon":return O(l).geometry;default:throw new Error(i+" is invalid")}}function oo(i,l,o){if(o===void 0&&(o={}),!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Si(i[0])||!Si(i[1]))throw new Error("coordinates must contain numbers");var s={type:"Point",coordinates:i};return jo(s,l,o)}function uf(i,l,o){return o===void 0&&(o={}),z(i.map(function(s){return oo(s,l)}),o)}function lf(i,l,o){o===void 0&&(o={});for(var s=0,c=i;s<c.length;s++){var d=c[s];if(d.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var _=0;_<d[d.length-1].length;_++)if(d[d.length-1][_]!==d[0][_])throw new Error("First and last Position are not equivalent.")}var A={type:"Polygon",coordinates:i};return jo(A,l,o)}function Wc(i,l,o){return o===void 0&&(o={}),z(i.map(function(s){return lf(s,l)}),o)}function ac(i,l,o){if(o===void 0&&(o={}),i.length<2)throw new Error("coordinates must be an array of two or more positions");var s={type:"LineString",coordinates:i};return jo(s,l,o)}function wc(i,l,o){return o===void 0&&(o={}),z(i.map(function(s){return ac(s,l)}),o)}function z(i,l){l===void 0&&(l={});var o={type:"FeatureCollection"};return l.id&&(o.id=l.id),l.bbox&&(o.bbox=l.bbox),o.features=i,o}function B(i,l,o){o===void 0&&(o={});var s={type:"MultiLineString",coordinates:i};return jo(s,l,o)}function M(i,l,o){o===void 0&&(o={});var s={type:"MultiPoint",coordinates:i};return jo(s,l,o)}function O(i,l,o){o===void 0&&(o={});var s={type:"MultiPolygon",coordinates:i};return jo(s,l,o)}function J(i,l,o){o===void 0&&(o={});var s={type:"GeometryCollection",geometries:i};return jo(s,l,o)}function me(i,l){if(l===void 0&&(l=0),l&&!(l>=0))throw new Error("precision must be a positive number");var o=Math.pow(10,l||0);return Math.round(i*o)/o}function qe(i,l){l===void 0&&(l="kilometers");var o=Nf[l];if(!o)throw new Error(l+" units is invalid");return i*o}function Et(i,l){l===void 0&&(l="kilometers");var o=Nf[l];if(!o)throw new Error(l+" units is invalid");return i/o}function St(i,l){return Br(Et(i,l))}function yr(i){var l=i%360;return l<0&&(l+=360),l}function Br(i){var l=i%(2*Math.PI);return l*180/Math.PI}function Mn(i){var l=i%360;return l*Math.PI/180}function Bn(i,l,o){if(l===void 0&&(l="kilometers"),o===void 0&&(o="kilometers"),!(i>=0))throw new Error("length must be a positive number");return qe(Et(i,l),o)}function ci(i,l,o){if(l===void 0&&(l="meters"),o===void 0&&(o="kilometers"),!(i>=0))throw new Error("area must be a positive number");var s=qf[l];if(!s)throw new Error("invalid original units");var c=qf[o];if(!c)throw new Error("invalid final units");return i/s*c}function Si(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function Ci(i){return!!i&&i.constructor===Object}function va(i){if(!i)throw new Error("bbox is required");if(!Array.isArray(i))throw new Error("bbox must be an Array");if(i.length!==4&&i.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");i.forEach(function(l){if(!Si(l))throw new Error("bbox must only contain numbers")})}function Pi(i){if(!i)throw new Error("id is required");if(["string","number"].indexOf(typeof i)===-1)throw new Error("id must be a number or a string")}function Ja(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Zo(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Vo(i){if(i.length>1&&isNumber(i[0])&&isNumber(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return Vo(i[0]);throw new Error("coordinates must only contain numbers")}function ys(i,l,o){if(!l||!o)throw new Error("type and name required");if(!i||i.type!==l)throw new Error("Invalid input to "+o+": must be a "+l+", given "+i.type)}function bo(i,l,o){if(!i)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!i.geometry||i.geometry.type!==l)throw new Error("Invalid input to "+o+": must be a "+l+", given "+i.geometry.type)}function Aa(i,l,o){if(!i)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!i||i.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var s=0,c=i.features;s<c.length;s++){var d=c[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!d.geometry||d.geometry.type!==l)throw new Error("Invalid input to "+o+": must be a "+l+", given "+d.geometry.type)}}function Ea(i){return i.type==="Feature"?i.geometry:i}function Lo(i,l){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}function Qa(i,l,o){if(i!==null)for(var s,c,d,_,A,I,D,Q=0,Y=0,fe,Ye=i.type,ct=Ye==="FeatureCollection",Bt=Ye==="Feature",Sr=ct?i.features.length:1,Pr=0;Pr<Sr;Pr++){D=ct?i.features[Pr].geometry:Bt?i.geometry:i,fe=D?D.type==="GeometryCollection":!1,A=fe?D.geometries.length:1;for(var Ur=0;Ur<A;Ur++){var dn=0,_n=0;if(_=fe?D.geometries[Ur]:D,_!==null){I=_.coordinates;var Gn=_.type;switch(Q=o&&(Gn==="Polygon"||Gn==="MultiPolygon")?1:0,Gn){case null:break;case"Point":if(l(I,Y,Pr,dn,_n)===!1)return!1;Y++,dn++;break;case"LineString":case"MultiPoint":for(s=0;s<I.length;s++){if(l(I[s],Y,Pr,dn,_n)===!1)return!1;Y++,Gn==="MultiPoint"&&dn++}Gn==="LineString"&&dn++;break;case"Polygon":case"MultiLineString":for(s=0;s<I.length;s++){for(c=0;c<I[s].length-Q;c++){if(l(I[s][c],Y,Pr,dn,_n)===!1)return!1;Y++}Gn==="MultiLineString"&&dn++,Gn==="Polygon"&&_n++}Gn==="Polygon"&&dn++;break;case"MultiPolygon":for(s=0;s<I.length;s++){for(_n=0,c=0;c<I[s].length;c++){for(d=0;d<I[s][c].length-Q;d++){if(l(I[s][c][d],Y,Pr,dn,_n)===!1)return!1;Y++}_n++}dn++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(Qa(_.geometries[s],l,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function qa(i,l,o,s){var c=o;return Qa(i,function(d,_,A,I,D){_===0&&o===void 0?c=d:c=l(c,d,_,A,I,D)},s),c}function Jo(i,l){var o;switch(i.type){case"FeatureCollection":for(o=0;o<i.features.length&&l(i.features[o].properties,o)!==!1;o++);break;case"Feature":l(i.properties,0);break}}function ss(i,l,o){var s=o;return Jo(i,function(c,d){d===0&&o===void 0?s=c:s=l(s,c,d)}),s}function Tc(i,l){if(i.type==="Feature")l(i,0);else if(i.type==="FeatureCollection")for(var o=0;o<i.features.length&&l(i.features[o],o)!==!1;o++);}function oc(i,l,o){var s=o;return Tc(i,function(c,d){d===0&&o===void 0?s=c:s=l(s,c,d)}),s}function Cs(i){var l=[];return Qa(i,function(o){l.push(o)}),l}function Xs(i,l){var o,s,c,d,_,A,I,D,Q,Y,fe=0,Ye=i.type==="FeatureCollection",ct=i.type==="Feature",Bt=Ye?i.features.length:1;for(o=0;o<Bt;o++){for(A=Ye?i.features[o].geometry:ct?i.geometry:i,D=Ye?i.features[o].properties:ct?i.properties:{},Q=Ye?i.features[o].bbox:ct?i.bbox:void 0,Y=Ye?i.features[o].id:ct?i.id:void 0,I=A?A.type==="GeometryCollection":!1,_=I?A.geometries.length:1,c=0;c<_;c++){if(d=I?A.geometries[c]:A,d===null){if(l(null,fe,D,Q,Y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(l(d,fe,D,Q,Y)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(l(d.geometries[s],fe,D,Q,Y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}fe++}}function us(i,l,o){var s=o;return Xs(i,function(c,d,_,A,I){d===0&&o===void 0?s=c:s=l(s,c,d,_,A,I)}),s}function su(i,l){Xs(i,function(o,s,c,d,_){var A=o===null?null:o.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return l(jo(o,c,{bbox:d,id:_}),s,0)===!1?!1:void 0}var I;switch(A){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon";break}for(var D=0;D<o.coordinates.length;D++){var Q=o.coordinates[D],Y={type:I,coordinates:Q};if(l(jo(Y,c),s,D)===!1)return!1}})}function hp(i,l,o){var s=o;return su(i,function(c,d,_){d===0&&_===0&&o===void 0?s=c:s=l(s,c,d,_)}),s}function pp(i,l){su(i,function(o,s,c){var d=0;if(!!o.geometry){var _=o.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var A,I=0,D=0,Q=0;if(Qa(o,function(Y,fe,Ye,ct,Bt){if(A===void 0||s>I||ct>D||Bt>Q){A=Y,I=s,D=ct,Q=Bt,d=0;return}var Sr=lineString([A,Y],o.properties);if(l(Sr,s,c,Bt,d)===!1)return!1;d++,A=Y})===!1)return!1}}})}function Hp(i,l,o){var s=o,c=!1;return pp(i,function(d,_,A,I,D){c===!1&&o===void 0?s=d:s=l(s,d,_,A,I,D),c=!0}),s}function Nh(i,l){if(!i)throw new Error("geojson is required");su(i,function(o,s,c){if(o.geometry!==null){var d=o.geometry.type,_=o.geometry.coordinates;switch(d){case"LineString":if(l(o,s,c,0,0)===!1)return!1;break;case"Polygon":for(var A=0;A<_.length;A++)if(l(lineString(_[A],o.properties),s,c,A)===!1)return!1;break}}})}function bu(i,l,o){var s=o;return Nh(i,function(c,d,_,A){d===0&&o===void 0?s=c:s=l(s,c,d,_,A)}),s}function dp(i,l){if(l=l||{},!isObject(l))throw new Error("options is invalid");var o=l.featureIndex||0,s=l.multiFeatureIndex||0,c=l.geometryIndex||0,d=l.segmentIndex||0,_=l.properties,A;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),_=_||i.features[o].properties,A=i.features[o].geometry;break;case"Feature":_=_||i.properties,A=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=i;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var I=A.coordinates;switch(A.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=I.length+d-1),lineString([I[d],I[d+1]],_,l);case"Polygon":return c<0&&(c=I.length+c),d<0&&(d=I[c].length+d-1),lineString([I[c][d],I[c][d+1]],_,l);case"MultiLineString":return s<0&&(s=I.length+s),d<0&&(d=I[s].length+d-1),lineString([I[s][d],I[s][d+1]],_,l);case"MultiPolygon":return s<0&&(s=I.length+s),c<0&&(c=I[s].length+c),d<0&&(d=I[s][c].length-d-1),lineString([I[s][c][d],I[s][c][d+1]],_,l)}throw new Error("geojson is invalid")}function vp(i,l){if(l=l||{},!isObject(l))throw new Error("options is invalid");var o=l.featureIndex||0,s=l.multiFeatureIndex||0,c=l.geometryIndex||0,d=l.coordIndex||0,_=l.properties,A;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),_=_||i.features[o].properties,A=i.features[o].geometry;break;case"Feature":_=_||i.properties,A=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=i;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var I=A.coordinates;switch(A.type){case"Point":return point(I,_,l);case"MultiPoint":return s<0&&(s=I.length+s),point(I[s],_,l);case"LineString":return d<0&&(d=I.length+d),point(I[d],_,l);case"Polygon":return c<0&&(c=I.length+c),d<0&&(d=I[c].length+d),point(I[c][d],_,l);case"MultiLineString":return s<0&&(s=I.length+s),d<0&&(d=I[s].length+d),point(I[s][d],_,l);case"MultiPolygon":return s<0&&(s=I.length+s),c<0&&(c=I[s].length+c),d<0&&(d=I[s][c].length-d),point(I[s][c][d],_,l)}throw new Error("geojson is invalid")}function gh(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Bh(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?gh(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):gh(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Uh(i,l){var o=[],s={};if(i.features=i.features.filter(function(d){var _=d.geometry;return d!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),zf()(i,!0),i.features.length===0)return{dataArray:[],featureKeys:s};var c=0;return su(i,function(d,_){var A=Zo(d),I=_,D=Bh(Bh({},d.properties),{},{coordinates:A,_id:I});o.push(D)}),{dataArray:o,featureKeys:s}}function jh(i,l){var o=l.extent,s=new Promise(function(d){Zh(i,function(_){d(_)})}),c={images:s,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return c}function Zh(i,l){var o=i,s=[];if(typeof o=="string")(0,se.getImage)({url:o},function(_,A){s.push(A),l(s)});else{var c=o.length,d=0;o.forEach(function(_){(0,se.getImage)({url:_},function(A,I){d++,s.push(I),d===c&&l(s)})})}return jh}function Vh(i,l){var o=l.extent,s=l.width,c=l.height,d=l.min,_=l.max,A={_id:1,dataArray:[{_id:1,data:Array.from(i),width:s,height:c,min:d,max:_,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return A}var yh=y(30236),mp=y.n(yh),gp=y(47037),cf=y.n(gp);function _h(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function U(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?_h(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):_h(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Te(i,l){var o=l.radius,s=o===void 0?40:o,c=l.maxZoom,d=c===void 0?18:c,_=l.minZoom,A=_===void 0?0:_,I=l.zoom,D=I===void 0?2:I;if(i.pointIndex){var Q=i.pointIndex.getClusters(i.extent,Math.floor(D));return i.dataArray=ze(Q),i}var Y=new(tr())({radius:s,minZoom:A,maxZoom:d}),fe={type:"FeatureCollection",features:[]};return fe.features=i.dataArray.map(function(Ye){return{type:"Feature",geometry:{type:"Point",coordinates:Ye.coordinates},properties:U({},Ye)}}),Y.load(fe.features),Y}function ze(i){return i.map(function(l,o){return U({coordinates:l.geometry.coordinates,_id:o+1},l.properties)})}function nr(i){if(i.length===0)throw new Error("max requires at least one data point");for(var l=i[0],o=1;o<i.length;o++)i[o]>l&&(l=i[o]);return l}function Ar(i){if(i.length===0)throw new Error("min requires at least one data point");for(var l=i[0],o=1;o<i.length;o++)i[o]<l&&(l=i[o]);return l}function qt(i){if(i.length===0)return 0;for(var l=i[0],o=0,s,c=1;c<i.length;c++)s=l+i[c]*1,Math.abs(l)>=Math.abs(i[c])?o+=l-s+i[c]:o+=i[c]-s+l,l=s;return l+o*1}function dr(i){if(i.length===0)throw new Error("mean requires at least one data point");return qt(i)/i.length}var Zr={min:Ar,max:nr,mean:dr,sum:qt};function Kr(i,l){return i.map(function(o){return o[l]*1})}function qr(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Wr(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?qr(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):qr(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function on(i){var l=hn();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function hn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Vr(i,l){if(Array.isArray(l))return l}var sn=function(i){(0,K.Z)(o,i);var l=on(o);function o(s,c){var d;return(0,N.Z)(this,o),d=l.call(this),d.data=void 0,d.extent=void 0,d.hooks={init:new Di.ni},d.parser={type:"geojson"},d.transforms=[],d.cluster=!1,d.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},d.mapService=void 0,d.invalidExtent=!1,d.originData=void 0,d.rawData=void 0,d.cfg={},d.clusterIndex=void 0,d.originData=s,d.initCfg(c),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,q.Z)(o,[{key:"setData",value:function(c,d){this.rawData=c,this.originData=c,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(c){return this.clusterIndex.getClusters(this.caculClusterExtent(2),c)}},{key:"getClustersLeaves",value:function(c){return this.clusterIndex.getLeaves(c,Infinity)}},{key:"updateClusterData",value:function(c){var d=this,_=this.clusterOptions,A=_.method,I=A===void 0?"sum":A,D=_.field,Q=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(c));this.clusterOptions.zoom=c,Q.forEach(function(Y){Y.id||(Y.properties.point_count=1)}),(D||ds()(I))&&(Q=Q.map(function(Y){var fe=Y.id;if(fe){var Ye=d.clusterIndex.getLeaves(fe,Infinity),ct=Ye.map(function(Pr){return Pr.properties}),Bt;if(cf()(I)&&D){var Sr=Kr(ct,D);Bt=Zr[I](Sr)}ds()(I)&&(Bt=I(ct)),Y.properties.stat=Bt}else Y.properties.point_count=1;return Y})),this.data=Uo("geojson")({type:"FeatureCollection",features:Q}),this.executeTrans()}},{key:"getFeatureById",value:function(c){var d=this.parser.type,_=d===void 0?"geojson":d;if(_==="geojson"&&!this.cluster){var A=c<this.originData.features.length?this.originData.features[c]:"null",I=Bo()(A);if(this.transforms.length!==0){var D=this.data.dataArray.find(function(Q){return Q._id===c});I.properties=D}return I}else return c<this.data.dataArray.length?this.data.dataArray[c]:"null"}},{key:"getFeatureId",value:function(c,d){var _=this.data.dataArray.find(function(A){return A[c]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(c){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,se.padBounds)((0,se.bBoxToBounds)(this.extent),c)),d[0].concat(d[1])}},{key:"initCfg",value:function(c){this.cfg=mp()(this.cfg,c,Vr);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=Wr(Wr({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var c=this.parser,d=c.type||"geojson",_=Uo(d);this.data=_(this.originData,c),this.extent=(0,se.extent)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var c=this,d=this.transforms;d.forEach(function(_){var A=_.type,I=Lu(A)(c.data,_);Object.assign(c.data,I)})}},{key:"initCluster",value:function(){if(!!this.cluster){var c=this.clusterOptions||{};this.clusterIndex=Te(this.data,c)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}(Ft.EventEmitter);function Zt(i,l){var o=l.callback;return o&&(i.dataArray=i.dataArray.filter(o)),i}function cr(i,l){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=Gr(i))||l&&i&&typeof i.length=="number"){o&&(i=o);var s=0,c=function(){};return{s:c,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,_=!1,A;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){_=!0,A=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(_)throw A}}}}function Gr(i,l){if(!!i){if(typeof i=="string")return mn(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return mn(i,l)}}function mn(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}var Dr=6378e3;function wn(i,l){var o=i.dataArray,s=l.size,c=s===void 0?10:s,d=c/(2*Math.PI*Dr)*(256<<20)/2,_=Nr(o,c),A=_.gridHash,I=_.gridOffset,D=Kn(A,I,l);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:D}}function Nr(i,l){var o=Infinity,s=-Infinity,c,d=cr(i),_;try{for(d.s();!(_=d.n()).done;){var A=_.value;c=A.coordinates[1],Number.isFinite(c)&&(o=c<o?c:o,s=c>s?c:s)}}catch(dn){d.e(dn)}finally{d.f()}var I=(o+s)/2,D=un(l,I);if(D.xOffset<=0||D.yOffset<=0)return{gridHash:{},gridOffset:D};var Q={},Y=cr(i),fe;try{for(Y.s();!(fe=Y.n()).done;){var Ye=fe.value,ct=Ye.coordinates[1],Bt=Ye.coordinates[0];if(Number.isFinite(ct)&&Number.isFinite(Bt)){var Sr=Math.floor((ct+90)/D.yOffset),Pr=Math.floor((Bt+180)/D.xOffset),Ur="".concat(Sr,"-").concat(Pr);Q[Ur]=Q[Ur]||{count:0,points:[]},Q[Ur].count+=1,Q[Ur].points.push(Ye)}}}catch(dn){Y.e(dn)}finally{Y.f()}return{gridHash:Q,gridOffset:D}}function un(i,l){var o=kr(i),s=an(l,i);return{yOffset:o,xOffset:s}}function kr(i){return i/Dr*(180/Math.PI)}function an(i,l){return l/Dr*(180/Math.PI)/Math.cos(i*Math.PI/180)}function Kn(i,l,o){return Object.keys(i).reduce(function(s,c,d){var _=c.split("-"),A=parseInt(_[0],10),I=parseInt(_[1],10),D={};if(o.field&&o.method){var Q=se.Satistics.getColumn(i[c].points,o.field);D[o.method]=se.Satistics.statMap[o.method](Q)}return Object.assign(D,{_id:d,coordinates:(0,se.aProjectFlat)([-180+l.xOffset*(I+.5),-90+l.yOffset*(A+.5)]),rawData:i[c].points,count:i[c].count}),s.push(D),s},[])}var Wn=Math.PI/3,ln=[0,Wn,2*Wn,3*Wn,4*Wn,5*Wn];function zr(i){return i[0]}function Lr(i){return i[1]}function oi(){var i=0,l=0,o=1,s=1,c=zr,d=Lr,_,A,I;function D(Y){var fe={},Ye=[],ct,Bt=Y.length;for(ct=0;ct<Bt;++ct)if(!(isNaN(Pr=+c.call(null,Sr=Y[ct],ct,Y))||isNaN(Ur=+d.call(null,Sr,ct,Y)))){var Sr,Pr,Ur,dn=Math.round(Ur=Ur/I),_n=Math.round(Pr=Pr/A-(dn&1)/2),Gn=Ur-dn;if(Math.abs(Gn)*3>1){var Li=Pr-_n,qn=_n+(Pr<_n?-1:1)/2,qi=dn+(Ur<dn?-1:1),Fa=Pr-qn,Ua=Ur-qi;Li*Li+Gn*Gn>Fa*Fa+Ua*Ua&&(_n=qn+(dn&1?1:-1)/2,dn=qi)}var di=_n+"-"+dn,Ca=fe[di];Ca?Ca.push(Sr):(Ye.push(Ca=fe[di]=[Sr]),Ca.x=(_n+(dn&1)/2)*A,Ca.y=dn*I)}return Ye}function Q(Y){var fe=0,Ye=0;return ln.map(function(ct){var Bt=Math.sin(ct)*Y,Sr=-Math.cos(ct)*Y,Pr=Bt-fe,Ur=Sr-Ye;return fe=Bt,Ye=Sr,[Pr,Ur]})}return D.hexagon=function(Y){return"m"+Q(Y==null?_:+Y).join("l")+"z"},D.centers=function(){for(var Y=[],fe=Math.round(l/I),Ye=Math.round(i/A),ct=fe*I;ct<s+_;ct+=I,++fe)for(var Bt=Ye*A+(fe&1)*A/2;Bt<o+A/2;Bt+=A)Y.push([Bt,ct]);return Y},D.mesh=function(){var Y=Q(_).slice(0,4).join("l");return D.centers().map(function(fe){return"M"+fe+"m"+Y}).join("")},D.x=function(Y){return arguments.length?(c=Y,D):c},D.y=function(Y){return arguments.length?(d=Y,D):d},D.radius=function(Y){return arguments.length?(_=+Y,A=_*2*Math.sin(Wn),I=_*1.5,D):_},D.size=function(Y){return arguments.length?(i=l=0,o=+Y[0],s=+Y[1],D):[o-i,s-l]},D.extent=function(Y){return arguments.length?(i=+Y[0][0],l=+Y[0][1],o=+Y[1][0],s=+Y[1][1],D):[[i,l],[o,s]]},D.radius(1)}function ti(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Ln(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?ti(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ti(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Vi=6378e3;function wi(i,l){var o=i.dataArray,s=l.size,c=s===void 0?10:s,d=l.method,_=d===void 0?"sum":d,A=c/(2*Math.PI*Vi)*(256<<20)/2,I=o.map(function(fe){var Ye=(0,se.aProjectFlat)(fe.coordinates),ct=(0,X.Z)(Ye,2),Bt=ct[0],Sr=ct[1];return Ln(Ln({},fe),{},{coordinates:[Bt,Sr]})}),D=oi().radius(A).x(function(fe){return fe.coordinates[0]}).y(function(fe){return fe.coordinates[1]}),Q=D(I),Y={dataArray:Q.map(function(fe,Ye){var ct;if(l.field&&_){var Bt=se.Satistics.getColumn(fe,l.field);fe[_]=se.Satistics.statMap[_](Bt)}return ct={},(0,L.Z)(ct,l.method,fe[_]),(0,L.Z)(ct,"count",fe.length),(0,L.Z)(ct,"rawData",fe),(0,L.Z)(ct,"coordinates",[fe.x,fe.y]),(0,L.Z)(ct,"_id",Ye),ct}),radius:A,xOffset:A,yOffset:A,type:"hexagon"};return Y}function Fi(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function sa(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Fi(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Fi(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Go(i,l){var o=l.sourceField,s=l.targetField,c=l.data,d={};return c.forEach(function(_){d[_[o]]=_}),i.dataArray=i.dataArray.map(function(_){var A=_[s];return sa(sa({},_),d[A])}),i}function Ps(i,l){var o=l.callback;return o&&(i.dataArray=i.dataArray.map(o)),i}var ea=y(4771),To=sn;xo("geojson",Uh),xo("image",jh),xo("csv",Jf),xo("json",$f),xo("raster",Vh),iu("cluster",Te),iu("filter",Zt),iu("join",Go),iu("map",Ps),iu("grid",wn),iu("hexagon",wi);var Va,Ho,Qo,_s=(Va=(0,H.b2)(),Va(Ho=(Qo=function(){function i(){(0,N.Z)(this,i),this.mapService=void 0}return(0,q.Z)(i,[{key:"apply",value:function(o){var s=this;this.mapService=o.getContainer().get(S.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var c=o.getSource();if(!c){var d=o.sourceOption,_=d.data,A=d.options;o.setSource(new To(_,A))}s.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var c=s.updateClusterData(o),d=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,c||d})}},{key:"updateClusterData",value:function(o){var s=o.getSource(),c=s.cluster,d=s.clusterOptions,_=d.zoom,A=_===void 0?0:_,I=d.maxZoom,D=I===void 0?16:I,Q=this.mapService.getZoom()-1,Y=o.dataState.dataSourceNeedUpdate;return c&&(Y||Math.abs(A-Q)>1)&&D>A?(s.updateClusterData(Math.floor(Q)),!0):!1}}]),i}(),Qo))||Ho),Ms=y(44908),Ns=y.n(Ms),Wo=y(14293),Oi=y.n(Wo);function Is(i,l){return i<l?-1:i>l?1:i>=l?0:NaN}function ma(i){return i.length===1&&(i=ni(i)),{left:function(l,o,s,c){for(s==null&&(s=0),c==null&&(c=l.length);s<c;){var d=s+c>>>1;i(l[d],o)<0?s=d+1:c=d}return s},right:function(l,o,s,c){for(s==null&&(s=0),c==null&&(c=l.length);s<c;){var d=s+c>>>1;i(l[d],o)>0?c=d:s=d+1}return s}}}function ni(i){return function(l,o){return Is(i(l),o)}}var Gi=ma(Is),ia=Gi.right,qo=Gi.left,Su=ia;function sc(i,l){var o=i.length,s=-1,c,d,_;if(l==null){for(;++s<o;)if((c=i[s])!=null&&c>=c)for(d=_=c;++s<o;)(c=i[s])!=null&&(d>c&&(d=c),_<c&&(_=c))}else for(;++s<o;)if((c=l(i[s],s,i))!=null&&c>=c)for(d=_=c;++s<o;)(c=l(i[s],s,i))!=null&&(d>c&&(d=c),_<c&&(_=c));return[d,_]}var Ve=Array.prototype,ir=Ve.slice,er=Ve.map,An=Math.sqrt(50),Ui=Math.sqrt(10),Re=Math.sqrt(2);function ye(i,l,o){var s,c=-1,d,_,A;if(l=+l,i=+i,o=+o,i===l&&o>0)return[i];if((s=l<i)&&(d=i,i=l,l=d),(A=ut(i,l,o))===0||!isFinite(A))return[];if(A>0)for(i=Math.ceil(i/A),l=Math.floor(l/A),_=new Array(d=Math.ceil(l-i+1));++c<d;)_[c]=(i+c)*A;else for(i=Math.floor(i*A),l=Math.ceil(l*A),_=new Array(d=Math.ceil(i-l+1));++c<d;)_[c]=(i-c)/A;return s&&_.reverse(),_}function ut(i,l,o){var s=(l-i)/Math.max(0,o),c=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,c);return c>=0?(d>=An?10:d>=Ui?5:d>=Re?2:1)*Math.pow(10,c):-Math.pow(10,-c)/(d>=An?10:d>=Ui?5:d>=Re?2:1)}function Lt(i,l,o){var s=Math.abs(l-i)/Math.max(0,o),c=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/c;return d>=An?c*=10:d>=Ui?c*=5:d>=Re&&(c*=2),l<i?-c:c}function Vt(){var i=identity,l=extent,o=sturges;function s(c){var d,_=c.length,A,I=new Array(_);for(d=0;d<_;++d)I[d]=i(c[d],d,c);var D=l(I),Q=D[0],Y=D[1],fe=o(I,Q,Y);Array.isArray(fe)||(fe=tickStep(Q,Y,fe),fe=range(Math.ceil(Q/fe)*fe,Y,fe));for(var Ye=fe.length;fe[0]<=Q;)fe.shift(),--Ye;for(;fe[Ye-1]>Y;)fe.pop(),--Ye;var ct=new Array(Ye+1),Bt;for(d=0;d<=Ye;++d)Bt=ct[d]=[],Bt.x0=d>0?fe[d-1]:Q,Bt.x1=d<Ye?fe[d]:Y;for(d=0;d<_;++d)A=I[d],Q<=A&&A<=Y&&ct[bisect(fe,A,0,Ye)].push(c[d]);return ct}return s.value=function(c){return arguments.length?(i=typeof c=="function"?c:constant(c),s):i},s.domain=function(c){return arguments.length?(l=typeof c=="function"?c:constant([c[0],c[1]]),s):l},s.thresholds=function(c){return arguments.length?(o=typeof c=="function"?c:Array.isArray(c)?constant(slice.call(c)):constant(c),s):o},s}function yt(i,l,o){return i=map.call(i,number).sort(ascending),Math.ceil((o-l)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function dt(i){return i===null?NaN:+i}function Ct(i,l,o){if(o==null&&(o=dt),!!(s=i.length)){if((l=+l)<=0||s<2)return+o(i[0],0,i);if(l>=1)return+o(i[s-1],s-1,i);var s,c=(s-1)*l,d=Math.floor(c),_=+o(i[d],d,i),A=+o(i[d+1],d+1,i);return _+(A-_)*(c-d)}}var Le="$";function rt(){}rt.prototype=Me.prototype={constructor:rt,has:function(i){return Le+i in this},get:function(i){return this[Le+i]},set:function(i,l){return this[Le+i]=l,this},remove:function(i){var l=Le+i;return l in this&&delete this[l]},clear:function(){for(var i in this)i[0]===Le&&delete this[i]},keys:function(){var i=[];for(var l in this)l[0]===Le&&i.push(l.slice(1));return i},values:function(){var i=[];for(var l in this)l[0]===Le&&i.push(this[l]);return i},entries:function(){var i=[];for(var l in this)l[0]===Le&&i.push({key:l.slice(1),value:this[l]});return i},size:function(){var i=0;for(var l in this)l[0]===Le&&++i;return i},empty:function(){for(var i in this)if(i[0]===Le)return!1;return!0},each:function(i){for(var l in this)l[0]===Le&&i(this[l],l.slice(1),this)}};function Me(i,l){var o=new rt;if(i instanceof rt)i.each(function(A,I){o.set(I,A)});else if(Array.isArray(i)){var s=-1,c=i.length,d;if(l==null)for(;++s<c;)o.set(s,i[s]);else for(;++s<c;)o.set(l(d=i[s],s,i),d)}else if(i)for(var _ in i)o.set(_,i[_]);return o}var It=Me;function Ht(){var i=[],l=[],o,s,c;function d(A,I,D,Q){if(I>=i.length)return o!=null&&A.sort(o),s!=null?s(A):A;for(var Y=-1,fe=A.length,Ye=i[I++],ct,Bt,Sr=map(),Pr,Ur=D();++Y<fe;)(Pr=Sr.get(ct=Ye(Bt=A[Y])+""))?Pr.push(Bt):Sr.set(ct,[Bt]);return Sr.each(function(dn,_n){Q(Ur,_n,d(dn,I,D,Q))}),Ur}function _(A,I){if(++I>i.length)return A;var D,Q=l[I-1];return s!=null&&I>=i.length?D=A.entries():(D=[],A.each(function(Y,fe){D.push({key:fe,values:_(Y,I)})})),Q!=null?D.sort(function(Y,fe){return Q(Y.key,fe.key)}):D}return c={object:function(A){return d(A,0,Cr,rr)},map:function(A){return d(A,0,Er,Xr)},entries:function(A){return _(d(A,0,Er,Xr),0)},key:function(A){return i.push(A),c},sortKeys:function(A){return l[i.length-1]=A,c},sortValues:function(A){return o=A,c},rollup:function(A){return s=A,c}}}function Cr(){return{}}function rr(i,l,o){i[l]=o}function Er(){return map()}function Xr(i,l,o){i.set(l,o)}function Fn(){}var bi=It.prototype;Fn.prototype=zn.prototype={constructor:Fn,has:bi.has,add:function(i){return i+="",this[Le+i]=i,this},remove:bi.remove,clear:bi.clear,values:bi.keys,size:bi.size,empty:bi.empty,each:bi.each};function zn(i,l){var o=new Fn;if(i instanceof Fn)i.each(function(d){o.add(d)});else if(i){var s=-1,c=i.length;if(l==null)for(;++s<c;)o.add(i[s]);else for(;++s<c;)o.add(l(i[s],s,i))}return o}var si=null,Ti=Array.prototype,ua=Ti.map,eo=Ti.slice;function ls(i,l){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(l).domain(i);break}return this}function xh(i,l){switch(arguments.length){case 0:break;case 1:this.interpolator(i);break;default:this.interpolator(l).domain(i);break}return this}var Hu={name:"implicit"};function Af(){var i=It(),l=[],o=[],s=Hu;function c(d){var _=d+"",A=i.get(_);if(!A){if(s!==Hu)return s;i.set(_,A=l.push(d))}return o[(A-1)%o.length]}return c.domain=function(d){if(!arguments.length)return l.slice();l=[],i=It();for(var _=-1,A=d.length,I,D;++_<A;)i.has(D=(I=d[_])+"")||i.set(D,l.push(I));return c},c.range=function(d){return arguments.length?(o=eo.call(d),c):o.slice()},c.unknown=function(d){return arguments.length?(s=d,c):s},c.copy=function(){return Af(l,o).unknown(s)},ls.apply(c,arguments),c}function ol(){var i=ordinal().unknown(void 0),l=i.domain,o=i.range,s=[0,1],c,d,_=!1,A=0,I=0,D=.5;delete i.unknown;function Q(){var Y=l().length,fe=s[1]<s[0],Ye=s[fe-0],ct=s[1-fe];c=(ct-Ye)/Math.max(1,Y-A+I*2),_&&(c=Math.floor(c)),Ye+=(ct-Ye-c*(Y-A))*D,d=c*(1-A),_&&(Ye=Math.round(Ye),d=Math.round(d));var Bt=sequence(Y).map(function(Sr){return Ye+c*Sr});return o(fe?Bt.reverse():Bt)}return i.domain=function(Y){return arguments.length?(l(Y),Q()):l()},i.range=function(Y){return arguments.length?(s=[+Y[0],+Y[1]],Q()):s.slice()},i.rangeRound=function(Y){return s=[+Y[0],+Y[1]],_=!0,Q()},i.bandwidth=function(){return d},i.step=function(){return c},i.round=function(Y){return arguments.length?(_=!!Y,Q()):_},i.padding=function(Y){return arguments.length?(A=Math.min(1,I=+Y),Q()):A},i.paddingInner=function(Y){return arguments.length?(A=Math.min(1,Y),Q()):A},i.paddingOuter=function(Y){return arguments.length?(I=+Y,Q()):I},i.align=function(Y){return arguments.length?(D=Math.max(0,Math.min(1,Y)),Q()):D},i.copy=function(){return ol(l(),s).round(_).paddingInner(A).paddingOuter(I).align(D)},initRange.apply(Q(),arguments)}function Cf(i){var l=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return Cf(l())},i}function eh(){return Cf(ol.apply(null,arguments).paddingInner(1))}var yp=y(26257),th=y(73626);function Wp(i,l){return i=+i,l=+l,function(o){return Math.round(i*(1-o)+l*o)}}function xs(i){return function(){return i}}function so(i){return+i}var _p=[0,1];function Zl(i){return i}function Gh(i,l){return(l-=i=+i)?function(o){return(o-i)/l}:xs(isNaN(l)?NaN:.5)}function xp(i){var l=i[0],o=i[i.length-1],s;return l>o&&(s=l,l=o,o=s),function(c){return Math.max(l,Math.min(o,c))}}function Xp(i,l,o){var s=i[0],c=i[1],d=l[0],_=l[1];return c<s?(s=Gh(c,s),d=o(_,d)):(s=Gh(s,c),d=o(d,_)),function(A){return d(s(A))}}function bp(i,l,o){var s=Math.min(i.length,l.length)-1,c=new Array(s),d=new Array(s),_=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),l=l.slice().reverse());++_<s;)c[_]=Gh(i[_],i[_+1]),d[_]=o(l[_],l[_+1]);return function(A){var I=Su(i,A,1,s)-1;return d[I](c[I](A))}}function Xc(i,l){return l.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function ff(){var i=_p,l=_p,o=yp.Z,s,c,d,_=Zl,A,I,D;function Q(){return A=Math.min(i.length,l.length)>2?bp:Xp,I=D=null,Y}function Y(fe){return isNaN(fe=+fe)?d:(I||(I=A(i.map(s),l,o)))(s(_(fe)))}return Y.invert=function(fe){return _(c((D||(D=A(l,i.map(s),th.Z)))(fe)))},Y.domain=function(fe){return arguments.length?(i=ua.call(fe,so),_===Zl||(_=xp(i)),Q()):i.slice()},Y.range=function(fe){return arguments.length?(l=eo.call(fe),Q()):l.slice()},Y.rangeRound=function(fe){return l=eo.call(fe),o=Wp,Q()},Y.clamp=function(fe){return arguments.length?(_=fe?xp(i):Zl,Y):_!==Zl},Y.interpolate=function(fe){return arguments.length?(o=fe,Q()):o},Y.unknown=function(fe){return arguments.length?(d=fe,Y):d},function(fe,Ye){return s=fe,c=Ye,Q()}}function Sp(i,l){return ff()(i,l)}var bs=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Pf(i){if(!(l=bs.exec(i)))throw new Error("invalid format: "+i);var l;return new Ac({fill:l[1],align:l[2],sign:l[3],symbol:l[4],zero:l[5],width:l[6],comma:l[7],precision:l[8]&&l[8].slice(1),trim:l[9],type:l[10]})}Pf.prototype=Ac.prototype;function Ac(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Ac.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Hh(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Bf(i,l){if((o=(i=l?i.toExponential(l-1):i.toExponential()).indexOf("e"))<0)return null;var o,s=i.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+i.slice(o+1)]}function Mf(i){return i=Bf(Math.abs(i)),i?i[1]:NaN}function rh(i,l){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Mf(l)/3)))*3-Mf(Math.abs(i)))}function hf(i,l){return function(o,s){for(var c=o.length,d=[],_=0,A=i[0],I=0;c>0&&A>0&&(I+A+1>s&&(A=Math.max(1,s-I)),d.push(o.substring(c-=A,c+A)),!((I+=A+1)>s));)A=i[_=(_+1)%i.length];return d.reverse().join(l)}}function Yp(i){return function(l){return l.replace(/[0-9]/g,function(o){return i[+o]})}}function Kp(i){e:for(var l=i.length,o=1,s=-1,c;o<l;++o)switch(i[o]){case".":s=c=o;break;case"0":s===0&&(s=o),c=o;break;default:if(!+i[o])break e;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(c+1):i}var $p;function Bs(i,l){var o=Bf(i,l);if(!o)return i+"";var s=o[0],c=o[1],d=c-($p=Math.max(-8,Math.min(8,Math.floor(c/3)))*3)+1,_=s.length;return d===_?s:d>_?s+new Array(d-_+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Bf(i,Math.max(0,l+d-1))[0]}function pf(i,l){var o=Bf(i,l);if(!o)return i+"";var s=o[0],c=o[1];return c<0?"0."+new Array(-c).join("0")+s:s.length>c+1?s.slice(0,c+1)+"."+s.slice(c+1):s+new Array(c-s.length+2).join("0")}var Ep={"%":function(i,l){return(i*100).toFixed(l)},b:function(i){return Math.round(i).toString(2)},c:function(i){return i+""},d:Hh,e:function(i,l){return i.toExponential(l)},f:function(i,l){return i.toFixed(l)},g:function(i,l){return i.toPrecision(l)},o:function(i){return Math.round(i).toString(8)},p:function(i,l){return pf(i*100,l)},r:pf,s:Bs,X:function(i){return Math.round(i).toString(16).toUpperCase()},x:function(i){return Math.round(i).toString(16)}};function e(i){return i}var t=Array.prototype.map,r=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function f(i){var l=i.grouping===void 0||i.thousands===void 0?e:hf(t.call(i.grouping,Number),i.thousands+""),o=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",c=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?e:Yp(t.call(i.numerals,String)),_=i.percent===void 0?"%":i.percent+"",A=i.minus===void 0?"-":i.minus+"",I=i.nan===void 0?"NaN":i.nan+"";function D(Y){Y=Pf(Y);var fe=Y.fill,Ye=Y.align,ct=Y.sign,Bt=Y.symbol,Sr=Y.zero,Pr=Y.width,Ur=Y.comma,dn=Y.precision,_n=Y.trim,Gn=Y.type;Gn==="n"?(Ur=!0,Gn="g"):Ep[Gn]||(dn===void 0&&(dn=12),_n=!0,Gn="g"),(Sr||fe==="0"&&Ye==="=")&&(Sr=!0,fe="0",Ye="=");var Li=Bt==="$"?o:Bt==="#"&&/[boxX]/.test(Gn)?"0"+Gn.toLowerCase():"",qn=Bt==="$"?s:/[%p]/.test(Gn)?_:"",qi=Ep[Gn],Fa=/[defgprs%]/.test(Gn);dn=dn===void 0?6:/[gprs]/.test(Gn)?Math.max(1,Math.min(21,dn)):Math.max(0,Math.min(20,dn));function Ua(di){var Ca=Li,uo=qn,Wu,up,lp;if(Gn==="c")uo=qi(di)+uo,di="";else{di=+di;var cp=di<0||1/di<0;if(di=isNaN(di)?I:qi(Math.abs(di),dn),_n&&(di=Kp(di)),cp&&+di==0&&ct!=="+"&&(cp=!1),Ca=(cp?ct==="("?ct:A:ct==="-"||ct==="("?"":ct)+Ca,uo=(Gn==="s"?r[8+$p/3]:"")+uo+(cp&&ct==="("?")":""),Fa){for(Wu=-1,up=di.length;++Wu<up;)if(lp=di.charCodeAt(Wu),48>lp||lp>57){uo=(lp===46?c+di.slice(Wu+1):di.slice(Wu))+uo,di=di.slice(0,Wu);break}}}Ur&&!Sr&&(di=l(di,Infinity));var fp=Ca.length+di.length+uo.length,xf=fp<Pr?new Array(Pr-fp+1).join(fe):"";switch(Ur&&Sr&&(di=l(xf+di,xf.length?Pr-uo.length:Infinity),xf=""),Ye){case"<":di=Ca+di+uo+xf;break;case"=":di=Ca+xf+di+uo;break;case"^":di=xf.slice(0,fp=xf.length>>1)+Ca+di+uo+xf.slice(fp);break;default:di=xf+Ca+di+uo;break}return d(di)}return Ua.toString=function(){return Y+""},Ua}function Q(Y,fe){var Ye=D((Y=Pf(Y),Y.type="f",Y)),ct=Math.max(-8,Math.min(8,Math.floor(Mf(fe)/3)))*3,Bt=Math.pow(10,-ct),Sr=r[8+ct/3];return function(Pr){return Ye(Bt*Pr)+Sr}}return{format:D,formatPrefix:Q}}var v,m,x;P({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function P(i){return v=f(i),m=v.format,x=v.formatPrefix,v}function k(i,l){return i=Math.abs(i),l=Math.abs(l)-i,Math.max(0,Mf(l)-Mf(i))+1}function j(i){return Math.max(0,-Mf(Math.abs(i)))}function W(i,l,o,s){var c=Lt(i,l,o),d;switch(s=Pf(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(i),Math.abs(l));return s.precision==null&&!isNaN(d=rh(c,_))&&(s.precision=d),x(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=k(c,Math.max(Math.abs(i),Math.abs(l))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=j(c))&&(s.precision=d-(s.type==="%")*2);break}}return m(s)}function $(i){var l=i.domain;return i.ticks=function(o){var s=l();return ye(s[0],s[s.length-1],o==null?10:o)},i.tickFormat=function(o,s){var c=l();return W(c[0],c[c.length-1],o==null?10:o,s)},i.nice=function(o){o==null&&(o=10);var s=l(),c=0,d=s.length-1,_=s[c],A=s[d],I;return A<_&&(I=_,_=A,A=I,I=c,c=d,d=I),I=ut(_,A,o),I>0?(_=Math.floor(_/I)*I,A=Math.ceil(A/I)*I,I=ut(_,A,o)):I<0&&(_=Math.ceil(_*I)/I,A=Math.floor(A*I)/I,I=ut(_,A,o)),I>0?(s[c]=Math.floor(_/I)*I,s[d]=Math.ceil(A/I)*I,l(s)):I<0&&(s[c]=Math.ceil(_*I)/I,s[d]=Math.floor(A*I)/I,l(s)),i},i}function ie(){var i=Sp(Zl,Zl);return i.copy=function(){return Xc(i,ie())},ls.apply(i,arguments),$(i)}function pe(i){var l;function o(s){return isNaN(s=+s)?l:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(i=ua.call(s,so),o):i.slice()},o.unknown=function(s){return arguments.length?(l=s,o):l},o.copy=function(){return pe(i).unknown(l)},i=arguments.length?ua.call(i,so):[0,1],$(o)}function Ge(i,l){i=i.slice();var o=0,s=i.length-1,c=i[o],d=i[s],_;return d<c&&(_=o,o=s,s=_,_=c,c=d,d=_),i[o]=l.floor(c),i[s]=l.ceil(d),i}function Xe(i){return Math.log(i)}function vt(i){return Math.exp(i)}function nt(i){return-Math.log(-i)}function Rt(i){return-Math.exp(-i)}function Kt(i){return isFinite(i)?+("1e"+i):i<0?0:i}function sr(i){return i===10?Kt:i===Math.E?Math.exp:function(l){return Math.pow(i,l)}}function hr(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),function(l){return Math.log(l)/i})}function Ir(i){return function(l){return-i(-l)}}function rn(i){var l=i(Xe,vt),o=l.domain,s=10,c,d;function _(){return c=hr(s),d=sr(s),o()[0]<0?(c=Ir(c),d=Ir(d),i(nt,Rt)):i(Xe,vt),l}return l.base=function(A){return arguments.length?(s=+A,_()):s},l.domain=function(A){return arguments.length?(o(A),_()):o()},l.ticks=function(A){var I=o(),D=I[0],Q=I[I.length-1],Y;(Y=Q<D)&&(fe=D,D=Q,Q=fe);var fe=c(D),Ye=c(Q),ct,Bt,Sr,Pr=A==null?10:+A,Ur=[];if(!(s%1)&&Ye-fe<Pr){if(fe=Math.round(fe)-1,Ye=Math.round(Ye)+1,D>0){for(;fe<Ye;++fe)for(Bt=1,ct=d(fe);Bt<s;++Bt)if(Sr=ct*Bt,!(Sr<D)){if(Sr>Q)break;Ur.push(Sr)}}else for(;fe<Ye;++fe)for(Bt=s-1,ct=d(fe);Bt>=1;--Bt)if(Sr=ct*Bt,!(Sr<D)){if(Sr>Q)break;Ur.push(Sr)}}else Ur=ye(fe,Ye,Math.min(Ye-fe,Pr)).map(d);return Y?Ur.reverse():Ur},l.tickFormat=function(A,I){if(I==null&&(I=s===10?".0e":","),typeof I!="function"&&(I=m(I)),A===Infinity)return I;A==null&&(A=10);var D=Math.max(1,s*A/l.ticks().length);return function(Q){var Y=Q/d(Math.round(c(Q)));return Y*s<s-.5&&(Y*=s),Y<=D?I(Q):""}},l.nice=function(){return o(Ge(o(),{floor:function(A){return d(Math.floor(c(A)))},ceil:function(A){return d(Math.ceil(c(A)))}}))},l}function pn(){var i=rn(ff()).domain([1,10]);return i.copy=function(){return Xc(i,pn()).base(i.base())},ls.apply(i,arguments),i}function Yn(i){return function(l){return Math.sign(l)*Math.log1p(Math.abs(l/i))}}function Sn(i){return function(l){return Math.sign(l)*Math.expm1(Math.abs(l))*i}}function $n(i){var l=1,o=i(Yn(l),Sn(l));return o.constant=function(s){return arguments.length?i(Yn(l=+s),Sn(l)):l},linearish(o)}function Tn(){var i=$n(transformer());return i.copy=function(){return copy(i,Tn()).constant(i.constant())},initRange.apply(i,arguments)}function Ni(i){return function(l){return l<0?-Math.pow(-l,i):Math.pow(l,i)}}function fi(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function Zn(i){return i<0?-i*i:i*i}function Ji(i){var l=i(Zl,Zl),o=1;function s(){return o===1?i(Zl,Zl):o===.5?i(fi,Zn):i(Ni(o),Ni(1/o))}return l.exponent=function(c){return arguments.length?(o=+c,s()):o},$(l)}function Mi(){var i=Ji(ff());return i.copy=function(){return Xc(i,Mi()).exponent(i.exponent())},ls.apply(i,arguments),i}function ca(){return Mi.apply(null,arguments).exponent(.5)}function Jn(){var i=[],l=[],o=[],s;function c(){var _=0,A=Math.max(1,l.length);for(o=new Array(A-1);++_<A;)o[_-1]=Ct(i,_/A);return d}function d(_){return isNaN(_=+_)?s:l[Su(o,_)]}return d.invertExtent=function(_){var A=l.indexOf(_);return A<0?[NaN,NaN]:[A>0?o[A-1]:i[0],A<o.length?o[A]:i[i.length-1]]},d.domain=function(_){if(!arguments.length)return i.slice();i=[];for(var A=0,I=_.length,D;A<I;++A)D=_[A],D!=null&&!isNaN(D=+D)&&i.push(D);return i.sort(Is),c()},d.range=function(_){return arguments.length?(l=eo.call(_),c()):l.slice()},d.unknown=function(_){return arguments.length?(s=_,d):s},d.quantiles=function(){return o.slice()},d.copy=function(){return Jn().domain(i).range(l).unknown(s)},ls.apply(d,arguments)}function ha(){var i=0,l=1,o=1,s=[.5],c=[0,1],d;function _(I){return I<=I?c[Su(s,I,0,o)]:d}function A(){var I=-1;for(s=new Array(o);++I<o;)s[I]=((I+1)*l-(I-o)*i)/(o+1);return _}return _.domain=function(I){return arguments.length?(i=+I[0],l=+I[1],A()):[i,l]},_.range=function(I){return arguments.length?(o=(c=eo.call(I)).length-1,A()):c.slice()},_.invertExtent=function(I){var D=c.indexOf(I);return D<0?[NaN,NaN]:D<1?[i,s[0]]:D>=o?[s[o-1],l]:[s[D-1],s[D]]},_.unknown=function(I){return arguments.length&&(d=I),_},_.thresholds=function(){return s.slice()},_.copy=function(){return ha().domain([i,l]).range(c).unknown(d)},ls.apply($(_),arguments)}function po(){var i=[.5],l=[0,1],o,s=1;function c(d){return d<=d?l[Su(i,d,0,s)]:o}return c.domain=function(d){return arguments.length?(i=eo.call(d),s=Math.min(i.length,l.length-1),c):i.slice()},c.range=function(d){return arguments.length?(l=eo.call(d),s=Math.min(i.length,l.length-1),c):l.slice()},c.invertExtent=function(d){var _=l.indexOf(d);return[i[_-1],i[_]]},c.unknown=function(d){return arguments.length?(o=d,c):o},c.copy=function(){return po().domain(i).range(l).unknown(o)},ls.apply(c,arguments)}var Ao=new Date,So=new Date;function la(i,l,o,s){function c(d){return i(d=arguments.length===0?new Date:new Date(+d)),d}return c.floor=function(d){return i(d=new Date(+d)),d},c.ceil=function(d){return i(d=new Date(d-1)),l(d,1),i(d),d},c.round=function(d){var _=c(d),A=c.ceil(d);return d-_<A-d?_:A},c.offset=function(d,_){return l(d=new Date(+d),_==null?1:Math.floor(_)),d},c.range=function(d,_,A){var I=[],D;if(d=c.ceil(d),A=A==null?1:Math.floor(A),!(d<_)||!(A>0))return I;do I.push(D=new Date(+d)),l(d,A),i(d);while(D<d&&d<_);return I},c.filter=function(d){return la(function(_){if(_>=_)for(;i(_),!d(_);)_.setTime(_-1)},function(_,A){if(_>=_)if(A<0)for(;++A<=0;)for(;l(_,-1),!d(_););else for(;--A>=0;)for(;l(_,1),!d(_););})},o&&(c.count=function(d,_){return Ao.setTime(+d),So.setTime(+_),i(Ao),i(So),Math.floor(o(Ao,So))},c.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?c.filter(s?function(_){return s(_)%d==0}:function(_){return c.count(0,_)%d==0}):c}),c}var Co=la(function(i){i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,l){i.setFullYear(i.getFullYear()+l)},function(i,l){return l.getFullYear()-i.getFullYear()},function(i){return i.getFullYear()});Co.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:la(function(l){l.setFullYear(Math.floor(l.getFullYear()/i)*i),l.setMonth(0,1),l.setHours(0,0,0,0)},function(l,o){l.setFullYear(l.getFullYear()+o*i)})};var Ro=Co,Us=Co.range,uu=la(function(i){i.setDate(1),i.setHours(0,0,0,0)},function(i,l){i.setMonth(i.getMonth()+l)},function(i,l){return l.getMonth()-i.getMonth()+(l.getFullYear()-i.getFullYear())*12},function(i){return i.getMonth()}),js=uu,Du=uu.range,Po=1e3,es=6e4,ta=36e5,Ba=864e5,Ia=6048e5;function Qi(i){return la(function(l){l.setDate(l.getDate()-(l.getDay()+7-i)%7),l.setHours(0,0,0,0)},function(l,o){l.setDate(l.getDate()+o*7)},function(l,o){return(o-l-(o.getTimezoneOffset()-l.getTimezoneOffset())*es)/Ia})}var lu=Qi(0),Os=Qi(1),vo=Qi(2),cs=Qi(3),fs=Qi(4),ga=Qi(5),Yc=Qi(6),Vl=lu.range,df=Os.range,hs=vo.range,vf=cs.range,Cc=fs.range,bh=ga.range,nh=Yc.range,Uf=la(function(i){i.setHours(0,0,0,0)},function(i,l){i.setDate(i.getDate()+l)},function(i,l){return(l-i-(l.getTimezoneOffset()-i.getTimezoneOffset())*es)/Ba},function(i){return i.getDate()-1}),Pc=Uf,Sh=Uf.range,Eh=la(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*Po-i.getMinutes()*es)},function(i,l){i.setTime(+i+l*ta)},function(i,l){return(l-i)/ta},function(i){return i.getHours()}),ih=Eh,Wh=Eh.range,wh=la(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*Po)},function(i,l){i.setTime(+i+l*es)},function(i,l){return(l-i)/es},function(i){return i.getMinutes()}),Xh=wh,If=wh.range,ah=la(function(i){i.setTime(i-i.getMilliseconds())},function(i,l){i.setTime(+i+l*Po)},function(i,l){return(l-i)/Po},function(i){return i.getUTCSeconds()}),oh=ah,jf=ah.range,mf=la(function(){},function(i,l){i.setTime(+i+l)},function(i,l){return l-i});mf.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?la(function(l){l.setTime(Math.floor(l/i)*i)},function(l,o){l.setTime(+l+o*i)},function(l,o){return(o-l)/i}):mf};var Yh=mf,wp=mf.range;function Mc(i){return la(function(l){l.setUTCDate(l.getUTCDate()-(l.getUTCDay()+7-i)%7),l.setUTCHours(0,0,0,0)},function(l,o){l.setUTCDate(l.getUTCDate()+o*7)},function(l,o){return(o-l)/Ia})}var sh=Mc(0),Zf=Mc(1),Th=Mc(2),Ah=Mc(3),Kc=Mc(4),Kh=Mc(5),uh=Mc(6),Tp=sh.range,Ch=Zf.range,$h=Th.range,lh=Ah.range,Jh=Kc.range,Ph=Kh.range,Jp=uh.range,Ap=la(function(i){i.setUTCHours(0,0,0,0)},function(i,l){i.setUTCDate(i.getUTCDate()+l)},function(i,l){return(l-i)/Ba},function(i){return i.getUTCDate()-1}),Qh=Ap,Od=Ap.range,Mh=la(function(i){i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,l){i.setUTCFullYear(i.getUTCFullYear()+l)},function(i,l){return l.getUTCFullYear()-i.getUTCFullYear()},function(i){return i.getUTCFullYear()});Mh.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:la(function(l){l.setUTCFullYear(Math.floor(l.getUTCFullYear()/i)*i),l.setUTCMonth(0,1),l.setUTCHours(0,0,0,0)},function(l,o){l.setUTCFullYear(l.getUTCFullYear()+o*i)})};var Ih=Mh,qh=Mh.range;function Do(i){if(0<=i.y&&i.y<100){var l=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return l.setFullYear(i.y),l}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function Gl(i){if(0<=i.y&&i.y<100){var l=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return l.setUTCFullYear(i.y),l}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function Oh(i,l,o){return{y:i,m:l,d:o,H:0,M:0,S:0,L:0}}function Of(i){var l=i.dateTime,o=i.date,s=i.time,c=i.periods,d=i.days,_=i.shortDays,A=i.months,I=i.shortMonths,D=Lf(c),Q=Rf(c),Y=Lf(d),fe=Rf(d),Ye=Lf(_),ct=Rf(_),Bt=Lf(A),Sr=Rf(A),Pr=Lf(I),Ur=Rf(I),dn={a:cp,A:fp,b:xf,B:T0,c:null,d:Op,e:Op,f:gf,g:fd,G:Ld,H:ad,I:od,j:Lp,L:np,m:sd,M:Rp,p:A0,q:C0,Q:Kd,s:$d,S:Dp,u:ud,U:kp,V:ld,w:zp,W:cd,x:null,X:null,y:Dh,Y:ip,Z:hd,"%":Yd},_n={a:P0,A:M0,b:I0,B:O0,c:null,d:pd,e:pd,f:Fd,g:$m,G:Qm,H:Rd,I:Dd,j:kd,L:dd,m:zd,M:Nd,p:L0,q:R0,Q:Kd,s:$d,S:Qc,u:ap,U:vd,V:md,w:Xm,W:Ym,x:null,X:null,y:Km,Y:Jm,Z:qm,"%":Yd},Gn={a:Ua,A:di,b:Ca,B:uo,c:Wu,d:Ip,e:Ip,f:fh,g:Mp,G:Pp,H:rd,I:rd,j:Jc,L:ch,m:rp,M:nd,p:Fa,q:Al,Q:ph,s:id,S:Vf,u:Qp,U:Rh,V:qp,w:Cp,W:ed,x:up,X:lp,y:Mp,Y:Pp,Z:td,"%":hh};dn.x=Li(o,dn),dn.X=Li(s,dn),dn.c=Li(l,dn),_n.x=Li(o,_n),_n.X=Li(s,_n),_n.c=Li(l,_n);function Li(mi,ja){return function(mo){var Cn=[],uc=-1,ps=0,Ic=mi.length,Oc,zh,Wm;for(mo instanceof Date||(mo=new Date(+mo));++uc<Ic;)mi.charCodeAt(uc)===37&&(Cn.push(mi.slice(ps,uc)),(zh=ep[Oc=mi.charAt(++uc)])!=null?Oc=mi.charAt(++uc):zh=Oc==="e"?" ":"0",(Wm=ja[Oc])&&(Oc=Wm(mo,zh)),Cn.push(Oc),ps=uc+1);return Cn.push(mi.slice(ps,uc)),Cn.join("")}}function qn(mi,ja){return function(mo){var Cn=Oh(1900,void 0,1),uc=qi(Cn,mi,mo+="",0),ps,Ic;if(uc!=mo.length)return null;if("Q"in Cn)return new Date(Cn.Q);if("s"in Cn)return new Date(Cn.s*1e3+("L"in Cn?Cn.L:0));if(ja&&!("Z"in Cn)&&(Cn.Z=0),"p"in Cn&&(Cn.H=Cn.H%12+Cn.p*12),Cn.m===void 0&&(Cn.m="q"in Cn?Cn.q:0),"V"in Cn){if(Cn.V<1||Cn.V>53)return null;"w"in Cn||(Cn.w=1),"Z"in Cn?(ps=Gl(Oh(Cn.y,0,1)),Ic=ps.getUTCDay(),ps=Ic>4||Ic===0?Zf.ceil(ps):Zf(ps),ps=Qh.offset(ps,(Cn.V-1)*7),Cn.y=ps.getUTCFullYear(),Cn.m=ps.getUTCMonth(),Cn.d=ps.getUTCDate()+(Cn.w+6)%7):(ps=Do(Oh(Cn.y,0,1)),Ic=ps.getDay(),ps=Ic>4||Ic===0?Os.ceil(ps):Os(ps),ps=Pc.offset(ps,(Cn.V-1)*7),Cn.y=ps.getFullYear(),Cn.m=ps.getMonth(),Cn.d=ps.getDate()+(Cn.w+6)%7)}else("W"in Cn||"U"in Cn)&&("w"in Cn||(Cn.w="u"in Cn?Cn.u%7:"W"in Cn?1:0),Ic="Z"in Cn?Gl(Oh(Cn.y,0,1)).getUTCDay():Do(Oh(Cn.y,0,1)).getDay(),Cn.m=0,Cn.d="W"in Cn?(Cn.w+6)%7+Cn.W*7-(Ic+5)%7:Cn.w+Cn.U*7-(Ic+6)%7);return"Z"in Cn?(Cn.H+=Cn.Z/100|0,Cn.M+=Cn.Z%100,Gl(Cn)):Do(Cn)}}function qi(mi,ja,mo,Cn){for(var uc=0,ps=ja.length,Ic=mo.length,Oc,zh;uc<ps;){if(Cn>=Ic)return-1;if(Oc=ja.charCodeAt(uc++),Oc===37){if(Oc=ja.charAt(uc++),zh=Gn[Oc in ep?ja.charAt(uc++):Oc],!zh||(Cn=zh(mi,mo,Cn))<0)return-1}else if(Oc!=mo.charCodeAt(Cn++))return-1}return Cn}function Fa(mi,ja,mo){var Cn=D.exec(ja.slice(mo));return Cn?(mi.p=Q[Cn[0].toLowerCase()],mo+Cn[0].length):-1}function Ua(mi,ja,mo){var Cn=Ye.exec(ja.slice(mo));return Cn?(mi.w=ct[Cn[0].toLowerCase()],mo+Cn[0].length):-1}function di(mi,ja,mo){var Cn=Y.exec(ja.slice(mo));return Cn?(mi.w=fe[Cn[0].toLowerCase()],mo+Cn[0].length):-1}function Ca(mi,ja,mo){var Cn=Pr.exec(ja.slice(mo));return Cn?(mi.m=Ur[Cn[0].toLowerCase()],mo+Cn[0].length):-1}function uo(mi,ja,mo){var Cn=Bt.exec(ja.slice(mo));return Cn?(mi.m=Sr[Cn[0].toLowerCase()],mo+Cn[0].length):-1}function Wu(mi,ja,mo){return qi(mi,l,ja,mo)}function up(mi,ja,mo){return qi(mi,o,ja,mo)}function lp(mi,ja,mo){return qi(mi,s,ja,mo)}function cp(mi){return _[mi.getDay()]}function fp(mi){return d[mi.getDay()]}function xf(mi){return I[mi.getMonth()]}function T0(mi){return A[mi.getMonth()]}function A0(mi){return c[+(mi.getHours()>=12)]}function C0(mi){return 1+~~(mi.getMonth()/3)}function P0(mi){return _[mi.getUTCDay()]}function M0(mi){return d[mi.getUTCDay()]}function I0(mi){return I[mi.getUTCMonth()]}function O0(mi){return A[mi.getUTCMonth()]}function L0(mi){return c[+(mi.getUTCHours()>=12)]}function R0(mi){return 1+~~(mi.getUTCMonth()/3)}return{format:function(mi){var ja=Li(mi+="",dn);return ja.toString=function(){return mi},ja},parse:function(mi){var ja=qn(mi+="",!1);return ja.toString=function(){return mi},ja},utcFormat:function(mi){var ja=Li(mi+="",_n);return ja.toString=function(){return mi},ja},utcParse:function(mi){var ja=qn(mi+="",!0);return ja.toString=function(){return mi},ja}}}var ep={"-":"",_:" ","0":"0"},cu=/^\s*\d+/,tp=/^%/,$c=/[\\^$*+?|[\]().{}]/g;function ka(i,l,o){var s=i<0?"-":"",c=(s?-i:i)+"",d=c.length;return s+(d<o?new Array(o-d+1).join(l)+c:c)}function Lh(i){return i.replace($c,"\\$&")}function Lf(i){return new RegExp("^(?:"+i.map(Lh).join("|")+")","i")}function Rf(i){for(var l={},o=-1,s=i.length;++o<s;)l[i[o].toLowerCase()]=o;return l}function Cp(i,l,o){var s=cu.exec(l.slice(o,o+1));return s?(i.w=+s[0],o+s[0].length):-1}function Qp(i,l,o){var s=cu.exec(l.slice(o,o+1));return s?(i.u=+s[0],o+s[0].length):-1}function Rh(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.U=+s[0],o+s[0].length):-1}function qp(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.V=+s[0],o+s[0].length):-1}function ed(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.W=+s[0],o+s[0].length):-1}function Pp(i,l,o){var s=cu.exec(l.slice(o,o+4));return s?(i.y=+s[0],o+s[0].length):-1}function Mp(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function td(i,l,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(l.slice(o,o+6));return s?(i.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Al(i,l,o){var s=cu.exec(l.slice(o,o+1));return s?(i.q=s[0]*3-3,o+s[0].length):-1}function rp(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.m=s[0]-1,o+s[0].length):-1}function Ip(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.d=+s[0],o+s[0].length):-1}function Jc(i,l,o){var s=cu.exec(l.slice(o,o+3));return s?(i.m=0,i.d=+s[0],o+s[0].length):-1}function rd(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.H=+s[0],o+s[0].length):-1}function nd(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.M=+s[0],o+s[0].length):-1}function Vf(i,l,o){var s=cu.exec(l.slice(o,o+2));return s?(i.S=+s[0],o+s[0].length):-1}function ch(i,l,o){var s=cu.exec(l.slice(o,o+3));return s?(i.L=+s[0],o+s[0].length):-1}function fh(i,l,o){var s=cu.exec(l.slice(o,o+6));return s?(i.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function hh(i,l,o){var s=tp.exec(l.slice(o,o+1));return s?o+s[0].length:-1}function ph(i,l,o){var s=cu.exec(l.slice(o));return s?(i.Q=+s[0],o+s[0].length):-1}function id(i,l,o){var s=cu.exec(l.slice(o));return s?(i.s=+s[0],o+s[0].length):-1}function Op(i,l){return ka(i.getDate(),l,2)}function ad(i,l){return ka(i.getHours(),l,2)}function od(i,l){return ka(i.getHours()%12||12,l,2)}function Lp(i,l){return ka(1+Pc.count(Ro(i),i),l,3)}function np(i,l){return ka(i.getMilliseconds(),l,3)}function gf(i,l){return np(i,l)+"000"}function sd(i,l){return ka(i.getMonth()+1,l,2)}function Rp(i,l){return ka(i.getMinutes(),l,2)}function Dp(i,l){return ka(i.getSeconds(),l,2)}function ud(i){var l=i.getDay();return l===0?7:l}function kp(i,l){return ka(lu.count(Ro(i)-1,i),l,2)}function Fp(i){var l=i.getDay();return l>=4||l===0?fs(i):fs.ceil(i)}function ld(i,l){return i=Fp(i),ka(fs.count(Ro(i),i)+(Ro(i).getDay()===4),l,2)}function zp(i){return i.getDay()}function cd(i,l){return ka(Os.count(Ro(i)-1,i),l,2)}function Dh(i,l){return ka(i.getFullYear()%100,l,2)}function fd(i,l){return i=Fp(i),ka(i.getFullYear()%100,l,2)}function ip(i,l){return ka(i.getFullYear()%1e4,l,4)}function Ld(i,l){var o=i.getDay();return i=o>=4||o===0?fs(i):fs.ceil(i),ka(i.getFullYear()%1e4,l,4)}function hd(i){var l=i.getTimezoneOffset();return(l>0?"-":(l*=-1,"+"))+ka(l/60|0,"0",2)+ka(l%60,"0",2)}function pd(i,l){return ka(i.getUTCDate(),l,2)}function Rd(i,l){return ka(i.getUTCHours(),l,2)}function Dd(i,l){return ka(i.getUTCHours()%12||12,l,2)}function kd(i,l){return ka(1+Qh.count(Ih(i),i),l,3)}function dd(i,l){return ka(i.getUTCMilliseconds(),l,3)}function Fd(i,l){return dd(i,l)+"000"}function zd(i,l){return ka(i.getUTCMonth()+1,l,2)}function Nd(i,l){return ka(i.getUTCMinutes(),l,2)}function Qc(i,l){return ka(i.getUTCSeconds(),l,2)}function ap(i){var l=i.getUTCDay();return l===0?7:l}function vd(i,l){return ka(sh.count(Ih(i)-1,i),l,2)}function dh(i){var l=i.getUTCDay();return l>=4||l===0?Kc(i):Kc.ceil(i)}function md(i,l){return i=dh(i),ka(Kc.count(Ih(i),i)+(Ih(i).getUTCDay()===4),l,2)}function Xm(i){return i.getUTCDay()}function Ym(i,l){return ka(Zf.count(Ih(i)-1,i),l,2)}function Km(i,l){return ka(i.getUTCFullYear()%100,l,2)}function $m(i,l){return i=dh(i),ka(i.getUTCFullYear()%100,l,2)}function Jm(i,l){return ka(i.getUTCFullYear()%1e4,l,4)}function Qm(i,l){var o=i.getUTCDay();return i=o>=4||o===0?Kc(i):Kc.ceil(i),ka(i.getUTCFullYear()%1e4,l,4)}function qm(){return"+0000"}function Yd(){return"%"}function Kd(i){return+i}function $d(i){return Math.floor(+i/1e3)}var op,Jd,eg,tg,rg;ng({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ng(i){return op=Of(i),Jd=op.format,eg=op.parse,tg=op.utcFormat,rg=op.utcParse,op}var Np=1e3,Bp=Np*60,Up=Bp*60,jp=Up*24,ig=jp*7,Qd=jp*30,Bd=jp*365;function ag(i){return new Date(i)}function og(i){return i instanceof Date?+i:+new Date(+i)}function qd(i,l,o,s,c,d,_,A,I){var D=Sp(Zl,Zl),Q=D.invert,Y=D.domain,fe=I(".%L"),Ye=I(":%S"),ct=I("%I:%M"),Bt=I("%I %p"),Sr=I("%a %d"),Pr=I("%b %d"),Ur=I("%B"),dn=I("%Y"),_n=[[_,1,Np],[_,5,5*Np],[_,15,15*Np],[_,30,30*Np],[d,1,Bp],[d,5,5*Bp],[d,15,15*Bp],[d,30,30*Bp],[c,1,Up],[c,3,3*Up],[c,6,6*Up],[c,12,12*Up],[s,1,jp],[s,2,2*jp],[o,1,ig],[l,1,Qd],[l,3,3*Qd],[i,1,Bd]];function Gn(qn){return(_(qn)<qn?fe:d(qn)<qn?Ye:c(qn)<qn?ct:s(qn)<qn?Bt:l(qn)<qn?o(qn)<qn?Sr:Pr:i(qn)<qn?Ur:dn)(qn)}function Li(qn,qi,Fa,Ua){if(qn==null&&(qn=10),typeof qn=="number"){var di=Math.abs(Fa-qi)/qn,Ca=ma(function(uo){return uo[2]}).right(_n,di);Ca===_n.length?(Ua=Lt(qi/Bd,Fa/Bd,qn),qn=i):Ca?(Ca=_n[di/_n[Ca-1][2]<_n[Ca][2]/di?Ca-1:Ca],Ua=Ca[1],qn=Ca[0]):(Ua=Math.max(Lt(qi,Fa,qn),1),qn=A)}return Ua==null?qn:qn.every(Ua)}return D.invert=function(qn){return new Date(Q(qn))},D.domain=function(qn){return arguments.length?Y(ua.call(qn,og)):Y().map(ag)},D.ticks=function(qn,qi){var Fa=Y(),Ua=Fa[0],di=Fa[Fa.length-1],Ca=di<Ua,uo;return Ca&&(uo=Ua,Ua=di,di=uo),uo=Li(qn,Ua,di,qi),uo=uo?uo.range(Ua,di+1):[],Ca?uo.reverse():uo},D.tickFormat=function(qn,qi){return qi==null?Gn:I(qi)},D.nice=function(qn,qi){var Fa=Y();return(qn=Li(qn,Fa[0],Fa[Fa.length-1],qi))?Y(Ge(Fa,qn)):D},D.copy=function(){return Xc(D,qd(i,l,o,s,c,d,_,A,I))},D}function sg(){return ls.apply(qd(Ro,js,lu,Pc,ih,Xh,oh,Yh,Jd).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function D0(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function gd(){var i=0,l=1,o,s,c,d,_=identity,A=!1,I;function D(Q){return isNaN(Q=+Q)?I:_(c===0?.5:(Q=(d(Q)-o)*c,A?Math.max(0,Math.min(1,Q)):Q))}return D.domain=function(Q){return arguments.length?(o=d(i=+Q[0]),s=d(l=+Q[1]),c=o===s?0:1/(s-o),D):[i,l]},D.clamp=function(Q){return arguments.length?(A=!!Q,D):A},D.interpolator=function(Q){return arguments.length?(_=Q,D):_},D.unknown=function(Q){return arguments.length?(I=Q,D):I},function(Q){return d=Q,o=Q(i),s=Q(l),c=o===s?0:1/(s-o),D}}function yd(i,l){return l.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function ug(){var i=linearish(gd()(identity));return i.copy=function(){return yd(i,ug())},initInterpolator.apply(i,arguments)}function lg(){var i=loggish(gd()).domain([1,10]);return i.copy=function(){return yd(i,lg()).base(i.base())},initInterpolator.apply(i,arguments)}function cg(){var i=symlogish(gd());return i.copy=function(){return yd(i,cg()).constant(i.constant())},initInterpolator.apply(i,arguments)}function ev(){var i=powish(gd());return i.copy=function(){return yd(i,ev()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function k0(){return ev.apply(null,arguments).exponent(.5)}function fg(){var i=[],l=identity;function o(s){if(!isNaN(s=+s))return l((bisect(i,s)-1)/(i.length-1))}return o.domain=function(s){if(!arguments.length)return i.slice();i=[];for(var c=0,d=s.length,_;c<d;++c)_=s[c],_!=null&&!isNaN(_=+_)&&i.push(_);return i.sort(ascending),o},o.interpolator=function(s){return arguments.length?(l=s,o):l},o.copy=function(){return fg(l).domain(i)},initInterpolator.apply(o,arguments)}function _d(){var i=0,l=.5,o=1,s,c,d,_,A,I=identity,D,Q=!1,Y;function fe(Ye){return isNaN(Ye=+Ye)?Y:(Ye=.5+((Ye=+D(Ye))-c)*(Ye<c?_:A),I(Q?Math.max(0,Math.min(1,Ye)):Ye))}return fe.domain=function(Ye){return arguments.length?(s=D(i=+Ye[0]),c=D(l=+Ye[1]),d=D(o=+Ye[2]),_=s===c?0:.5/(c-s),A=c===d?0:.5/(d-c),fe):[i,l,o]},fe.clamp=function(Ye){return arguments.length?(Q=!!Ye,fe):Q},fe.interpolator=function(Ye){return arguments.length?(I=Ye,fe):I},fe.unknown=function(Ye){return arguments.length?(Y=Ye,fe):Y},function(Ye){return D=Ye,s=Ye(i),c=Ye(l),d=Ye(o),_=s===c?0:.5/(c-s),A=c===d?0:.5/(d-c),fe}}function hg(){var i=linearish(_d()(identity));return i.copy=function(){return copy(i,hg())},initInterpolator.apply(i,arguments)}function pg(){var i=loggish(_d()).domain([.1,1,10]);return i.copy=function(){return copy(i,pg()).base(i.base())},initInterpolator.apply(i,arguments)}function dg(){var i=symlogish(_d());return i.copy=function(){return copy(i,dg()).constant(i.constant())},initInterpolator.apply(i,arguments)}function tv(){var i=powish(_d());return i.copy=function(){return copy(i,tv()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function F0(){return tv.apply(null,arguments).exponent(.5)}var yf,rv,nv,iv,av,xd,ov,sv,uv,vg=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,mg=(yf={},(0,L.Z)(yf,S.ScaleTypes.LINEAR,ie),(0,L.Z)(yf,S.ScaleTypes.POWER,Mi),(0,L.Z)(yf,S.ScaleTypes.LOG,pn),(0,L.Z)(yf,S.ScaleTypes.IDENTITY,pe),(0,L.Z)(yf,S.ScaleTypes.TIME,sg),(0,L.Z)(yf,S.ScaleTypes.QUANTILE,Jn),(0,L.Z)(yf,S.ScaleTypes.QUANTIZE,ha),(0,L.Z)(yf,S.ScaleTypes.THRESHOLD,po),(0,L.Z)(yf,S.ScaleTypes.CAT,Af),yf),gg=(rv=(0,H.b2)(),nv=(0,H.f3)(S.vK.IGlobalConfigService),iv=(0,H.f3)(S.vK.ILogService),rv(av=(xd=(uv=function(){function i(){(0,N.Z)(this,i),(0,Rn.Z)(this,"configService",ov,this),(0,Rn.Z)(this,"logger",sv,this),this.scaleCache={},this.scaleOptions={}}return(0,q.Z)(i,[{key:"apply",value:function(o,s){var c=this,d=s.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){c.scaleOptions=o.getScaleOptions();var _=d.getLayerStyleAttributes(),A=o.getSource().data.dataArray;A.length!==0&&c.caculateScalesForAttributes(_||[],A)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){c.scaleOptions=o.getScaleOptions();var _=d.getLayerStyleAttributes(),A=o.getSource().data.dataArray;return c.caculateScalesForAttributes(_||[],A),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){c.scaleOptions=o.getScaleOptions();var _=d.getLayerStyleAttributes();if(_){var A=o.getSource().data.dataArray;if(A.length===0)return;var I=_.filter(function(D){return D.needRescale});I.length&&(c.caculateScalesForAttributes(I,A),c.logger.debug("rescale finished"))}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,s){var c=this;this.scaleCache={},o.forEach(function(d){if(d.scale){var _=d.scale,A=d.name;_.names=c.parseFields(d.scale.field||[]);var I=[];_.names.forEach(function(D){I.push(c.getOrCreateScale(D,d,s))}),I.some(function(D){return D.type===S.StyleScaleType.VARIABLE})?(_.type=S.StyleScaleType.VARIABLE,I.forEach(function(D){if(!_.callback){var Q;if(_.values&&_.values!=="text"){var Y;if(((Y=D.option)===null||Y===void 0?void 0:Y.type)==="linear"&&_.values.length>2){var fe=D.scale.ticks(_.values.length);A==="color"&&D.scale.domain(fe)}D.scale.range(_.values)}else((Q=D.option)===null||Q===void 0?void 0:Q.type)==="cat"&&D.scale.range(D.option.domain)}})):(_.type=S.StyleScaleType.CONSTANT,_.defaultValues=I.map(function(D,Q){return D.scale(_.names[Q])})),_.scalers=I.map(function(D){return{field:D.field,func:D.scale,option:D.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,s,c){var d,_=[o,s.name].join("_"),A=(d=s.scale)===null||d===void 0?void 0:d.values,I=this.createScale(o,s.name,A,c);return I}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:cf()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,s,c,d){var _,A,I=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===o?this.scaleOptions[s]:this.scaleOptions[o],D={field:o,scale:void 0,type:S.StyleScaleType.VARIABLE,option:I};if(!d||!d.length)return I&&I.type?D.scale=this.createDefaultScale(I):(D.scale=Af([o]),D.type=S.StyleScaleType.CONSTANT),D;var Q=(A=d.find(function(Ye){return!Oi()(Ye[o])}))===null||A===void 0?void 0:A[o];if(this.isNumber(o)||Oi()(Q)&&!I)D.scale=Af([o]),D.type=S.StyleScaleType.CONSTANT;else{var Y=I&&I.type||this.getDefaultType(Q);c==="text"&&(Y=S.ScaleTypes.CAT);var fe=this.createDefaultScaleConfig(Y,o,d);Object.assign(fe,I),D.scale=this.createDefaultScale(fe),D.option=fe}return D}},{key:"getDefaultType",value:function(o){var s=S.ScaleTypes.LINEAR;return typeof o=="string"&&(s=vg.test(o)?S.ScaleTypes.TIME:S.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(o,s,c){var d={type:o},_=(c==null?void 0:c.map(function(A){return A[s]}))||[];return o!==S.ScaleTypes.CAT&&o!==S.ScaleTypes.QUANTILE?d.domain=sc(_):o===S.ScaleTypes.CAT?d.domain=Ns()(_):o===S.ScaleTypes.QUANTILE&&(d.domain=_),d}},{key:"createDefaultScale",value:function(o){var s=o.type,c=o.domain,d=mg[s]();return c&&d.domain(c),d}}]),i}(),uv),ov=(0,Dn.Z)(xd.prototype,"configService",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sv=(0,Dn.Z)(xd.prototype,"logger",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||av),lv,cv,fv,hv,bd,pv,dv,vv;function mv(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function yg(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?mv(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):mv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var _g=(lv=(0,H.b2)(),cv=(0,H.f3)(S.vK.ICameraService),fv=(0,H.f3)(S.vK.IRendererService),lv(hv=(bd=(vv=function(){function i(){(0,N.Z)(this,i),(0,Rn.Z)(this,"cameraService",pv,this),(0,Rn.Z)(this,"rendererService",dv,this)}return(0,q.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(s){s.addUniforms(yg({},o.layerModel.getAnimateUniforms()))})})}}]),i}(),vv),pv=(0,Dn.Z)(bd.prototype,"cameraService",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dv=(0,Dn.Z)(bd.prototype,"rendererService",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd))||hv),gv,yv,xg=(gv=(0,H.b2)(),gv(yv=function(){function i(){(0,N.Z)(this,i)}return(0,q.Z)(i,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),i}())||yv),_v,xv,bg=(_v=(0,H.b2)(),_v(xv=function(){function i(){(0,N.Z)(this,i)}return(0,q.Z)(i,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var s=o.getLayerConfig(),c=s.autoFit,d=s.fitBoundsOptions;c&&setTimeout(function(){o.fitBounds(d)},100)})}}]),i}())||xv),bv,Sv;function Ev(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Zp(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Ev(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ev(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var wv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Sg={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Eg={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},wg={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},z0=null;function Tg(i){var l={u_DirectionalLights:new Array(3).fill(Zp({},Eg)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Zp({},wg)),u_NumOfSpotLights:0};return(!i||!i.length)&&(i=[Sg]),i.forEach(function(o,s){var c=o.type,d=c===void 0?"directional":c,_=(0,ji.Z)(o,["type"]),A=wv[d].lights,I=wv[d].num,D=l[I];l[A][D]=Zp(Zp({},l[A][D]),_),l[I]++}),l}var Ag=(bv=(0,H.b2)(),bv(Sv=function(){function i(){(0,N.Z)(this,i)}return(0,q.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var s=o.getLayerConfig(),c=s.enableLighting;c&&o.models.forEach(function(d){return d.addUniforms(Zp({},Tg()))})})}}]),i}())||Sv),Tv,Av,Sd={NONE:0,ENCODE:1,HIGHLIGHT:2},Cg=(Tv=(0,H.b2)(),Tv(Av=function(){function i(){(0,N.Z)(this,i)}return(0,q.Z)(i,[{key:"apply",value:function(o,s){var c=s.rendererService,d=s.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var _=o.getLayerConfig(),A=_.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:S.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:S.gl.FLOAT},size:3,update:function(D,Q){var Y=D.id;return A?(0,se.encodePickingColor)(Y):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=o.getLayerConfig(),A=_.enablePicking;A&&o.isVisible()&&o.models.forEach(function(I){return I.addUniforms({u_PickingStage:Sd.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=o.getLayerConfig(),A=_.enablePicking;A&&o.isVisible()&&o.models.forEach(function(I){return I.addUniforms({u_PickingStage:Sd.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var A=o.getLayerConfig(),I=A.highlightColor,D=typeof I=="string"?(0,se.rgb2arr)(I):I||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,se.decodePickingColor)(new Uint8Array(_))}),o.models.forEach(function(Q){return Q.addUniforms({u_PickingStage:Sd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:D.map(function(Y){return Y*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var A=o.getLayerConfig(),I=A.selectColor,D=typeof I=="string"?(0,se.rgb2arr)(I):I||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,se.decodePickingColor)(new Uint8Array(_))}),o.models.forEach(function(Q){return Q.addUniforms({u_PickingStage:Sd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:D.map(function(Y){return Y*255})})})})}}]),i}())||Av),Cv,Pv,Mv,Ud,Iv,Ov,Pg=(Cv=(0,H.b2)(),Pv=(0,H.f3)(S.vK.ILogService),Cv(Mv=(Ud=(Ov=function(){function i(){(0,N.Z)(this,i),(0,Rn.Z)(this,"logger",Iv,this)}return(0,q.Z)(i,[{key:"apply",value:function(o,s){var c=this,d=s.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){c.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:S.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:S.gl.FLOAT},size:3,update:function(c,d,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),o.registerStyleAttribute({name:"filter",type:S.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(c,d){var _=c.filter;return _?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:S.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(c,d){var _=c.color;return!_||!_.length?[1,1,1,1]:_}}})}}]),i}(),Ov),Iv=(0,Dn.Z)(Ud.prototype,"logger",[Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud))||Mv),Lv,Rv,Dv,kv,Fv,zv,sp,Nv,Bv,Uv,jv,Zv,Mg=(Lv=(0,H.b2)(),Rv=(0,H.f3)(S.vK.ICameraService),Dv=(0,H.f3)(S.vK.ICoordinateSystemService),kv=(0,H.f3)(S.vK.IRendererService),Fv=(0,H.f3)(S.vK.IMapService),Lv(zv=(sp=(Zv=function(){function i(){(0,N.Z)(this,i),(0,Rn.Z)(this,"cameraService",Nv,this),(0,Rn.Z)(this,"coordinateSystemService",Bv,this),(0,Rn.Z)(this,"rendererService",Uv,this),(0,Rn.Z)(this,"mapService",jv,this)}return(0,q.Z)(i,[{key:"apply",value:function(o){var s=this,c=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),c==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var A=s.rendererService.getViewportSize(),I=A.width,D=A.height;o.models.forEach(function(Q){var Y;Q.addUniforms((Y={},(0,L.Z)(Y,S.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,L.Z)(Y,S.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,L.Z)(Y,S.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,L.Z)(Y,S.CameraUniform.Zoom,s.cameraService.getZoom()),(0,L.Z)(Y,S.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,L.Z)(Y,S.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,L.Z)(Y,S.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,L.Z)(Y,S.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,L.Z)(Y,S.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,L.Z)(Y,S.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,L.Z)(Y,S.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,L.Z)(Y,S.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,L.Z)(Y,S.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,L.Z)(Y,S.CoordinateUniform.Mvp,d),(0,L.Z)(Y,"u_SceneCenterMKT",_),(0,L.Z)(Y,"u_ViewportSize",[I,D]),(0,L.Z)(Y,"u_DevicePixelRatio",window.devicePixelRatio),(0,L.Z)(Y,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,L.Z)(Y,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),Y))})})}}]),i}(),Zv),Nv=(0,Dn.Z)(sp.prototype,"cameraService",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv=(0,Dn.Z)(sp.prototype,"coordinateSystemService",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv=(0,Dn.Z)(sp.prototype,"rendererService",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jv=(0,Dn.Z)(sp.prototype,"mapService",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sp))||zv),Vv,Gv,Ig=(Vv=(0,H.b2)(),Vv(Gv=function(){function i(){(0,N.Z)(this,i)}return(0,q.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),i}())||Gv),Hv,Wv,Xv,jd,Yv,Kv,Og=(Hv=(0,H.b2)(),Wv=(0,H.f3)(S.vK.ILogService),Hv(Xv=(jd=(Kv=function(){function i(){(0,N.Z)(this,i),(0,Rn.Z)(this,"logger",Yv,this)}return(0,q.Z)(i,[{key:"apply",value:function(o,s){var c=this,d=s.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){c.initStyleAttribute(o,{styleAttributeService:d})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||c.updateStyleAtrribute(o,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(o,s){var c=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),I=d.getLayerStyleAttribute("shape");if(A&&A.needRegenerateVertices||I&&I.needRegenerateVertices){o.layerModelNeedUpdate=!0,_.forEach(function(D){return D.needRegenerateVertices=!1});return}_.filter(function(D){return D.needRegenerateVertices}).forEach(function(D){d.updateAttributeByFeatureRange(D.name,o.getEncodedData(),D.featureRange.startIndex,D.featureRange.endIndex),D.needRegenerateVertices=!1,c.logger.debug("regenerate vertex attributes: ".concat(D.name," finished"))})}},{key:"initStyleAttribute",value:function(o,s){var c=this,d=s.styleAttributeService,_=d.getLayerStyleAttributes()||[];_.filter(function(A){return A.needRegenerateVertices}).forEach(function(A){d.updateAttributeByFeatureRange(A.name,o.getEncodedData(),A.featureRange.startIndex,A.featureRange.endIndex),A.needRegenerateVertices=!1,c.logger.debug("init vertex attributes: ".concat(A.name," finished"))})}}]),i}(),Kv),Yv=(0,Dn.Z)(jd.prototype,"logger",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd))||Xv);S.nC.bind(S.vK.ILayerPlugin).to(_s).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Pg).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(gg).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(yu).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(bg).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Og).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Ig).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Wa).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Mg).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(_g).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Ag).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(Cg).inRequestScope(),S.nC.bind(S.vK.ILayerPlugin).to(xg).inRequestScope();var N0="2.4.2";function $v(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function B0(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?$v(Object(o),!0).forEach(function(s){Lg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):$v(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Lg(i,l,o){return l in i?Object.defineProperty(i,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[l]=o,i}function U0(i,l){return Fg(i)||kg(i,l)||Dg(i,l)||Rg()}function Rg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dg(i,l){if(!!i){if(typeof i=="string")return Jv(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Jv(i,l)}}function Jv(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function kg(i,l){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],c=!0,d=!1,_,A;try{for(o=o.call(i);!(c=(_=o.next()).done)&&(s.push(_.value),!(l&&s.length===l));c=!0);}catch(I){d=!0,A=I}finally{try{!c&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function Fg(i){if(Array.isArray(i))return i}var j0=null,Z0=null,Qv,qv,Ed,em,tm,rm;function nm(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function im(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?nm(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):nm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var zg=(Qv=(0,S.yT)(S.vK.ILogService),qv=(0,S.yT)(S.vK.IGlobalConfigService),Ed=(rm=function(){function i(l){(0,N.Z)(this,i),(0,Rn.Z)(this,"logger",em,this),(0,Rn.Z)(this,"configService",tm,this),this.config=void 0,this.config=l}return(0,q.Z)(i,[{key:"setContainer",value:function(o,s){o.bind(S.vK.MapConfig).toConstantValue(im(im({},this.config),{},{id:s})),o.bind(S.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),i}(),rm),em=(0,Dn.Z)(Ed.prototype,"logger",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=(0,Dn.Z)(Ed.prototype,"configService",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed),Ng=y(6158),Bg=y.n(Ng),Zd;(function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP"})(Zd||(Zd={}));function Vp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wd(i,l){var o=tu.fF([],l,i);return tu.bA(o,o,1/o[3]),o}function V0(i,l){var o=i%l;return o<0?l+o:o}function G0(i,l,o){return o*l+(1-o)*i}function kh(i,l){if(!i)throw new Error(l||"viewport-mercator-project: assertion failed.")}var _f=Math.PI,am=_f/4,Gf=_f/180,om=180/_f,Vd=512,Gd=4003e4,Ug=1.5;function sm(i){return Math.pow(2,i)}function jg(i){return Math.log2(i)}function Td(i,l){var o=(0,X.Z)(i,2),s=o[0],c=o[1];kh(Number.isFinite(s)&&Number.isFinite(l)),kh(Number.isFinite(c)&&c>=-90&&c<=90,"invalid latitude"),l*=Vd;var d=s*Gf,_=c*Gf,A=l*(d+_f)/(2*_f),I=l*(_f-Math.log(Math.tan(am+_*.5)))/(2*_f);return[A,I]}function Hd(i,l){var o=(0,X.Z)(i,2),s=o[0],c=o[1];l*=Vd;var d=s/l*(2*_f)-_f,_=2*(Math.atan(Math.exp(_f-c/l*(2*_f)))-am);return[d*om,_*om]}function H0(i){var l=i.latitude;assert(Number.isFinite(l));var o=Math.cos(l*Gf);return jg(Gd*o)-9}function um(i){var l=i.latitude,o=i.longitude,s=i.zoom,c=i.scale,d=i.highPrecision,_=d===void 0?!1:d;c=c!==void 0?c:sm(s),kh(Number.isFinite(l)&&Number.isFinite(o)&&Number.isFinite(c));var A={},I=Vd*c,D=Math.cos(l*Gf),Q=I/360,Y=Q/D,fe=I/Gd/D;if(A.pixelsPerMeter=[fe,-fe,fe],A.metersPerPixel=[1/fe,-1/fe,1/fe],A.pixelsPerDegree=[Q,-Y,fe],A.degreesPerPixel=[1/Q,-1/Y,1/fe],_){var Ye=Gf*Math.tan(l*Gf)/D,ct=Q*Ye/2,Bt=I/Gd*Ye,Sr=Bt/Y*fe;A.pixelsPerDegree2=[0,-ct,Bt],A.pixelsPerMeter2=[Sr,0,Sr]}return A}function W0(i,l){var o=_slicedToArray(i,3),s=o[0],c=o[1],d=o[2],_=_slicedToArray(l,3),A=_[0],I=_[1],D=_[2],Q=1,Y=um({longitude:s,latitude:c,scale:Q,highPrecision:!0}),fe=Y.pixelsPerMeter,Ye=Y.pixelsPerMeter2,ct=Td(i,Q);ct[0]+=A*(fe[0]+Ye[0]*I),ct[1]+=I*(fe[1]+Ye[1]*I);var Bt=Hd(ct,Q),Sr=(d||0)+(D||0);return Number.isFinite(d)||Number.isFinite(D)?[Bt[0],Bt[1],Sr]:Bt}function Zg(i){var l=i.height,o=i.pitch,s=i.bearing,c=i.altitude,d=i.center,_=d===void 0?null:d,A=i.flipY,I=A===void 0?!1:A,D=Vp();return pa.translate(D,D,[0,0,-c]),pa.scale(D,D,[1,1,1/l]),pa.rotateX(D,D,-o*Gf),pa.rotateZ(D,D,s*Gf),I&&pa.scale(D,D,[1,-1,1]),_&&pa.translate(D,D,yi.negate([],_)),D}function Vg(i){var l=i.width,o=i.height,s=i.altitude,c=s===void 0?Ug:s,d=i.pitch,_=d===void 0?0:d,A=i.nearZMultiplier,I=A===void 0?1:A,D=i.farZMultiplier,Q=D===void 0?1:D,Y=_*Gf,fe=Math.atan(.5/c),Ye=Math.sin(fe)*c/Math.sin(Math.PI/2-Y-fe),ct=Math.cos(Math.PI/2-Y)*Ye+c;return{fov:2*Math.atan(o/2/c),aspect:l/o,focalDistance:c,near:I,far:ct*Q}}function Gg(i){var l=i.width,o=i.height,s=i.pitch,c=i.altitude,d=i.nearZMultiplier,_=i.farZMultiplier,A=Vg({width:l,height:o,altitude:c,pitch:s,nearZMultiplier:d,farZMultiplier:_}),I=A.fov,D=A.aspect,Q=A.near,Y=A.far,fe=pa.perspective([],I,D,Q,Y);return fe}function Hg(i,l){var o=(0,X.Z)(i,3),s=o[0],c=o[1],d=o[2],_=d===void 0?0:d;return kh(Number.isFinite(s)&&Number.isFinite(c)&&Number.isFinite(_)),wd(l,[s,c,_,1])}function lm(i,l){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,X.Z)(i,3),c=s[0],d=s[1],_=s[2];if(kh(Number.isFinite(c)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(_)){var A=wd(l,[c,d,_,1]);return A}var I=wd(l,[c,d,0,1]),D=wd(l,[c,d,1,1]),Q=I[2],Y=D[2],fe=Q===Y?0:((o||0)-Q)/(Y-Q);return Nn.lerp([],I,D,fe)}var cm=Vp(),Wg=function(){function i(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=l.width,s=l.height,c=l.viewMatrix,d=c===void 0?cm:c,_=l.projectionMatrix,A=_===void 0?cm:_;(0,N.Z)(this,i),this.width=o||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=A;var I=Vp();pa.multiply(I,I,this.projectionMatrix),pa.multiply(I,I,this.viewMatrix),this.viewProjectionMatrix=I;var D=Vp();pa.scale(D,D,[this.width/2,-this.height/2,1]),pa.translate(D,D,[1,-1,0]),pa.multiply(D,D,this.viewProjectionMatrix);var Q=pa.invert(Vp(),D);if(!Q)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=Q,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,q.Z)(i,[{key:"equals",value:function(o){return o instanceof i?o.width===this.width&&o.height===this.height&&pa.equals(o.projectionMatrix,this.projectionMatrix)&&pa.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=s.topLeft,d=c===void 0?!0:c,_=this.projectPosition(o),A=Hg(_,this.pixelProjectionMatrix),I=(0,X.Z)(A,2),D=I[0],Q=I[1],Y=d?Q:this.height-Q;return o.length===2?[D,Y]:[D,Y,A[2]]}},{key:"unproject",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=s.topLeft,d=c===void 0?!0:c,_=s.targetZ,A=(0,X.Z)(o,3),I=A[0],D=A[1],Q=A[2],Y=d?D:this.height-D,fe=_&&_*this.pixelsPerMeter,Ye=lm([I,Y,Q],this.pixelUnprojectionMatrix,fe),ct=this.unprojectPosition(Ye),Bt=(0,X.Z)(ct,3),Sr=Bt[0],Pr=Bt[1],Ur=Bt[2];return Number.isFinite(Q)?[Sr,Pr,Ur]:Number.isFinite(_)?[Sr,Pr,_]:[Sr,Pr]}},{key:"projectPosition",value:function(o){var s=this.projectFlat(o),c=(0,X.Z)(s,2),d=c[0],_=c[1],A=(o[2]||0)*this.pixelsPerMeter;return[d,_,A]}},{key:"unprojectPosition",value:function(o){var s=this.unprojectFlat(o),c=(0,X.Z)(s,2),d=c[0],_=c[1],A=(o[2]||0)/this.pixelsPerMeter;return[d,_,A]}},{key:"projectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),i}();function Xg(i){var l=i.width,o=i.height,s=i.bounds,c=i.minExtent,d=c===void 0?0:c,_=i.maxZoom,A=_===void 0?24:_,I=i.padding,D=I===void 0?0:I,Q=i.offset,Y=Q===void 0?[0,0]:Q,fe=(0,X.Z)(s,2),Ye=(0,X.Z)(fe[0],2),ct=Ye[0],Bt=Ye[1],Sr=(0,X.Z)(fe[1],2),Pr=Sr[0],Ur=Sr[1];if(Number.isFinite(D)){var dn=D;D={top:dn,bottom:dn,left:dn,right:dn}}else kh(Number.isFinite(D.top)&&Number.isFinite(D.bottom)&&Number.isFinite(D.left)&&Number.isFinite(D.right));var _n=new fm({width:l,height:o,longitude:0,latitude:0,zoom:0}),Gn=_n.project([ct,Ur]),Li=_n.project([Pr,Bt]),qn=[Math.max(Math.abs(Li[0]-Gn[0]),d),Math.max(Math.abs(Li[1]-Gn[1]),d)],qi=[l-D.left-D.right-Math.abs(Y[0])*2,o-D.top-D.bottom-Math.abs(Y[1])*2];kh(qi[0]>0&&qi[1]>0);var Fa=qi[0]/qn[0],Ua=qi[1]/qn[1],di=(D.right-D.left)/2/Fa,Ca=(D.bottom-D.top)/2/Ua,uo=[(Li[0]+Gn[0])/2+di,(Li[1]+Gn[1])/2+Ca],Wu=_n.unproject(uo),up=_n.zoom+Math.log2(Math.abs(Math.min(Fa,Ua)));return{longitude:Wu[0],latitude:Wu[1],zoom:Math.min(up,A)}}var fm=function(i){(0,K.Z)(l,i);function l(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.width,d=s.height,_=s.latitude,A=_===void 0?0:_,I=s.longitude,D=I===void 0?0:I,Q=s.zoom,Y=Q===void 0?0:Q,fe=s.pitch,Ye=fe===void 0?0:fe,ct=s.bearing,Bt=ct===void 0?0:ct,Sr=s.altitude,Pr=Sr===void 0?1.5:Sr,Ur=s.nearZMultiplier,dn=s.farZMultiplier;(0,N.Z)(this,l),c=c||1,d=d||1;var _n=sm(Y);Pr=Math.max(.75,Pr);var Gn=Td([D,A],_n);Gn[2]=0;var Li=Gg({width:c,height:d,pitch:Ye,bearing:Bt,altitude:Pr,nearZMultiplier:Ur||1/d,farZMultiplier:dn||1.01}),qn=Zg({height:d,center:Gn,pitch:Ye,bearing:Bt,altitude:Pr,flipY:!0});return o=(0,ae.Z)(this,(0,xe.Z)(l).call(this,{width:c,height:d,viewMatrix:qn,projectionMatrix:Li})),o.latitude=A,o.longitude=D,o.zoom=Y,o.pitch=Ye,o.bearing=Bt,o.altitude=Pr,o.scale=_n,o.center=Gn,o.pixelsPerMeter=um((0,ke.Z)((0,ke.Z)(o))).pixelsPerMeter[2],Object.freeze((0,ke.Z)((0,ke.Z)(o))),o}return(0,q.Z)(l,[{key:"projectFlat",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Td(s,c)}},{key:"unprojectFlat",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Hd(s,c)}},{key:"getMapCenterByLngLatPosition",value:function(s){var c=s.lngLat,d=s.pos,_=lm(d,this.pixelUnprojectionMatrix),A=Td(c,this.scale),I=Nn.add([],A,Nn.negate([],_)),D=Nn.add([],this.center,I);return Hd(D,this.scale)}},{key:"getLocationAtPoint",value:function(s){var c=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:c,pos:d})}},{key:"fitBounds",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,_=this.height,A=Xg(Object.assign({width:d,height:_,bounds:s},c)),I=A.longitude,D=A.latitude,Q=A.zoom;return new l({width:d,height:_,longitude:I,latitude:D,zoom:Q})}}]),l}(Wg),Yg=function(){function i(){(0,N.Z)(this,i),this.viewport=void 0}return(0,q.Z)(i,[{key:"syncWithMapCamera",value:function(o){var s=o.center,c=o.zoom,d=o.pitch,_=o.bearing,A=o.viewportHeight,I=o.viewportWidth;this.viewport=new fm({width:I,height:A,longitude:s&&s[0],latitude:s&&s[1],zoom:c,pitch:d,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,s){return this.viewport.projectFlat(o,s)}}]),i}(),hm={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},pm,dm,vm,mm,gm,ym,_m,Fh,xm,bm,Sm,Em,wm,Tm;function Am(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Kg(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Am(Object(o),!0).forEach(function(s){(0,L.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Am(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}y(68982)(`/* @antv/l7-maps */
.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Bg();var Cm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},$g=0,Jg=12,Pm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",Qg=(pm=(0,H.b2)(),dm=(0,H.f3)(S.vK.MapConfig),vm=(0,H.f3)(S.vK.IGlobalConfigService),mm=(0,H.f3)(S.vK.ILogService),gm=(0,H.f3)(S.vK.ICoordinateSystemService),ym=(0,H.f3)(S.vK.IEventEmitter),pm(_m=(Fh=(Tm=function(){function i(){var l=this;(0,N.Z)(this,i),this.version=Zd.MAPBOX,this.map=void 0,(0,Rn.Z)(this,"config",xm,this),(0,Rn.Z)(this,"configService",bm,this),(0,Rn.Z)(this,"logger",Sm,this),(0,Rn.Z)(this,"coordinateSystemService",Em,this),(0,Rn.Z)(this,"eventEmitter",wm,this),this.viewport=void 0,this.markerContainer=void 0,this.cameraChangedCallback=void 0,this.$mapContainer=void 0,this.handleCameraChanged=function(){var o=l.map.getCenter().wrap(),s=o.lat,c=o.lng;l.viewport.syncWithMapCamera({bearing:l.map.getBearing(),center:[c,s],viewportHeight:l.map.transform.height,pitch:l.map.getPitch(),viewportWidth:l.map.transform.width,zoom:l.map.getZoom(),cameraHeight:0});var d=l.config.offsetZoom,_=d===void 0?Jg:d;l.viewport.getZoom()>_?l.coordinateSystemService.setCoordinateSystem(S.CoordinateSystem.LNGLAT_OFFSET):l.coordinateSystemService.setCoordinateSystem(S.CoordinateSystem.LNGLAT),l.cameraChangedCallback(l.viewport)}}return(0,q.Z)(i,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=se.DOM.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,s){S.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,s):this.map.on(Cm[o]||o,s)}},{key:"off",value:function(o,s){this.map.off(Cm[o]||o,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,s){this.map.zoomIn(o,s)}},{key:"zoomOut",value:function(o,s){this.map.zoomOut(o,s)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,s){this.map.fitBounds(o,s)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,s){this.map.flyTo({zoom:o,center:s})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,s){var c=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),d=c.x,_=d===void 0?0:d,A=c.y,I=A===void 0?0:A,D=c.z,Q=D===void 0?0:D;return{x:_,y:I,z:Q}}},{key:"getModelMatrix",value:function(o,s,c){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},A=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),I=A.meterInMercatorCoordinateUnits(),D=pa.create();return pa.translate(D,D,yi.fromValues(A.x-_.x,A.y-_.y,A.z||0-_.z)),pa.scale(D,D,yi.fromValues(I*d[0],-I*d[1],I*d[2])),pa.rotateX(D,D,c[0]),pa.rotateY(D,D,c[1]),pa.rotateZ(D,D,c[2]),D}},{key:"init",value:function(){var l=(0,Qe.Z)(Dt().mark(function s(){var c,d,_,A,I,D,Q,Y,fe,Ye,ct,Bt,Sr;return Dt().wrap(function(Ur){for(;;)switch(Ur.prev=Ur.next){case 0:c=this.config,d=c.id,_=d===void 0?"map":d,A=c.attributionControl,I=A===void 0?!1:A,D=c.style,Q=D===void 0?"light":D,Y=c.token,fe=Y===void 0?Pm:Y,Ye=c.rotation,ct=Ye===void 0?0:Ye,Bt=c.mapInstance,Sr=(0,ji.Z)(c,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new Yg,!Bt&&!window.mapboxgl&&this.logger.error(this.configService.getSceneWarninfo("SDK")),fe===Pm&&Q!=="blank"&&!window.mapboxgl.accessToken&&!Bt&&this.logger.warn(this.configService.getSceneWarninfo("MapToken")),!Bt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=fe),Bt?(this.map=Bt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(Kg({container:this.$mapContainer,style:this.getMapStyle(Q),attributionControl:I,bearing:ct},Sr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ur.stop()}},s,this)}));function o(){return l.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var s,c=arguments.length,d=new Array(c>1?c-1:0),_=1;_<c;_++)d[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[o].concat(d))}},{key:"once",value:function(o){for(var s,c=arguments.length,d=new Array(c>1?c-1:0),_=1;_<c;_++)d[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[o].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var s=this.map.getCanvas(),c=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return c}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var s=o;typeof o=="string"&&(s=document.getElementById(o));var c=document.createElement("div");return c.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,c.id="l7_mapbox_div"+$g++,s.appendChild(c),c}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:hm[o]?hm[o]:o}}]),i}(),Tm),xm=(0,Dn.Z)(Fh.prototype,"config",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm=(0,Dn.Z)(Fh.prototype,"configService",[vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sm=(0,Dn.Z)(Fh.prototype,"logger",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Em=(0,Dn.Z)(Fh.prototype,"coordinateSystemService",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=(0,Dn.Z)(Fh.prototype,"eventEmitter",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fh))||_m);function qg(i){var l=ey();return function(){var s=(0,xe.Z)(i),c;if(l){var d=(0,xe.Z)(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return(0,ae.Z)(this,c)}}function ey(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}y(68982)(`/* @antv/l7-maps */
.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var ty=function(i){(0,K.Z)(o,i);var l=qg(o);function o(){return(0,N.Z)(this,o),l.apply(this,arguments)}return(0,q.Z)(o,[{key:"getServiceConstructor",value:function(){return Qg}}]),o}(zg);function Mm(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Im(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Mm(Object(o),!0).forEach(function(s){ry(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Mm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ry(i,l,o){return l in i?Object.defineProperty(i,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[l]=o,i}function ny(i,l){return sy(i)||oy(i,l)||ay(i,l)||iy()}function iy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ay(i,l){if(!!i){if(typeof i=="string")return Om(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Om(i,l)}}function Om(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function oy(i,l){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],c=!0,d=!1,_,A;try{for(o=o.call(i);!(c=(_=o.next()).done)&&(s.push(_.value),!(l&&s.length===l));c=!0);}catch(I){d=!0,A=I}finally{try{!c&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function sy(i){if(Array.isArray(i))return i}var uy=G.memo(function(i){var l=i.style,o=i.className,s=i.map,c=i.option,d=i.onSceneLoaded,_=(0,G.createRef)(),A=(0,G.useState)(),I=ny(A,2),D=I[0],Q=I[1];return(0,G.useEffect)(function(){var Y=new go(Im(Im({id:_.current},c),{},{map:new ty(s)}));return Y.on("loaded",function(){Q(Y),d&&d(Y)}),function(){Y.destroy()}},[]),(0,G.useEffect)(function(){D&&s.style&&D.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,G.useEffect)(function(){D&&s.zoom&&D.setZoom(s.zoom)},[s.zoom]),(0,G.useEffect)(function(){D&&s.center&&D.setCenter(s.center)},[JSON.stringify(s.center)]),(0,G.useEffect)(function(){D&&s.pitch!==void 0&&D.setPitch(s.pitch||0)},[s.pitch]),(0,G.useEffect)(function(){D&&s.rotation&&D.setRotation(s.rotation)},[s.rotation]),G.createElement(b.Provider,{value:D},(0,G.createElement)("div",{ref:_,style:l,className:o},D&&i.children))}),ly=uy;function Lm(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function X0(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Lm(Object(o),!0).forEach(function(s){cy(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Lm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function cy(i,l,o){return l in i?Object.defineProperty(i,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[l]=o,i}function Y0(i,l){return dy(i)||py(i,l)||hy(i,l)||fy()}function fy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hy(i,l){if(!!i){if(typeof i=="string")return Rm(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Rm(i,l)}}function Rm(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function py(i,l){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],c=!0,d=!1,_,A;try{for(o=o.call(i);!(c=(_=o.next()).done)&&(s.push(_.value),!(l&&s.length===l));c=!0);}catch(I){d=!0,A=I}finally{try{!c&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function dy(i){if(Array.isArray(i))return i}var K0=null,$0=null;function Dm(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function J0(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Dm(Object(o),!0).forEach(function(s){vy(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Dm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function vy(i,l,o){return l in i?Object.defineProperty(i,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[l]=o,i}function Q0(i,l){return _y(i)||yy(i,l)||gy(i,l)||my()}function my(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gy(i,l){if(!!i){if(typeof i=="string")return km(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return km(i,l)}}function km(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function yy(i,l){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],c=!0,d=!1,_,A;try{for(o=o.call(i);!(c=(_=o.next()).done)&&(s.push(_.value),!(l&&s.length===l));c=!0);}catch(I){d=!0,A=I}finally{try{!c&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function _y(i){if(Array.isArray(i))return i}var q0=null,e_=null;function t_(i,l){return Ey(i)||Sy(i,l)||by(i,l)||xy()}function xy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function by(i,l){if(!!i){if(typeof i=="string")return Fm(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Fm(i,l)}}function Fm(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function Sy(i,l){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],c=!0,d=!1,_,A;try{for(o=o.call(i);!(c=(_=o.next()).done)&&(s.push(_.value),!(l&&s.length===l));c=!0);}catch(I){d=!0,A=I}finally{try{!c&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function Ey(i){if(Array.isArray(i))return i}var r_=null,n_=null;function zm(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function i_(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?zm(Object(o),!0).forEach(function(s){wy(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):zm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function wy(i,l,o){return l in i?Object.defineProperty(i,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[l]=o,i}function a_(i,l){if(i==null)return{};var o=Ty(i,l),s,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(c=0;c<d.length;c++)s=d[c],!(l.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function Ty(i,l){if(i==null)return{};var o={},s=Object.keys(i),c,d;for(d=0;d<s.length;d++)c=s[d],!(l.indexOf(c)>=0)&&(o[c]=i[c]);return o}var o_=null,Nm=y(73935);function Ay(i,l){return Iy(i)||My(i,l)||Py(i,l)||Cy()}function Cy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Py(i,l){if(!!i){if(typeof i=="string")return Bm(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Bm(i,l)}}function Bm(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function My(i,l){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],c=!0,d=!1,_,A;try{for(o=o.call(i);!(c=(_=o.next()).done)&&(s.push(_.value),!(l&&s.length===l));c=!0);}catch(I){d=!0,A=I}finally{try{!c&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function Iy(i){if(Array.isArray(i))return i}var Oy=G.useEffect,Ly=G.useState;function s_(i){var l=i.className,o=i.style,s=i.children,c=i.position,d=useSceneValue(),_=Ly(function(){return document.createElement("div")}),A=Ay(_,1),I=A[0];return Oy(function(){var D=new Control({position:c});return D.onAdd=function(){if(l&&(I.className=l),o){var Q=Object.keys(o).map(function(Y){return"".concat(Y,":").concat(o[Y])}).join(";");I.style.cssText=Q}return I},d.addControl(D),function(){d.removeControl(D)}},[]),createPortal(s,I)}var Um=(0,G.createContext)({});function u_(){return useContext(Um)}var Ry=G.useEffect,Dy=G.memo(function(l){var o=l.layer,s=l.active;return Ry(function(){o.active(s.option)},[JSON.stringify(s)]),null}),ky=G.useEffect,Fy=G.memo(function(l){var o=l.layer,s=l.animate;return ky(function(){o.animate(s)},[JSON.stringify(s)]),null}),zy=G.useEffect,Ny=G.memo(function(l){var o=l.layer,s=l.color;return zy(function(){s.field?o.color(s.field,s.values):o.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),By=G.useEffect,Uy=G.memo(function(l){var o=l.layer,s=l.filter;return By(function(){s.field&&o.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),jy=G.useEffect,Zy=G.memo(function(l){var o=l.layer,s=l.scale;return jy(function(){o.scale(s.values)},[s.values]),null}),Vy=G.useEffect,Gy=G.memo(function(l){var o=l.layer,s=l.select;return Vy(function(){o.select(s.option)},[JSON.stringify(s)]),null}),Hy=G.useEffect,Wy=G.memo(function(l){var o=l.layer,s=l.shape;return Hy(function(){s.field?o.shape(s.field,s.values):o.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Xy=G.useEffect,Yy=G.memo(function(l){var o=l.layer,s=l.size;return Xy(function(){s.field?o.size(s.field,s.values):o.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ky=["data"];function $y(i,l){if(i==null)return{};var o=Jy(i,l),s,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(c=0;c<d.length;c++)s=d[c],!(l.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function Jy(i,l){if(i==null)return{};var o={},s=Object.keys(i),c,d;for(d=0;d<s.length;d++)c=s[d],!(l.indexOf(c)>=0)&&(o[c]=i[c]);return o}var Qy=G.useEffect,qy=G.memo(function(l){var o=l.layer,s=l.source,c=s.data,d=$y(s,Ky);return Qy(function(){o.inited?o.setData(c,d):o.source(c,d),d.autoFit&&o.fitBounds(d&&d.fitBoundsOptions)},[c,JSON.stringify(d)]),null}),e0=G.useEffect,t0=G.memo(function(l){var o=l.layer,s=l.style;return e0(function(){o.style(s)},Object.keys(s).map(function(c){return s[c]})),null});function r0(i,l){return o0(i)||a0(i,l)||i0(i,l)||n0()}function n0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i0(i,l){if(!!i){if(typeof i=="string")return jm(i,l);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return jm(i,l)}}function jm(i,l){(l==null||l>i.length)&&(l=i.length);for(var o=0,s=new Array(l);o<l;o++)s[o]=i[o];return s}function a0(i,l){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],c=!0,d=!1,_,A;try{for(o=o.call(i);!(c=(_=o.next()).done)&&(s.push(_.value),!(l&&s.length===l));c=!0);}catch(I){d=!0,A=I}finally{try{!c&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function o0(i){if(Array.isArray(i))return i}var Gp=G.useEffect,s0=G.useState;function Zm(i,l){var o=l.source,s=l.color,c=l.shape,d=l.style,_=l.size,A=l.scale,I=l.active,D=l.select,Q=l.filter,Y=l.animate,fe=l.options,Ye=l.onLayerLoaded,ct=p(),Bt=s0(function(){var Ur;switch(i){case"polygonLayer":Ur=new ii(fe);break;case"lineLayer":Ur=new rl(fe);break;case"pointLayer":Ur=new Gt(fe);break;case"heatmapLayer":Ur=new Rl(fe);break;case"rasterLayer":Ur=new io(fe);break;case"imageLayer":Ur=new ho(fe);break;case"citybuildingLayer":Ur=new Qu(fe);break;default:Ur=new ii(fe)}return Ur.on("inited",function(){Ye&&Ye(Ur,ct)}),Ur}),Sr=r0(Bt,1),Pr=Sr[0];return Gp(function(){return ct.addLayer(Pr),function(){ct.removeLayer(Pr)}},[]),Gp(function(){Pr.inited&&fe&&Pr.updateLayerConfig(fe)},[fe==null?void 0:fe.minZoom,fe==null?void 0:fe.maxZoom,fe==null?void 0:fe.visible]),Gp(function(){Pr.inited&&(fe==null?void 0:fe.zIndex)&&Pr.setIndex(fe.zIndex)},[fe==null?void 0:fe.zIndex]),Gp(function(){Pr.inited&&(fe==null?void 0:fe.blend)&&Pr.setBlend(fe.blend)},[fe==null?void 0:fe.blend]),Gp(function(){ct.render()}),G.createElement(Um.Provider,{value:Pr},G.createElement(qy,{layer:Pr,source:o}),A&&G.createElement(Zy,{layer:Pr,scale:A}),s&&G.createElement(Ny,{layer:Pr,color:s}),_&&G.createElement(Yy,{layer:Pr,size:_}),c&&G.createElement(Wy,{layer:Pr,shape:c}),d&&G.createElement(t0,{layer:Pr,style:d}),I&&G.createElement(Dy,{layer:Pr,active:I}),D&&G.createElement(Gy,{layer:Pr,select:D}),Q&&G.createElement(Uy,{layer:Pr,filter:Q}),Y&&G.createElement(Fy,{layer:Pr,animate:Y}),l.children)}var l_=null,c_=null,u0=G.memo(function(l){return Zm("pointLayer",l)}),l0=G.memo(function(l){return Zm("heatmapLayer",l)}),f_=null,h_=null,p_=null,d_=G.useEffect,v_=null,m_=null;function Ad(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ad=function(o){return typeof o}:Ad=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Ad(i)}function Vm(i,l){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);l&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function Cd(i){for(var l=1;l<arguments.length;l++){var o=arguments[l]!=null?arguments[l]:{};l%2?Vm(Object(o),!0).forEach(function(s){c0(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Vm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function c0(i,l,o){return l in i?Object.defineProperty(i,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[l]=o,i}function f0(i,l){if(!(i instanceof l))throw new TypeError("Cannot call a class as a function")}function Gm(i,l){for(var o=0;o<l.length;o++){var s=l[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function h0(i,l,o){return l&&Gm(i.prototype,l),o&&Gm(i,o),i}function p0(i,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(l&&l.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),l&&Wd(i,l)}function Wd(i,l){return Wd=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},Wd(i,l)}function d0(i){var l=g0();return function(){var s=Pd(i),c;if(l){var d=Pd(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return v0(this,c)}}function v0(i,l){return l&&(Ad(l)==="object"||typeof l=="function")?l:m0(i)}function m0(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function g0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Pd(i){return Pd=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Pd(i)}var g_=function(i){p0(o,i);var l=d0(o);function o(s){var c;return f0(this,o),c=l.call(this,s),c.el=void 0,c.scene=void 0,c.popup=void 0,c.el=document.createElement("div"),c}return h0(o,[{key:"componentDidMount",value:function(){var c,d=this.props,_=d.lnglat,A=d.children,I=d.option,D=d.lngLat,Q=new Ue(Cd(Cd({},I),{},{stopPropagation:(c=this.props.option)===null||c===void 0?void 0:c.stopPropagation}));_&&Q.setLnglat(_),D&&Q.setLnglat(D),A&&Q.setDOMContent(this.el),this.popup=Q,this.scene.addPopup(Q)}},{key:"componentDidUpdate",value:function(c){var d,_,A,I,D,Q,Y=Array.isArray(c.lnglat)?c.lnglat:[c==null||(d=c.lnglat)===null||d===void 0?void 0:d.lng,c==null||(_=c.lnglat)===null||_===void 0?void 0:_.lat],fe=Array.isArray(this.props.lnglat)?this.props.lnglat:[(A=this.props)===null||A===void 0||(I=A.lnglat)===null||I===void 0?void 0:I.lng,(D=this.props)===null||D===void 0||(Q=D.lnglat)===null||Q===void 0?void 0:Q.lat],Ye=Y.toString()!==fe.toString();if(Ye){var ct;this.popup.remove(),this.popup=new Ue(Cd(Cd({},this.props.option),{},{stopPropagation:(ct=this.props.option)===null||ct===void 0?void 0:ct.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var c=this;return G.createElement(b.Consumer,{},function(d){return d&&(c.scene=d),(0,Nm.createPortal)(c.props.children,c.el)})}}]),o}(G.PureComponent);function Md(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Md=function(o){return typeof o}:Md=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Md(i)}function y0(i,l){if(!(i instanceof l))throw new TypeError("Cannot call a class as a function")}function Hm(i,l){for(var o=0;o<l.length;o++){var s=l[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function _0(i,l,o){return l&&Hm(i.prototype,l),o&&Hm(i,o),i}function x0(i,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(l&&l.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),l&&Xd(i,l)}function Xd(i,l){return Xd=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},Xd(i,l)}function b0(i){var l=w0();return function(){var s=Id(i),c;if(l){var d=Id(this).constructor;c=Reflect.construct(s,arguments,d)}else c=s.apply(this,arguments);return S0(this,c)}}function S0(i,l){return l&&(Md(l)==="object"||typeof l=="function")?l:E0(i)}function E0(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function w0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Id(i){return Id=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Id(i)}var y_=function(i){x0(o,i);var l=b0(o);function o(s){var c;return y0(this,o),c=l.call(this,s),c.el=void 0,c.scene=void 0,c.marker=void 0,c.el=document.createElement("div"),c}return _0(o,[{key:"componentDidMount",value:function(){var c=this.props,d=c.lnglat,_=c.children,A=c.option,I=c.onMarkerLoaded,D=new Pt(A);d&&D.setLnglat(d),_&&D.setElement(this.el),this.marker=D,I&&I(D),this.scene.addMarker(D)}},{key:"componentDidUpdate",value:function(c){var d,_=(c==null?void 0:c.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var c=this;return G.createElement(b.Consumer,{},function(d){return d&&(c.scene=d),(0,Nm.createPortal)(c.props.children,c.el)})}}]),o}(G.PureComponent),__=G.useEffect,x_=null,b_=null,S_=G.useEffect,E_=null},4771:function(){},6563:function(ft,C,y){var G=y(31795);ft.exports=b;function b(q,K){switch(q&&q.type||null){case"FeatureCollection":return q.features=q.features.map(p(b,K)),q;case"GeometryCollection":return q.geometries=q.geometries.map(p(b,K)),q;case"Feature":return q.geometry=b(q.geometry,K),q;case"Polygon":case"MultiPolygon":return S(q,K);default:return q}}function p(q,K){return function(ae){return q(ae,K)}}function S(q,K){return q.type==="Polygon"?q.coordinates=L(q.coordinates,K):q.type==="MultiPolygon"&&(q.coordinates=q.coordinates.map(p(L,K))),q}function L(q,K){K=!!K,q[0]=X(q[0],K);for(var ae=1;ae<q.length;ae++)q[ae]=X(q[ae],!K);return q}function X(q,K){return N(q)===K?q:q.reverse()}function N(q){return G.ring(q)>=0}},22936:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.applyAnchorClass=b,C.anchorTranslate=C.anchorType=void 0;var y;C.anchorType=y,function(p){p.CENTER="center",p.TOP="top",p["TOP-LEFT"]="top-left",p["TOP-RIGHT"]="top-right",p.BOTTOM="bottom",p["BOTTOM-LEFT"]="bottom-left",p.LEFT="left",p.RIGHT="right"}(y||(C.anchorType=y={}));var G={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};C.anchorTranslate=G;function b(p,S,L){var X=p.classList;for(var N in G)G.hasOwnProperty(N)&&X.remove("l7-".concat(L,"-anchor-").concat(N));X.add("l7-".concat(L,"-anchor-").concat(S))}},11736:function(ft,C,y){"use strict";var G=y(20862);Object.defineProperty(C,"__esModule",{value:!0}),C.rgb2arr=p,C.decodePickingColor=S,C.encodePickingColor=L,C.generateColorRamp=X;var b=G(y(3054));function p(N){var q=b.color(N),K=[0,0,0,0];return q!=null&&(K[0]=q.r/255,K[1]=q.g/255,K[2]=q.b/255,K[3]=q.opacity),K}function S(N){var q=N&&N[0],K=N&&N[1],ae=N&&N[2],xe=q+K*256+ae*65536-1;return xe}function L(N){return[N+1&255,N+1>>8&255,N+1>>8>>8&255]}function X(N){var q=document.createElement("canvas"),K=q.getContext("2d");q.width=256,q.height=1;for(var ae=K.createLinearGradient(0,0,256,1),xe=null,se=N.positions[0],Ft=N.positions[N.positions.length-1],zt=0;zt<N.colors.length;++zt){var Wt=(N.positions[zt]-se)/(Ft-se);ae.addColorStop(Wt,N.colors[zt])}return K.fillStyle=ae,K.fillRect(0,0,256,1),xe=new Uint8ClampedArray(K.getImageData(0,0,256,1).data),new ImageData(xe,256,1)}},98570:function(ft,C,y){"use strict";var G=y(95318);Object.defineProperty(C,"__esModule",{value:!0}),C.getContainer=S,C.trim=L,C.splitWords=X,C.create=q,C.remove=K,C.addClass=ae,C.removeClass=xe,C.hasClass=se,C.setClass=Ft,C.getClass=zt,C.empty=Wt,C.setTransform=wt,C.triggerResize=ot,C.printCanvas=tt,C.getViewPortScale=Yt,C.DPR=void 0;var b=G(y(63038)),p=window.document.documentElement.style;function S(Ne){var Be=Ne;return typeof Ne=="string"&&(Be=document.getElementById(Ne)),Be}function L(Ne){return Ne.trim?Ne.trim():Ne.replace(/^\s+|\s+$/g,"")}function X(Ne){return L(Ne).split(/\s+/)}function N(Ne){if(!p)return Ne[0];for(var Be in Ne)if(Ne[Be]&&Ne[Be]in p)return Ne[Be];return Ne[0]}function q(Ne,Be,Ie){var pt=document.createElement(Ne);return pt.className=Be||"",Ie&&Ie.appendChild(pt),pt}function K(Ne){var Be=Ne.parentNode;Be&&Be.removeChild(Ne)}function ae(Ne,Be){if(Ne.classList!==void 0)for(var Ie=X(Be),pt=0,oe=Ie.length;pt<oe;pt++)Ne.classList.add(Ie[pt]);else if(!se(Ne,Be)){var re=zt(Ne);Ft(Ne,(re?re+" ":"")+Be)}}function xe(Ne,Be){Ne.classList!==void 0?Ne.classList.remove(Be):Ft(Ne,L((" "+zt(Ne)+" ").replace(" "+Be+" "," ")))}function se(Ne,Be){if(Ne.classList!==void 0)return Ne.classList.contains(Be);var Ie=zt(Ne);return Ie.length>0&&new RegExp("(^|\\s)"+Be+"(\\s|$)").test(Ie)}function Ft(Ne,Be){Ne instanceof HTMLElement?Ne.className=Be:Ne.className.baseVal=Be}function zt(Ne){return Ne instanceof SVGElement&&(Ne=Ne.correspondingElement),Ne.className.baseVal===void 0?Ne.className:Ne.className.baseVal}function Wt(Ne){for(;Ne&&Ne.firstChild;)Ne.removeChild(Ne.firstChild)}var Mt=N(["transform","WebkitTransform"]);function wt(Ne,Be){Ne.style[Mt]=Be}function ot(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var Ne=window.document.createEvent("UIEvents");Ne.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(Ne)}}function tt(Ne){var Be=["padding: "+(Ne.height/2-8)+"px "+Ne.width/2+"px;","line-height: "+Ne.height+"px;","background-image: url("+Ne.toDataURL()+");"];console.log(`%c
`,Be.join(""))}function Yt(){var Ne,Be=document.querySelector('meta[name="viewport"]');if(!Be)return 1;var Ie=(Ne=Be.content)===null||Ne===void 0?void 0:Ne.split(","),pt=Ie.find(function(oe){var re=oe.split("="),ue=(0,b.default)(re,2),it=ue[0],Jt=ue[1];return it==="initial-scale"});return pt?pt.split("=")[1]*1:1}var ke=Yt()<1?1:window.devicePixelRatio;C.DPR=ke},19969:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.bindAll=y;function y(G,b){G.forEach(function(p){!b[p]||(b[p]=b[p].bind(b))})}},29469:function(ft,C,y){"use strict";var G=y(95318);Object.defineProperty(C,"__esModule",{value:!0}),C.getImage=C.getArrayBuffer=C.getJSON=void 0;var b=G(y(34575)),p=G(y(93913)),S=G(y(2205)),L=G(y(78585)),X=G(y(29754)),N=G(y(65957));function q(wt){var ot=K();return function(){var Yt=(0,X.default)(wt),ke;if(ot){var Ne=(0,X.default)(this).constructor;ke=Reflect.construct(Yt,arguments,Ne)}else ke=Yt.apply(this,arguments);return(0,L.default)(this,ke)}}function K(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(wt){return!1}}var ae=function(wt){(0,S.default)(tt,wt);var ot=q(tt);function tt(Yt,ke,Ne){var Be;return(0,b.default)(this,tt),Be=ot.call(this,Yt),Be.status=void 0,Be.url=void 0,Be.status=ke,Be.url=Ne,Be.name=Be.constructor.name,Be.message=Yt,Be}return(0,p.default)(tt,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),tt}((0,N.default)(Error));function xe(wt){var ot=new XMLHttpRequest;ot.open("GET",wt.url,!0);for(var tt in wt.headers)wt.headers.hasOwnProperty(tt)&&ot.setRequestHeader(tt,wt.headers[tt]);return ot.withCredentials=wt.credentials==="include",ot}var se=function(ot,tt){var Yt=xe(ot);return Yt.setRequestHeader("Accept","application/json"),Yt.onerror=function(){tt(new Error(Yt.statusText))},Yt.onload=function(){if(Yt.status>=200&&Yt.status<300&&Yt.response){var ke;try{ke=JSON.parse(Yt.response)}catch(Ne){return tt(Ne)}tt(null,ke)}else Yt.status===401?tt(new ae("".concat(Yt.statusText),Yt.status,ot.url)):tt(new ae(Yt.statusText,Yt.status,ot.url))},Yt.send(),Yt};C.getJSON=se;var Ft=function(ot,tt){var Yt=xe(ot);return Yt.responseType="arraybuffer",Yt.onerror=function(){tt(new Error(Yt.statusText))},Yt.onload=function(){var ke=Yt.response;if(ke.byteLength===0&&Yt.status===200)return tt(new Error("http status 200 returned without content."));Yt.status>=200&&Yt.status<300&&Yt.response?tt(null,{data:ke,cacheControl:Yt.getResponseHeader("Cache-Control"),expires:Yt.getResponseHeader("Expires")}):tt(new ae(Yt.statusText,Yt.status,ot.url))},Yt.send(),Yt};C.getArrayBuffer=Ft;function zt(wt){var ot=window.document.createElement("a");return ot.href=wt,ot.protocol===window.document.location.protocol&&ot.host===window.document.location.host}var Wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Mt=function(ot,tt){return Ft(ot,function(Yt,ke){if(Yt)tt(Yt);else if(ke){var Ne=new window.Image;Ne.crossOrigin="anonymous";var Be=window.URL||window.webkitURL;Ne.onload=function(){tt(null,Ne),Be.revokeObjectURL(Ne.src)};var Ie=new window.Blob([new Uint8Array(ke.data)],{type:"image/png"});Ne.src=ke.data.byteLength?Be.createObjectURL(Ie):Wt}})};C.getImage=Mt},22194:function(ft,C,y){"use strict";var G=y(95318);Object.defineProperty(C,"__esModule",{value:!0}),C.extent=L,C.tranfrormCoord=N,C.lngLatToMeters=K,C.metersToLngLat=ae,C.longitude=xe,C.latitude=se,C.validateLngLat=Ft,C.aProjectFlat=zt,C.unProjectFlat=Wt,C.lnglatDistance=Mt,C.project=wt,C.padBounds=ot,C.boundsContains=tt,C.bBoxToBounds=Yt;var b=G(y(63038)),p=y(84102),S=2*Math.PI*6378137/2;function L(ke){var Ne=[Infinity,Infinity,-Infinity,-Infinity];return ke.forEach(function(Be){var Ie=Be.coordinates;X(Ne,Ie)}),Ne}function X(ke,Ne){return Array.isArray(Ne[0])?Ne.forEach(function(Be){X(ke,Be)}):(ke[0]>Ne[0]&&(ke[0]=Ne[0]),ke[1]>Ne[1]&&(ke[1]=Ne[1]),ke[2]<Ne[0]&&(ke[2]=Ne[0]),ke[3]<Ne[1]&&(ke[3]=Ne[1])),ke}function N(ke,Ne){return q(ke,Ne)}function q(ke,Ne){return Array.isArray(ke[0])?ke.map(function(Be){return q(Be,Ne)}):Ne(ke)}function K(ke){var Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Be=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};ke=Ft(ke,Ne);var Ie=ke[0],pt=ke[1],oe=Ie*S/180,re=Math.log(Math.tan((90+pt)*Math.PI/360))/(Math.PI/180);return re=re*S/180,Be.enable&&(oe=Number(oe.toFixed(Be.decimal)),re=Number(re.toFixed(Be.decimal))),ke.length===3?[oe,re,ke[2]]:[oe,re]}function ae(ke){var Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,Be=ke[0],Ie=ke[1],pt=Be/S*180,oe=Ie/S*180;return oe=180/Math.PI*(2*Math.atan(Math.exp(oe*Math.PI/180))-Math.PI/2),Ne!=null&&(pt=Number(pt.toFixed(Ne)),oe=Number(oe.toFixed(Ne))),ke.length===3?[pt,oe,ke[2]]:[pt,oe]}function xe(ke){if(ke==null)throw new Error("lng is required");return(ke>180||ke<-180)&&(ke=ke%360,ke>180&&(ke=-360+ke),ke<-180&&(ke=360+ke),ke===0&&(ke=0)),ke}function se(ke){if(ke==null)throw new Error("lat is required");return(ke>90||ke<-90)&&(ke=ke%180,ke>90&&(ke=-180+ke),ke<-90&&(ke=180+ke),ke===0&&(ke=0)),ke}function Ft(ke,Ne){if(Ne===!1)return ke;var Be=xe(ke[0]),Ie=se(ke[1]);return Ie>85&&(Ie=85),Ie<-85&&(Ie=-85),ke.length===3?[Be,Ie,ke[2]]:[Be,Ie]}function zt(ke){var Ne=85.0511287798,Be=Math.max(Math.min(Ne,ke[1]),-Ne),Ie=256<<20,pt=Math.PI/180,oe=ke[0]*pt,re=Be*pt;re=Math.log(Math.tan(Math.PI/4+re/2));var ue=.5/Math.PI,it=.5,Jt=-.5/Math.PI;return pt=.5,oe=Ie*(ue*oe+it),re=Ie*(Jt*re+pt),[Math.floor(oe),Math.floor(re)]}function Wt(ke){var Ne=.5/Math.PI,Be=.5,Ie=-.5/Math.PI,pt=.5,oe=256<<20,re=(0,b.default)(ke,2),ue=re[0],it=re[1];ue=(ue/oe-Be)/Ne,it=(it/oe-pt)/Ie,it=(Math.atan(Math.pow(Math.E,it))-Math.PI/4)*2,pt=Math.PI/180;var Jt=it/pt,ce=ue/pt;return[ce,Jt]}function Mt(ke,Ne,Be){var Ie=(0,p.degreesToRadians)(Ne[1]-ke[1]),pt=(0,p.degreesToRadians)(Ne[0]-ke[0]),oe=(0,p.degreesToRadians)(ke[1]),re=(0,p.degreesToRadians)(Ne[1]),ue=Math.pow(Math.sin(Ie/2),2)+Math.pow(Math.sin(pt/2),2)*Math.cos(oe)*Math.cos(re);return(0,p.radiansToLength)(2*Math.atan2(Math.sqrt(ue),Math.sqrt(1-ue)),Be="meters")}function wt(ke){var Ne=Math.PI/180,Be=85.0511287798,Ie=6378137,pt=Math.max(Math.min(Be,ke[1]),-Be),oe=Math.sin(pt*Ne),re=Ie*ke[0]*Ne,ue=Ie*Math.log((1+oe)/(1-oe))/2;return[re,ue]}function ot(ke,Ne){var Be=Math.abs(ke[1][1]-ke[0][1])*Ne,Ie=Math.abs(ke[1][0]-ke[0][0])*Ne;return[[ke[0][0]-Ie,ke[0][1]-Be],[ke[1][0]+Ie,ke[1][1]+Be]]}function tt(ke,Ne){return ke[0][0]<=Ne[0][0]&&ke[0][1]<=Ne[0][1]&&ke[1][0]>=Ne[1][0]&&ke[1][1]>=Ne[1][1]}function Yt(ke){return[[ke[0],ke[1]],[ke[2],ke[3]]]}},21605:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BKDRHash=y,C.djb2hash=G;function y(b){var p=131,S=137,L=0;b+="x";for(var X=Math.floor(9007199254740991/S),N=0;N<b.length;N++)L>X&&(L=Math.floor(L/S)),L=L*p+b.charCodeAt(N);return L}function G(b){b=b.toString();for(var p=5381,S=b.length;S;)p=p*33^b.charCodeAt(--S);return p>>>0}},82887:function(ft,C,y){"use strict";var G=y(20862);Object.defineProperty(C,"__esModule",{value:!0});var b={djb2hash:!0,BKDRHash:!0,DOM:!0,Satistics:!0};Object.defineProperty(C,"djb2hash",{enumerable:!0,get:function(){return p.djb2hash}}),Object.defineProperty(C,"BKDRHash",{enumerable:!0,get:function(){return p.BKDRHash}}),C.Satistics=C.DOM=void 0;var p=y(21605),S=G(y(98570));C.DOM=S;var L=y(29469);Object.keys(L).forEach(function(se){se==="default"||se==="__esModule"||Object.prototype.hasOwnProperty.call(b,se)||se in C&&C[se]===L[se]||Object.defineProperty(C,se,{enumerable:!0,get:function(){return L[se]}})});var X=y(22194);Object.keys(X).forEach(function(se){se==="default"||se==="__esModule"||Object.prototype.hasOwnProperty.call(b,se)||se in C&&C[se]===X[se]||Object.defineProperty(C,se,{enumerable:!0,get:function(){return X[se]}})});var N=y(74866);Object.keys(N).forEach(function(se){se==="default"||se==="__esModule"||Object.prototype.hasOwnProperty.call(b,se)||se in C&&C[se]===N[se]||Object.defineProperty(C,se,{enumerable:!0,get:function(){return N[se]}})});var q=y(19969);Object.keys(q).forEach(function(se){se==="default"||se==="__esModule"||Object.prototype.hasOwnProperty.call(b,se)||se in C&&C[se]===q[se]||Object.defineProperty(C,se,{enumerable:!0,get:function(){return q[se]}})});var K=y(11736);Object.keys(K).forEach(function(se){se==="default"||se==="__esModule"||Object.prototype.hasOwnProperty.call(b,se)||se in C&&C[se]===K[se]||Object.defineProperty(C,se,{enumerable:!0,get:function(){return K[se]}})});var ae=y(22936);Object.keys(ae).forEach(function(se){se==="default"||se==="__esModule"||Object.prototype.hasOwnProperty.call(b,se)||se in C&&C[se]===ae[se]||Object.defineProperty(C,se,{enumerable:!0,get:function(){return ae[se]}})});var xe=G(y(39256));C.Satistics=xe},74866:function(ft,C,y){"use strict";var G=y(95318);Object.defineProperty(C,"__esModule",{value:!0}),C.LRUCache=void 0;var b=G(y(34575)),p=G(y(93913)),S=function(){function L(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,N=arguments.length>1?arguments[1]:void 0;(0,b.default)(this,L),this.limit=void 0,this.cache=void 0,this.destroy=void 0,this.order=void 0,this.limit=X,this.destroy=N||this.defaultDestroy,this.order=[],this.clear()}return(0,p.default)(L,[{key:"clear",value:function(){var N=this;this.order.forEach(function(q){N.delete(q)}),this.cache={},this.order=[]}},{key:"get",value:function(N){var q=this.cache[N];return q&&(this.deleteOrder(N),this.appendOrder(N)),q}},{key:"set",value:function(N,q){this.cache[N]?(this.delete(N),this.cache[N]=q,this.appendOrder(N)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[N]=q,this.appendOrder(N))}},{key:"delete",value:function(N){var q=this.cache[N];q&&(this.deleteCache(N),this.deleteOrder(N),this.destroy(q,N))}},{key:"deleteCache",value:function(N){delete this.cache[N]}},{key:"deleteOrder",value:function(N){var q=this.order.findIndex(function(K){return K===N});q>=0&&this.order.splice(q,1)}},{key:"appendOrder",value:function(N){this.order.push(N)}},{key:"defaultDestroy",value:function(N,q){return null}}]),L}();C.LRUCache=S},39256:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.sum=b,C.max=y,C.min=G,C.mean=p,C.mode=S,C.getColumn=X,C.getSatByColumn=N,C.statMap=void 0;function y(q){if(q.length===0)throw new Error("max requires at least one data point");for(var K=q[0],ae=1;ae<q.length;ae++)q[ae]>K&&(K=q[ae]);return K*1}function G(q){if(q.length===0)throw new Error("min requires at least one data point");for(var K=q[0],ae=1;ae<q.length;ae++)q[ae]<K&&(K=q[ae]);return K*1}function b(q){if(q.length===0)return 0;for(var K=q[0]*1,ae=1;ae<q.length;ae++)K+=q[ae]*1;return K}function p(q){if(q.length===0)throw new Error("mean requires at least one data point");return b(q)/q.length}function S(q){if(q.length===0)throw new Error("mean requires at least one data point");if(q.length<3)return q[0];q.sort();for(var K=q[0],ae=NaN,xe=0,se=1,Ft=1;Ft<q.length+1;Ft++)q[Ft]!==K?(se>xe&&(xe=se,ae=K),se=1,K=q[Ft]):se++;return ae*1}var L={min:G,max:y,mean:p,sum:b,mode:S};C.statMap=L;function X(q,K){return q.map(function(ae){return ae[K]})}function N(q,K){return L[q](K)}},81506:function(ft){function C(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}ft.exports=C,ft.exports.default=ft.exports,ft.exports.__esModule=!0},34575:function(ft){function C(y,G){if(!(y instanceof G))throw new TypeError("Cannot call a class as a function")}ft.exports=C,ft.exports.default=ft.exports,ft.exports.__esModule=!0},69100:function(ft,C,y){var G=y(99489),b=y(57067);function p(S,L,X){return b()?(ft.exports=p=Reflect.construct,ft.exports.default=ft.exports,ft.exports.__esModule=!0):(ft.exports=p=function(q,K,ae){var xe=[null];xe.push.apply(xe,K);var se=Function.bind.apply(q,xe),Ft=new se;return ae&&G(Ft,ae.prototype),Ft},ft.exports.default=ft.exports,ft.exports.__esModule=!0),p.apply(null,arguments)}ft.exports=p,ft.exports.default=ft.exports,ft.exports.__esModule=!0},93913:function(ft){function C(G,b){for(var p=0;p<b.length;p++){var S=b[p];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(G,S.key,S)}}function y(G,b,p){return b&&C(G.prototype,b),p&&C(G,p),G}ft.exports=y,ft.exports.default=ft.exports,ft.exports.__esModule=!0},3473:function(ft,C,y){"use strict";y.d(C,{Z:function(){return G}});function G(b,p,S,L,X){var N={};return Object.keys(L).forEach(function(q){N[q]=L[q]}),N.enumerable=!!N.enumerable,N.configurable=!!N.configurable,("value"in N||N.initializer)&&(N.writable=!0),N=S.slice().reverse().reduce(function(q,K){return K(b,p,q)||q},N),X&&N.initializer!==void 0&&(N.value=N.initializer?N.initializer.call(X):void 0,N.initializer=void 0),N.initializer===void 0&&(Object.defineProperty(b,p,N),N=null),N}},66213:function(ft,C,y){"use strict";y.d(C,{Z:function(){return p}});var G=y(77608);function b(S,L){for(;!Object.prototype.hasOwnProperty.call(S,L)&&(S=(0,G.Z)(S),S!==null););return S}function p(S,L,X){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(q,K,ae){var xe=b(q,K);if(!!xe){var se=Object.getOwnPropertyDescriptor(xe,K);return se.get?se.get.call(ae):se.value}},p(S,L,X||S)}},55770:function(ft,C,y){"use strict";y.d(C,{Z:function(){return G}});function G(b,p,S,L){!S||Object.defineProperty(b,p,{enumerable:S.enumerable,configurable:S.configurable,writable:S.writable,value:S.initializer?S.initializer.call(L):void 0})}},29754:function(ft){function C(y){return ft.exports=C=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)},ft.exports.default=ft.exports,ft.exports.__esModule=!0,C(y)}ft.exports=C,ft.exports.default=ft.exports,ft.exports.__esModule=!0},2205:function(ft,C,y){var G=y(99489);function b(p,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function");p.prototype=Object.create(S&&S.prototype,{constructor:{value:p,writable:!0,configurable:!0}}),S&&G(p,S)}ft.exports=b,ft.exports.default=ft.exports,ft.exports.__esModule=!0},70430:function(ft){function C(y){return Function.toString.call(y).indexOf("[native code]")!==-1}ft.exports=C,ft.exports.default=ft.exports,ft.exports.__esModule=!0},57067:function(ft){function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}ft.exports=C,ft.exports.default=ft.exports,ft.exports.__esModule=!0},78585:function(ft,C,y){var G=y(50008).default,b=y(81506);function p(S,L){return L&&(G(L)==="object"||typeof L=="function")?L:b(S)}ft.exports=p,ft.exports.default=ft.exports,ft.exports.__esModule=!0},99489:function(ft){function C(y,G){return ft.exports=C=Object.setPrototypeOf||function(p,S){return p.__proto__=S,p},ft.exports.default=ft.exports,ft.exports.__esModule=!0,C(y,G)}ft.exports=C,ft.exports.default=ft.exports,ft.exports.__esModule=!0},65957:function(ft,C,y){var G=y(29754),b=y(99489),p=y(70430),S=y(69100);function L(X){var N=typeof Map=="function"?new Map:void 0;return ft.exports=L=function(K){if(K===null||!p(K))return K;if(typeof K!="function")throw new TypeError("Super expression must either be null or a function");if(typeof N!="undefined"){if(N.has(K))return N.get(K);N.set(K,ae)}function ae(){return S(K,arguments,G(this).constructor)}return ae.prototype=Object.create(K.prototype,{constructor:{value:ae,enumerable:!1,writable:!0,configurable:!0}}),b(ae,K)},ft.exports.default=ft.exports,ft.exports.__esModule=!0,L(X)}ft.exports=L,ft.exports.default=ft.exports,ft.exports.__esModule=!0},31795:function(ft,C,y){var G=y(75752);ft.exports.geometry=b,ft.exports.ring=S;function b(X){var N=0,q;switch(X.type){case"Polygon":return p(X.coordinates);case"MultiPolygon":for(q=0;q<X.coordinates.length;q++)N+=p(X.coordinates[q]);return N;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(q=0;q<X.geometries.length;q++)N+=b(X.geometries[q]);return N}}function p(X){var N=0;if(X&&X.length>0){N+=Math.abs(S(X[0]));for(var q=1;q<X.length;q++)N-=Math.abs(S(X[q]))}return N}function S(X){var N,q,K,ae,xe,se,Ft,zt=0,Wt=X.length;if(Wt>2){for(Ft=0;Ft<Wt;Ft++)Ft===Wt-2?(ae=Wt-2,xe=Wt-1,se=0):Ft===Wt-1?(ae=Wt-1,xe=0,se=1):(ae=Ft,xe=Ft+1,se=Ft+2),N=X[ae],q=X[xe],K=X[se],zt+=(L(K[0])-L(N[0]))*Math.sin(L(q[1]));zt=zt*G.RADIUS*G.RADIUS/2}return zt}function L(X){return X*Math.PI/180}},49296:function(ft){"use strict";ft.exports=y,ft.exports.default=y;var C=1e20;function y(L,X,N,q,K,ae){this.fontSize=L||24,this.buffer=X===void 0?3:X,this.cutoff=q||.25,this.fontFamily=K||"sans-serif",this.fontWeight=ae||"normal",this.radius=N||8;var xe=this.size=this.fontSize+this.buffer*2,se=xe+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=xe,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(se*se),this.gridInner=new Float64Array(se*se),this.f=new Float64Array(se),this.z=new Float64Array(se+1),this.v=new Uint16Array(se),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(xe/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function G(L,X,N,q,K,ae,xe){ae.fill(C,0,X*N),xe.fill(0,0,X*N);for(var se=(X-q)/2,Ft=0;Ft<K;Ft++)for(var zt=0;zt<q;zt++){var Wt=(Ft+se)*X+zt+se,Mt=L.data[4*(Ft*q+zt)+3]/255;if(Mt===1)ae[Wt]=0,xe[Wt]=C;else if(Mt===0)ae[Wt]=C,xe[Wt]=0;else{var wt=Math.max(0,.5-Mt),ot=Math.max(0,Mt-.5);ae[Wt]=wt*wt,xe[Wt]=ot*ot}}}function b(L,X,N,q,K,ae,xe){for(var se=0;se<X*N;se++){var Ft=Math.sqrt(q[se])-Math.sqrt(K[se]);L[se]=Math.round(255-255*(Ft/ae+xe))}}y.prototype._draw=function(L,X){var N=this.ctx.measureText(L),q=N.width,K=2*this.buffer,ae,xe,se,Ft,zt,Wt,Mt,wt;X&&this.useMetrics?(zt=Math.floor(N.actualBoundingBoxAscent),wt=this.buffer+Math.ceil(N.actualBoundingBoxAscent),Wt=this.buffer,Mt=this.buffer,xe=Math.min(this.size,Math.ceil(N.actualBoundingBoxRight-N.actualBoundingBoxLeft)),Ft=Math.min(this.size-Wt,Math.ceil(N.actualBoundingBoxAscent+N.actualBoundingBoxDescent)),ae=xe+K,se=Ft+K,this.ctx.textBaseline="alphabetic"):(ae=xe=this.size,se=Ft=this.size,zt=19*this.fontSize/24,Wt=Mt=0,wt=this.middle,this.ctx.textBaseline="middle");var ot;xe&&Ft&&(this.ctx.clearRect(Mt,Wt,xe,Ft),this.ctx.fillText(L,this.buffer,wt),ot=this.ctx.getImageData(Mt,Wt,xe,Ft));var tt=new Uint8ClampedArray(ae*se);return G(ot,ae,se,xe,Ft,this.gridOuter,this.gridInner),p(this.gridOuter,ae,se,this.f,this.v,this.z),p(this.gridInner,ae,se,this.f,this.v,this.z),b(tt,ae,se,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:tt,metrics:{width:xe,height:Ft,sdfWidth:ae,sdfHeight:se,top:zt,left:0,advance:q}}},y.prototype.draw=function(L){return this._draw(L,!1).data},y.prototype.drawWithMetrics=function(L){return this._draw(L,!0)};function p(L,X,N,q,K,ae){for(var xe=0;xe<X;xe++)S(L,xe,X,N,q,K,ae);for(var se=0;se<N;se++)S(L,se*X,1,X,q,K,ae)}function S(L,X,N,q,K,ae,xe){var se,Ft,zt,Wt;for(ae[0]=0,xe[0]=-C,xe[1]=C,se=0;se<q;se++)K[se]=L[X+se*N];for(se=1,Ft=0,zt=0;se<q;se++){do Wt=ae[Ft],zt=(K[se]-K[Wt]+se*se-Wt*Wt)/(se-Wt)/2;while(zt<=xe[Ft]&&--Ft>-1);Ft++,ae[Ft]=se,xe[Ft]=zt,xe[Ft+1]=C}for(se=0,Ft=0;se<q;se++){for(;xe[Ft+1]<se;)Ft++;Wt=ae[Ft],L[X+se*N]=K[Wt]+(se-Wt)*(se-Wt)}}},84102:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.earthRadius=63710088e-1,C.factors={centimeters:C.earthRadius*100,centimetres:C.earthRadius*100,degrees:C.earthRadius/111325,feet:C.earthRadius*3.28084,inches:C.earthRadius*39.37,kilometers:C.earthRadius/1e3,kilometres:C.earthRadius/1e3,meters:C.earthRadius,metres:C.earthRadius,miles:C.earthRadius/1609.344,millimeters:C.earthRadius*1e3,millimetres:C.earthRadius*1e3,nauticalmiles:C.earthRadius/1852,radians:1,yards:C.earthRadius*1.0936},C.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/C.earthRadius,yards:1.0936133},C.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function y(oe,re,ue){ue===void 0&&(ue={});var it={type:"Feature"};return(ue.id===0||ue.id)&&(it.id=ue.id),ue.bbox&&(it.bbox=ue.bbox),it.properties=re||{},it.geometry=oe,it}C.feature=y;function G(oe,re,ue){switch(ue===void 0&&(ue={}),oe){case"Point":return b(re).geometry;case"LineString":return X(re).geometry;case"Polygon":return S(re).geometry;case"MultiPoint":return ae(re).geometry;case"MultiLineString":return K(re).geometry;case"MultiPolygon":return xe(re).geometry;default:throw new Error(oe+" is invalid")}}C.geometry=G;function b(oe,re,ue){if(ue===void 0&&(ue={}),!oe)throw new Error("coordinates is required");if(!Array.isArray(oe))throw new Error("coordinates must be an Array");if(oe.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ne(oe[0])||!Ne(oe[1]))throw new Error("coordinates must contain numbers");var it={type:"Point",coordinates:oe};return y(it,re,ue)}C.point=b;function p(oe,re,ue){return ue===void 0&&(ue={}),q(oe.map(function(it){return b(it,re)}),ue)}C.points=p;function S(oe,re,ue){ue===void 0&&(ue={});for(var it=0,Jt=oe;it<Jt.length;it++){var ce=Jt[it];if(ce.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var $e=0;$e<ce[ce.length-1].length;$e++)if(ce[ce.length-1][$e]!==ce[0][$e])throw new Error("First and last Position are not equivalent.")}var Ae={type:"Polygon",coordinates:oe};return y(Ae,re,ue)}C.polygon=S;function L(oe,re,ue){return ue===void 0&&(ue={}),q(oe.map(function(it){return S(it,re)}),ue)}C.polygons=L;function X(oe,re,ue){if(ue===void 0&&(ue={}),oe.length<2)throw new Error("coordinates must be an array of two or more positions");var it={type:"LineString",coordinates:oe};return y(it,re,ue)}C.lineString=X;function N(oe,re,ue){return ue===void 0&&(ue={}),q(oe.map(function(it){return X(it,re)}),ue)}C.lineStrings=N;function q(oe,re){re===void 0&&(re={});var ue={type:"FeatureCollection"};return re.id&&(ue.id=re.id),re.bbox&&(ue.bbox=re.bbox),ue.features=oe,ue}C.featureCollection=q;function K(oe,re,ue){ue===void 0&&(ue={});var it={type:"MultiLineString",coordinates:oe};return y(it,re,ue)}C.multiLineString=K;function ae(oe,re,ue){ue===void 0&&(ue={});var it={type:"MultiPoint",coordinates:oe};return y(it,re,ue)}C.multiPoint=ae;function xe(oe,re,ue){ue===void 0&&(ue={});var it={type:"MultiPolygon",coordinates:oe};return y(it,re,ue)}C.multiPolygon=xe;function se(oe,re,ue){ue===void 0&&(ue={});var it={type:"GeometryCollection",geometries:oe};return y(it,re,ue)}C.geometryCollection=se;function Ft(oe,re){if(re===void 0&&(re=0),re&&!(re>=0))throw new Error("precision must be a positive number");var ue=Math.pow(10,re||0);return Math.round(oe*ue)/ue}C.round=Ft;function zt(oe,re){re===void 0&&(re="kilometers");var ue=C.factors[re];if(!ue)throw new Error(re+" units is invalid");return oe*ue}C.radiansToLength=zt;function Wt(oe,re){re===void 0&&(re="kilometers");var ue=C.factors[re];if(!ue)throw new Error(re+" units is invalid");return oe/ue}C.lengthToRadians=Wt;function Mt(oe,re){return ot(Wt(oe,re))}C.lengthToDegrees=Mt;function wt(oe){var re=oe%360;return re<0&&(re+=360),re}C.bearingToAzimuth=wt;function ot(oe){var re=oe%(2*Math.PI);return re*180/Math.PI}C.radiansToDegrees=ot;function tt(oe){var re=oe%360;return re*Math.PI/180}C.degreesToRadians=tt;function Yt(oe,re,ue){if(re===void 0&&(re="kilometers"),ue===void 0&&(ue="kilometers"),!(oe>=0))throw new Error("length must be a positive number");return zt(Wt(oe,re),ue)}C.convertLength=Yt;function ke(oe,re,ue){if(re===void 0&&(re="meters"),ue===void 0&&(ue="kilometers"),!(oe>=0))throw new Error("area must be a positive number");var it=C.areaFactors[re];if(!it)throw new Error("invalid original units");var Jt=C.areaFactors[ue];if(!Jt)throw new Error("invalid final units");return oe/it*Jt}C.convertArea=ke;function Ne(oe){return!isNaN(oe)&&oe!==null&&!Array.isArray(oe)}C.isNumber=Ne;function Be(oe){return!!oe&&oe.constructor===Object}C.isObject=Be;function Ie(oe){if(!oe)throw new Error("bbox is required");if(!Array.isArray(oe))throw new Error("bbox must be an Array");if(oe.length!==4&&oe.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");oe.forEach(function(re){if(!Ne(re))throw new Error("bbox must only contain numbers")})}C.validateBBox=Ie;function pt(oe){if(!oe)throw new Error("id is required");if(["string","number"].indexOf(typeof oe)===-1)throw new Error("id must be a number or a string")}C.validateId=pt},17781:function(ft){ft.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},48583:function(ft,C,y){"use strict";var G=y(27418);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function b(re,ue){if(re===ue)return 0;for(var it=re.length,Jt=ue.length,ce=0,$e=Math.min(it,Jt);ce<$e;++ce)if(re[ce]!==ue[ce]){it=re[ce],Jt=ue[ce];break}return it<Jt?-1:Jt<it?1:0}function p(re){return y.g.Buffer&&typeof y.g.Buffer.isBuffer=="function"?y.g.Buffer.isBuffer(re):!!(re!=null&&re._isBuffer)}var S=y(30069),L=Object.prototype.hasOwnProperty,X=Array.prototype.slice,N=function(){return function(){}.name==="foo"}();function q(re){return Object.prototype.toString.call(re)}function K(re){return p(re)||typeof y.g.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(re):re?!!(re instanceof DataView||re.buffer&&re.buffer instanceof ArrayBuffer):!1}var ae=ft.exports=wt,xe=/\s*function\s+([^\(\s]*)\s*/;function se(re){if(!!S.isFunction(re)){if(N)return re.name;var ue=re.toString(),it=ue.match(xe);return it&&it[1]}}ae.AssertionError=function(ue){this.name="AssertionError",this.actual=ue.actual,this.expected=ue.expected,this.operator=ue.operator,ue.message?(this.message=ue.message,this.generatedMessage=!1):(this.message=Wt(this),this.generatedMessage=!0);var it=ue.stackStartFunction||Mt;if(Error.captureStackTrace)Error.captureStackTrace(this,it);else{var Jt=new Error;if(Jt.stack){var ce=Jt.stack,$e=se(it),Ae=ce.indexOf(`
`+$e);if(Ae>=0){var Ce=ce.indexOf(`
`,Ae+1);ce=ce.substring(Ce+1)}this.stack=ce}}},S.inherits(ae.AssertionError,Error);function Ft(re,ue){return typeof re=="string"?re.length<ue?re:re.slice(0,ue):re}function zt(re){if(N||!S.isFunction(re))return S.inspect(re);var ue=se(re),it=ue?": "+ue:"";return"[Function"+it+"]"}function Wt(re){return Ft(zt(re.actual),128)+" "+re.operator+" "+Ft(zt(re.expected),128)}function Mt(re,ue,it,Jt,ce){throw new ae.AssertionError({message:it,actual:re,expected:ue,operator:Jt,stackStartFunction:ce})}ae.fail=Mt;function wt(re,ue){re||Mt(re,!0,ue,"==",ae.ok)}ae.ok=wt,ae.equal=function(ue,it,Jt){ue!=it&&Mt(ue,it,Jt,"==",ae.equal)},ae.notEqual=function(ue,it,Jt){ue==it&&Mt(ue,it,Jt,"!=",ae.notEqual)},ae.deepEqual=function(ue,it,Jt){ot(ue,it,!1)||Mt(ue,it,Jt,"deepEqual",ae.deepEqual)},ae.deepStrictEqual=function(ue,it,Jt){ot(ue,it,!0)||Mt(ue,it,Jt,"deepStrictEqual",ae.deepStrictEqual)};function ot(re,ue,it,Jt){if(re===ue)return!0;if(p(re)&&p(ue))return b(re,ue)===0;if(S.isDate(re)&&S.isDate(ue))return re.getTime()===ue.getTime();if(S.isRegExp(re)&&S.isRegExp(ue))return re.source===ue.source&&re.global===ue.global&&re.multiline===ue.multiline&&re.lastIndex===ue.lastIndex&&re.ignoreCase===ue.ignoreCase;if((re===null||typeof re!="object")&&(ue===null||typeof ue!="object"))return it?re===ue:re==ue;if(K(re)&&K(ue)&&q(re)===q(ue)&&!(re instanceof Float32Array||re instanceof Float64Array))return b(new Uint8Array(re.buffer),new Uint8Array(ue.buffer))===0;if(p(re)!==p(ue))return!1;Jt=Jt||{actual:[],expected:[]};var ce=Jt.actual.indexOf(re);return ce!==-1&&ce===Jt.expected.indexOf(ue)?!0:(Jt.actual.push(re),Jt.expected.push(ue),Yt(re,ue,it,Jt))}function tt(re){return Object.prototype.toString.call(re)=="[object Arguments]"}function Yt(re,ue,it,Jt){if(re==null||ue===null||ue===void 0)return!1;if(S.isPrimitive(re)||S.isPrimitive(ue))return re===ue;if(it&&Object.getPrototypeOf(re)!==Object.getPrototypeOf(ue))return!1;var ce=tt(re),$e=tt(ue);if(ce&&!$e||!ce&&$e)return!1;if(ce)return re=X.call(re),ue=X.call(ue),ot(re,ue,it);var Ae=oe(re),Ce=oe(ue),Pe,et;if(Ae.length!==Ce.length)return!1;for(Ae.sort(),Ce.sort(),et=Ae.length-1;et>=0;et--)if(Ae[et]!==Ce[et])return!1;for(et=Ae.length-1;et>=0;et--)if(Pe=Ae[et],!ot(re[Pe],ue[Pe],it,Jt))return!1;return!0}ae.notDeepEqual=function(ue,it,Jt){ot(ue,it,!1)&&Mt(ue,it,Jt,"notDeepEqual",ae.notDeepEqual)},ae.notDeepStrictEqual=ke;function ke(re,ue,it){ot(re,ue,!0)&&Mt(re,ue,it,"notDeepStrictEqual",ke)}ae.strictEqual=function(ue,it,Jt){ue!==it&&Mt(ue,it,Jt,"===",ae.strictEqual)},ae.notStrictEqual=function(ue,it,Jt){ue===it&&Mt(ue,it,Jt,"!==",ae.notStrictEqual)};function Ne(re,ue){if(!re||!ue)return!1;if(Object.prototype.toString.call(ue)=="[object RegExp]")return ue.test(re);try{if(re instanceof ue)return!0}catch(it){}return Error.isPrototypeOf(ue)?!1:ue.call({},re)===!0}function Be(re){var ue;try{re()}catch(it){ue=it}return ue}function Ie(re,ue,it,Jt){var ce;if(typeof ue!="function")throw new TypeError('"block" argument must be a function');typeof it=="string"&&(Jt=it,it=null),ce=Be(ue),Jt=(it&&it.name?" ("+it.name+").":".")+(Jt?" "+Jt:"."),re&&!ce&&Mt(ce,it,"Missing expected exception"+Jt);var $e=typeof Jt=="string",Ae=!re&&S.isError(ce),Ce=!re&&ce&&!it;if((Ae&&$e&&Ne(ce,it)||Ce)&&Mt(ce,it,"Got unwanted exception"+Jt),re&&ce&&it&&!Ne(ce,it)||!re&&ce)throw ce}ae.throws=function(re,ue,it){Ie(!0,re,ue,it)},ae.doesNotThrow=function(re,ue,it){Ie(!1,re,ue,it)},ae.ifError=function(re){if(re)throw re};function pt(re,ue){re||Mt(re,!0,ue,"==",pt)}ae.strict=G(pt,ae,{equal:ae.strictEqual,deepEqual:ae.deepStrictEqual,notEqual:ae.notStrictEqual,notDeepEqual:ae.notDeepStrictEqual}),ae.strict.strict=ae.strict;var oe=Object.keys||function(re){var ue=[];for(var it in re)L.call(re,it)&&ue.push(it);return ue}},16076:function(ft){typeof Object.create=="function"?ft.exports=function(y,G){y.super_=G,y.prototype=Object.create(G.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}})}:ft.exports=function(y,G){y.super_=G;var b=function(){};b.prototype=G.prototype,y.prototype=new b,y.prototype.constructor=y}},52014:function(ft){ft.exports=function(y){return y&&typeof y=="object"&&typeof y.copy=="function"&&typeof y.fill=="function"&&typeof y.readUInt8=="function"}},30069:function(ft,C,y){var G=y(34155),b=/%[sdj%]/g;C.format=function(Ce){if(!Yt(Ce)){for(var Pe=[],et=0;et<arguments.length;et++)Pe.push(L(arguments[et]));return Pe.join(" ")}for(var et=1,Se=arguments,Pt=Se.length,vr=String(Ce).replace(b,function(Yr){if(Yr==="%%")return"%";if(et>=Pt)return Yr;switch(Yr){case"%s":return String(Se[et++]);case"%d":return Number(Se[et++]);case"%j":try{return JSON.stringify(Se[et++])}catch(tr){return"[Circular]"}default:return Yr}}),_r=Se[et];et<Pt;_r=Se[++et])wt(_r)||!Ie(_r)?vr+=" "+_r:vr+=" "+L(_r);return vr},C.deprecate=function(Ce,Pe){if(Ne(y.g.process))return function(){return C.deprecate(Ce,Pe).apply(this,arguments)};if(G.noDeprecation===!0)return Ce;var et=!1;function Se(){if(!et){if(G.throwDeprecation)throw new Error(Pe);G.traceDeprecation?console.trace(Pe):console.error(Pe),et=!0}return Ce.apply(this,arguments)}return Se};var p={},S;C.debuglog=function(Ce){if(Ne(S)&&(S={NODE_ENV:"production"}.NODE_DEBUG||""),Ce=Ce.toUpperCase(),!p[Ce])if(new RegExp("\\b"+Ce+"\\b","i").test(S)){var Pe=G.pid;p[Ce]=function(){var et=C.format.apply(C,arguments);console.error("%s %d: %s",Ce,Pe,et)}}else p[Ce]=function(){};return p[Ce]};function L(Ce,Pe){var et={seen:[],stylize:N};return arguments.length>=3&&(et.depth=arguments[2]),arguments.length>=4&&(et.colors=arguments[3]),Mt(Pe)?et.showHidden=Pe:Pe&&C._extend(et,Pe),Ne(et.showHidden)&&(et.showHidden=!1),Ne(et.depth)&&(et.depth=2),Ne(et.colors)&&(et.colors=!1),Ne(et.customInspect)&&(et.customInspect=!0),et.colors&&(et.stylize=X),K(et,Ce,et.depth)}C.inspect=L,L.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},L.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function X(Ce,Pe){var et=L.styles[Pe];return et?"["+L.colors[et][0]+"m"+Ce+"["+L.colors[et][1]+"m":Ce}function N(Ce,Pe){return Ce}function q(Ce){var Pe={};return Ce.forEach(function(et,Se){Pe[et]=!0}),Pe}function K(Ce,Pe,et){if(Ce.customInspect&&Pe&&re(Pe.inspect)&&Pe.inspect!==C.inspect&&!(Pe.constructor&&Pe.constructor.prototype===Pe)){var Se=Pe.inspect(et,Ce);return Yt(Se)||(Se=K(Ce,Se,et)),Se}var Pt=ae(Ce,Pe);if(Pt)return Pt;var vr=Object.keys(Pe),_r=q(vr);if(Ce.showHidden&&(vr=Object.getOwnPropertyNames(Pe)),oe(Pe)&&(vr.indexOf("message")>=0||vr.indexOf("description")>=0))return xe(Pe);if(vr.length===0){if(re(Pe)){var Yr=Pe.name?": "+Pe.name:"";return Ce.stylize("[Function"+Yr+"]","special")}if(Be(Pe))return Ce.stylize(RegExp.prototype.toString.call(Pe),"regexp");if(pt(Pe))return Ce.stylize(Date.prototype.toString.call(Pe),"date");if(oe(Pe))return xe(Pe)}var tr="",ne=!1,be=["{","}"];if(Wt(Pe)&&(ne=!0,be=["[","]"]),re(Pe)){var De=Pe.name?": "+Pe.name:"";tr=" [Function"+De+"]"}if(Be(Pe)&&(tr=" "+RegExp.prototype.toString.call(Pe)),pt(Pe)&&(tr=" "+Date.prototype.toUTCString.call(Pe)),oe(Pe)&&(tr=" "+xe(Pe)),vr.length===0&&(!ne||Pe.length==0))return be[0]+tr+be[1];if(et<0)return Be(Pe)?Ce.stylize(RegExp.prototype.toString.call(Pe),"regexp"):Ce.stylize("[Object]","special");Ce.seen.push(Pe);var at;return ne?at=se(Ce,Pe,et,_r,vr):at=vr.map(function(kt){return Ft(Ce,Pe,et,_r,kt,ne)}),Ce.seen.pop(),zt(at,tr,be)}function ae(Ce,Pe){if(Ne(Pe))return Ce.stylize("undefined","undefined");if(Yt(Pe)){var et="'"+JSON.stringify(Pe).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Ce.stylize(et,"string")}if(tt(Pe))return Ce.stylize(""+Pe,"number");if(Mt(Pe))return Ce.stylize(""+Pe,"boolean");if(wt(Pe))return Ce.stylize("null","null")}function xe(Ce){return"["+Error.prototype.toString.call(Ce)+"]"}function se(Ce,Pe,et,Se,Pt){for(var vr=[],_r=0,Yr=Pe.length;_r<Yr;++_r)Ae(Pe,String(_r))?vr.push(Ft(Ce,Pe,et,Se,String(_r),!0)):vr.push("");return Pt.forEach(function(tr){tr.match(/^\d+$/)||vr.push(Ft(Ce,Pe,et,Se,tr,!0))}),vr}function Ft(Ce,Pe,et,Se,Pt,vr){var _r,Yr,tr;if(tr=Object.getOwnPropertyDescriptor(Pe,Pt)||{value:Pe[Pt]},tr.get?tr.set?Yr=Ce.stylize("[Getter/Setter]","special"):Yr=Ce.stylize("[Getter]","special"):tr.set&&(Yr=Ce.stylize("[Setter]","special")),Ae(Se,Pt)||(_r="["+Pt+"]"),Yr||(Ce.seen.indexOf(tr.value)<0?(wt(et)?Yr=K(Ce,tr.value,null):Yr=K(Ce,tr.value,et-1),Yr.indexOf(`
`)>-1&&(vr?Yr=Yr.split(`
`).map(function(ne){return"  "+ne}).join(`
`).substr(2):Yr=`
`+Yr.split(`
`).map(function(ne){return"   "+ne}).join(`
`))):Yr=Ce.stylize("[Circular]","special")),Ne(_r)){if(vr&&Pt.match(/^\d+$/))return Yr;_r=JSON.stringify(""+Pt),_r.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(_r=_r.substr(1,_r.length-2),_r=Ce.stylize(_r,"name")):(_r=_r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),_r=Ce.stylize(_r,"string"))}return _r+": "+Yr}function zt(Ce,Pe,et){var Se=0,Pt=Ce.reduce(function(vr,_r){return Se++,_r.indexOf(`
`)>=0&&Se++,vr+_r.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Pt>60?et[0]+(Pe===""?"":Pe+`
 `)+" "+Ce.join(`,
  `)+" "+et[1]:et[0]+Pe+" "+Ce.join(", ")+" "+et[1]}function Wt(Ce){return Array.isArray(Ce)}C.isArray=Wt;function Mt(Ce){return typeof Ce=="boolean"}C.isBoolean=Mt;function wt(Ce){return Ce===null}C.isNull=wt;function ot(Ce){return Ce==null}C.isNullOrUndefined=ot;function tt(Ce){return typeof Ce=="number"}C.isNumber=tt;function Yt(Ce){return typeof Ce=="string"}C.isString=Yt;function ke(Ce){return typeof Ce=="symbol"}C.isSymbol=ke;function Ne(Ce){return Ce===void 0}C.isUndefined=Ne;function Be(Ce){return Ie(Ce)&&it(Ce)==="[object RegExp]"}C.isRegExp=Be;function Ie(Ce){return typeof Ce=="object"&&Ce!==null}C.isObject=Ie;function pt(Ce){return Ie(Ce)&&it(Ce)==="[object Date]"}C.isDate=pt;function oe(Ce){return Ie(Ce)&&(it(Ce)==="[object Error]"||Ce instanceof Error)}C.isError=oe;function re(Ce){return typeof Ce=="function"}C.isFunction=re;function ue(Ce){return Ce===null||typeof Ce=="boolean"||typeof Ce=="number"||typeof Ce=="string"||typeof Ce=="symbol"||typeof Ce=="undefined"}C.isPrimitive=ue,C.isBuffer=y(52014);function it(Ce){return Object.prototype.toString.call(Ce)}function Jt(Ce){return Ce<10?"0"+Ce.toString(10):Ce.toString(10)}var ce=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function $e(){var Ce=new Date,Pe=[Jt(Ce.getHours()),Jt(Ce.getMinutes()),Jt(Ce.getSeconds())].join(":");return[Ce.getDate(),ce[Ce.getMonth()],Pe].join(" ")}C.log=function(){console.log("%s - %s",$e(),C.format.apply(C,arguments))},C.inherits=y(16076),C._extend=function(Ce,Pe){if(!Pe||!Ie(Pe))return Ce;for(var et=Object.keys(Pe),Se=et.length;Se--;)Ce[et[Se]]=Pe[et[Se]];return Ce};function Ae(Ce,Pe){return Object.prototype.hasOwnProperty.call(Ce,Pe)}},3054:function(ft,C,y){"use strict";y.r(C),y.d(C,{color:function(){return G.ZP},cubehelix:function(){return Pe},gray:function(){return zt},hcl:function(){return Be},hsl:function(){return G.Ym},lab:function(){return Wt},lch:function(){return Ne},rgb:function(){return G.B8}});var G=y(16372),b=y(44087),p=Math.PI/180,S=180/Math.PI,L=18,X=.96422,N=1,q=.82521,K=4/29,ae=6/29,xe=3*ae*ae,se=ae*ae*ae;function Ft(Se){if(Se instanceof Mt)return new Mt(Se.l,Se.a,Se.b,Se.opacity);if(Se instanceof Ie)return pt(Se);Se instanceof G.Ss||(Se=(0,G.SU)(Se));var Pt=Yt(Se.r),vr=Yt(Se.g),_r=Yt(Se.b),Yr=wt((.2225045*Pt+.7168786*vr+.0606169*_r)/N),tr,ne;return Pt===vr&&vr===_r?tr=ne=Yr:(tr=wt((.4360747*Pt+.3850649*vr+.1430804*_r)/X),ne=wt((.0139322*Pt+.0971045*vr+.7141733*_r)/q)),new Mt(116*Yr-16,500*(tr-Yr),200*(Yr-ne),Se.opacity)}function zt(Se,Pt){return new Mt(Se,0,0,Pt==null?1:Pt)}function Wt(Se,Pt,vr,_r){return arguments.length===1?Ft(Se):new Mt(Se,Pt,vr,_r==null?1:_r)}function Mt(Se,Pt,vr,_r){this.l=+Se,this.a=+Pt,this.b=+vr,this.opacity=+_r}(0,b.Z)(Mt,Wt,(0,b.l)(G.Il,{brighter:function(Se){return new Mt(this.l+L*(Se==null?1:Se),this.a,this.b,this.opacity)},darker:function(Se){return new Mt(this.l-L*(Se==null?1:Se),this.a,this.b,this.opacity)},rgb:function(){var Se=(this.l+16)/116,Pt=isNaN(this.a)?Se:Se+this.a/500,vr=isNaN(this.b)?Se:Se-this.b/200;return Pt=X*ot(Pt),Se=N*ot(Se),vr=q*ot(vr),new G.Ss(tt(3.1338561*Pt-1.6168667*Se-.4906146*vr),tt(-.9787684*Pt+1.9161415*Se+.033454*vr),tt(.0719453*Pt-.2289914*Se+1.4052427*vr),this.opacity)}}));function wt(Se){return Se>se?Math.pow(Se,1/3):Se/xe+K}function ot(Se){return Se>ae?Se*Se*Se:xe*(Se-K)}function tt(Se){return 255*(Se<=.0031308?12.92*Se:1.055*Math.pow(Se,1/2.4)-.055)}function Yt(Se){return(Se/=255)<=.04045?Se/12.92:Math.pow((Se+.055)/1.055,2.4)}function ke(Se){if(Se instanceof Ie)return new Ie(Se.h,Se.c,Se.l,Se.opacity);if(Se instanceof Mt||(Se=Ft(Se)),Se.a===0&&Se.b===0)return new Ie(NaN,0<Se.l&&Se.l<100?0:NaN,Se.l,Se.opacity);var Pt=Math.atan2(Se.b,Se.a)*S;return new Ie(Pt<0?Pt+360:Pt,Math.sqrt(Se.a*Se.a+Se.b*Se.b),Se.l,Se.opacity)}function Ne(Se,Pt,vr,_r){return arguments.length===1?ke(Se):new Ie(vr,Pt,Se,_r==null?1:_r)}function Be(Se,Pt,vr,_r){return arguments.length===1?ke(Se):new Ie(Se,Pt,vr,_r==null?1:_r)}function Ie(Se,Pt,vr,_r){this.h=+Se,this.c=+Pt,this.l=+vr,this.opacity=+_r}function pt(Se){if(isNaN(Se.h))return new Mt(Se.l,0,0,Se.opacity);var Pt=Se.h*p;return new Mt(Se.l,Math.cos(Pt)*Se.c,Math.sin(Pt)*Se.c,Se.opacity)}(0,b.Z)(Ie,Be,(0,b.l)(G.Il,{brighter:function(Se){return new Ie(this.h,this.c,this.l+L*(Se==null?1:Se),this.opacity)},darker:function(Se){return new Ie(this.h,this.c,this.l-L*(Se==null?1:Se),this.opacity)},rgb:function(){return pt(this).rgb()}}));var oe=-.14861,re=1.78277,ue=-.29227,it=-.90649,Jt=1.97294,ce=Jt*it,$e=Jt*re,Ae=re*ue-it*oe;function Ce(Se){if(Se instanceof et)return new et(Se.h,Se.s,Se.l,Se.opacity);Se instanceof G.Ss||(Se=(0,G.SU)(Se));var Pt=Se.r/255,vr=Se.g/255,_r=Se.b/255,Yr=(Ae*_r+ce*Pt-$e*vr)/(Ae+ce-$e),tr=_r-Yr,ne=(Jt*(vr-Yr)-ue*tr)/it,be=Math.sqrt(ne*ne+tr*tr)/(Jt*Yr*(1-Yr)),De=be?Math.atan2(ne,tr)*S-120:NaN;return new et(De<0?De+360:De,be,Yr,Se.opacity)}function Pe(Se,Pt,vr,_r){return arguments.length===1?Ce(Se):new et(Se,Pt,vr,_r==null?1:_r)}function et(Se,Pt,vr,_r){this.h=+Se,this.s=+Pt,this.l=+vr,this.opacity=+_r}(0,b.Z)(et,Pe,(0,b.l)(G.Il,{brighter:function(Se){return Se=Se==null?G.J5:Math.pow(G.J5,Se),new et(this.h,this.s,this.l*Se,this.opacity)},darker:function(Se){return Se=Se==null?G.xV:Math.pow(G.xV,Se),new et(this.h,this.s,this.l*Se,this.opacity)},rgb:function(){var Se=isNaN(this.h)?0:(this.h+120)*p,Pt=+this.l,vr=isNaN(this.s)?0:this.s*Pt*(1-Pt),_r=Math.cos(Se),Yr=Math.sin(Se);return new G.Ss(255*(Pt+vr*(oe*_r+re*Yr)),255*(Pt+vr*(ue*_r+it*Yr)),255*(Pt+vr*(Jt*_r)),this.opacity)}}))},9187:function(ft){"use strict";ft.exports=C,ft.exports.default=C;function C(ce,$e,Ae){Ae=Ae||2;var Ce=$e&&$e.length,Pe=Ce?$e[0]*Ae:ce.length,et=y(ce,0,Pe,Ae,!0),Se=[];if(!et||et.next===et.prev)return Se;var Pt,vr,_r,Yr,tr,ne,be;if(Ce&&(et=N(ce,$e,et,Ae)),ce.length>80*Ae){Pt=_r=ce[0],vr=Yr=ce[1];for(var De=Ae;De<Pe;De+=Ae)tr=ce[De],ne=ce[De+1],tr<Pt&&(Pt=tr),ne<vr&&(vr=ne),tr>_r&&(_r=tr),ne>Yr&&(Yr=ne);be=Math.max(_r-Pt,Yr-vr),be=be!==0?1/be:0}return b(et,Se,Ae,Pt,vr,be),Se}function y(ce,$e,Ae,Ce,Pe){var et,Se;if(Pe===Jt(ce,$e,Ae,Ce)>0)for(et=$e;et<Ae;et+=Ce)Se=re(et,ce[et],ce[et+1],Se);else for(et=Ae-Ce;et>=$e;et-=Ce)Se=re(et,ce[et],ce[et+1],Se);return Se&&tt(Se,Se.next)&&(ue(Se),Se=Se.next),Se}function G(ce,$e){if(!ce)return ce;$e||($e=ce);var Ae=ce,Ce;do if(Ce=!1,!Ae.steiner&&(tt(Ae,Ae.next)||ot(Ae.prev,Ae,Ae.next)===0)){if(ue(Ae),Ae=$e=Ae.prev,Ae===Ae.next)break;Ce=!0}else Ae=Ae.next;while(Ce||Ae!==$e);return $e}function b(ce,$e,Ae,Ce,Pe,et,Se){if(!!ce){!Se&&et&&se(ce,Ce,Pe,et);for(var Pt=ce,vr,_r;ce.prev!==ce.next;){if(vr=ce.prev,_r=ce.next,et?S(ce,Ce,Pe,et):p(ce)){$e.push(vr.i/Ae),$e.push(ce.i/Ae),$e.push(_r.i/Ae),ue(ce),ce=_r.next,Pt=_r.next;continue}if(ce=_r,ce===Pt){Se?Se===1?(ce=L(G(ce),$e,Ae),b(ce,$e,Ae,Ce,Pe,et,2)):Se===2&&X(ce,$e,Ae,Ce,Pe,et):b(G(ce),$e,Ae,Ce,Pe,et,1);break}}}}function p(ce){var $e=ce.prev,Ae=ce,Ce=ce.next;if(ot($e,Ae,Ce)>=0)return!1;for(var Pe=ce.next.next;Pe!==ce.prev;){if(Mt($e.x,$e.y,Ae.x,Ae.y,Ce.x,Ce.y,Pe.x,Pe.y)&&ot(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.next}return!0}function S(ce,$e,Ae,Ce){var Pe=ce.prev,et=ce,Se=ce.next;if(ot(Pe,et,Se)>=0)return!1;for(var Pt=Pe.x<et.x?Pe.x<Se.x?Pe.x:Se.x:et.x<Se.x?et.x:Se.x,vr=Pe.y<et.y?Pe.y<Se.y?Pe.y:Se.y:et.y<Se.y?et.y:Se.y,_r=Pe.x>et.x?Pe.x>Se.x?Pe.x:Se.x:et.x>Se.x?et.x:Se.x,Yr=Pe.y>et.y?Pe.y>Se.y?Pe.y:Se.y:et.y>Se.y?et.y:Se.y,tr=zt(Pt,vr,$e,Ae,Ce),ne=zt(_r,Yr,$e,Ae,Ce),be=ce.prevZ,De=ce.nextZ;be&&be.z>=tr&&De&&De.z<=ne;){if(be!==ce.prev&&be!==ce.next&&Mt(Pe.x,Pe.y,et.x,et.y,Se.x,Se.y,be.x,be.y)&&ot(be.prev,be,be.next)>=0||(be=be.prevZ,De!==ce.prev&&De!==ce.next&&Mt(Pe.x,Pe.y,et.x,et.y,Se.x,Se.y,De.x,De.y)&&ot(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;be&&be.z>=tr;){if(be!==ce.prev&&be!==ce.next&&Mt(Pe.x,Pe.y,et.x,et.y,Se.x,Se.y,be.x,be.y)&&ot(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;De&&De.z<=ne;){if(De!==ce.prev&&De!==ce.next&&Mt(Pe.x,Pe.y,et.x,et.y,Se.x,Se.y,De.x,De.y)&&ot(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function L(ce,$e,Ae){var Ce=ce;do{var Pe=Ce.prev,et=Ce.next.next;!tt(Pe,et)&&Yt(Pe,Ce,Ce.next,et)&&Ie(Pe,et)&&Ie(et,Pe)&&($e.push(Pe.i/Ae),$e.push(Ce.i/Ae),$e.push(et.i/Ae),ue(Ce),ue(Ce.next),Ce=ce=et),Ce=Ce.next}while(Ce!==ce);return G(Ce)}function X(ce,$e,Ae,Ce,Pe,et){var Se=ce;do{for(var Pt=Se.next.next;Pt!==Se.prev;){if(Se.i!==Pt.i&&wt(Se,Pt)){var vr=oe(Se,Pt);Se=G(Se,Se.next),vr=G(vr,vr.next),b(Se,$e,Ae,Ce,Pe,et),b(vr,$e,Ae,Ce,Pe,et);return}Pt=Pt.next}Se=Se.next}while(Se!==ce)}function N(ce,$e,Ae,Ce){var Pe=[],et,Se,Pt,vr,_r;for(et=0,Se=$e.length;et<Se;et++)Pt=$e[et]*Ce,vr=et<Se-1?$e[et+1]*Ce:ce.length,_r=y(ce,Pt,vr,Ce,!1),_r===_r.next&&(_r.steiner=!0),Pe.push(Wt(_r));for(Pe.sort(q),et=0;et<Pe.length;et++)Ae=K(Pe[et],Ae),Ae=G(Ae,Ae.next);return Ae}function q(ce,$e){return ce.x-$e.x}function K(ce,$e){var Ae=ae(ce,$e);if(!Ae)return $e;var Ce=oe(Ae,ce),Pe=G(Ae,Ae.next);return G(Ce,Ce.next),$e===Ae?Pe:$e}function ae(ce,$e){var Ae=$e,Ce=ce.x,Pe=ce.y,et=-Infinity,Se;do{if(Pe<=Ae.y&&Pe>=Ae.next.y&&Ae.next.y!==Ae.y){var Pt=Ae.x+(Pe-Ae.y)*(Ae.next.x-Ae.x)/(Ae.next.y-Ae.y);if(Pt<=Ce&&Pt>et){if(et=Pt,Pt===Ce){if(Pe===Ae.y)return Ae;if(Pe===Ae.next.y)return Ae.next}Se=Ae.x<Ae.next.x?Ae:Ae.next}}Ae=Ae.next}while(Ae!==$e);if(!Se)return null;if(Ce===et)return Se;var vr=Se,_r=Se.x,Yr=Se.y,tr=Infinity,ne;Ae=Se;do Ce>=Ae.x&&Ae.x>=_r&&Ce!==Ae.x&&Mt(Pe<Yr?Ce:et,Pe,_r,Yr,Pe<Yr?et:Ce,Pe,Ae.x,Ae.y)&&(ne=Math.abs(Pe-Ae.y)/(Ce-Ae.x),Ie(Ae,ce)&&(ne<tr||ne===tr&&(Ae.x>Se.x||Ae.x===Se.x&&xe(Se,Ae)))&&(Se=Ae,tr=ne)),Ae=Ae.next;while(Ae!==vr);return Se}function xe(ce,$e){return ot(ce.prev,ce,$e.prev)<0&&ot($e.next,ce,ce.next)<0}function se(ce,$e,Ae,Ce){var Pe=ce;do Pe.z===null&&(Pe.z=zt(Pe.x,Pe.y,$e,Ae,Ce)),Pe.prevZ=Pe.prev,Pe.nextZ=Pe.next,Pe=Pe.next;while(Pe!==ce);Pe.prevZ.nextZ=null,Pe.prevZ=null,Ft(Pe)}function Ft(ce){var $e,Ae,Ce,Pe,et,Se,Pt,vr,_r=1;do{for(Ae=ce,ce=null,et=null,Se=0;Ae;){for(Se++,Ce=Ae,Pt=0,$e=0;$e<_r&&(Pt++,Ce=Ce.nextZ,!!Ce);$e++);for(vr=_r;Pt>0||vr>0&&Ce;)Pt!==0&&(vr===0||!Ce||Ae.z<=Ce.z)?(Pe=Ae,Ae=Ae.nextZ,Pt--):(Pe=Ce,Ce=Ce.nextZ,vr--),et?et.nextZ=Pe:ce=Pe,Pe.prevZ=et,et=Pe;Ae=Ce}et.nextZ=null,_r*=2}while(Se>1);return ce}function zt(ce,$e,Ae,Ce,Pe){return ce=32767*(ce-Ae)*Pe,$e=32767*($e-Ce)*Pe,ce=(ce|ce<<8)&16711935,ce=(ce|ce<<4)&252645135,ce=(ce|ce<<2)&858993459,ce=(ce|ce<<1)&1431655765,$e=($e|$e<<8)&16711935,$e=($e|$e<<4)&252645135,$e=($e|$e<<2)&858993459,$e=($e|$e<<1)&1431655765,ce|$e<<1}function Wt(ce){var $e=ce,Ae=ce;do($e.x<Ae.x||$e.x===Ae.x&&$e.y<Ae.y)&&(Ae=$e),$e=$e.next;while($e!==ce);return Ae}function Mt(ce,$e,Ae,Ce,Pe,et,Se,Pt){return(Pe-Se)*($e-Pt)-(ce-Se)*(et-Pt)>=0&&(ce-Se)*(Ce-Pt)-(Ae-Se)*($e-Pt)>=0&&(Ae-Se)*(et-Pt)-(Pe-Se)*(Ce-Pt)>=0}function wt(ce,$e){return ce.next.i!==$e.i&&ce.prev.i!==$e.i&&!Be(ce,$e)&&(Ie(ce,$e)&&Ie($e,ce)&&pt(ce,$e)&&(ot(ce.prev,ce,$e.prev)||ot(ce,$e.prev,$e))||tt(ce,$e)&&ot(ce.prev,ce,ce.next)>0&&ot($e.prev,$e,$e.next)>0)}function ot(ce,$e,Ae){return($e.y-ce.y)*(Ae.x-$e.x)-($e.x-ce.x)*(Ae.y-$e.y)}function tt(ce,$e){return ce.x===$e.x&&ce.y===$e.y}function Yt(ce,$e,Ae,Ce){var Pe=Ne(ot(ce,$e,Ae)),et=Ne(ot(ce,$e,Ce)),Se=Ne(ot(Ae,Ce,ce)),Pt=Ne(ot(Ae,Ce,$e));return!!(Pe!==et&&Se!==Pt||Pe===0&&ke(ce,Ae,$e)||et===0&&ke(ce,Ce,$e)||Se===0&&ke(Ae,ce,Ce)||Pt===0&&ke(Ae,$e,Ce))}function ke(ce,$e,Ae){return $e.x<=Math.max(ce.x,Ae.x)&&$e.x>=Math.min(ce.x,Ae.x)&&$e.y<=Math.max(ce.y,Ae.y)&&$e.y>=Math.min(ce.y,Ae.y)}function Ne(ce){return ce>0?1:ce<0?-1:0}function Be(ce,$e){var Ae=ce;do{if(Ae.i!==ce.i&&Ae.next.i!==ce.i&&Ae.i!==$e.i&&Ae.next.i!==$e.i&&Yt(Ae,Ae.next,ce,$e))return!0;Ae=Ae.next}while(Ae!==ce);return!1}function Ie(ce,$e){return ot(ce.prev,ce,ce.next)<0?ot(ce,$e,ce.next)>=0&&ot(ce,ce.prev,$e)>=0:ot(ce,$e,ce.prev)<0||ot(ce,ce.next,$e)<0}function pt(ce,$e){var Ae=ce,Ce=!1,Pe=(ce.x+$e.x)/2,et=(ce.y+$e.y)/2;do Ae.y>et!=Ae.next.y>et&&Ae.next.y!==Ae.y&&Pe<(Ae.next.x-Ae.x)*(et-Ae.y)/(Ae.next.y-Ae.y)+Ae.x&&(Ce=!Ce),Ae=Ae.next;while(Ae!==ce);return Ce}function oe(ce,$e){var Ae=new it(ce.i,ce.x,ce.y),Ce=new it($e.i,$e.x,$e.y),Pe=ce.next,et=$e.prev;return ce.next=$e,$e.prev=ce,Ae.next=Pe,Pe.prev=Ae,Ce.next=Ae,Ae.prev=Ce,et.next=Ce,Ce.prev=et,Ce}function re(ce,$e,Ae,Ce){var Pe=new it(ce,$e,Ae);return Ce?(Pe.next=Ce.next,Pe.prev=Ce,Ce.next.prev=Pe,Ce.next=Pe):(Pe.prev=Pe,Pe.next=Pe),Pe}function ue(ce){ce.next.prev=ce.prev,ce.prev.next=ce.next,ce.prevZ&&(ce.prevZ.nextZ=ce.nextZ),ce.nextZ&&(ce.nextZ.prevZ=ce.prevZ)}function it(ce,$e,Ae){this.i=ce,this.x=$e,this.y=Ae,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}C.deviation=function(ce,$e,Ae,Ce){var Pe=$e&&$e.length,et=Pe?$e[0]*Ae:ce.length,Se=Math.abs(Jt(ce,0,et,Ae));if(Pe)for(var Pt=0,vr=$e.length;Pt<vr;Pt++){var _r=$e[Pt]*Ae,Yr=Pt<vr-1?$e[Pt+1]*Ae:ce.length;Se-=Math.abs(Jt(ce,_r,Yr,Ae))}var tr=0;for(Pt=0;Pt<Ce.length;Pt+=3){var ne=Ce[Pt]*Ae,be=Ce[Pt+1]*Ae,De=Ce[Pt+2]*Ae;tr+=Math.abs((ce[ne]-ce[De])*(ce[be+1]-ce[ne+1])-(ce[ne]-ce[be])*(ce[De+1]-ce[ne+1]))}return Se===0&&tr===0?0:Math.abs((tr-Se)/Se)};function Jt(ce,$e,Ae,Ce){for(var Pe=0,et=$e,Se=Ae-Ce;et<Ae;et+=Ce)Pe+=(ce[Se]-ce[et])*(ce[et+1]+ce[Se+1]),Se=et;return Pe}C.flatten=function(ce){for(var $e=ce[0][0].length,Ae={vertices:[],holes:[],dimensions:$e},Ce=0,Pe=0;Pe<ce.length;Pe++){for(var et=0;et<ce[Pe].length;et++)for(var Se=0;Se<$e;Se++)Ae.vertices.push(ce[Pe][et][Se]);Pe>0&&(Ce+=ce[Pe-1].length,Ae.holes.push(Ce))}return Ae}},67709:function(ft){function C(G){var b=G.target||G.srcElement;b.__resizeRAF__&&cancelAnimationFrame(b.__resizeRAF__),b.__resizeRAF__=requestAnimationFrame(function(){var p=b.__resizeTrigger__,S=p&&p.__resizeListeners__;S&&S.forEach(function(L){L.call(p,G)})})}var y=function(b,p){var S=this,L=S.document,X,N=L.attachEvent;typeof navigator!="undefined"&&(X=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function q(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",C)}if(!b.__resizeListeners__)if(b.__resizeListeners__=[],N)b.__resizeTrigger__=b,b.attachEvent("onresize",C);else{getComputedStyle(b).position==="static"&&(b.style.position="relative");var K=b.__resizeTrigger__=L.createElement("object");K.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),K.setAttribute("class","resize-sensor"),K.setAttribute("tabindex","-1"),K.setAttribute("title",""),K.__resizeElement__=b,K.onload=q,K.type="text/html",X&&b.appendChild(K),K.data="about:blank",X||b.appendChild(K)}b.__resizeListeners__.push(p)};ft.exports=typeof window=="undefined"?y:y.bind(window),ft.exports.unbind=function(G,b){var p=document.attachEvent,S=G.__resizeListeners__||[];if(b){var L=S.indexOf(b);L!==-1&&S.splice(L,1)}else S=G.__resizeListeners__=[];if(!S.length){if(p)G.detachEvent("onresize",C);else if(G.__resizeTrigger__){var X=G.__resizeTrigger__.contentDocument,N=X&&X.defaultView;N&&(N.removeEventListener("resize",C),delete N.__resizeTrigger__),G.__resizeTrigger__=!G.removeChild(G.__resizeTrigger__)}delete G.__resizeListeners__}}},26729:function(ft){"use strict";var C=Object.prototype.hasOwnProperty,y="~";function G(){}Object.create&&(G.prototype=Object.create(null),new G().__proto__||(y=!1));function b(X,N,q){this.fn=X,this.context=N,this.once=q||!1}function p(X,N,q,K,ae){if(typeof q!="function")throw new TypeError("The listener must be a function");var xe=new b(q,K||X,ae),se=y?y+N:N;return X._events[se]?X._events[se].fn?X._events[se]=[X._events[se],xe]:X._events[se].push(xe):(X._events[se]=xe,X._eventsCount++),X}function S(X,N){--X._eventsCount==0?X._events=new G:delete X._events[N]}function L(){this._events=new G,this._eventsCount=0}L.prototype.eventNames=function(){var N=[],q,K;if(this._eventsCount===0)return N;for(K in q=this._events)C.call(q,K)&&N.push(y?K.slice(1):K);return Object.getOwnPropertySymbols?N.concat(Object.getOwnPropertySymbols(q)):N},L.prototype.listeners=function(N){var q=y?y+N:N,K=this._events[q];if(!K)return[];if(K.fn)return[K.fn];for(var ae=0,xe=K.length,se=new Array(xe);ae<xe;ae++)se[ae]=K[ae].fn;return se},L.prototype.listenerCount=function(N){var q=y?y+N:N,K=this._events[q];return K?K.fn?1:K.length:0},L.prototype.emit=function(N,q,K,ae,xe,se){var Ft=y?y+N:N;if(!this._events[Ft])return!1;var zt=this._events[Ft],Wt=arguments.length,Mt,wt;if(zt.fn){switch(zt.once&&this.removeListener(N,zt.fn,void 0,!0),Wt){case 1:return zt.fn.call(zt.context),!0;case 2:return zt.fn.call(zt.context,q),!0;case 3:return zt.fn.call(zt.context,q,K),!0;case 4:return zt.fn.call(zt.context,q,K,ae),!0;case 5:return zt.fn.call(zt.context,q,K,ae,xe),!0;case 6:return zt.fn.call(zt.context,q,K,ae,xe,se),!0}for(wt=1,Mt=new Array(Wt-1);wt<Wt;wt++)Mt[wt-1]=arguments[wt];zt.fn.apply(zt.context,Mt)}else{var ot=zt.length,tt;for(wt=0;wt<ot;wt++)switch(zt[wt].once&&this.removeListener(N,zt[wt].fn,void 0,!0),Wt){case 1:zt[wt].fn.call(zt[wt].context);break;case 2:zt[wt].fn.call(zt[wt].context,q);break;case 3:zt[wt].fn.call(zt[wt].context,q,K);break;case 4:zt[wt].fn.call(zt[wt].context,q,K,ae);break;default:if(!Mt)for(tt=1,Mt=new Array(Wt-1);tt<Wt;tt++)Mt[tt-1]=arguments[tt];zt[wt].fn.apply(zt[wt].context,Mt)}}return!0},L.prototype.on=function(N,q,K){return p(this,N,q,K,!1)},L.prototype.once=function(N,q,K){return p(this,N,q,K,!0)},L.prototype.removeListener=function(N,q,K,ae){var xe=y?y+N:N;if(!this._events[xe])return this;if(!q)return S(this,xe),this;var se=this._events[xe];if(se.fn)se.fn===q&&(!ae||se.once)&&(!K||se.context===K)&&S(this,xe);else{for(var Ft=0,zt=[],Wt=se.length;Ft<Wt;Ft++)(se[Ft].fn!==q||ae&&!se[Ft].once||K&&se[Ft].context!==K)&&zt.push(se[Ft]);zt.length?this._events[xe]=zt.length===1?zt[0]:zt:S(this,xe)}return this},L.prototype.removeAllListeners=function(N){var q;return N?(q=y?y+N:N,this._events[q]&&S(this,q)):(this._events=new G,this._eventsCount=0),this},L.prototype.off=L.prototype.removeListener,L.prototype.addListener=L.prototype.on,L.prefixed=y,L.EventEmitter=L,ft.exports=L},85975:function(ft,C,y){"use strict";y.r(C),y.d(C,{create:function(){return b},clone:function(){return p},copy:function(){return S},fromValues:function(){return L},set:function(){return X},identity:function(){return N},transpose:function(){return q},invert:function(){return K},adjoint:function(){return ae},determinant:function(){return xe},multiply:function(){return se},translate:function(){return Ft},scale:function(){return zt},rotate:function(){return Wt},rotateX:function(){return Mt},rotateY:function(){return wt},rotateZ:function(){return ot},fromTranslation:function(){return tt},fromScaling:function(){return Yt},fromRotation:function(){return ke},fromXRotation:function(){return Ne},fromYRotation:function(){return Be},fromZRotation:function(){return Ie},fromRotationTranslation:function(){return pt},fromQuat2:function(){return oe},getTranslation:function(){return re},getScaling:function(){return ue},getRotation:function(){return it},fromRotationTranslationScale:function(){return Jt},fromRotationTranslationScaleOrigin:function(){return ce},fromQuat:function(){return $e},frustum:function(){return Ae},perspective:function(){return Ce},perspectiveFromFieldOfView:function(){return Pe},ortho:function(){return et},lookAt:function(){return Se},targetTo:function(){return Pt},str:function(){return vr},frob:function(){return _r},add:function(){return Yr},subtract:function(){return tr},multiplyScalar:function(){return ne},multiplyScalarAndAdd:function(){return be},exactEquals:function(){return De},equals:function(){return at},mul:function(){return kt},sub:function(){return jt}});var G=y(49685);function b(){var w=new G.WT(16);return G.WT!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w}function p(w){var F=new G.WT(16);return F[0]=w[0],F[1]=w[1],F[2]=w[2],F[3]=w[3],F[4]=w[4],F[5]=w[5],F[6]=w[6],F[7]=w[7],F[8]=w[8],F[9]=w[9],F[10]=w[10],F[11]=w[11],F[12]=w[12],F[13]=w[13],F[14]=w[14],F[15]=w[15],F}function S(w,F){return w[0]=F[0],w[1]=F[1],w[2]=F[2],w[3]=F[3],w[4]=F[4],w[5]=F[5],w[6]=F[6],w[7]=F[7],w[8]=F[8],w[9]=F[9],w[10]=F[10],w[11]=F[11],w[12]=F[12],w[13]=F[13],w[14]=F[14],w[15]=F[15],w}function L(w,F,de,Ue,Qe,Tt,Dt,H,Qt,$t,wr,Tr,Mr,Or,Je,At){var _t=new G.WT(16);return _t[0]=w,_t[1]=F,_t[2]=de,_t[3]=Ue,_t[4]=Qe,_t[5]=Tt,_t[6]=Dt,_t[7]=H,_t[8]=Qt,_t[9]=$t,_t[10]=wr,_t[11]=Tr,_t[12]=Mr,_t[13]=Or,_t[14]=Je,_t[15]=At,_t}function X(w,F,de,Ue,Qe,Tt,Dt,H,Qt,$t,wr,Tr,Mr,Or,Je,At,_t){return w[0]=F,w[1]=de,w[2]=Ue,w[3]=Qe,w[4]=Tt,w[5]=Dt,w[6]=H,w[7]=Qt,w[8]=$t,w[9]=wr,w[10]=Tr,w[11]=Mr,w[12]=Or,w[13]=Je,w[14]=At,w[15]=_t,w}function N(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function q(w,F){if(w===F){var de=F[1],Ue=F[2],Qe=F[3],Tt=F[6],Dt=F[7],H=F[11];w[1]=F[4],w[2]=F[8],w[3]=F[12],w[4]=de,w[6]=F[9],w[7]=F[13],w[8]=Ue,w[9]=Tt,w[11]=F[14],w[12]=Qe,w[13]=Dt,w[14]=H}else w[0]=F[0],w[1]=F[4],w[2]=F[8],w[3]=F[12],w[4]=F[1],w[5]=F[5],w[6]=F[9],w[7]=F[13],w[8]=F[2],w[9]=F[6],w[10]=F[10],w[11]=F[14],w[12]=F[3],w[13]=F[7],w[14]=F[11],w[15]=F[15];return w}function K(w,F){var de=F[0],Ue=F[1],Qe=F[2],Tt=F[3],Dt=F[4],H=F[5],Qt=F[6],$t=F[7],wr=F[8],Tr=F[9],Mr=F[10],Or=F[11],Je=F[12],At=F[13],_t=F[14],pr=F[15],en=de*H-Ue*Dt,mt=de*Qt-Qe*Dt,Nt=de*$t-Tt*Dt,ar=Ue*Qt-Qe*H,xr=Ue*$t-Tt*H,xn=Qe*$t-Tt*Qt,In=wr*At-Tr*Je,Ei=wr*_t-Mr*Je,Ai=wr*pr-Or*Je,Bi=Tr*_t-Mr*At,aa=Tr*pr-Or*At,hi=Mr*pr-Or*_t,V=en*hi-mt*aa+Nt*Bi+ar*Ai-xr*Ei+xn*In;return V?(V=1/V,w[0]=(H*hi-Qt*aa+$t*Bi)*V,w[1]=(Qe*aa-Ue*hi-Tt*Bi)*V,w[2]=(At*xn-_t*xr+pr*ar)*V,w[3]=(Mr*xr-Tr*xn-Or*ar)*V,w[4]=(Qt*Ai-Dt*hi-$t*Ei)*V,w[5]=(de*hi-Qe*Ai+Tt*Ei)*V,w[6]=(_t*Nt-Je*xn-pr*mt)*V,w[7]=(wr*xn-Mr*Nt+Or*mt)*V,w[8]=(Dt*aa-H*Ai+$t*In)*V,w[9]=(Ue*Ai-de*aa-Tt*In)*V,w[10]=(Je*xr-At*Nt+pr*en)*V,w[11]=(Tr*Nt-wr*xr-Or*en)*V,w[12]=(H*Ei-Dt*Bi-Qt*In)*V,w[13]=(de*Bi-Ue*Ei+Qe*In)*V,w[14]=(At*mt-Je*ar-_t*en)*V,w[15]=(wr*ar-Tr*mt+Mr*en)*V,w):null}function ae(w,F){var de=F[0],Ue=F[1],Qe=F[2],Tt=F[3],Dt=F[4],H=F[5],Qt=F[6],$t=F[7],wr=F[8],Tr=F[9],Mr=F[10],Or=F[11],Je=F[12],At=F[13],_t=F[14],pr=F[15];return w[0]=H*(Mr*pr-Or*_t)-Tr*(Qt*pr-$t*_t)+At*(Qt*Or-$t*Mr),w[1]=-(Ue*(Mr*pr-Or*_t)-Tr*(Qe*pr-Tt*_t)+At*(Qe*Or-Tt*Mr)),w[2]=Ue*(Qt*pr-$t*_t)-H*(Qe*pr-Tt*_t)+At*(Qe*$t-Tt*Qt),w[3]=-(Ue*(Qt*Or-$t*Mr)-H*(Qe*Or-Tt*Mr)+Tr*(Qe*$t-Tt*Qt)),w[4]=-(Dt*(Mr*pr-Or*_t)-wr*(Qt*pr-$t*_t)+Je*(Qt*Or-$t*Mr)),w[5]=de*(Mr*pr-Or*_t)-wr*(Qe*pr-Tt*_t)+Je*(Qe*Or-Tt*Mr),w[6]=-(de*(Qt*pr-$t*_t)-Dt*(Qe*pr-Tt*_t)+Je*(Qe*$t-Tt*Qt)),w[7]=de*(Qt*Or-$t*Mr)-Dt*(Qe*Or-Tt*Mr)+wr*(Qe*$t-Tt*Qt),w[8]=Dt*(Tr*pr-Or*At)-wr*(H*pr-$t*At)+Je*(H*Or-$t*Tr),w[9]=-(de*(Tr*pr-Or*At)-wr*(Ue*pr-Tt*At)+Je*(Ue*Or-Tt*Tr)),w[10]=de*(H*pr-$t*At)-Dt*(Ue*pr-Tt*At)+Je*(Ue*$t-Tt*H),w[11]=-(de*(H*Or-$t*Tr)-Dt*(Ue*Or-Tt*Tr)+wr*(Ue*$t-Tt*H)),w[12]=-(Dt*(Tr*_t-Mr*At)-wr*(H*_t-Qt*At)+Je*(H*Mr-Qt*Tr)),w[13]=de*(Tr*_t-Mr*At)-wr*(Ue*_t-Qe*At)+Je*(Ue*Mr-Qe*Tr),w[14]=-(de*(H*_t-Qt*At)-Dt*(Ue*_t-Qe*At)+Je*(Ue*Qt-Qe*H)),w[15]=de*(H*Mr-Qt*Tr)-Dt*(Ue*Mr-Qe*Tr)+wr*(Ue*Qt-Qe*H),w}function xe(w){var F=w[0],de=w[1],Ue=w[2],Qe=w[3],Tt=w[4],Dt=w[5],H=w[6],Qt=w[7],$t=w[8],wr=w[9],Tr=w[10],Mr=w[11],Or=w[12],Je=w[13],At=w[14],_t=w[15],pr=F*Dt-de*Tt,en=F*H-Ue*Tt,mt=F*Qt-Qe*Tt,Nt=de*H-Ue*Dt,ar=de*Qt-Qe*Dt,xr=Ue*Qt-Qe*H,xn=$t*Je-wr*Or,In=$t*At-Tr*Or,Ei=$t*_t-Mr*Or,Ai=wr*At-Tr*Je,Bi=wr*_t-Mr*Je,aa=Tr*_t-Mr*At;return pr*aa-en*Bi+mt*Ai+Nt*Ei-ar*In+xr*xn}function se(w,F,de){var Ue=F[0],Qe=F[1],Tt=F[2],Dt=F[3],H=F[4],Qt=F[5],$t=F[6],wr=F[7],Tr=F[8],Mr=F[9],Or=F[10],Je=F[11],At=F[12],_t=F[13],pr=F[14],en=F[15],mt=de[0],Nt=de[1],ar=de[2],xr=de[3];return w[0]=mt*Ue+Nt*H+ar*Tr+xr*At,w[1]=mt*Qe+Nt*Qt+ar*Mr+xr*_t,w[2]=mt*Tt+Nt*$t+ar*Or+xr*pr,w[3]=mt*Dt+Nt*wr+ar*Je+xr*en,mt=de[4],Nt=de[5],ar=de[6],xr=de[7],w[4]=mt*Ue+Nt*H+ar*Tr+xr*At,w[5]=mt*Qe+Nt*Qt+ar*Mr+xr*_t,w[6]=mt*Tt+Nt*$t+ar*Or+xr*pr,w[7]=mt*Dt+Nt*wr+ar*Je+xr*en,mt=de[8],Nt=de[9],ar=de[10],xr=de[11],w[8]=mt*Ue+Nt*H+ar*Tr+xr*At,w[9]=mt*Qe+Nt*Qt+ar*Mr+xr*_t,w[10]=mt*Tt+Nt*$t+ar*Or+xr*pr,w[11]=mt*Dt+Nt*wr+ar*Je+xr*en,mt=de[12],Nt=de[13],ar=de[14],xr=de[15],w[12]=mt*Ue+Nt*H+ar*Tr+xr*At,w[13]=mt*Qe+Nt*Qt+ar*Mr+xr*_t,w[14]=mt*Tt+Nt*$t+ar*Or+xr*pr,w[15]=mt*Dt+Nt*wr+ar*Je+xr*en,w}function Ft(w,F,de){var Ue=de[0],Qe=de[1],Tt=de[2],Dt,H,Qt,$t,wr,Tr,Mr,Or,Je,At,_t,pr;return F===w?(w[12]=F[0]*Ue+F[4]*Qe+F[8]*Tt+F[12],w[13]=F[1]*Ue+F[5]*Qe+F[9]*Tt+F[13],w[14]=F[2]*Ue+F[6]*Qe+F[10]*Tt+F[14],w[15]=F[3]*Ue+F[7]*Qe+F[11]*Tt+F[15]):(Dt=F[0],H=F[1],Qt=F[2],$t=F[3],wr=F[4],Tr=F[5],Mr=F[6],Or=F[7],Je=F[8],At=F[9],_t=F[10],pr=F[11],w[0]=Dt,w[1]=H,w[2]=Qt,w[3]=$t,w[4]=wr,w[5]=Tr,w[6]=Mr,w[7]=Or,w[8]=Je,w[9]=At,w[10]=_t,w[11]=pr,w[12]=Dt*Ue+wr*Qe+Je*Tt+F[12],w[13]=H*Ue+Tr*Qe+At*Tt+F[13],w[14]=Qt*Ue+Mr*Qe+_t*Tt+F[14],w[15]=$t*Ue+Or*Qe+pr*Tt+F[15]),w}function zt(w,F,de){var Ue=de[0],Qe=de[1],Tt=de[2];return w[0]=F[0]*Ue,w[1]=F[1]*Ue,w[2]=F[2]*Ue,w[3]=F[3]*Ue,w[4]=F[4]*Qe,w[5]=F[5]*Qe,w[6]=F[6]*Qe,w[7]=F[7]*Qe,w[8]=F[8]*Tt,w[9]=F[9]*Tt,w[10]=F[10]*Tt,w[11]=F[11]*Tt,w[12]=F[12],w[13]=F[13],w[14]=F[14],w[15]=F[15],w}function Wt(w,F,de,Ue){var Qe=Ue[0],Tt=Ue[1],Dt=Ue[2],H=Math.hypot(Qe,Tt,Dt),Qt,$t,wr,Tr,Mr,Or,Je,At,_t,pr,en,mt,Nt,ar,xr,xn,In,Ei,Ai,Bi,aa,hi,V,te;return H<G.Ib?null:(H=1/H,Qe*=H,Tt*=H,Dt*=H,Qt=Math.sin(de),$t=Math.cos(de),wr=1-$t,Tr=F[0],Mr=F[1],Or=F[2],Je=F[3],At=F[4],_t=F[5],pr=F[6],en=F[7],mt=F[8],Nt=F[9],ar=F[10],xr=F[11],xn=Qe*Qe*wr+$t,In=Tt*Qe*wr+Dt*Qt,Ei=Dt*Qe*wr-Tt*Qt,Ai=Qe*Tt*wr-Dt*Qt,Bi=Tt*Tt*wr+$t,aa=Dt*Tt*wr+Qe*Qt,hi=Qe*Dt*wr+Tt*Qt,V=Tt*Dt*wr-Qe*Qt,te=Dt*Dt*wr+$t,w[0]=Tr*xn+At*In+mt*Ei,w[1]=Mr*xn+_t*In+Nt*Ei,w[2]=Or*xn+pr*In+ar*Ei,w[3]=Je*xn+en*In+xr*Ei,w[4]=Tr*Ai+At*Bi+mt*aa,w[5]=Mr*Ai+_t*Bi+Nt*aa,w[6]=Or*Ai+pr*Bi+ar*aa,w[7]=Je*Ai+en*Bi+xr*aa,w[8]=Tr*hi+At*V+mt*te,w[9]=Mr*hi+_t*V+Nt*te,w[10]=Or*hi+pr*V+ar*te,w[11]=Je*hi+en*V+xr*te,F!==w&&(w[12]=F[12],w[13]=F[13],w[14]=F[14],w[15]=F[15]),w)}function Mt(w,F,de){var Ue=Math.sin(de),Qe=Math.cos(de),Tt=F[4],Dt=F[5],H=F[6],Qt=F[7],$t=F[8],wr=F[9],Tr=F[10],Mr=F[11];return F!==w&&(w[0]=F[0],w[1]=F[1],w[2]=F[2],w[3]=F[3],w[12]=F[12],w[13]=F[13],w[14]=F[14],w[15]=F[15]),w[4]=Tt*Qe+$t*Ue,w[5]=Dt*Qe+wr*Ue,w[6]=H*Qe+Tr*Ue,w[7]=Qt*Qe+Mr*Ue,w[8]=$t*Qe-Tt*Ue,w[9]=wr*Qe-Dt*Ue,w[10]=Tr*Qe-H*Ue,w[11]=Mr*Qe-Qt*Ue,w}function wt(w,F,de){var Ue=Math.sin(de),Qe=Math.cos(de),Tt=F[0],Dt=F[1],H=F[2],Qt=F[3],$t=F[8],wr=F[9],Tr=F[10],Mr=F[11];return F!==w&&(w[4]=F[4],w[5]=F[5],w[6]=F[6],w[7]=F[7],w[12]=F[12],w[13]=F[13],w[14]=F[14],w[15]=F[15]),w[0]=Tt*Qe-$t*Ue,w[1]=Dt*Qe-wr*Ue,w[2]=H*Qe-Tr*Ue,w[3]=Qt*Qe-Mr*Ue,w[8]=Tt*Ue+$t*Qe,w[9]=Dt*Ue+wr*Qe,w[10]=H*Ue+Tr*Qe,w[11]=Qt*Ue+Mr*Qe,w}function ot(w,F,de){var Ue=Math.sin(de),Qe=Math.cos(de),Tt=F[0],Dt=F[1],H=F[2],Qt=F[3],$t=F[4],wr=F[5],Tr=F[6],Mr=F[7];return F!==w&&(w[8]=F[8],w[9]=F[9],w[10]=F[10],w[11]=F[11],w[12]=F[12],w[13]=F[13],w[14]=F[14],w[15]=F[15]),w[0]=Tt*Qe+$t*Ue,w[1]=Dt*Qe+wr*Ue,w[2]=H*Qe+Tr*Ue,w[3]=Qt*Qe+Mr*Ue,w[4]=$t*Qe-Tt*Ue,w[5]=wr*Qe-Dt*Ue,w[6]=Tr*Qe-H*Ue,w[7]=Mr*Qe-Qt*Ue,w}function tt(w,F){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=F[0],w[13]=F[1],w[14]=F[2],w[15]=1,w}function Yt(w,F){return w[0]=F[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=F[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=F[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ke(w,F,de){var Ue=de[0],Qe=de[1],Tt=de[2],Dt=Math.hypot(Ue,Qe,Tt),H,Qt,$t;return Dt<G.Ib?null:(Dt=1/Dt,Ue*=Dt,Qe*=Dt,Tt*=Dt,H=Math.sin(F),Qt=Math.cos(F),$t=1-Qt,w[0]=Ue*Ue*$t+Qt,w[1]=Qe*Ue*$t+Tt*H,w[2]=Tt*Ue*$t-Qe*H,w[3]=0,w[4]=Ue*Qe*$t-Tt*H,w[5]=Qe*Qe*$t+Qt,w[6]=Tt*Qe*$t+Ue*H,w[7]=0,w[8]=Ue*Tt*$t+Qe*H,w[9]=Qe*Tt*$t-Ue*H,w[10]=Tt*Tt*$t+Qt,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)}function Ne(w,F){var de=Math.sin(F),Ue=Math.cos(F);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ue,w[6]=de,w[7]=0,w[8]=0,w[9]=-de,w[10]=Ue,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Be(w,F){var de=Math.sin(F),Ue=Math.cos(F);return w[0]=Ue,w[1]=0,w[2]=-de,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=de,w[9]=0,w[10]=Ue,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ie(w,F){var de=Math.sin(F),Ue=Math.cos(F);return w[0]=Ue,w[1]=de,w[2]=0,w[3]=0,w[4]=-de,w[5]=Ue,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function pt(w,F,de){var Ue=F[0],Qe=F[1],Tt=F[2],Dt=F[3],H=Ue+Ue,Qt=Qe+Qe,$t=Tt+Tt,wr=Ue*H,Tr=Ue*Qt,Mr=Ue*$t,Or=Qe*Qt,Je=Qe*$t,At=Tt*$t,_t=Dt*H,pr=Dt*Qt,en=Dt*$t;return w[0]=1-(Or+At),w[1]=Tr+en,w[2]=Mr-pr,w[3]=0,w[4]=Tr-en,w[5]=1-(wr+At),w[6]=Je+_t,w[7]=0,w[8]=Mr+pr,w[9]=Je-_t,w[10]=1-(wr+Or),w[11]=0,w[12]=de[0],w[13]=de[1],w[14]=de[2],w[15]=1,w}function oe(w,F){var de=new G.WT(3),Ue=-F[0],Qe=-F[1],Tt=-F[2],Dt=F[3],H=F[4],Qt=F[5],$t=F[6],wr=F[7],Tr=Ue*Ue+Qe*Qe+Tt*Tt+Dt*Dt;return Tr>0?(de[0]=(H*Dt+wr*Ue+Qt*Tt-$t*Qe)*2/Tr,de[1]=(Qt*Dt+wr*Qe+$t*Ue-H*Tt)*2/Tr,de[2]=($t*Dt+wr*Tt+H*Qe-Qt*Ue)*2/Tr):(de[0]=(H*Dt+wr*Ue+Qt*Tt-$t*Qe)*2,de[1]=(Qt*Dt+wr*Qe+$t*Ue-H*Tt)*2,de[2]=($t*Dt+wr*Tt+H*Qe-Qt*Ue)*2),pt(w,F,de),w}function re(w,F){return w[0]=F[12],w[1]=F[13],w[2]=F[14],w}function ue(w,F){var de=F[0],Ue=F[1],Qe=F[2],Tt=F[4],Dt=F[5],H=F[6],Qt=F[8],$t=F[9],wr=F[10];return w[0]=Math.hypot(de,Ue,Qe),w[1]=Math.hypot(Tt,Dt,H),w[2]=Math.hypot(Qt,$t,wr),w}function it(w,F){var de=new G.WT(3);ue(de,F);var Ue=1/de[0],Qe=1/de[1],Tt=1/de[2],Dt=F[0]*Ue,H=F[1]*Qe,Qt=F[2]*Tt,$t=F[4]*Ue,wr=F[5]*Qe,Tr=F[6]*Tt,Mr=F[8]*Ue,Or=F[9]*Qe,Je=F[10]*Tt,At=Dt+wr+Je,_t=0;return At>0?(_t=Math.sqrt(At+1)*2,w[3]=.25*_t,w[0]=(Tr-Or)/_t,w[1]=(Mr-Qt)/_t,w[2]=(H-$t)/_t):Dt>wr&&Dt>Je?(_t=Math.sqrt(1+Dt-wr-Je)*2,w[3]=(Tr-Or)/_t,w[0]=.25*_t,w[1]=(H+$t)/_t,w[2]=(Mr+Qt)/_t):wr>Je?(_t=Math.sqrt(1+wr-Dt-Je)*2,w[3]=(Mr-Qt)/_t,w[0]=(H+$t)/_t,w[1]=.25*_t,w[2]=(Tr+Or)/_t):(_t=Math.sqrt(1+Je-Dt-wr)*2,w[3]=(H-$t)/_t,w[0]=(Mr+Qt)/_t,w[1]=(Tr+Or)/_t,w[2]=.25*_t),w}function Jt(w,F,de,Ue){var Qe=F[0],Tt=F[1],Dt=F[2],H=F[3],Qt=Qe+Qe,$t=Tt+Tt,wr=Dt+Dt,Tr=Qe*Qt,Mr=Qe*$t,Or=Qe*wr,Je=Tt*$t,At=Tt*wr,_t=Dt*wr,pr=H*Qt,en=H*$t,mt=H*wr,Nt=Ue[0],ar=Ue[1],xr=Ue[2];return w[0]=(1-(Je+_t))*Nt,w[1]=(Mr+mt)*Nt,w[2]=(Or-en)*Nt,w[3]=0,w[4]=(Mr-mt)*ar,w[5]=(1-(Tr+_t))*ar,w[6]=(At+pr)*ar,w[7]=0,w[8]=(Or+en)*xr,w[9]=(At-pr)*xr,w[10]=(1-(Tr+Je))*xr,w[11]=0,w[12]=de[0],w[13]=de[1],w[14]=de[2],w[15]=1,w}function ce(w,F,de,Ue,Qe){var Tt=F[0],Dt=F[1],H=F[2],Qt=F[3],$t=Tt+Tt,wr=Dt+Dt,Tr=H+H,Mr=Tt*$t,Or=Tt*wr,Je=Tt*Tr,At=Dt*wr,_t=Dt*Tr,pr=H*Tr,en=Qt*$t,mt=Qt*wr,Nt=Qt*Tr,ar=Ue[0],xr=Ue[1],xn=Ue[2],In=Qe[0],Ei=Qe[1],Ai=Qe[2],Bi=(1-(At+pr))*ar,aa=(Or+Nt)*ar,hi=(Je-mt)*ar,V=(Or-Nt)*xr,te=(1-(Mr+pr))*xr,le=(_t+en)*xr,we=(Je+mt)*xn,je=(_t-en)*xn,ht=(1-(Mr+At))*xn;return w[0]=Bi,w[1]=aa,w[2]=hi,w[3]=0,w[4]=V,w[5]=te,w[6]=le,w[7]=0,w[8]=we,w[9]=je,w[10]=ht,w[11]=0,w[12]=de[0]+In-(Bi*In+V*Ei+we*Ai),w[13]=de[1]+Ei-(aa*In+te*Ei+je*Ai),w[14]=de[2]+Ai-(hi*In+le*Ei+ht*Ai),w[15]=1,w}function $e(w,F){var de=F[0],Ue=F[1],Qe=F[2],Tt=F[3],Dt=de+de,H=Ue+Ue,Qt=Qe+Qe,$t=de*Dt,wr=Ue*Dt,Tr=Ue*H,Mr=Qe*Dt,Or=Qe*H,Je=Qe*Qt,At=Tt*Dt,_t=Tt*H,pr=Tt*Qt;return w[0]=1-Tr-Je,w[1]=wr+pr,w[2]=Mr-_t,w[3]=0,w[4]=wr-pr,w[5]=1-$t-Je,w[6]=Or+At,w[7]=0,w[8]=Mr+_t,w[9]=Or-At,w[10]=1-$t-Tr,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ae(w,F,de,Ue,Qe,Tt,Dt){var H=1/(de-F),Qt=1/(Qe-Ue),$t=1/(Tt-Dt);return w[0]=Tt*2*H,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Tt*2*Qt,w[6]=0,w[7]=0,w[8]=(de+F)*H,w[9]=(Qe+Ue)*Qt,w[10]=(Dt+Tt)*$t,w[11]=-1,w[12]=0,w[13]=0,w[14]=Dt*Tt*2*$t,w[15]=0,w}function Ce(w,F,de,Ue,Qe){var Tt=1/Math.tan(F/2),Dt;return w[0]=Tt/de,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Tt,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,Qe!=null&&Qe!==Infinity?(Dt=1/(Ue-Qe),w[10]=(Qe+Ue)*Dt,w[14]=2*Qe*Ue*Dt):(w[10]=-1,w[14]=-2*Ue),w}function Pe(w,F,de,Ue){var Qe=Math.tan(F.upDegrees*Math.PI/180),Tt=Math.tan(F.downDegrees*Math.PI/180),Dt=Math.tan(F.leftDegrees*Math.PI/180),H=Math.tan(F.rightDegrees*Math.PI/180),Qt=2/(Dt+H),$t=2/(Qe+Tt);return w[0]=Qt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=$t,w[6]=0,w[7]=0,w[8]=-((Dt-H)*Qt*.5),w[9]=(Qe-Tt)*$t*.5,w[10]=Ue/(de-Ue),w[11]=-1,w[12]=0,w[13]=0,w[14]=Ue*de/(de-Ue),w[15]=0,w}function et(w,F,de,Ue,Qe,Tt,Dt){var H=1/(F-de),Qt=1/(Ue-Qe),$t=1/(Tt-Dt);return w[0]=-2*H,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*Qt,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*$t,w[11]=0,w[12]=(F+de)*H,w[13]=(Qe+Ue)*Qt,w[14]=(Dt+Tt)*$t,w[15]=1,w}function Se(w,F,de,Ue){var Qe,Tt,Dt,H,Qt,$t,wr,Tr,Mr,Or,Je=F[0],At=F[1],_t=F[2],pr=Ue[0],en=Ue[1],mt=Ue[2],Nt=de[0],ar=de[1],xr=de[2];return Math.abs(Je-Nt)<G.Ib&&Math.abs(At-ar)<G.Ib&&Math.abs(_t-xr)<G.Ib?N(w):(wr=Je-Nt,Tr=At-ar,Mr=_t-xr,Or=1/Math.hypot(wr,Tr,Mr),wr*=Or,Tr*=Or,Mr*=Or,Qe=en*Mr-mt*Tr,Tt=mt*wr-pr*Mr,Dt=pr*Tr-en*wr,Or=Math.hypot(Qe,Tt,Dt),Or?(Or=1/Or,Qe*=Or,Tt*=Or,Dt*=Or):(Qe=0,Tt=0,Dt=0),H=Tr*Dt-Mr*Tt,Qt=Mr*Qe-wr*Dt,$t=wr*Tt-Tr*Qe,Or=Math.hypot(H,Qt,$t),Or?(Or=1/Or,H*=Or,Qt*=Or,$t*=Or):(H=0,Qt=0,$t=0),w[0]=Qe,w[1]=H,w[2]=wr,w[3]=0,w[4]=Tt,w[5]=Qt,w[6]=Tr,w[7]=0,w[8]=Dt,w[9]=$t,w[10]=Mr,w[11]=0,w[12]=-(Qe*Je+Tt*At+Dt*_t),w[13]=-(H*Je+Qt*At+$t*_t),w[14]=-(wr*Je+Tr*At+Mr*_t),w[15]=1,w)}function Pt(w,F,de,Ue){var Qe=F[0],Tt=F[1],Dt=F[2],H=Ue[0],Qt=Ue[1],$t=Ue[2],wr=Qe-de[0],Tr=Tt-de[1],Mr=Dt-de[2],Or=wr*wr+Tr*Tr+Mr*Mr;Or>0&&(Or=1/Math.sqrt(Or),wr*=Or,Tr*=Or,Mr*=Or);var Je=Qt*Mr-$t*Tr,At=$t*wr-H*Mr,_t=H*Tr-Qt*wr;return Or=Je*Je+At*At+_t*_t,Or>0&&(Or=1/Math.sqrt(Or),Je*=Or,At*=Or,_t*=Or),w[0]=Je,w[1]=At,w[2]=_t,w[3]=0,w[4]=Tr*_t-Mr*At,w[5]=Mr*Je-wr*_t,w[6]=wr*At-Tr*Je,w[7]=0,w[8]=wr,w[9]=Tr,w[10]=Mr,w[11]=0,w[12]=Qe,w[13]=Tt,w[14]=Dt,w[15]=1,w}function vr(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"}function _r(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}function Yr(w,F,de){return w[0]=F[0]+de[0],w[1]=F[1]+de[1],w[2]=F[2]+de[2],w[3]=F[3]+de[3],w[4]=F[4]+de[4],w[5]=F[5]+de[5],w[6]=F[6]+de[6],w[7]=F[7]+de[7],w[8]=F[8]+de[8],w[9]=F[9]+de[9],w[10]=F[10]+de[10],w[11]=F[11]+de[11],w[12]=F[12]+de[12],w[13]=F[13]+de[13],w[14]=F[14]+de[14],w[15]=F[15]+de[15],w}function tr(w,F,de){return w[0]=F[0]-de[0],w[1]=F[1]-de[1],w[2]=F[2]-de[2],w[3]=F[3]-de[3],w[4]=F[4]-de[4],w[5]=F[5]-de[5],w[6]=F[6]-de[6],w[7]=F[7]-de[7],w[8]=F[8]-de[8],w[9]=F[9]-de[9],w[10]=F[10]-de[10],w[11]=F[11]-de[11],w[12]=F[12]-de[12],w[13]=F[13]-de[13],w[14]=F[14]-de[14],w[15]=F[15]-de[15],w}function ne(w,F,de){return w[0]=F[0]*de,w[1]=F[1]*de,w[2]=F[2]*de,w[3]=F[3]*de,w[4]=F[4]*de,w[5]=F[5]*de,w[6]=F[6]*de,w[7]=F[7]*de,w[8]=F[8]*de,w[9]=F[9]*de,w[10]=F[10]*de,w[11]=F[11]*de,w[12]=F[12]*de,w[13]=F[13]*de,w[14]=F[14]*de,w[15]=F[15]*de,w}function be(w,F,de,Ue){return w[0]=F[0]+de[0]*Ue,w[1]=F[1]+de[1]*Ue,w[2]=F[2]+de[2]*Ue,w[3]=F[3]+de[3]*Ue,w[4]=F[4]+de[4]*Ue,w[5]=F[5]+de[5]*Ue,w[6]=F[6]+de[6]*Ue,w[7]=F[7]+de[7]*Ue,w[8]=F[8]+de[8]*Ue,w[9]=F[9]+de[9]*Ue,w[10]=F[10]+de[10]*Ue,w[11]=F[11]+de[11]*Ue,w[12]=F[12]+de[12]*Ue,w[13]=F[13]+de[13]*Ue,w[14]=F[14]+de[14]*Ue,w[15]=F[15]+de[15]*Ue,w}function De(w,F){return w[0]===F[0]&&w[1]===F[1]&&w[2]===F[2]&&w[3]===F[3]&&w[4]===F[4]&&w[5]===F[5]&&w[6]===F[6]&&w[7]===F[7]&&w[8]===F[8]&&w[9]===F[9]&&w[10]===F[10]&&w[11]===F[11]&&w[12]===F[12]&&w[13]===F[13]&&w[14]===F[14]&&w[15]===F[15]}function at(w,F){var de=w[0],Ue=w[1],Qe=w[2],Tt=w[3],Dt=w[4],H=w[5],Qt=w[6],$t=w[7],wr=w[8],Tr=w[9],Mr=w[10],Or=w[11],Je=w[12],At=w[13],_t=w[14],pr=w[15],en=F[0],mt=F[1],Nt=F[2],ar=F[3],xr=F[4],xn=F[5],In=F[6],Ei=F[7],Ai=F[8],Bi=F[9],aa=F[10],hi=F[11],V=F[12],te=F[13],le=F[14],we=F[15];return Math.abs(de-en)<=G.Ib*Math.max(1,Math.abs(de),Math.abs(en))&&Math.abs(Ue-mt)<=G.Ib*Math.max(1,Math.abs(Ue),Math.abs(mt))&&Math.abs(Qe-Nt)<=G.Ib*Math.max(1,Math.abs(Qe),Math.abs(Nt))&&Math.abs(Tt-ar)<=G.Ib*Math.max(1,Math.abs(Tt),Math.abs(ar))&&Math.abs(Dt-xr)<=G.Ib*Math.max(1,Math.abs(Dt),Math.abs(xr))&&Math.abs(H-xn)<=G.Ib*Math.max(1,Math.abs(H),Math.abs(xn))&&Math.abs(Qt-In)<=G.Ib*Math.max(1,Math.abs(Qt),Math.abs(In))&&Math.abs($t-Ei)<=G.Ib*Math.max(1,Math.abs($t),Math.abs(Ei))&&Math.abs(wr-Ai)<=G.Ib*Math.max(1,Math.abs(wr),Math.abs(Ai))&&Math.abs(Tr-Bi)<=G.Ib*Math.max(1,Math.abs(Tr),Math.abs(Bi))&&Math.abs(Mr-aa)<=G.Ib*Math.max(1,Math.abs(Mr),Math.abs(aa))&&Math.abs(Or-hi)<=G.Ib*Math.max(1,Math.abs(Or),Math.abs(hi))&&Math.abs(Je-V)<=G.Ib*Math.max(1,Math.abs(Je),Math.abs(V))&&Math.abs(At-te)<=G.Ib*Math.max(1,Math.abs(At),Math.abs(te))&&Math.abs(_t-le)<=G.Ib*Math.max(1,Math.abs(_t),Math.abs(le))&&Math.abs(pr-we)<=G.Ib*Math.max(1,Math.abs(pr),Math.abs(we))}var kt=se,jt=tr},98333:function(ft,C,y){"use strict";y.d(C,{Ue:function(){return b},al:function(){return S},bA:function(){return Mt},fF:function(){return it}});var G=y(49685);function b(){var ne=new G.WT(4);return G.WT!=Float32Array&&(ne[0]=0,ne[1]=0,ne[2]=0,ne[3]=0),ne}function p(ne){var be=new glMatrix.ARRAY_TYPE(4);return be[0]=ne[0],be[1]=ne[1],be[2]=ne[2],be[3]=ne[3],be}function S(ne,be,De,at){var kt=new G.WT(4);return kt[0]=ne,kt[1]=be,kt[2]=De,kt[3]=at,kt}function L(ne,be){return ne[0]=be[0],ne[1]=be[1],ne[2]=be[2],ne[3]=be[3],ne}function X(ne,be,De,at,kt){return ne[0]=be,ne[1]=De,ne[2]=at,ne[3]=kt,ne}function N(ne,be,De){return ne[0]=be[0]+De[0],ne[1]=be[1]+De[1],ne[2]=be[2]+De[2],ne[3]=be[3]+De[3],ne}function q(ne,be,De){return ne[0]=be[0]-De[0],ne[1]=be[1]-De[1],ne[2]=be[2]-De[2],ne[3]=be[3]-De[3],ne}function K(ne,be,De){return ne[0]=be[0]*De[0],ne[1]=be[1]*De[1],ne[2]=be[2]*De[2],ne[3]=be[3]*De[3],ne}function ae(ne,be,De){return ne[0]=be[0]/De[0],ne[1]=be[1]/De[1],ne[2]=be[2]/De[2],ne[3]=be[3]/De[3],ne}function xe(ne,be){return ne[0]=Math.ceil(be[0]),ne[1]=Math.ceil(be[1]),ne[2]=Math.ceil(be[2]),ne[3]=Math.ceil(be[3]),ne}function se(ne,be){return ne[0]=Math.floor(be[0]),ne[1]=Math.floor(be[1]),ne[2]=Math.floor(be[2]),ne[3]=Math.floor(be[3]),ne}function Ft(ne,be,De){return ne[0]=Math.min(be[0],De[0]),ne[1]=Math.min(be[1],De[1]),ne[2]=Math.min(be[2],De[2]),ne[3]=Math.min(be[3],De[3]),ne}function zt(ne,be,De){return ne[0]=Math.max(be[0],De[0]),ne[1]=Math.max(be[1],De[1]),ne[2]=Math.max(be[2],De[2]),ne[3]=Math.max(be[3],De[3]),ne}function Wt(ne,be){return ne[0]=Math.round(be[0]),ne[1]=Math.round(be[1]),ne[2]=Math.round(be[2]),ne[3]=Math.round(be[3]),ne}function Mt(ne,be,De){return ne[0]=be[0]*De,ne[1]=be[1]*De,ne[2]=be[2]*De,ne[3]=be[3]*De,ne}function wt(ne,be,De,at){return ne[0]=be[0]+De[0]*at,ne[1]=be[1]+De[1]*at,ne[2]=be[2]+De[2]*at,ne[3]=be[3]+De[3]*at,ne}function ot(ne,be){var De=be[0]-ne[0],at=be[1]-ne[1],kt=be[2]-ne[2],jt=be[3]-ne[3];return Math.hypot(De,at,kt,jt)}function tt(ne,be){var De=be[0]-ne[0],at=be[1]-ne[1],kt=be[2]-ne[2],jt=be[3]-ne[3];return De*De+at*at+kt*kt+jt*jt}function Yt(ne){var be=ne[0],De=ne[1],at=ne[2],kt=ne[3];return Math.hypot(be,De,at,kt)}function ke(ne){var be=ne[0],De=ne[1],at=ne[2],kt=ne[3];return be*be+De*De+at*at+kt*kt}function Ne(ne,be){return ne[0]=-be[0],ne[1]=-be[1],ne[2]=-be[2],ne[3]=-be[3],ne}function Be(ne,be){return ne[0]=1/be[0],ne[1]=1/be[1],ne[2]=1/be[2],ne[3]=1/be[3],ne}function Ie(ne,be){var De=be[0],at=be[1],kt=be[2],jt=be[3],w=De*De+at*at+kt*kt+jt*jt;return w>0&&(w=1/Math.sqrt(w)),ne[0]=De*w,ne[1]=at*w,ne[2]=kt*w,ne[3]=jt*w,ne}function pt(ne,be){return ne[0]*be[0]+ne[1]*be[1]+ne[2]*be[2]+ne[3]*be[3]}function oe(ne,be,De,at){var kt=De[0]*at[1]-De[1]*at[0],jt=De[0]*at[2]-De[2]*at[0],w=De[0]*at[3]-De[3]*at[0],F=De[1]*at[2]-De[2]*at[1],de=De[1]*at[3]-De[3]*at[1],Ue=De[2]*at[3]-De[3]*at[2],Qe=be[0],Tt=be[1],Dt=be[2],H=be[3];return ne[0]=Tt*Ue-Dt*de+H*F,ne[1]=-(Qe*Ue)+Dt*w-H*jt,ne[2]=Qe*de-Tt*w+H*kt,ne[3]=-(Qe*F)+Tt*jt-Dt*kt,ne}function re(ne,be,De,at){var kt=be[0],jt=be[1],w=be[2],F=be[3];return ne[0]=kt+at*(De[0]-kt),ne[1]=jt+at*(De[1]-jt),ne[2]=w+at*(De[2]-w),ne[3]=F+at*(De[3]-F),ne}function ue(ne,be){be=be||1;var De,at,kt,jt,w,F;do De=glMatrix.RANDOM()*2-1,at=glMatrix.RANDOM()*2-1,w=De*De+at*at;while(w>=1);do kt=glMatrix.RANDOM()*2-1,jt=glMatrix.RANDOM()*2-1,F=kt*kt+jt*jt;while(F>=1);var de=Math.sqrt((1-w)/F);return ne[0]=be*De,ne[1]=be*at,ne[2]=be*kt*de,ne[3]=be*jt*de,ne}function it(ne,be,De){var at=be[0],kt=be[1],jt=be[2],w=be[3];return ne[0]=De[0]*at+De[4]*kt+De[8]*jt+De[12]*w,ne[1]=De[1]*at+De[5]*kt+De[9]*jt+De[13]*w,ne[2]=De[2]*at+De[6]*kt+De[10]*jt+De[14]*w,ne[3]=De[3]*at+De[7]*kt+De[11]*jt+De[15]*w,ne}function Jt(ne,be,De){var at=be[0],kt=be[1],jt=be[2],w=De[0],F=De[1],de=De[2],Ue=De[3],Qe=Ue*at+F*jt-de*kt,Tt=Ue*kt+de*at-w*jt,Dt=Ue*jt+w*kt-F*at,H=-w*at-F*kt-de*jt;return ne[0]=Qe*Ue+H*-w+Tt*-de-Dt*-F,ne[1]=Tt*Ue+H*-F+Dt*-w-Qe*-de,ne[2]=Dt*Ue+H*-de+Qe*-F-Tt*-w,ne[3]=be[3],ne}function ce(ne){return ne[0]=0,ne[1]=0,ne[2]=0,ne[3]=0,ne}function $e(ne){return"vec4("+ne[0]+", "+ne[1]+", "+ne[2]+", "+ne[3]+")"}function Ae(ne,be){return ne[0]===be[0]&&ne[1]===be[1]&&ne[2]===be[2]&&ne[3]===be[3]}function Ce(ne,be){var De=ne[0],at=ne[1],kt=ne[2],jt=ne[3],w=be[0],F=be[1],de=be[2],Ue=be[3];return Math.abs(De-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(De),Math.abs(w))&&Math.abs(at-F)<=glMatrix.EPSILON*Math.max(1,Math.abs(at),Math.abs(F))&&Math.abs(kt-de)<=glMatrix.EPSILON*Math.max(1,Math.abs(kt),Math.abs(de))&&Math.abs(jt-Ue)<=glMatrix.EPSILON*Math.max(1,Math.abs(jt),Math.abs(Ue))}var Pe=null,et=null,Se=null,Pt=null,vr=null,_r=null,Yr=null,tr=function(){var ne=b();return function(be,De,at,kt,jt,w){var F,de;for(De||(De=4),at||(at=0),kt?de=Math.min(kt*De+at,be.length):de=be.length,F=at;F<de;F+=De)ne[0]=be[F],ne[1]=be[F+1],ne[2]=be[F+2],ne[3]=be[F+3],jt(ne,ne,w),be[F]=ne[0],be[F+1]=ne[1],be[F+2]=ne[2],be[F+3]=ne[3];return be}}()},50840:function(ft,C,y){var G;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(b,p,S,L){"use strict";var X=["","webkit","Moz","MS","ms","o"],N=p.createElement("div"),q="function",K=Math.round,ae=Math.abs,xe=Date.now;function se(he,Oe,gt){return setTimeout(Yt(he,gt),Oe)}function Ft(he,Oe,gt){return Array.isArray(he)?(zt(he,gt[Oe],gt),!0):!1}function zt(he,Oe,gt){var fr;if(!!he)if(he.forEach)he.forEach(Oe,gt);else if(he.length!==L)for(fr=0;fr<he.length;)Oe.call(gt,he[fr],fr,he),fr++;else for(fr in he)he.hasOwnProperty(fr)&&Oe.call(gt,he[fr],fr,he)}function Wt(he,Oe,gt){var fr="DEPRECATED METHOD: "+Oe+`
`+gt+` AT 
`;return function(){var tn=new Error("get-stack-trace"),kn=tn&&tn.stack?tn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Zi=b.console&&(b.console.warn||b.console.log);return Zi&&Zi.call(b.console,fr,kn),he.apply(this,arguments)}}var Mt;typeof Object.assign!="function"?Mt=function(Oe){if(Oe===L||Oe===null)throw new TypeError("Cannot convert undefined or null to object");for(var gt=Object(Oe),fr=1;fr<arguments.length;fr++){var tn=arguments[fr];if(tn!==L&&tn!==null)for(var kn in tn)tn.hasOwnProperty(kn)&&(gt[kn]=tn[kn])}return gt}:Mt=Object.assign;var wt=Wt(function(Oe,gt,fr){for(var tn=Object.keys(gt),kn=0;kn<tn.length;)(!fr||fr&&Oe[tn[kn]]===L)&&(Oe[tn[kn]]=gt[tn[kn]]),kn++;return Oe},"extend","Use `assign`."),ot=Wt(function(Oe,gt){return wt(Oe,gt,!0)},"merge","Use `assign`.");function tt(he,Oe,gt){var fr=Oe.prototype,tn;tn=he.prototype=Object.create(fr),tn.constructor=he,tn._super=fr,gt&&Mt(tn,gt)}function Yt(he,Oe){return function(){return he.apply(Oe,arguments)}}function ke(he,Oe){return typeof he==q?he.apply(Oe&&Oe[0]||L,Oe):he}function Ne(he,Oe){return he===L?Oe:he}function Be(he,Oe,gt){zt(re(Oe),function(fr){he.addEventListener(fr,gt,!1)})}function Ie(he,Oe,gt){zt(re(Oe),function(fr){he.removeEventListener(fr,gt,!1)})}function pt(he,Oe){for(;he;){if(he==Oe)return!0;he=he.parentNode}return!1}function oe(he,Oe){return he.indexOf(Oe)>-1}function re(he){return he.trim().split(/\s+/g)}function ue(he,Oe,gt){if(he.indexOf&&!gt)return he.indexOf(Oe);for(var fr=0;fr<he.length;){if(gt&&he[fr][gt]==Oe||!gt&&he[fr]===Oe)return fr;fr++}return-1}function it(he){return Array.prototype.slice.call(he,0)}function Jt(he,Oe,gt){for(var fr=[],tn=[],kn=0;kn<he.length;){var Zi=Oe?he[kn][Oe]:he[kn];ue(tn,Zi)<0&&fr.push(he[kn]),tn[kn]=Zi,kn++}return gt&&(Oe?fr=fr.sort(function(Xa,Ya){return Xa[Oe]>Ya[Oe]}):fr=fr.sort()),fr}function ce(he,Oe){for(var gt,fr,tn=Oe[0].toUpperCase()+Oe.slice(1),kn=0;kn<X.length;){if(gt=X[kn],fr=gt?gt+tn:Oe,fr in he)return fr;kn++}return L}var $e=1;function Ae(){return $e++}function Ce(he){var Oe=he.ownerDocument||he;return Oe.defaultView||Oe.parentWindow||b}var Pe=/mobile|tablet|ip(ad|hone|od)|android/i,et="ontouchstart"in b,Se=ce(b,"PointerEvent")!==L,Pt=et&&Pe.test(navigator.userAgent),vr="touch",_r="pen",Yr="mouse",tr="kinect",ne=25,be=1,De=2,at=4,kt=8,jt=1,w=2,F=4,de=8,Ue=16,Qe=w|F,Tt=de|Ue,Dt=Qe|Tt,H=["x","y"],Qt=["clientX","clientY"];function $t(he,Oe){var gt=this;this.manager=he,this.callback=Oe,this.element=he.element,this.target=he.options.inputTarget,this.domHandler=function(fr){ke(he.options.enable,[he])&&gt.handler(fr)},this.init()}$t.prototype={handler:function(){},init:function(){this.evEl&&Be(this.element,this.evEl,this.domHandler),this.evTarget&&Be(this.target,this.evTarget,this.domHandler),this.evWin&&Be(Ce(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ie(this.element,this.evEl,this.domHandler),this.evTarget&&Ie(this.target,this.evTarget,this.domHandler),this.evWin&&Ie(Ce(this.element),this.evWin,this.domHandler)}};function wr(he){var Oe,gt=he.options.inputClass;return gt?Oe=gt:Se?Oe=te:Pt?Oe=Ut:et?Oe=mr:Oe=Ai,new Oe(he,Tr)}function Tr(he,Oe,gt){var fr=gt.pointers.length,tn=gt.changedPointers.length,kn=Oe&be&&fr-tn==0,Zi=Oe&(at|kt)&&fr-tn==0;gt.isFirst=!!kn,gt.isFinal=!!Zi,kn&&(he.session={}),gt.eventType=Oe,Mr(he,gt),he.emit("hammer.input",gt),he.recognize(gt),he.session.prevInput=gt}function Mr(he,Oe){var gt=he.session,fr=Oe.pointers,tn=fr.length;gt.firstInput||(gt.firstInput=At(Oe)),tn>1&&!gt.firstMultiple?gt.firstMultiple=At(Oe):tn===1&&(gt.firstMultiple=!1);var kn=gt.firstInput,Zi=gt.firstMultiple,Xi=Zi?Zi.center:kn.center,Xa=Oe.center=_t(fr);Oe.timeStamp=xe(),Oe.deltaTime=Oe.timeStamp-kn.timeStamp,Oe.angle=Nt(Xi,Xa),Oe.distance=mt(Xi,Xa),Or(gt,Oe),Oe.offsetDirection=en(Oe.deltaX,Oe.deltaY);var Ya=pr(Oe.deltaTime,Oe.deltaX,Oe.deltaY);Oe.overallVelocityX=Ya.x,Oe.overallVelocityY=Ya.y,Oe.overallVelocity=ae(Ya.x)>ae(Ya.y)?Ya.x:Ya.y,Oe.scale=Zi?xr(Zi.pointers,fr):1,Oe.rotation=Zi?ar(Zi.pointers,fr):0,Oe.maxPointers=gt.prevInput?Oe.pointers.length>gt.prevInput.maxPointers?Oe.pointers.length:gt.prevInput.maxPointers:Oe.pointers.length,Je(gt,Oe);var Yo=he.element;pt(Oe.srcEvent.target,Yo)&&(Yo=Oe.srcEvent.target),Oe.target=Yo}function Or(he,Oe){var gt=Oe.center,fr=he.offsetDelta||{},tn=he.prevDelta||{},kn=he.prevInput||{};(Oe.eventType===be||kn.eventType===at)&&(tn=he.prevDelta={x:kn.deltaX||0,y:kn.deltaY||0},fr=he.offsetDelta={x:gt.x,y:gt.y}),Oe.deltaX=tn.x+(gt.x-fr.x),Oe.deltaY=tn.y+(gt.y-fr.y)}function Je(he,Oe){var gt=he.lastInterval||Oe,fr=Oe.timeStamp-gt.timeStamp,tn,kn,Zi,Xi;if(Oe.eventType!=kt&&(fr>ne||gt.velocity===L)){var Xa=Oe.deltaX-gt.deltaX,Ya=Oe.deltaY-gt.deltaY,Yo=pr(fr,Xa,Ya);kn=Yo.x,Zi=Yo.y,tn=ae(Yo.x)>ae(Yo.y)?Yo.x:Yo.y,Xi=en(Xa,Ya),he.lastInterval=Oe}else tn=gt.velocity,kn=gt.velocityX,Zi=gt.velocityY,Xi=gt.direction;Oe.velocity=tn,Oe.velocityX=kn,Oe.velocityY=Zi,Oe.direction=Xi}function At(he){for(var Oe=[],gt=0;gt<he.pointers.length;)Oe[gt]={clientX:K(he.pointers[gt].clientX),clientY:K(he.pointers[gt].clientY)},gt++;return{timeStamp:xe(),pointers:Oe,center:_t(Oe),deltaX:he.deltaX,deltaY:he.deltaY}}function _t(he){var Oe=he.length;if(Oe===1)return{x:K(he[0].clientX),y:K(he[0].clientY)};for(var gt=0,fr=0,tn=0;tn<Oe;)gt+=he[tn].clientX,fr+=he[tn].clientY,tn++;return{x:K(gt/Oe),y:K(fr/Oe)}}function pr(he,Oe,gt){return{x:Oe/he||0,y:gt/he||0}}function en(he,Oe){return he===Oe?jt:ae(he)>=ae(Oe)?he<0?w:F:Oe<0?de:Ue}function mt(he,Oe,gt){gt||(gt=H);var fr=Oe[gt[0]]-he[gt[0]],tn=Oe[gt[1]]-he[gt[1]];return Math.sqrt(fr*fr+tn*tn)}function Nt(he,Oe,gt){gt||(gt=H);var fr=Oe[gt[0]]-he[gt[0]],tn=Oe[gt[1]]-he[gt[1]];return Math.atan2(tn,fr)*180/Math.PI}function ar(he,Oe){return Nt(Oe[1],Oe[0],Qt)+Nt(he[1],he[0],Qt)}function xr(he,Oe){return mt(Oe[0],Oe[1],Qt)/mt(he[0],he[1],Qt)}var xn={mousedown:be,mousemove:De,mouseup:at},In="mousedown",Ei="mousemove mouseup";function Ai(){this.evEl=In,this.evWin=Ei,this.pressed=!1,$t.apply(this,arguments)}tt(Ai,$t,{handler:function(Oe){var gt=xn[Oe.type];gt&be&&Oe.button===0&&(this.pressed=!0),gt&De&&Oe.which!==1&&(gt=at),!!this.pressed&&(gt&at&&(this.pressed=!1),this.callback(this.manager,gt,{pointers:[Oe],changedPointers:[Oe],pointerType:Yr,srcEvent:Oe}))}});var Bi={pointerdown:be,pointermove:De,pointerup:at,pointercancel:kt,pointerout:kt},aa={2:vr,3:_r,4:Yr,5:tr},hi="pointerdown",V="pointermove pointerup pointercancel";b.MSPointerEvent&&!b.PointerEvent&&(hi="MSPointerDown",V="MSPointerMove MSPointerUp MSPointerCancel");function te(){this.evEl=hi,this.evWin=V,$t.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}tt(te,$t,{handler:function(Oe){var gt=this.store,fr=!1,tn=Oe.type.toLowerCase().replace("ms",""),kn=Bi[tn],Zi=aa[Oe.pointerType]||Oe.pointerType,Xi=Zi==vr,Xa=ue(gt,Oe.pointerId,"pointerId");kn&be&&(Oe.button===0||Xi)?Xa<0&&(gt.push(Oe),Xa=gt.length-1):kn&(at|kt)&&(fr=!0),!(Xa<0)&&(gt[Xa]=Oe,this.callback(this.manager,kn,{pointers:gt,changedPointers:[Oe],pointerType:Zi,srcEvent:Oe}),fr&&gt.splice(Xa,1))}});var le={touchstart:be,touchmove:De,touchend:at,touchcancel:kt},we="touchstart",je="touchstart touchmove touchend touchcancel";function ht(){this.evTarget=we,this.evWin=je,this.started=!1,$t.apply(this,arguments)}tt(ht,$t,{handler:function(Oe){var gt=le[Oe.type];if(gt===be&&(this.started=!0),!!this.started){var fr=xt.call(this,Oe,gt);gt&(at|kt)&&fr[0].length-fr[1].length==0&&(this.started=!1),this.callback(this.manager,gt,{pointers:fr[0],changedPointers:fr[1],pointerType:vr,srcEvent:Oe})}}});function xt(he,Oe){var gt=it(he.touches),fr=it(he.changedTouches);return Oe&(at|kt)&&(gt=Jt(gt.concat(fr),"identifier",!0)),[gt,fr]}var ge={touchstart:be,touchmove:De,touchend:at,touchcancel:kt},Ke="touchstart touchmove touchend touchcancel";function Ut(){this.evTarget=Ke,this.targetIds={},$t.apply(this,arguments)}tt(Ut,$t,{handler:function(Oe){var gt=ge[Oe.type],fr=Fr.call(this,Oe,gt);!fr||this.callback(this.manager,gt,{pointers:fr[0],changedPointers:fr[1],pointerType:vr,srcEvent:Oe})}});function Fr(he,Oe){var gt=it(he.touches),fr=this.targetIds;if(Oe&(be|De)&&gt.length===1)return fr[gt[0].identifier]=!0,[gt,gt];var tn,kn,Zi=it(he.changedTouches),Xi=[],Xa=this.target;if(kn=gt.filter(function(Ya){return pt(Ya.target,Xa)}),Oe===be)for(tn=0;tn<kn.length;)fr[kn[tn].identifier]=!0,tn++;for(tn=0;tn<Zi.length;)fr[Zi[tn].identifier]&&Xi.push(Zi[tn]),Oe&(at|kt)&&delete fr[Zi[tn].identifier],tn++;if(!!Xi.length)return[Jt(kn.concat(Xi),"identifier",!0),Xi]}var jr=2500,Xt=25;function mr(){$t.apply(this,arguments);var he=Yt(this.handler,this);this.touch=new Ut(this.manager,he),this.mouse=new Ai(this.manager,he),this.primaryTouch=null,this.lastTouches=[]}tt(mr,$t,{handler:function(Oe,gt,fr){var tn=fr.pointerType==vr,kn=fr.pointerType==Yr;if(!(kn&&fr.sourceCapabilities&&fr.sourceCapabilities.firesTouchEvents)){if(tn)Hr.call(this,gt,fr);else if(kn&&gr.call(this,fr))return;this.callback(Oe,gt,fr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Hr(he,Oe){he&be?(this.primaryTouch=Oe.changedPointers[0].identifier,gn.call(this,Oe)):he&(at|kt)&&gn.call(this,Oe)}function gn(he){var Oe=he.changedPointers[0];if(Oe.identifier===this.primaryTouch){var gt={x:Oe.clientX,y:Oe.clientY};this.lastTouches.push(gt);var fr=this.lastTouches,tn=function(){var kn=fr.indexOf(gt);kn>-1&&fr.splice(kn,1)};setTimeout(tn,jr)}}function gr(he){for(var Oe=he.srcEvent.clientX,gt=he.srcEvent.clientY,fr=0;fr<this.lastTouches.length;fr++){var tn=this.lastTouches[fr],kn=Math.abs(Oe-tn.x),Zi=Math.abs(gt-tn.y);if(kn<=Xt&&Zi<=Xt)return!0}return!1}var vn=ce(N.style,"touchAction"),$r=vn!==L,cn="compute",pi="auto",fn="manipulation",gi="none",Wi="pan-x",vi="pan-y",Ri=ji();function Ii(he,Oe){this.manager=he,this.set(Oe)}Ii.prototype={set:function(he){he==cn&&(he=this.compute()),$r&&this.manager.element.style&&Ri[he]&&(this.manager.element.style[vn]=he),this.actions=he.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var he=[];return zt(this.manager.recognizers,function(Oe){ke(Oe.options.enable,[Oe])&&(he=he.concat(Oe.getTouchAction()))}),go(he.join(" "))},preventDefaults:function(he){var Oe=he.srcEvent,gt=he.offsetDirection;if(this.manager.session.prevented){Oe.preventDefault();return}var fr=this.actions,tn=oe(fr,gi)&&!Ri[gi],kn=oe(fr,vi)&&!Ri[vi],Zi=oe(fr,Wi)&&!Ri[Wi];if(tn){var Xi=he.pointers.length===1,Xa=he.distance<2,Ya=he.deltaTime<250;if(Xi&&Xa&&Ya)return}if(!(Zi&&kn)&&(tn||kn&&gt&Qe||Zi&&gt&Tt))return this.preventSrc(Oe)},preventSrc:function(he){this.manager.session.prevented=!0,he.preventDefault()}};function go(he){if(oe(he,gi))return gi;var Oe=oe(he,Wi),gt=oe(he,vi);return Oe&&gt?gi:Oe||gt?Oe?Wi:vi:oe(he,fn)?fn:pi}function ji(){if(!$r)return!1;var he={},Oe=b.CSS&&b.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(gt){he[gt]=Oe?b.CSS.supports("touch-action",gt):!0}),he}var Rn=1,Dn=2,ui=4,Vn=8,za=Vn,ds=16,Di=32;function Na(he){this.options=Mt({},this.defaults,he||{}),this.id=Ae(),this.manager=null,this.options.enable=Ne(this.options.enable,!0),this.state=Rn,this.simultaneous={},this.requireFail=[]}Na.prototype={defaults:{},set:function(he){return Mt(this.options,he),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(he){if(Ft(he,"recognizeWith",this))return this;var Oe=this.simultaneous;return he=ya(he,this),Oe[he.id]||(Oe[he.id]=he,he.recognizeWith(this)),this},dropRecognizeWith:function(he){return Ft(he,"dropRecognizeWith",this)?this:(he=ya(he,this),delete this.simultaneous[he.id],this)},requireFailure:function(he){if(Ft(he,"requireFailure",this))return this;var Oe=this.requireFail;return he=ya(he,this),ue(Oe,he)===-1&&(Oe.push(he),he.requireFailure(this)),this},dropRequireFailure:function(he){if(Ft(he,"dropRequireFailure",this))return this;he=ya(he,this);var Oe=ue(this.requireFail,he);return Oe>-1&&this.requireFail.splice(Oe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(he){return!!this.simultaneous[he.id]},emit:function(he){var Oe=this,gt=this.state;function fr(tn){Oe.manager.emit(tn,he)}gt<Vn&&fr(Oe.options.event+Eu(gt)),fr(Oe.options.event),he.additionalEvent&&fr(he.additionalEvent),gt>=Vn&&fr(Oe.options.event+Eu(gt))},tryEmit:function(he){if(this.canEmit())return this.emit(he);this.state=Di},canEmit:function(){for(var he=0;he<this.requireFail.length;){if(!(this.requireFail[he].state&(Di|Rn)))return!1;he++}return!0},recognize:function(he){var Oe=Mt({},he);if(!ke(this.options.enable,[this,Oe])){this.reset(),this.state=Di;return}this.state&(za|ds|Di)&&(this.state=Rn),this.state=this.process(Oe),this.state&(Dn|ui|Vn|ds)&&this.tryEmit(Oe)},process:function(he){},getTouchAction:function(){},reset:function(){}};function Eu(he){return he&ds?"cancel":he&Vn?"end":he&ui?"move":he&Dn?"start":""}function fu(he){return he==Ue?"down":he==de?"up":he==w?"left":he==F?"right":""}function ya(he,Oe){var gt=Oe.manager;return gt?gt.get(he):he}function lo(){Na.apply(this,arguments)}tt(lo,Na,{defaults:{pointers:1},attrTest:function(he){var Oe=this.options.pointers;return Oe===0||he.pointers.length===Oe},process:function(he){var Oe=this.state,gt=he.eventType,fr=Oe&(Dn|ui),tn=this.attrTest(he);return fr&&(gt&kt||!tn)?Oe|ds:fr||tn?gt&at?Oe|Vn:Oe&Dn?Oe|ui:Dn:Di}});function Ga(){lo.apply(this,arguments),this.pX=null,this.pY=null}tt(Ga,lo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Dt},getTouchAction:function(){var he=this.options.direction,Oe=[];return he&Qe&&Oe.push(vi),he&Tt&&Oe.push(Wi),Oe},directionTest:function(he){var Oe=this.options,gt=!0,fr=he.distance,tn=he.direction,kn=he.deltaX,Zi=he.deltaY;return tn&Oe.direction||(Oe.direction&Qe?(tn=kn===0?jt:kn<0?w:F,gt=kn!=this.pX,fr=Math.abs(he.deltaX)):(tn=Zi===0?jt:Zi<0?de:Ue,gt=Zi!=this.pY,fr=Math.abs(he.deltaY))),he.direction=tn,gt&&fr>Oe.threshold&&tn&Oe.direction},attrTest:function(he){return lo.prototype.attrTest.call(this,he)&&(this.state&Dn||!(this.state&Dn)&&this.directionTest(he))},emit:function(he){this.pX=he.deltaX,this.pY=he.deltaY;var Oe=fu(he.direction);Oe&&(he.additionalEvent=this.options.event+Oe),this._super.emit.call(this,he)}});function Ha(){lo.apply(this,arguments)}tt(Ha,lo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[gi]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.scale-1)>this.options.threshold||this.state&Dn)},emit:function(he){if(he.scale!==1){var Oe=he.scale<1?"in":"out";he.additionalEvent=this.options.event+Oe}this._super.emit.call(this,he)}});function Xo(){Na.apply(this,arguments),this._timer=null,this._input=null}tt(Xo,Na,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[pi]},process:function(he){var Oe=this.options,gt=he.pointers.length===Oe.pointers,fr=he.distance<Oe.threshold,tn=he.deltaTime>Oe.time;if(this._input=he,!fr||!gt||he.eventType&(at|kt)&&!tn)this.reset();else if(he.eventType&be)this.reset(),this._timer=se(function(){this.state=za,this.tryEmit()},Oe.time,this);else if(he.eventType&at)return za;return Di},reset:function(){clearTimeout(this._timer)},emit:function(he){this.state===za&&(he&&he.eventType&at?this.manager.emit(this.options.event+"up",he):(this._input.timeStamp=xe(),this.manager.emit(this.options.event,this._input)))}});function oa(){lo.apply(this,arguments)}tt(oa,lo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[gi]},attrTest:function(he){return this._super.attrTest.call(this,he)&&(Math.abs(he.rotation)>this.options.threshold||this.state&Dn)}});function Wa(){lo.apply(this,arguments)}tt(Wa,lo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Qe|Tt,pointers:1},getTouchAction:function(){return Ga.prototype.getTouchAction.call(this)},attrTest:function(he){var Oe=this.options.direction,gt;return Oe&(Qe|Tt)?gt=he.overallVelocity:Oe&Qe?gt=he.overallVelocityX:Oe&Tt&&(gt=he.overallVelocityY),this._super.attrTest.call(this,he)&&Oe&he.offsetDirection&&he.distance>this.options.threshold&&he.maxPointers==this.options.pointers&&ae(gt)>this.options.velocity&&he.eventType&at},emit:function(he){var Oe=fu(he.offsetDirection);Oe&&this.manager.emit(this.options.event+Oe,he),this.manager.emit(this.options.event,he)}});function wa(){Na.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}tt(wa,Na,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fn]},process:function(he){var Oe=this.options,gt=he.pointers.length===Oe.pointers,fr=he.distance<Oe.threshold,tn=he.deltaTime<Oe.time;if(this.reset(),he.eventType&be&&this.count===0)return this.failTimeout();if(fr&&tn&&gt){if(he.eventType!=at)return this.failTimeout();var kn=this.pTime?he.timeStamp-this.pTime<Oe.interval:!0,Zi=!this.pCenter||mt(this.pCenter,he.center)<Oe.posThreshold;this.pTime=he.timeStamp,this.pCenter=he.center,!Zi||!kn?this.count=1:this.count+=1,this._input=he;var Xi=this.count%Oe.taps;if(Xi===0)return this.hasRequireFailures()?(this._timer=se(function(){this.state=za,this.tryEmit()},Oe.interval,this),Dn):za}return Di},failTimeout:function(){return this._timer=se(function(){this.state=Di},this.options.interval,this),Di},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==za&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function _a(he,Oe){return Oe=Oe||{},Oe.recognizers=Ne(Oe.recognizers,_a.defaults.preset),new ts(he,Oe)}_a.VERSION="2.0.7",_a.defaults={domEvents:!1,touchAction:cn,enable:!0,inputTarget:null,inputClass:null,preset:[[oa,{enable:!1}],[Ha,{enable:!1},["rotate"]],[Wa,{direction:Qe}],[Ga,{direction:Qe},["swipe"]],[wa],[wa,{event:"doubletap",taps:2},["tap"]],[Xo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ra=1,sl=2;function ts(he,Oe){this.options=Mt({},_a.defaults,Oe||{}),this.options.inputTarget=this.options.inputTarget||he,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=he,this.input=wr(this),this.touchAction=new Ii(this,this.options.touchAction),to(this,!0),zt(this.options.recognizers,function(gt){var fr=this.add(new gt[0](gt[1]));gt[2]&&fr.recognizeWith(gt[2]),gt[3]&&fr.requireFailure(gt[3])},this)}ts.prototype={set:function(he){return Mt(this.options,he),he.touchAction&&this.touchAction.update(),he.inputTarget&&(this.input.destroy(),this.input.target=he.inputTarget,this.input.init()),this},stop:function(he){this.session.stopped=he?sl:ra},recognize:function(he){var Oe=this.session;if(!Oe.stopped){this.touchAction.preventDefaults(he);var gt,fr=this.recognizers,tn=Oe.curRecognizer;(!tn||tn&&tn.state&za)&&(tn=Oe.curRecognizer=null);for(var kn=0;kn<fr.length;)gt=fr[kn],Oe.stopped!==sl&&(!tn||gt==tn||gt.canRecognizeWith(tn))?gt.recognize(he):gt.reset(),!tn&&gt.state&(Dn|ui|Vn)&&(tn=Oe.curRecognizer=gt),kn++}},get:function(he){if(he instanceof Na)return he;for(var Oe=this.recognizers,gt=0;gt<Oe.length;gt++)if(Oe[gt].options.event==he)return Oe[gt];return null},add:function(he){if(Ft(he,"add",this))return this;var Oe=this.get(he.options.event);return Oe&&this.remove(Oe),this.recognizers.push(he),he.manager=this,this.touchAction.update(),he},remove:function(he){if(Ft(he,"remove",this))return this;if(he=this.get(he),he){var Oe=this.recognizers,gt=ue(Oe,he);gt!==-1&&(Oe.splice(gt,1),this.touchAction.update())}return this},on:function(he,Oe){if(he!==L&&Oe!==L){var gt=this.handlers;return zt(re(he),function(fr){gt[fr]=gt[fr]||[],gt[fr].push(Oe)}),this}},off:function(he,Oe){if(he!==L){var gt=this.handlers;return zt(re(he),function(fr){Oe?gt[fr]&&gt[fr].splice(ue(gt[fr],Oe),1):delete gt[fr]}),this}},emit:function(he,Oe){this.options.domEvents&&Oa(he,Oe);var gt=this.handlers[he]&&this.handlers[he].slice();if(!(!gt||!gt.length)){Oe.type=he,Oe.preventDefault=function(){Oe.srcEvent.preventDefault()};for(var fr=0;fr<gt.length;)gt[fr](Oe),fr++}},destroy:function(){this.element&&to(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function to(he,Oe){var gt=he.element;if(!!gt.style){var fr;zt(he.options.cssProps,function(tn,kn){fr=ce(gt.style,kn),Oe?(he.oldCssProps[fr]=gt.style[fr],gt.style[fr]=tn):gt.style[fr]=he.oldCssProps[fr]||""}),Oe||(he.oldCssProps={})}}function Oa(he,Oe){var gt=p.createEvent("Event");gt.initEvent(he,!0,!0),gt.gesture=Oe,Oe.target.dispatchEvent(gt)}Mt(_a,{INPUT_START:be,INPUT_MOVE:De,INPUT_END:at,INPUT_CANCEL:kt,STATE_POSSIBLE:Rn,STATE_BEGAN:Dn,STATE_CHANGED:ui,STATE_ENDED:Vn,STATE_RECOGNIZED:za,STATE_CANCELLED:ds,STATE_FAILED:Di,DIRECTION_NONE:jt,DIRECTION_LEFT:w,DIRECTION_RIGHT:F,DIRECTION_UP:de,DIRECTION_DOWN:Ue,DIRECTION_HORIZONTAL:Qe,DIRECTION_VERTICAL:Tt,DIRECTION_ALL:Dt,Manager:ts,Input:$t,TouchAction:Ii,TouchInput:Ut,MouseInput:Ai,PointerEventInput:te,TouchMouseInput:mr,SingleTouchInput:ht,Recognizer:Na,AttrRecognizer:lo,Tap:wa,Pan:Ga,Swipe:Wa,Pinch:Ha,Rotate:oa,Press:Xo,on:Be,off:Ie,each:zt,merge:ot,extend:wt,assign:Mt,inherit:tt,bindFn:Yt,prefixed:ce});var fa=typeof b!="undefined"?b:typeof self!="undefined"?self:{};fa.Hammer=_a,G=function(){return _a}.call(C,y,C,ft),G!==L&&(ft.exports=G)})(window,document,"Hammer")},7375:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0});var y=Symbol.for("INJECTION");function G(X,N,q,K){function ae(){return K&&!Reflect.hasMetadata(y,this,N)&&Reflect.defineMetadata(y,q(),this,N),Reflect.hasMetadata(y,this,N)?Reflect.getMetadata(y,this,N):q()}function xe(se){Reflect.defineMetadata(y,se,this,N)}Object.defineProperty(X,N,{configurable:!0,enumerable:!0,get:ae,set:xe})}function b(X,N){return function(q){return function(K,ae){var xe=function(){return X.get(q)};G(K,ae,xe,N)}}}C.makePropertyInjectDecorator=b;function p(X,N){return function(q,K){return function(ae,xe){var se=function(){return X.getNamed(q,K)};G(ae,xe,se,N)}}}C.makePropertyInjectNamedDecorator=p;function S(X,N){return function(q,K,ae){return function(xe,se){var Ft=function(){return X.getTagged(q,K,ae)};G(xe,se,Ft,N)}}}C.makePropertyInjectTaggedDecorator=S;function L(X,N){return function(q){return function(K,ae){var xe=function(){return X.getAll(q)};G(K,ae,xe,N)}}}C.makePropertyMultiInjectDecorator=L},84879:function(ft,C,y){"use strict";var G;G={value:!0};var b=y(7375);function p(S,L){L===void 0&&(L=!0);var X=b.makePropertyInjectDecorator(S,L),N=b.makePropertyInjectNamedDecorator(S,L),q=b.makePropertyInjectTaggedDecorator(S,L),K=b.makePropertyMultiInjectDecorator(S,L);return{lazyInject:X,lazyInjectNamed:N,lazyInjectTagged:q,lazyMultiInject:K}}C.Z=p},99934:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.tagProperty=C.tagParameter=C.decorate=void 0;var G=y(16674),b=y(6867);function p(K,ae,xe,se){var Ft=b.TAGGED;L(Ft,K,ae,se,xe)}C.tagParameter=p;function S(K,ae,xe){var se=b.TAGGED_PROP;L(se,K.constructor,ae,xe)}C.tagProperty=S;function L(K,ae,xe,se,Ft){var zt={},Wt=typeof Ft=="number",Mt=Ft!==void 0&&Wt?Ft.toString():xe;if(Wt&&xe!==void 0)throw new Error(G.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(K,ae)&&(zt=Reflect.getMetadata(K,ae));var wt=zt[Mt];if(!Array.isArray(wt))wt=[];else for(var ot=0,tt=wt;ot<tt.length;ot++){var Yt=tt[ot];if(Yt.key===se.key)throw new Error(G.DUPLICATED_METADATA+" "+Yt.key.toString())}wt.push(se),zt[Mt]=wt,Reflect.defineMetadata(K,zt,ae)}function X(K,ae){Reflect.decorate(K,ae)}function N(K,ae){return function(xe,se){ae(xe,se,K)}}function q(K,ae,xe){typeof xe=="number"?X([N(xe,K)],ae):typeof xe=="string"?Reflect.decorate([K],ae,xe):X([K],ae)}C.decorate=q},5744:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.inject=C.LazyServiceIdentifer=void 0;var G=y(16674),b=y(6867),p=y(47738),S=y(99934),L=function(){function N(q){this._cb=q}return N.prototype.unwrap=function(){return this._cb()},N}();C.LazyServiceIdentifer=L;function X(N){return function(q,K,ae){if(N===void 0)throw new Error(G.UNDEFINED_INJECT_ANNOTATION(q.name));var xe=new p.Metadata(b.INJECT_TAG,N);typeof ae=="number"?S.tagParameter(q,K,ae,xe):S.tagProperty(q,K,xe)}}C.inject=X},64315:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.injectable=void 0;var G=y(16674),b=y(6867);function p(){return function(S){if(Reflect.hasOwnMetadata(b.PARAM_TYPES,S))throw new Error(G.DUPLICATED_INJECTABLE_DECORATOR);var L=Reflect.getMetadata(b.DESIGN_PARAM_TYPES,S)||[];return Reflect.defineMetadata(b.PARAM_TYPES,L,S),S}}C.injectable=p},71693:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.multiInject=void 0;var G=y(6867),b=y(47738),p=y(99934);function S(L){return function(X,N,q){var K=new b.Metadata(G.MULTI_INJECT_TAG,L);typeof q=="number"?p.tagParameter(X,N,q,K):p.tagProperty(X,N,K)}}C.multiInject=S},38085:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.named=void 0;var G=y(6867),b=y(47738),p=y(99934);function S(L){return function(X,N,q){var K=new b.Metadata(G.NAMED_TAG,L);typeof q=="number"?p.tagParameter(X,N,q,K):p.tagProperty(X,N,K)}}C.named=S},6515:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.optional=void 0;var G=y(6867),b=y(47738),p=y(99934);function S(){return function(L,X,N){var q=new b.Metadata(G.OPTIONAL_TAG,!0);typeof N=="number"?p.tagParameter(L,X,N,q):p.tagProperty(L,X,q)}}C.optional=S},7014:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.postConstruct=void 0;var G=y(16674),b=y(6867),p=y(47738);function S(){return function(L,X,N){var q=new p.Metadata(b.POST_CONSTRUCT,X);if(Reflect.hasOwnMetadata(b.POST_CONSTRUCT,L.constructor))throw new Error(G.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(b.POST_CONSTRUCT,q,L.constructor)}}C.postConstruct=S},32052:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.tagged=void 0;var G=y(47738),b=y(99934);function p(S,L){return function(X,N,q){var K=new G.Metadata(S,L);typeof q=="number"?b.tagParameter(X,N,q,K):b.tagProperty(X,N,K)}}C.tagged=p},55638:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.targetName=void 0;var G=y(6867),b=y(47738),p=y(99934);function S(L){return function(X,N,q){var K=new b.Metadata(G.NAME_TAG,L);p.tagParameter(X,N,q,K)}}C.targetName=S},86757:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.unmanaged=void 0;var G=y(6867),b=y(47738),p=y(99934);function S(){return function(L,X,N){var q=new b.Metadata(G.UNMANAGED_TAG,!0);p.tagParameter(L,X,N,q)}}C.unmanaged=S},44290:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.Binding=void 0;var G=y(28421),b=y(37791),p=function(){function S(L,X){this.id=b.id(),this.activated=!1,this.serviceIdentifier=L,this.scope=X,this.type=G.BindingTypeEnum.Invalid,this.constraint=function(N){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return S.prototype.clone=function(){var L=new S(this.serviceIdentifier,this.scope);return L.activated=L.scope===G.BindingScopeEnum.Singleton?this.activated:!1,L.implementationType=this.implementationType,L.dynamicValue=this.dynamicValue,L.scope=this.scope,L.type=this.type,L.factory=this.factory,L.provider=this.provider,L.constraint=this.constraint,L.onActivation=this.onActivation,L.cache=this.cache,L},S}();C.Binding=p},23184:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BindingCount=void 0;var y={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};C.BindingCount=y},16674:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.STACK_OVERFLOW=C.CIRCULAR_DEPENDENCY_IN_FACTORY=C.POST_CONSTRUCT_ERROR=C.MULTIPLE_POST_CONSTRUCT_METHODS=C.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=C.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=C.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=C.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=C.ARGUMENTS_LENGTH_MISMATCH=C.INVALID_DECORATOR_OPERATION=C.INVALID_TO_SELF_VALUE=C.INVALID_FUNCTION_BINDING=C.INVALID_MIDDLEWARE_RETURN=C.NO_MORE_SNAPSHOTS_AVAILABLE=C.INVALID_BINDING_TYPE=C.NOT_IMPLEMENTED=C.CIRCULAR_DEPENDENCY=C.UNDEFINED_INJECT_ANNOTATION=C.MISSING_INJECT_ANNOTATION=C.MISSING_INJECTABLE_ANNOTATION=C.NOT_REGISTERED=C.CANNOT_UNBIND=C.AMBIGUOUS_MATCH=C.KEY_NOT_FOUND=C.NULL_ARGUMENT=C.DUPLICATED_METADATA=C.DUPLICATED_INJECTABLE_DECORATOR=void 0,C.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",C.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",C.NULL_ARGUMENT="NULL argument",C.KEY_NOT_FOUND="Key Not Found",C.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",C.CANNOT_UNBIND="Could not unbind serviceIdentifier:",C.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",C.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",C.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var y=function(S){return"@inject called with undefined this could mean that the class "+S+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};C.UNDEFINED_INJECT_ANNOTATION=y,C.CIRCULAR_DEPENDENCY="Circular dependency found:",C.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",C.INVALID_BINDING_TYPE="Invalid binding type:",C.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",C.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",C.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",C.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",C.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var G=function(){for(var S=[],L=0;L<arguments.length;L++)S[L]=arguments[L];return"The number of constructor arguments in the derived class "+(S[0]+" must be >= than the number of constructor arguments of its base class.")};C.ARGUMENTS_LENGTH_MISMATCH=G,C.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",C.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",C.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",C.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",C.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var b=function(){for(var S=[],L=0;L<arguments.length;L++)S[L]=arguments[L];return"@postConstruct error in class "+S[0]+": "+S[1]};C.POST_CONSTRUCT_ERROR=b;var p=function(){for(var S=[],L=0;L<arguments.length;L++)S[L]=arguments[L];return"It looks like there is a circular dependency "+("in one of the '"+S[0]+"' bindings. Please investigate bindings with")+("service identifier '"+S[1]+"'.")};C.CIRCULAR_DEPENDENCY_IN_FACTORY=p,C.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.TargetTypeEnum=C.BindingTypeEnum=C.BindingScopeEnum=void 0;var y={Request:"Request",Singleton:"Singleton",Transient:"Transient"};C.BindingScopeEnum=y;var G={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};C.BindingTypeEnum=G;var b={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};C.TargetTypeEnum=b},6867:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.NON_CUSTOM_TAG_KEYS=C.POST_CONSTRUCT=C.DESIGN_PARAM_TYPES=C.PARAM_TYPES=C.TAGGED_PROP=C.TAGGED=C.MULTI_INJECT_TAG=C.INJECT_TAG=C.OPTIONAL_TAG=C.UNMANAGED_TAG=C.NAME_TAG=C.NAMED_TAG=void 0,C.NAMED_TAG="named",C.NAME_TAG="name",C.UNMANAGED_TAG="unmanaged",C.OPTIONAL_TAG="optional",C.INJECT_TAG="inject",C.MULTI_INJECT_TAG="multi_inject",C.TAGGED="inversify:tagged",C.TAGGED_PROP="inversify:tagged_props",C.PARAM_TYPES="inversify:paramtypes",C.DESIGN_PARAM_TYPES="design:paramtypes",C.POST_CONSTRUCT="post_construct";function y(){return[C.INJECT_TAG,C.MULTI_INJECT_TAG,C.NAME_TAG,C.UNMANAGED_TAG,C.NAMED_TAG,C.OPTIONAL_TAG]}C.NON_CUSTOM_TAG_KEYS=y()},51389:function(ft,C,y){"use strict";var G=this&&this.__awaiter||function(wt,ot,tt,Yt){function ke(Ne){return Ne instanceof tt?Ne:new tt(function(Be){Be(Ne)})}return new(tt||(tt=Promise))(function(Ne,Be){function Ie(re){try{oe(Yt.next(re))}catch(ue){Be(ue)}}function pt(re){try{oe(Yt.throw(re))}catch(ue){Be(ue)}}function oe(re){re.done?Ne(re.value):ke(re.value).then(Ie,pt)}oe((Yt=Yt.apply(wt,ot||[])).next())})},b=this&&this.__generator||function(wt,ot){var tt={label:0,sent:function(){if(Ne[0]&1)throw Ne[1];return Ne[1]},trys:[],ops:[]},Yt,ke,Ne,Be;return Be={next:Ie(0),throw:Ie(1),return:Ie(2)},typeof Symbol=="function"&&(Be[Symbol.iterator]=function(){return this}),Be;function Ie(oe){return function(re){return pt([oe,re])}}function pt(oe){if(Yt)throw new TypeError("Generator is already executing.");for(;tt;)try{if(Yt=1,ke&&(Ne=oe[0]&2?ke.return:oe[0]?ke.throw||((Ne=ke.return)&&Ne.call(ke),0):ke.next)&&!(Ne=Ne.call(ke,oe[1])).done)return Ne;switch(ke=0,Ne&&(oe=[oe[0]&2,Ne.value]),oe[0]){case 0:case 1:Ne=oe;break;case 4:return tt.label++,{value:oe[1],done:!1};case 5:tt.label++,ke=oe[1],oe=[0];continue;case 7:oe=tt.ops.pop(),tt.trys.pop();continue;default:if(Ne=tt.trys,!(Ne=Ne.length>0&&Ne[Ne.length-1])&&(oe[0]===6||oe[0]===2)){tt=0;continue}if(oe[0]===3&&(!Ne||oe[1]>Ne[0]&&oe[1]<Ne[3])){tt.label=oe[1];break}if(oe[0]===6&&tt.label<Ne[1]){tt.label=Ne[1],Ne=oe;break}if(Ne&&tt.label<Ne[2]){tt.label=Ne[2],tt.ops.push(oe);break}Ne[2]&&tt.ops.pop(),tt.trys.pop();continue}oe=ot.call(wt,tt)}catch(re){oe=[6,re],ke=0}finally{Yt=Ne=0}if(oe[0]&5)throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(wt,ot){for(var tt=0,Yt=ot.length,ke=wt.length;tt<Yt;tt++,ke++)wt[ke]=ot[tt];return wt};Object.defineProperty(C,"__esModule",{value:!0}),C.Container=void 0;var S=y(44290),L=y(16674),X=y(28421),N=y(6867),q=y(51377),K=y(86311),ae=y(31927),xe=y(15451),se=y(37791),Ft=y(55800),zt=y(85700),Wt=y(80175),Mt=function(){function wt(ot){this._appliedMiddleware=[];var tt=ot||{};if(typeof tt!="object")throw new Error(""+L.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(tt.defaultScope===void 0)tt.defaultScope=X.BindingScopeEnum.Transient;else if(tt.defaultScope!==X.BindingScopeEnum.Singleton&&tt.defaultScope!==X.BindingScopeEnum.Transient&&tt.defaultScope!==X.BindingScopeEnum.Request)throw new Error(""+L.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(tt.autoBindInjectable===void 0)tt.autoBindInjectable=!1;else if(typeof tt.autoBindInjectable!="boolean")throw new Error(""+L.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(tt.skipBaseClassChecks===void 0)tt.skipBaseClassChecks=!1;else if(typeof tt.skipBaseClassChecks!="boolean")throw new Error(""+L.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:tt.autoBindInjectable,defaultScope:tt.defaultScope,skipBaseClassChecks:tt.skipBaseClassChecks},this.id=se.id(),this._bindingDictionary=new Wt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new q.MetadataReader}return wt.merge=function(ot,tt){for(var Yt=[],ke=2;ke<arguments.length;ke++)Yt[ke-2]=arguments[ke];var Ne=new wt,Be=p([ot,tt],Yt).map(function(oe){return K.getBindingDictionary(oe)}),Ie=K.getBindingDictionary(Ne);function pt(oe,re){oe.traverse(function(ue,it){it.forEach(function(Jt){re.add(Jt.serviceIdentifier,Jt.clone())})})}return Be.forEach(function(oe){pt(oe,Ie)}),Ne},wt.prototype.load=function(){for(var ot=[],tt=0;tt<arguments.length;tt++)ot[tt]=arguments[tt];for(var Yt=this._getContainerModuleHelpersFactory(),ke=0,Ne=ot;ke<Ne.length;ke++){var Be=Ne[ke],Ie=Yt(Be.id);Be.registry(Ie.bindFunction,Ie.unbindFunction,Ie.isboundFunction,Ie.rebindFunction)}},wt.prototype.loadAsync=function(){for(var ot=[],tt=0;tt<arguments.length;tt++)ot[tt]=arguments[tt];return G(this,void 0,void 0,function(){var Yt,ke,Ne,Be,Ie;return b(this,function(pt){switch(pt.label){case 0:Yt=this._getContainerModuleHelpersFactory(),ke=0,Ne=ot,pt.label=1;case 1:return ke<Ne.length?(Be=Ne[ke],Ie=Yt(Be.id),[4,Be.registry(Ie.bindFunction,Ie.unbindFunction,Ie.isboundFunction,Ie.rebindFunction)]):[3,4];case 2:pt.sent(),pt.label=3;case 3:return ke++,[3,1];case 4:return[2]}})})},wt.prototype.unload=function(){for(var ot=this,tt=[],Yt=0;Yt<arguments.length;Yt++)tt[Yt]=arguments[Yt];var ke=function(Ne){return function(Be){return Be.moduleId===Ne}};tt.forEach(function(Ne){var Be=ke(Ne.id);ot._bindingDictionary.removeByCondition(Be)})},wt.prototype.bind=function(ot){var tt=this.options.defaultScope||X.BindingScopeEnum.Transient,Yt=new S.Binding(ot,tt);return this._bindingDictionary.add(ot,Yt),new xe.BindingToSyntax(Yt)},wt.prototype.rebind=function(ot){return this.unbind(ot),this.bind(ot)},wt.prototype.unbind=function(ot){try{this._bindingDictionary.remove(ot)}catch(tt){throw new Error(L.CANNOT_UNBIND+" "+Ft.getServiceIdentifierAsString(ot))}},wt.prototype.unbindAll=function(){this._bindingDictionary=new Wt.Lookup},wt.prototype.isBound=function(ot){var tt=this._bindingDictionary.hasKey(ot);return!tt&&this.parent&&(tt=this.parent.isBound(ot)),tt},wt.prototype.isBoundNamed=function(ot,tt){return this.isBoundTagged(ot,N.NAMED_TAG,tt)},wt.prototype.isBoundTagged=function(ot,tt,Yt){var ke=!1;if(this._bindingDictionary.hasKey(ot)){var Ne=this._bindingDictionary.get(ot),Be=K.createMockRequest(this,ot,tt,Yt);ke=Ne.some(function(Ie){return Ie.constraint(Be)})}return!ke&&this.parent&&(ke=this.parent.isBoundTagged(ot,tt,Yt)),ke},wt.prototype.snapshot=function(){this._snapshots.push(zt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},wt.prototype.restore=function(){var ot=this._snapshots.pop();if(ot===void 0)throw new Error(L.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ot.bindings,this._middleware=ot.middleware},wt.prototype.createChild=function(ot){var tt=new wt(ot||this.options);return tt.parent=this,tt},wt.prototype.applyMiddleware=function(){for(var ot=[],tt=0;tt<arguments.length;tt++)ot[tt]=arguments[tt];this._appliedMiddleware=this._appliedMiddleware.concat(ot);var Yt=this._middleware?this._middleware:this._planAndResolve();this._middleware=ot.reduce(function(ke,Ne){return Ne(ke)},Yt)},wt.prototype.applyCustomMetadataReader=function(ot){this._metadataReader=ot},wt.prototype.get=function(ot){return this._get(!1,!1,X.TargetTypeEnum.Variable,ot)},wt.prototype.getTagged=function(ot,tt,Yt){return this._get(!1,!1,X.TargetTypeEnum.Variable,ot,tt,Yt)},wt.prototype.getNamed=function(ot,tt){return this.getTagged(ot,N.NAMED_TAG,tt)},wt.prototype.getAll=function(ot){return this._get(!0,!0,X.TargetTypeEnum.Variable,ot)},wt.prototype.getAllTagged=function(ot,tt,Yt){return this._get(!1,!0,X.TargetTypeEnum.Variable,ot,tt,Yt)},wt.prototype.getAllNamed=function(ot,tt){return this.getAllTagged(ot,N.NAMED_TAG,tt)},wt.prototype.resolve=function(ot){var tt=this.createChild();return tt.bind(ot).toSelf(),this._appliedMiddleware.forEach(function(Yt){tt.applyMiddleware(Yt)}),tt.get(ot)},wt.prototype._getContainerModuleHelpersFactory=function(){var ot=this,tt=function(Ie,pt){Ie._binding.moduleId=pt},Yt=function(Ie){return function(pt){var oe=ot.bind.bind(ot),re=oe(pt);return tt(re,Ie),re}},ke=function(Ie){return function(pt){var oe=ot.unbind.bind(ot);oe(pt)}},Ne=function(Ie){return function(pt){var oe=ot.isBound.bind(ot);return oe(pt)}},Be=function(Ie){return function(pt){var oe=ot.rebind.bind(ot),re=oe(pt);return tt(re,Ie),re}};return function(Ie){return{bindFunction:Yt(Ie),isboundFunction:Ne(Ie),rebindFunction:Be(Ie),unbindFunction:ke(Ie)}}},wt.prototype._get=function(ot,tt,Yt,ke,Ne,Be){var Ie=null,pt={avoidConstraints:ot,contextInterceptor:function(oe){return oe},isMultiInject:tt,key:Ne,serviceIdentifier:ke,targetType:Yt,value:Be};if(this._middleware){if(Ie=this._middleware(pt),Ie==null)throw new Error(L.INVALID_MIDDLEWARE_RETURN)}else Ie=this._planAndResolve()(pt);return Ie},wt.prototype._planAndResolve=function(){var ot=this;return function(tt){var Yt=K.plan(ot._metadataReader,ot,tt.isMultiInject,tt.targetType,tt.serviceIdentifier,tt.key,tt.value,tt.avoidConstraints);Yt=tt.contextInterceptor(Yt);var ke=ae.resolve(Yt);return ke}},wt}();C.Container=Mt},33244:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.AsyncContainerModule=C.ContainerModule=void 0;var G=y(37791),b=function(){function S(L){this.id=G.id(),this.registry=L}return S}();C.ContainerModule=b;var p=function(){function S(L){this.id=G.id(),this.registry=L}return S}();C.AsyncContainerModule=p},85700:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.ContainerSnapshot=void 0;var y=function(){function G(){}return G.of=function(b,p){var S=new G;return S.bindings=b,S.middleware=p,S},G}();C.ContainerSnapshot=y},80175:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.Lookup=void 0;var G=y(16674),b=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(S,L){if(S==null)throw new Error(G.NULL_ARGUMENT);if(L==null)throw new Error(G.NULL_ARGUMENT);var X=this._map.get(S);X!==void 0?(X.push(L),this._map.set(S,X)):this._map.set(S,[L])},p.prototype.get=function(S){if(S==null)throw new Error(G.NULL_ARGUMENT);var L=this._map.get(S);if(L!==void 0)return L;throw new Error(G.KEY_NOT_FOUND)},p.prototype.remove=function(S){if(S==null)throw new Error(G.NULL_ARGUMENT);if(!this._map.delete(S))throw new Error(G.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(S){var L=this;this._map.forEach(function(X,N){var q=X.filter(function(K){return!S(K)});q.length>0?L._map.set(N,q):L._map.delete(N)})},p.prototype.hasKey=function(S){if(S==null)throw new Error(G.NULL_ARGUMENT);return this._map.has(S)},p.prototype.clone=function(){var S=new p;return this._map.forEach(function(L,X){L.forEach(function(N){return S.add(X,N.clone())})}),S},p.prototype.traverse=function(S){this._map.forEach(function(L,X){S(X,L)})},p}();C.Lookup=b},86700:function(ft,C,y){"use strict";var G;G={value:!0},G=G=G=G=G=G=C.GW=G=G=C.zY=G=G=G=G=G=C.f3=G=G=C.b2=G=G=G=G=G=C.W2=G=void 0;var b=y(6867);G=b;var p=y(51389);Object.defineProperty(C,"W2",{enumerable:!0,get:function(){return p.Container}});var S=y(28421);G={enumerable:!0,get:function(){return S.BindingScopeEnum}},G={enumerable:!0,get:function(){return S.BindingTypeEnum}},G={enumerable:!0,get:function(){return S.TargetTypeEnum}};var L=y(33244);G={enumerable:!0,get:function(){return L.AsyncContainerModule}},G={enumerable:!0,get:function(){return L.ContainerModule}};var X=y(64315);Object.defineProperty(C,"b2",{enumerable:!0,get:function(){return X.injectable}});var N=y(32052);G={enumerable:!0,get:function(){return N.tagged}};var q=y(38085);G={enumerable:!0,get:function(){return q.named}};var K=y(5744);Object.defineProperty(C,"f3",{enumerable:!0,get:function(){return K.inject}}),G={enumerable:!0,get:function(){return K.LazyServiceIdentifer}};var ae=y(6515);G={enumerable:!0,get:function(){return ae.optional}};var xe=y(86757);G={enumerable:!0,get:function(){return xe.unmanaged}};var se=y(71693);G={enumerable:!0,get:function(){return se.multiInject}};var Ft=y(55638);G={enumerable:!0,get:function(){return Ft.targetName}};var zt=y(7014);Object.defineProperty(C,"zY",{enumerable:!0,get:function(){return zt.postConstruct}});var Wt=y(51377);G={enumerable:!0,get:function(){return Wt.MetadataReader}};var Mt=y(37791);G={enumerable:!0,get:function(){return Mt.id}};var wt=y(99934);Object.defineProperty(C,"GW",{enumerable:!0,get:function(){return wt.decorate}});var ot=y(80758);G={enumerable:!0,get:function(){return ot.traverseAncerstors}},G={enumerable:!0,get:function(){return ot.taggedConstraint}},G={enumerable:!0,get:function(){return ot.namedConstraint}},G={enumerable:!0,get:function(){return ot.typeConstraint}};var tt=y(55800);G={enumerable:!0,get:function(){return tt.getServiceIdentifierAsString}};var Yt=y(70600);G={enumerable:!0,get:function(){return Yt.multiBindToService}}},95228:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.Context=void 0;var G=y(37791),b=function(){function p(S){this.id=G.id(),this.container=S}return p.prototype.addPlan=function(S){this.plan=S},p.prototype.setCurrentRequest=function(S){this.currentRequest=S},p}();C.Context=b},47738:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.Metadata=void 0;var G=y(6867),b=function(){function p(S,L){this.key=S,this.value=L}return p.prototype.toString=function(){return this.key===G.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();C.Metadata=b},51377:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.MetadataReader=void 0;var G=y(6867),b=function(){function p(){}return p.prototype.getConstructorMetadata=function(S){var L=Reflect.getMetadata(G.PARAM_TYPES,S),X=Reflect.getMetadata(G.TAGGED,S);return{compilerGeneratedMetadata:L,userGeneratedMetadata:X||{}}},p.prototype.getPropertiesMetadata=function(S){var L=Reflect.getMetadata(G.TAGGED_PROP,S)||[];return L},p}();C.MetadataReader=b},55314:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.Plan=void 0;var y=function(){function G(b,p){this.parentContext=b,this.rootRequest=p}return G}();C.Plan=y},86311:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.getBindingDictionary=C.createMockRequest=C.plan=void 0;var G=y(23184),b=y(16674),p=y(28421),S=y(6867),L=y(85265),X=y(55800),N=y(95228),q=y(47738),K=y(55314),ae=y(6e3),xe=y(6748),se=y(18924);function Ft(ke){return ke._bindingDictionary}C.getBindingDictionary=Ft;function zt(ke,Ne,Be,Ie,pt,oe){var re=ke?S.MULTI_INJECT_TAG:S.INJECT_TAG,ue=new q.Metadata(re,Be),it=new se.Target(Ne,Ie,Be,ue);if(pt!==void 0){var Jt=new q.Metadata(pt,oe);it.metadata.push(Jt)}return it}function Wt(ke,Ne,Be,Ie,pt){var oe=ot(Be.container,pt.serviceIdentifier),re=[];return oe.length===G.BindingCount.NoBindingsAvailable&&Be.container.options.autoBindInjectable&&typeof pt.serviceIdentifier=="function"&&ke.getConstructorMetadata(pt.serviceIdentifier).compilerGeneratedMetadata&&(Be.container.bind(pt.serviceIdentifier).toSelf(),oe=ot(Be.container,pt.serviceIdentifier)),Ne?re=oe:re=oe.filter(function(ue){var it=new xe.Request(ue.serviceIdentifier,Be,Ie,ue,pt);return ue.constraint(it)}),Mt(pt.serviceIdentifier,re,pt,Be.container),re}function Mt(ke,Ne,Be,Ie){switch(Ne.length){case G.BindingCount.NoBindingsAvailable:if(Be.isOptional())return Ne;var pt=X.getServiceIdentifierAsString(ke),oe=b.NOT_REGISTERED;throw oe+=X.listMetadataForTarget(pt,Be),oe+=X.listRegisteredBindingsForServiceIdentifier(Ie,pt,ot),new Error(oe);case G.BindingCount.OnlyOneBindingAvailable:if(!Be.isArray())return Ne;case G.BindingCount.MultipleBindingsAvailable:default:if(Be.isArray())return Ne;var pt=X.getServiceIdentifierAsString(ke),oe=b.AMBIGUOUS_MATCH+" "+pt;throw oe+=X.listRegisteredBindingsForServiceIdentifier(Ie,pt,ot),new Error(oe)}}function wt(ke,Ne,Be,Ie,pt,oe){var re,ue;if(pt===null){re=Wt(ke,Ne,Ie,null,oe),ue=new xe.Request(Be,Ie,null,re,oe);var it=new K.Plan(Ie,ue);Ie.addPlan(it)}else re=Wt(ke,Ne,Ie,pt,oe),ue=pt.addChildRequest(oe.serviceIdentifier,re,oe);re.forEach(function(Jt){var ce=null;if(oe.isArray())ce=ue.addChildRequest(Jt.serviceIdentifier,Jt,oe);else{if(Jt.cache)return;ce=ue}if(Jt.type===p.BindingTypeEnum.Instance&&Jt.implementationType!==null){var $e=ae.getDependencies(ke,Jt.implementationType);if(!Ie.container.options.skipBaseClassChecks){var Ae=ae.getBaseClassDependencyCount(ke,Jt.implementationType);if($e.length<Ae){var Ce=b.ARGUMENTS_LENGTH_MISMATCH(ae.getFunctionName(Jt.implementationType));throw new Error(Ce)}}$e.forEach(function(Pe){wt(ke,!1,Pe.serviceIdentifier,Ie,ce,Pe)})}})}function ot(ke,Ne){var Be=[],Ie=Ft(ke);return Ie.hasKey(Ne)?Be=Ie.get(Ne):ke.parent!==null&&(Be=ot(ke.parent,Ne)),Be}function tt(ke,Ne,Be,Ie,pt,oe,re,ue){ue===void 0&&(ue=!1);var it=new N.Context(Ne),Jt=zt(Be,Ie,pt,"",oe,re);try{return wt(ke,ue,pt,it,null,Jt),it}catch(ce){throw L.isStackOverflowExeption(ce)&&it.plan&&X.circularDependencyToException(it.plan.rootRequest),ce}}C.plan=tt;function Yt(ke,Ne,Be,Ie){var pt=new se.Target(p.TargetTypeEnum.Variable,"",Ne,new q.Metadata(Be,Ie)),oe=new N.Context(ke),re=new xe.Request(Ne,oe,null,[],pt);return re}C.createMockRequest=Yt},88460:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.QueryableString=void 0;var y=function(){function G(b){this.str=b}return G.prototype.startsWith=function(b){return this.str.indexOf(b)===0},G.prototype.endsWith=function(b){var p="",S=b.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},S)},G.prototype.contains=function(b){return this.str.indexOf(b)!==-1},G.prototype.equals=function(b){return this.str===b},G.prototype.value=function(){return this.str},G}();C.QueryableString=y},6e3:function(ft,C,y){"use strict";var G=this&&this.__spreadArray||function(Wt,Mt){for(var wt=0,ot=Mt.length,tt=Wt.length;wt<ot;wt++,tt++)Wt[tt]=Mt[wt];return Wt};Object.defineProperty(C,"__esModule",{value:!0}),C.getFunctionName=C.getBaseClassDependencyCount=C.getDependencies=void 0;var b=y(5744),p=y(16674),S=y(28421),L=y(6867),X=y(55800);Object.defineProperty(C,"getFunctionName",{enumerable:!0,get:function(){return X.getFunctionName}});var N=y(18924);function q(Wt,Mt){var wt=X.getFunctionName(Mt),ot=K(Wt,wt,Mt,!1);return ot}C.getDependencies=q;function K(Wt,Mt,wt,ot){var tt=Wt.getConstructorMetadata(wt),Yt=tt.compilerGeneratedMetadata;if(Yt===void 0){var ke=p.MISSING_INJECTABLE_ANNOTATION+" "+Mt+".";throw new Error(ke)}var Ne=tt.userGeneratedMetadata,Be=Object.keys(Ne),Ie=wt.length===0&&Be.length>0,pt=Be.length>wt.length,oe=Ie||pt?Be.length:wt.length,re=xe(ot,Mt,Yt,Ne,oe),ue=se(Wt,wt),it=G(G([],re),ue);return it}function ae(Wt,Mt,wt,ot,tt){var Yt=tt[Wt.toString()]||[],ke=zt(Yt),Ne=ke.unmanaged!==!0,Be=ot[Wt],Ie=ke.inject||ke.multiInject;if(Be=Ie||Be,Be instanceof b.LazyServiceIdentifer&&(Be=Be.unwrap()),Ne){var pt=Be===Object,oe=Be===Function,re=Be===void 0,ue=pt||oe||re;if(!Mt&&ue){var it=p.MISSING_INJECT_ANNOTATION+" argument "+Wt+" in class "+wt+".";throw new Error(it)}var Jt=new N.Target(S.TargetTypeEnum.ConstructorArgument,ke.targetName,Be);return Jt.metadata=Yt,Jt}return null}function xe(Wt,Mt,wt,ot,tt){for(var Yt=[],ke=0;ke<tt;ke++){var Ne=ke,Be=ae(Ne,Wt,Mt,wt,ot);Be!==null&&Yt.push(Be)}return Yt}function se(Wt,Mt){for(var wt=Wt.getPropertiesMetadata(Mt),ot=[],tt=Object.keys(wt),Yt=0,ke=tt;Yt<ke.length;Yt++){var Ne=ke[Yt],Be=wt[Ne],Ie=zt(wt[Ne]),pt=Ie.targetName||Ne,oe=Ie.inject||Ie.multiInject,re=new N.Target(S.TargetTypeEnum.ClassProperty,pt,oe);re.metadata=Be,ot.push(re)}var ue=Object.getPrototypeOf(Mt.prototype).constructor;if(ue!==Object){var it=se(Wt,ue);ot=G(G([],ot),it)}return ot}function Ft(Wt,Mt){var wt=Object.getPrototypeOf(Mt.prototype).constructor;if(wt!==Object){var ot=X.getFunctionName(wt),tt=K(Wt,ot,wt,!0),Yt=tt.map(function(Be){return Be.metadata.filter(function(Ie){return Ie.key===L.UNMANAGED_TAG})}),ke=[].concat.apply([],Yt).length,Ne=tt.length-ke;return Ne>0?Ne:Ft(Wt,wt)}else return 0}C.getBaseClassDependencyCount=Ft;function zt(Wt){var Mt={};return Wt.forEach(function(wt){Mt[wt.key.toString()]=wt.value}),{inject:Mt[L.INJECT_TAG],multiInject:Mt[L.MULTI_INJECT_TAG],targetName:Mt[L.NAME_TAG],unmanaged:Mt[L.UNMANAGED_TAG]}}},6748:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.Request=void 0;var G=y(37791),b=function(){function p(S,L,X,N,q){this.id=G.id(),this.serviceIdentifier=S,this.parentContext=L,this.parentRequest=X,this.target=q,this.childRequests=[],this.bindings=Array.isArray(N)?N:[N],this.requestScope=X===null?new Map:null}return p.prototype.addChildRequest=function(S,L,X){var N=new p(S,this.parentContext,this,L,X);return this.childRequests.push(N),N},p}();C.Request=b},18924:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.Target=void 0;var G=y(6867),b=y(37791),p=y(47738),S=y(88460),L=function(){function X(N,q,K,ae){this.id=b.id(),this.type=N,this.serviceIdentifier=K,this.name=new S.QueryableString(q||""),this.metadata=new Array;var xe=null;typeof ae=="string"?xe=new p.Metadata(G.NAMED_TAG,ae):ae instanceof p.Metadata&&(xe=ae),xe!==null&&this.metadata.push(xe)}return X.prototype.hasTag=function(N){for(var q=0,K=this.metadata;q<K.length;q++){var ae=K[q];if(ae.key===N)return!0}return!1},X.prototype.isArray=function(){return this.hasTag(G.MULTI_INJECT_TAG)},X.prototype.matchesArray=function(N){return this.matchesTag(G.MULTI_INJECT_TAG)(N)},X.prototype.isNamed=function(){return this.hasTag(G.NAMED_TAG)},X.prototype.isTagged=function(){return this.metadata.some(function(N){return G.NON_CUSTOM_TAG_KEYS.every(function(q){return N.key!==q})})},X.prototype.isOptional=function(){return this.matchesTag(G.OPTIONAL_TAG)(!0)},X.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(N){return N.key===G.NAMED_TAG})[0]:null},X.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(N){return G.NON_CUSTOM_TAG_KEYS.every(function(q){return N.key!==q})}):null},X.prototype.matchesNamedTag=function(N){return this.matchesTag(G.NAMED_TAG)(N)},X.prototype.matchesTag=function(N){var q=this;return function(K){for(var ae=0,xe=q.metadata;ae<xe.length;ae++){var se=xe[ae];if(se.key===N&&se.value===K)return!0}return!1}},X}();C.Target=L},52279:function(ft,C,y){"use strict";var G=this&&this.__spreadArray||function(K,ae){for(var xe=0,se=ae.length,Ft=K.length;xe<se;xe++,Ft++)K[Ft]=ae[xe];return K};Object.defineProperty(C,"__esModule",{value:!0}),C.resolveInstance=void 0;var b=y(16674),p=y(28421),S=y(6867);function L(K,ae,xe){var se=ae.filter(function(zt){return zt.target!==null&&zt.target.type===p.TargetTypeEnum.ClassProperty}),Ft=se.map(xe);return se.forEach(function(zt,Wt){var Mt="";Mt=zt.target.name.value();var wt=Ft[Wt];K[Mt]=wt}),K}function X(K,ae){return new(K.bind.apply(K,G([void 0],ae)))}function N(K,ae){if(Reflect.hasMetadata(S.POST_CONSTRUCT,K)){var xe=Reflect.getMetadata(S.POST_CONSTRUCT,K);try{ae[xe.value]()}catch(se){throw new Error(b.POST_CONSTRUCT_ERROR(K.name,se.message))}}}function q(K,ae,xe){var se=null;if(ae.length>0){var Ft=ae.filter(function(Wt){return Wt.target!==null&&Wt.target.type===p.TargetTypeEnum.ConstructorArgument}),zt=Ft.map(xe);se=X(K,zt),se=L(se,ae,xe)}else se=new K;return N(K,se),se}C.resolveInstance=q},31927:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.resolve=void 0;var G=y(16674),b=y(28421),p=y(85265),S=y(55800),L=y(52279),X=function(K,ae,xe){try{return xe()}catch(se){throw p.isStackOverflowExeption(se)?new Error(G.CIRCULAR_DEPENDENCY_IN_FACTORY(K,ae.toString())):se}},N=function(K){return function(ae){ae.parentContext.setCurrentRequest(ae);var xe=ae.bindings,se=ae.childRequests,Ft=ae.target&&ae.target.isArray(),zt=!ae.parentRequest||!ae.parentRequest.target||!ae.target||!ae.parentRequest.target.matchesArray(ae.target.serviceIdentifier);if(Ft&&zt)return se.map(function(Yt){var ke=N(K);return ke(Yt)});var Wt=null;if(ae.target.isOptional()&&xe.length===0)return;var Mt=xe[0],wt=Mt.scope===b.BindingScopeEnum.Singleton,ot=Mt.scope===b.BindingScopeEnum.Request;if(wt&&Mt.activated)return Mt.cache;if(ot&&K!==null&&K.has(Mt.id))return K.get(Mt.id);if(Mt.type===b.BindingTypeEnum.ConstantValue)Wt=Mt.cache,Mt.activated=!0;else if(Mt.type===b.BindingTypeEnum.Function)Wt=Mt.cache,Mt.activated=!0;else if(Mt.type===b.BindingTypeEnum.Constructor)Wt=Mt.implementationType;else if(Mt.type===b.BindingTypeEnum.DynamicValue&&Mt.dynamicValue!==null)Wt=X("toDynamicValue",Mt.serviceIdentifier,function(){return Mt.dynamicValue(ae.parentContext)});else if(Mt.type===b.BindingTypeEnum.Factory&&Mt.factory!==null)Wt=X("toFactory",Mt.serviceIdentifier,function(){return Mt.factory(ae.parentContext)});else if(Mt.type===b.BindingTypeEnum.Provider&&Mt.provider!==null)Wt=X("toProvider",Mt.serviceIdentifier,function(){return Mt.provider(ae.parentContext)});else if(Mt.type===b.BindingTypeEnum.Instance&&Mt.implementationType!==null)Wt=L.resolveInstance(Mt.implementationType,se,N(K));else{var tt=S.getServiceIdentifierAsString(ae.serviceIdentifier);throw new Error(G.INVALID_BINDING_TYPE+" "+tt)}return typeof Mt.onActivation=="function"&&(Wt=Mt.onActivation(ae.parentContext,Wt)),wt&&(Mt.cache=Wt,Mt.activated=!0),ot&&K!==null&&!K.has(Mt.id)&&K.set(Mt.id,Wt),Wt}};function q(K){var ae=N(K.plan.rootRequest.requestScope);return ae(K.plan.rootRequest)}C.resolve=q},83366:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BindingInSyntax=void 0;var G=y(28421),b=y(71325),p=function(){function S(L){this._binding=L}return S.prototype.inRequestScope=function(){return this._binding.scope=G.BindingScopeEnum.Request,new b.BindingWhenOnSyntax(this._binding)},S.prototype.inSingletonScope=function(){return this._binding.scope=G.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},S.prototype.inTransientScope=function(){return this._binding.scope=G.BindingScopeEnum.Transient,new b.BindingWhenOnSyntax(this._binding)},S}();C.BindingInSyntax=p},74889:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BindingInWhenOnSyntax=void 0;var G=y(83366),b=y(51811),p=y(98370),S=function(){function L(X){this._binding=X,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new b.BindingOnSyntax(this._binding),this._bindingInSyntax=new G.BindingInSyntax(X)}return L.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},L.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},L.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},L.prototype.when=function(X){return this._bindingWhenSyntax.when(X)},L.prototype.whenTargetNamed=function(X){return this._bindingWhenSyntax.whenTargetNamed(X)},L.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},L.prototype.whenTargetTagged=function(X,N){return this._bindingWhenSyntax.whenTargetTagged(X,N)},L.prototype.whenInjectedInto=function(X){return this._bindingWhenSyntax.whenInjectedInto(X)},L.prototype.whenParentNamed=function(X){return this._bindingWhenSyntax.whenParentNamed(X)},L.prototype.whenParentTagged=function(X,N){return this._bindingWhenSyntax.whenParentTagged(X,N)},L.prototype.whenAnyAncestorIs=function(X){return this._bindingWhenSyntax.whenAnyAncestorIs(X)},L.prototype.whenNoAncestorIs=function(X){return this._bindingWhenSyntax.whenNoAncestorIs(X)},L.prototype.whenAnyAncestorNamed=function(X){return this._bindingWhenSyntax.whenAnyAncestorNamed(X)},L.prototype.whenAnyAncestorTagged=function(X,N){return this._bindingWhenSyntax.whenAnyAncestorTagged(X,N)},L.prototype.whenNoAncestorNamed=function(X){return this._bindingWhenSyntax.whenNoAncestorNamed(X)},L.prototype.whenNoAncestorTagged=function(X,N){return this._bindingWhenSyntax.whenNoAncestorTagged(X,N)},L.prototype.whenAnyAncestorMatches=function(X){return this._bindingWhenSyntax.whenAnyAncestorMatches(X)},L.prototype.whenNoAncestorMatches=function(X){return this._bindingWhenSyntax.whenNoAncestorMatches(X)},L.prototype.onActivation=function(X){return this._bindingOnSyntax.onActivation(X)},L}();C.BindingInWhenOnSyntax=S},51811:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BindingOnSyntax=void 0;var G=y(98370),b=function(){function p(S){this._binding=S}return p.prototype.onActivation=function(S){return this._binding.onActivation=S,new G.BindingWhenSyntax(this._binding)},p}();C.BindingOnSyntax=b},15451:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BindingToSyntax=void 0;var G=y(16674),b=y(28421),p=y(74889),S=y(71325),L=function(){function X(N){this._binding=N}return X.prototype.to=function(N){return this._binding.type=b.BindingTypeEnum.Instance,this._binding.implementationType=N,new p.BindingInWhenOnSyntax(this._binding)},X.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+G.INVALID_TO_SELF_VALUE);var N=this._binding.serviceIdentifier;return this.to(N)},X.prototype.toConstantValue=function(N){return this._binding.type=b.BindingTypeEnum.ConstantValue,this._binding.cache=N,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=b.BindingScopeEnum.Singleton,new S.BindingWhenOnSyntax(this._binding)},X.prototype.toDynamicValue=function(N){return this._binding.type=b.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=N,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},X.prototype.toConstructor=function(N){return this._binding.type=b.BindingTypeEnum.Constructor,this._binding.implementationType=N,this._binding.scope=b.BindingScopeEnum.Singleton,new S.BindingWhenOnSyntax(this._binding)},X.prototype.toFactory=function(N){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=N,this._binding.scope=b.BindingScopeEnum.Singleton,new S.BindingWhenOnSyntax(this._binding)},X.prototype.toFunction=function(N){if(typeof N!="function")throw new Error(G.INVALID_FUNCTION_BINDING);var q=this.toConstantValue(N);return this._binding.type=b.BindingTypeEnum.Function,this._binding.scope=b.BindingScopeEnum.Singleton,q},X.prototype.toAutoFactory=function(N){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=function(q){var K=function(){return q.container.get(N)};return K},this._binding.scope=b.BindingScopeEnum.Singleton,new S.BindingWhenOnSyntax(this._binding)},X.prototype.toProvider=function(N){return this._binding.type=b.BindingTypeEnum.Provider,this._binding.provider=N,this._binding.scope=b.BindingScopeEnum.Singleton,new S.BindingWhenOnSyntax(this._binding)},X.prototype.toService=function(N){this.toDynamicValue(function(q){return q.container.get(N)})},X}();C.BindingToSyntax=L},71325:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BindingWhenOnSyntax=void 0;var G=y(51811),b=y(98370),p=function(){function S(L){this._binding=L,this._bindingWhenSyntax=new b.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new G.BindingOnSyntax(this._binding)}return S.prototype.when=function(L){return this._bindingWhenSyntax.when(L)},S.prototype.whenTargetNamed=function(L){return this._bindingWhenSyntax.whenTargetNamed(L)},S.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},S.prototype.whenTargetTagged=function(L,X){return this._bindingWhenSyntax.whenTargetTagged(L,X)},S.prototype.whenInjectedInto=function(L){return this._bindingWhenSyntax.whenInjectedInto(L)},S.prototype.whenParentNamed=function(L){return this._bindingWhenSyntax.whenParentNamed(L)},S.prototype.whenParentTagged=function(L,X){return this._bindingWhenSyntax.whenParentTagged(L,X)},S.prototype.whenAnyAncestorIs=function(L){return this._bindingWhenSyntax.whenAnyAncestorIs(L)},S.prototype.whenNoAncestorIs=function(L){return this._bindingWhenSyntax.whenNoAncestorIs(L)},S.prototype.whenAnyAncestorNamed=function(L){return this._bindingWhenSyntax.whenAnyAncestorNamed(L)},S.prototype.whenAnyAncestorTagged=function(L,X){return this._bindingWhenSyntax.whenAnyAncestorTagged(L,X)},S.prototype.whenNoAncestorNamed=function(L){return this._bindingWhenSyntax.whenNoAncestorNamed(L)},S.prototype.whenNoAncestorTagged=function(L,X){return this._bindingWhenSyntax.whenNoAncestorTagged(L,X)},S.prototype.whenAnyAncestorMatches=function(L){return this._bindingWhenSyntax.whenAnyAncestorMatches(L)},S.prototype.whenNoAncestorMatches=function(L){return this._bindingWhenSyntax.whenNoAncestorMatches(L)},S.prototype.onActivation=function(L){return this._bindingOnSyntax.onActivation(L)},S}();C.BindingWhenOnSyntax=p},98370:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.BindingWhenSyntax=void 0;var G=y(51811),b=y(80758),p=function(){function S(L){this._binding=L}return S.prototype.when=function(L){return this._binding.constraint=L,new G.BindingOnSyntax(this._binding)},S.prototype.whenTargetNamed=function(L){return this._binding.constraint=b.namedConstraint(L),new G.BindingOnSyntax(this._binding)},S.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(L){var X=L.target!==null&&!L.target.isNamed()&&!L.target.isTagged();return X},new G.BindingOnSyntax(this._binding)},S.prototype.whenTargetTagged=function(L,X){return this._binding.constraint=b.taggedConstraint(L)(X),new G.BindingOnSyntax(this._binding)},S.prototype.whenInjectedInto=function(L){return this._binding.constraint=function(X){return b.typeConstraint(L)(X.parentRequest)},new G.BindingOnSyntax(this._binding)},S.prototype.whenParentNamed=function(L){return this._binding.constraint=function(X){return b.namedConstraint(L)(X.parentRequest)},new G.BindingOnSyntax(this._binding)},S.prototype.whenParentTagged=function(L,X){return this._binding.constraint=function(N){return b.taggedConstraint(L)(X)(N.parentRequest)},new G.BindingOnSyntax(this._binding)},S.prototype.whenAnyAncestorIs=function(L){return this._binding.constraint=function(X){return b.traverseAncerstors(X,b.typeConstraint(L))},new G.BindingOnSyntax(this._binding)},S.prototype.whenNoAncestorIs=function(L){return this._binding.constraint=function(X){return!b.traverseAncerstors(X,b.typeConstraint(L))},new G.BindingOnSyntax(this._binding)},S.prototype.whenAnyAncestorNamed=function(L){return this._binding.constraint=function(X){return b.traverseAncerstors(X,b.namedConstraint(L))},new G.BindingOnSyntax(this._binding)},S.prototype.whenNoAncestorNamed=function(L){return this._binding.constraint=function(X){return!b.traverseAncerstors(X,b.namedConstraint(L))},new G.BindingOnSyntax(this._binding)},S.prototype.whenAnyAncestorTagged=function(L,X){return this._binding.constraint=function(N){return b.traverseAncerstors(N,b.taggedConstraint(L)(X))},new G.BindingOnSyntax(this._binding)},S.prototype.whenNoAncestorTagged=function(L,X){return this._binding.constraint=function(N){return!b.traverseAncerstors(N,b.taggedConstraint(L)(X))},new G.BindingOnSyntax(this._binding)},S.prototype.whenAnyAncestorMatches=function(L){return this._binding.constraint=function(X){return b.traverseAncerstors(X,L)},new G.BindingOnSyntax(this._binding)},S.prototype.whenNoAncestorMatches=function(L){return this._binding.constraint=function(X){return!b.traverseAncerstors(X,L)},new G.BindingOnSyntax(this._binding)},S}();C.BindingWhenSyntax=p},80758:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.typeConstraint=C.namedConstraint=C.taggedConstraint=C.traverseAncerstors=void 0;var G=y(6867),b=y(47738),p=function(N,q){var K=N.parentRequest;return K!==null?q(K)?!0:p(K,q):!1};C.traverseAncerstors=p;var S=function(N){return function(q){var K=function(ae){return ae!==null&&ae.target!==null&&ae.target.matchesTag(N)(q)};return K.metaData=new b.Metadata(N,q),K}};C.taggedConstraint=S;var L=S(G.NAMED_TAG);C.namedConstraint=L;var X=function(N){return function(q){var K=null;if(q!==null)if(K=q.bindings[0],typeof N=="string"){var ae=K.serviceIdentifier;return ae===N}else{var xe=q.bindings[0].implementationType;return N===xe}return!1}};C.typeConstraint=X},70600:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.multiBindToService=void 0;var y=function(G){return function(b){return function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];return p.forEach(function(L){return G.bind(L).toService(b)})}}};C.multiBindToService=y},85265:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.isStackOverflowExeption=void 0;var G=y(16674);function b(p){return p instanceof RangeError||p.message===G.STACK_OVERFLOW}C.isStackOverflowExeption=b},37791:function(ft,C){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.id=void 0;var y=0;function G(){return y++}C.id=G},55800:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.circularDependencyToException=C.listMetadataForTarget=C.listRegisteredBindingsForServiceIdentifier=C.getServiceIdentifierAsString=C.getFunctionName=void 0;var G=y(16674);function b(K){if(typeof K=="function"){var ae=K;return ae.name}else{if(typeof K=="symbol")return K.toString();var ae=K;return ae}}C.getServiceIdentifierAsString=b;function p(K,ae,xe){var se="",Ft=xe(K,ae);return Ft.length!==0&&(se=`
Registered bindings:`,Ft.forEach(function(zt){var Wt="Object";zt.implementationType!==null&&(Wt=q(zt.implementationType)),se=se+`
 `+Wt,zt.constraint.metaData&&(se=se+" - "+zt.constraint.metaData)})),se}C.listRegisteredBindingsForServiceIdentifier=p;function S(K,ae){return K.parentRequest===null?!1:K.parentRequest.serviceIdentifier===ae?!0:S(K.parentRequest,ae)}function L(K){function ae(se,Ft){Ft===void 0&&(Ft=[]);var zt=b(se.serviceIdentifier);return Ft.push(zt),se.parentRequest!==null?ae(se.parentRequest,Ft):Ft}var xe=ae(K);return xe.reverse().join(" --> ")}function X(K){K.childRequests.forEach(function(ae){if(S(ae,ae.serviceIdentifier)){var xe=L(ae);throw new Error(G.CIRCULAR_DEPENDENCY+" "+xe)}else X(ae)})}C.circularDependencyToException=X;function N(K,ae){if(ae.isTagged()||ae.isNamed()){var xe="",se=ae.getNamedTag(),Ft=ae.getCustomTags();return se!==null&&(xe+=se.toString()+`
`),Ft!==null&&Ft.forEach(function(zt){xe+=zt.toString()+`
`})," "+K+`
 `+K+" - "+xe}else return" "+K}C.listMetadataForTarget=N;function q(K){if(K.name)return K.name;var ae=K.toString(),xe=ae.match(/^function\s*([^\s(]+)/);return xe?xe[1]:"Anonymous function: "+ae}C.getFunctionName=q},68982:function(ft){ft.exports=C;function C(y,G){G||(G=document);var b=G.head||G.getElementsByTagName("head")[0];if(!b){b=G.createElement("head");var p=G.body||G.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(b,p):G.documentElement.appendChild(b)}var S=G.createElement("style");return S.type="text/css",S.styleSheet?S.styleSheet.cssText=y:S.appendChild(G.createTextNode(y)),b.appendChild(S),S}},53778:function(ft){var C=Array.isArray;ft.exports=C},59722:function(ft){function C(y){return y==null}ft.exports=C},8146:function(ft){var C="[object Object]";function y(xe){var se=!1;if(xe!=null&&typeof xe.toString!="function")try{se=!!(xe+"")}catch(Ft){}return se}function G(xe,se){return function(Ft){return xe(se(Ft))}}var b=Function.prototype,p=Object.prototype,S=b.toString,L=p.hasOwnProperty,X=S.call(Object),N=p.toString,q=G(Object.getPrototypeOf,Object);function K(xe){return!!xe&&typeof xe=="object"}function ae(xe){if(!K(xe)||N.call(xe)!=C||y(xe))return!1;var se=q(xe);if(se===null)return!0;var Ft=L.call(se,"constructor")&&se.constructor;return typeof Ft=="function"&&Ft instanceof Ft&&S.call(Ft)==X}ft.exports=ae},38554:function(ft,C,y){ft=y.nmd(ft);var G=200,b="__lodash_hash_undefined__",p=800,S=16,L=9007199254740991,X="[object Arguments]",N="[object Array]",q="[object AsyncFunction]",K="[object Boolean]",ae="[object Date]",xe="[object Error]",se="[object Function]",Ft="[object GeneratorFunction]",zt="[object Map]",Wt="[object Number]",Mt="[object Null]",wt="[object Object]",ot="[object Proxy]",tt="[object RegExp]",Yt="[object Set]",ke="[object String]",Ne="[object Undefined]",Be="[object WeakMap]",Ie="[object ArrayBuffer]",pt="[object DataView]",oe="[object Float32Array]",re="[object Float64Array]",ue="[object Int8Array]",it="[object Int16Array]",Jt="[object Int32Array]",ce="[object Uint8Array]",$e="[object Uint8ClampedArray]",Ae="[object Uint16Array]",Ce="[object Uint32Array]",Pe=/[\\^$.*+?()[\]{}|]/g,et=/^\[object .+?Constructor\]$/,Se=/^(?:0|[1-9]\d*)$/,Pt={};Pt[oe]=Pt[re]=Pt[ue]=Pt[it]=Pt[Jt]=Pt[ce]=Pt[$e]=Pt[Ae]=Pt[Ce]=!0,Pt[X]=Pt[N]=Pt[Ie]=Pt[K]=Pt[pt]=Pt[ae]=Pt[xe]=Pt[se]=Pt[zt]=Pt[Wt]=Pt[wt]=Pt[tt]=Pt[Yt]=Pt[ke]=Pt[Be]=!1;var vr=typeof y.g=="object"&&y.g&&y.g.Object===Object&&y.g,_r=typeof self=="object"&&self&&self.Object===Object&&self,Yr=vr||_r||Function("return this")(),tr=C&&!C.nodeType&&C,ne=tr&&!0&&ft&&!ft.nodeType&&ft,be=ne&&ne.exports===tr,De=be&&vr.process,at=function(){try{var Ze=ne&&ne.require&&ne.require("util").types;return Ze||De&&De.binding&&De.binding("util")}catch(Ot){}}(),kt=at&&at.isTypedArray;function jt(Ze,Ot,br){switch(br.length){case 0:return Ze.call(Ot);case 1:return Ze.call(Ot,br[0]);case 2:return Ze.call(Ot,br[0],br[1]);case 3:return Ze.call(Ot,br[0],br[1],br[2])}return Ze.apply(Ot,br)}function w(Ze,Ot){for(var br=-1,On=Array(Ze);++br<Ze;)On[br]=Ot(br);return On}function F(Ze){return function(Ot){return Ze(Ot)}}function de(Ze,Ot){return Ze==null?void 0:Ze[Ot]}function Ue(Ze,Ot){return function(br){return Ze(Ot(br))}}var Qe=Array.prototype,Tt=Function.prototype,Dt=Object.prototype,H=Yr["__core-js_shared__"],Qt=Tt.toString,$t=Dt.hasOwnProperty,wr=function(){var Ze=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return Ze?"Symbol(src)_1."+Ze:""}(),Tr=Dt.toString,Mr=Qt.call(Object),Or=RegExp("^"+Qt.call($t).replace(Pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Je=be?Yr.Buffer:void 0,At=Yr.Symbol,_t=Yr.Uint8Array,pr=Je?Je.allocUnsafe:void 0,en=Ue(Object.getPrototypeOf,Object),mt=Object.create,Nt=Dt.propertyIsEnumerable,ar=Qe.splice,xr=At?At.toStringTag:void 0,xn=function(){try{var Ze=_a(Object,"defineProperty");return Ze({},"",{}),Ze}catch(Ot){}}(),In=Je?Je.isBuffer:void 0,Ei=Math.max,Ai=Date.now,Bi=_a(Yr,"Map"),aa=_a(Object,"create"),hi=function(){function Ze(){}return function(Ot){if(!co(Ot))return{};if(mt)return mt(Ot);Ze.prototype=Ot;var br=new Ze;return Ze.prototype=void 0,br}}();function V(Ze){var Ot=-1,br=Ze==null?0:Ze.length;for(this.clear();++Ot<br;){var On=Ze[Ot];this.set(On[0],On[1])}}function te(){this.__data__=aa?aa(null):{},this.size=0}function le(Ze){var Ot=this.has(Ze)&&delete this.__data__[Ze];return this.size-=Ot?1:0,Ot}function we(Ze){var Ot=this.__data__;if(aa){var br=Ot[Ze];return br===b?void 0:br}return $t.call(Ot,Ze)?Ot[Ze]:void 0}function je(Ze){var Ot=this.__data__;return aa?Ot[Ze]!==void 0:$t.call(Ot,Ze)}function ht(Ze,Ot){var br=this.__data__;return this.size+=this.has(Ze)?0:1,br[Ze]=aa&&Ot===void 0?b:Ot,this}V.prototype.clear=te,V.prototype.delete=le,V.prototype.get=we,V.prototype.has=je,V.prototype.set=ht;function xt(Ze){var Ot=-1,br=Ze==null?0:Ze.length;for(this.clear();++Ot<br;){var On=Ze[Ot];this.set(On[0],On[1])}}function ge(){this.__data__=[],this.size=0}function Ke(Ze){var Ot=this.__data__,br=go(Ot,Ze);if(br<0)return!1;var On=Ot.length-1;return br==On?Ot.pop():ar.call(Ot,br,1),--this.size,!0}function Ut(Ze){var Ot=this.__data__,br=go(Ot,Ze);return br<0?void 0:Ot[br][1]}function Fr(Ze){return go(this.__data__,Ze)>-1}function jr(Ze,Ot){var br=this.__data__,On=go(br,Ze);return On<0?(++this.size,br.push([Ze,Ot])):br[On][1]=Ot,this}xt.prototype.clear=ge,xt.prototype.delete=Ke,xt.prototype.get=Ut,xt.prototype.has=Fr,xt.prototype.set=jr;function Xt(Ze){var Ot=-1,br=Ze==null?0:Ze.length;for(this.clear();++Ot<br;){var On=Ze[Ot];this.set(On[0],On[1])}}function mr(){this.size=0,this.__data__={hash:new V,map:new(Bi||xt),string:new V}}function Hr(Ze){var Ot=wa(this,Ze).delete(Ze);return this.size-=Ot?1:0,Ot}function gn(Ze){return wa(this,Ze).get(Ze)}function gr(Ze){return wa(this,Ze).has(Ze)}function vn(Ze,Ot){var br=wa(this,Ze),On=br.size;return br.set(Ze,Ot),this.size+=br.size==On?0:1,this}Xt.prototype.clear=mr,Xt.prototype.delete=Hr,Xt.prototype.get=gn,Xt.prototype.has=gr,Xt.prototype.set=vn;function $r(Ze){var Ot=this.__data__=new xt(Ze);this.size=Ot.size}function cn(){this.__data__=new xt,this.size=0}function pi(Ze){var Ot=this.__data__,br=Ot.delete(Ze);return this.size=Ot.size,br}function fn(Ze){return this.__data__.get(Ze)}function gi(Ze){return this.__data__.has(Ze)}function Wi(Ze,Ot){var br=this.__data__;if(br instanceof xt){var On=br.__data__;if(!Bi||On.length<G-1)return On.push([Ze,Ot]),this.size=++br.size,this;br=this.__data__=new Xt(On)}return br.set(Ze,Ot),this.size=br.size,this}$r.prototype.clear=cn,$r.prototype.delete=pi,$r.prototype.get=fn,$r.prototype.has=gi,$r.prototype.set=Wi;function vi(Ze,Ot){var br=Yo(Ze),On=!br&&Ya(Ze),Hi=!br&&!On&&Xu(Ze),ba=!br&&!On&&!Hi&&li(Ze),Za=br||On||Hi||ba,na=Za?w(Ze.length,String):[],Ra=na.length;for(var Fo in Ze)(Ot||$t.call(Ze,Fo))&&!(Za&&(Fo=="length"||Hi&&(Fo=="offset"||Fo=="parent")||ba&&(Fo=="buffer"||Fo=="byteLength"||Fo=="byteOffset")||ts(Fo,Ra)))&&na.push(Fo);return na}function Ri(Ze,Ot,br){(br!==void 0&&!Xa(Ze[Ot],br)||br===void 0&&!(Ot in Ze))&&ji(Ze,Ot,br)}function Ii(Ze,Ot,br){var On=Ze[Ot];(!($t.call(Ze,Ot)&&Xa(On,br))||br===void 0&&!(Ot in Ze))&&ji(Ze,Ot,br)}function go(Ze,Ot){for(var br=Ze.length;br--;)if(Xa(Ze[br][0],Ot))return br;return-1}function ji(Ze,Ot,br){Ot=="__proto__"&&xn?xn(Ze,Ot,{configurable:!0,enumerable:!0,value:br,writable:!0}):Ze[Ot]=br}var Rn=Wa();function Dn(Ze){return Ze==null?Ze===void 0?Ne:Mt:xr&&xr in Object(Ze)?ra(Ze):gt(Ze)}function ui(Ze){return Rs(Ze)&&Dn(Ze)==X}function Vn(Ze){if(!co(Ze)||fa(Ze))return!1;var Ot=ko(Ze)?Or:et;return Ot.test(Xi(Ze))}function za(Ze){return Rs(Ze)&&Ls(Ze.length)&&!!Pt[Dn(Ze)]}function ds(Ze){if(!co(Ze))return Oe(Ze);var Ot=he(Ze),br=[];for(var On in Ze)On=="constructor"&&(Ot||!$t.call(Ze,On))||br.push(On);return br}function Di(Ze,Ot,br,On,Hi){Ze!==Ot&&Rn(Ot,function(ba,Za){if(Hi||(Hi=new $r),co(ba))Na(Ze,Ot,Za,br,Di,On,Hi);else{var na=On?On(tn(Ze,Za),ba,Za+"",Ze,Ot,Hi):void 0;na===void 0&&(na=ba),Ri(Ze,Za,na)}},xa)}function Na(Ze,Ot,br,On,Hi,ba,Za){var na=tn(Ze,br),Ra=tn(Ot,br),Fo=Za.get(Ra);if(Fo){Ri(Ze,br,Fo);return}var Mo=ba?ba(na,Ra,br+"",Ze,Ot,Za):void 0,yi=Mo===void 0;if(yi){var Yu=Yo(Ra),hu=!Yu&&Xu(Ra),Ko=!Yu&&!hu&&li(Ra);Mo=Ra,Yu||hu||Ko?Yo(na)?Mo=na:Hl(na)?Mo=Ha(na):hu?(yi=!1,Mo=ya(Ra,!0)):Ko?(yi=!1,Mo=Ga(Ra,!0)):Mo=[]:La(Ra)||Ya(Ra)?(Mo=na,Ya(na)?Mo=ul(na):(!co(na)||ko(na))&&(Mo=sl(Ra))):yi=!1}yi&&(Za.set(Ra,Mo),Hi(Mo,Ra,On,ba,Za),Za.delete(Ra)),Ri(Ze,br,Mo)}function Eu(Ze,Ot){return kn(fr(Ze,Ot,Wl),Ze+"")}var fu=xn?function(Ze,Ot){return xn(Ze,"toString",{configurable:!0,enumerable:!1,value:Ys(Ot),writable:!0})}:Wl;function ya(Ze,Ot){if(Ot)return Ze.slice();var br=Ze.length,On=pr?pr(br):new Ze.constructor(br);return Ze.copy(On),On}function lo(Ze){var Ot=new Ze.constructor(Ze.byteLength);return new _t(Ot).set(new _t(Ze)),Ot}function Ga(Ze,Ot){var br=Ot?lo(Ze.buffer):Ze.buffer;return new Ze.constructor(br,Ze.byteOffset,Ze.length)}function Ha(Ze,Ot){var br=-1,On=Ze.length;for(Ot||(Ot=Array(On));++br<On;)Ot[br]=Ze[br];return Ot}function Xo(Ze,Ot,br,On){var Hi=!br;br||(br={});for(var ba=-1,Za=Ot.length;++ba<Za;){var na=Ot[ba],Ra=On?On(br[na],Ze[na],na,br,Ze):void 0;Ra===void 0&&(Ra=Ze[na]),Hi?ji(br,na,Ra):Ii(br,na,Ra)}return br}function oa(Ze){return Eu(function(Ot,br){var On=-1,Hi=br.length,ba=Hi>1?br[Hi-1]:void 0,Za=Hi>2?br[2]:void 0;for(ba=Ze.length>3&&typeof ba=="function"?(Hi--,ba):void 0,Za&&to(br[0],br[1],Za)&&(ba=Hi<3?void 0:ba,Hi=1),Ot=Object(Ot);++On<Hi;){var na=br[On];na&&Ze(Ot,na,On,ba)}return Ot})}function Wa(Ze){return function(Ot,br,On){for(var Hi=-1,ba=Object(Ot),Za=On(Ot),na=Za.length;na--;){var Ra=Za[Ze?na:++Hi];if(br(ba[Ra],Ra,ba)===!1)break}return Ot}}function wa(Ze,Ot){var br=Ze.__data__;return Oa(Ot)?br[typeof Ot=="string"?"string":"hash"]:br.map}function _a(Ze,Ot){var br=de(Ze,Ot);return Vn(br)?br:void 0}function ra(Ze){var Ot=$t.call(Ze,xr),br=Ze[xr];try{Ze[xr]=void 0;var On=!0}catch(ba){}var Hi=Tr.call(Ze);return On&&(Ot?Ze[xr]=br:delete Ze[xr]),Hi}function sl(Ze){return typeof Ze.constructor=="function"&&!he(Ze)?hi(en(Ze)):{}}function ts(Ze,Ot){var br=typeof Ze;return Ot=Ot==null?L:Ot,!!Ot&&(br=="number"||br!="symbol"&&Se.test(Ze))&&Ze>-1&&Ze%1==0&&Ze<Ot}function to(Ze,Ot,br){if(!co(br))return!1;var On=typeof Ot;return(On=="number"?Ss(br)&&ts(Ot,br.length):On=="string"&&Ot in br)?Xa(br[Ot],Ze):!1}function Oa(Ze){var Ot=typeof Ze;return Ot=="string"||Ot=="number"||Ot=="symbol"||Ot=="boolean"?Ze!=="__proto__":Ze===null}function fa(Ze){return!!wr&&wr in Ze}function he(Ze){var Ot=Ze&&Ze.constructor,br=typeof Ot=="function"&&Ot.prototype||Dt;return Ze===br}function Oe(Ze){var Ot=[];if(Ze!=null)for(var br in Object(Ze))Ot.push(br);return Ot}function gt(Ze){return Tr.call(Ze)}function fr(Ze,Ot,br){return Ot=Ei(Ot===void 0?Ze.length-1:Ot,0),function(){for(var On=arguments,Hi=-1,ba=Ei(On.length-Ot,0),Za=Array(ba);++Hi<ba;)Za[Hi]=On[Ot+Hi];Hi=-1;for(var na=Array(Ot+1);++Hi<Ot;)na[Hi]=On[Hi];return na[Ot]=br(Za),jt(Ze,this,na)}}function tn(Ze,Ot){if(!(Ot==="constructor"&&typeof Ze[Ot]=="function")&&Ot!="__proto__")return Ze[Ot]}var kn=Zi(fu);function Zi(Ze){var Ot=0,br=0;return function(){var On=Ai(),Hi=S-(On-br);if(br=On,Hi>0){if(++Ot>=p)return arguments[0]}else Ot=0;return Ze.apply(void 0,arguments)}}function Xi(Ze){if(Ze!=null){try{return Qt.call(Ze)}catch(Ot){}try{return Ze+""}catch(Ot){}}return""}function Xa(Ze,Ot){return Ze===Ot||Ze!==Ze&&Ot!==Ot}var Ya=ui(function(){return arguments}())?ui:function(Ze){return Rs(Ze)&&$t.call(Ze,"callee")&&!Nt.call(Ze,"callee")},Yo=Array.isArray;function Ss(Ze){return Ze!=null&&Ls(Ze.length)&&!ko(Ze)}function Hl(Ze){return Rs(Ze)&&Ss(Ze)}var Xu=In||fo;function ko(Ze){if(!co(Ze))return!1;var Ot=Dn(Ze);return Ot==se||Ot==Ft||Ot==q||Ot==ot}function Ls(Ze){return typeof Ze=="number"&&Ze>-1&&Ze%1==0&&Ze<=L}function co(Ze){var Ot=typeof Ze;return Ze!=null&&(Ot=="object"||Ot=="function")}function Rs(Ze){return Ze!=null&&typeof Ze=="object"}function La(Ze){if(!Rs(Ze)||Dn(Ze)!=wt)return!1;var Ot=en(Ze);if(Ot===null)return!0;var br=$t.call(Ot,"constructor")&&Ot.constructor;return typeof br=="function"&&br instanceof br&&Qt.call(br)==Mr}var li=kt?F(kt):za;function ul(Ze){return Xo(Ze,xa(Ze))}function xa(Ze){return Ss(Ze)?vi(Ze,!0):ds(Ze)}var Nn=oa(function(Ze,Ot,br,On){Di(Ze,Ot,br,On)});function Ys(Ze){return function(){return Ze}}function Wl(Ze){return Ze}function fo(){return!1}ft.exports=Nn},97644:function(ft,C,y){var G=200,b="__lodash_hash_undefined__",p=1/0,S="[object Function]",L="[object GeneratorFunction]",X=/[\\^$.*+?()[\]{}|]/g,N=/^\[object .+?Constructor\]$/,q=typeof y.g=="object"&&y.g&&y.g.Object===Object&&y.g,K=typeof self=="object"&&self&&self.Object===Object&&self,ae=q||K||Function("return this")();function xe(mt,Nt){var ar=mt?mt.length:0;return!!ar&&zt(mt,Nt,0)>-1}function se(mt,Nt,ar){for(var xr=-1,xn=mt?mt.length:0;++xr<xn;)if(ar(Nt,mt[xr]))return!0;return!1}function Ft(mt,Nt,ar,xr){for(var xn=mt.length,In=ar+(xr?1:-1);xr?In--:++In<xn;)if(Nt(mt[In],In,mt))return In;return-1}function zt(mt,Nt,ar){if(Nt!==Nt)return Ft(mt,Wt,ar);for(var xr=ar-1,xn=mt.length;++xr<xn;)if(mt[xr]===Nt)return xr;return-1}function Wt(mt){return mt!==mt}function Mt(mt,Nt){return mt.has(Nt)}function wt(mt,Nt){return mt==null?void 0:mt[Nt]}function ot(mt){var Nt=!1;if(mt!=null&&typeof mt.toString!="function")try{Nt=!!(mt+"")}catch(ar){}return Nt}function tt(mt){var Nt=-1,ar=Array(mt.size);return mt.forEach(function(xr){ar[++Nt]=xr}),ar}var Yt=Array.prototype,ke=Function.prototype,Ne=Object.prototype,Be=ae["__core-js_shared__"],Ie=function(){var mt=/[^.]+$/.exec(Be&&Be.keys&&Be.keys.IE_PROTO||"");return mt?"Symbol(src)_1."+mt:""}(),pt=ke.toString,oe=Ne.hasOwnProperty,re=Ne.toString,ue=RegExp("^"+pt.call(oe).replace(X,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),it=Yt.splice,Jt=wr(ae,"Map"),ce=wr(ae,"Set"),$e=wr(Object,"create");function Ae(mt){var Nt=-1,ar=mt?mt.length:0;for(this.clear();++Nt<ar;){var xr=mt[Nt];this.set(xr[0],xr[1])}}function Ce(){this.__data__=$e?$e(null):{}}function Pe(mt){return this.has(mt)&&delete this.__data__[mt]}function et(mt){var Nt=this.__data__;if($e){var ar=Nt[mt];return ar===b?void 0:ar}return oe.call(Nt,mt)?Nt[mt]:void 0}function Se(mt){var Nt=this.__data__;return $e?Nt[mt]!==void 0:oe.call(Nt,mt)}function Pt(mt,Nt){var ar=this.__data__;return ar[mt]=$e&&Nt===void 0?b:Nt,this}Ae.prototype.clear=Ce,Ae.prototype.delete=Pe,Ae.prototype.get=et,Ae.prototype.has=Se,Ae.prototype.set=Pt;function vr(mt){var Nt=-1,ar=mt?mt.length:0;for(this.clear();++Nt<ar;){var xr=mt[Nt];this.set(xr[0],xr[1])}}function _r(){this.__data__=[]}function Yr(mt){var Nt=this.__data__,ar=Tt(Nt,mt);if(ar<0)return!1;var xr=Nt.length-1;return ar==xr?Nt.pop():it.call(Nt,ar,1),!0}function tr(mt){var Nt=this.__data__,ar=Tt(Nt,mt);return ar<0?void 0:Nt[ar][1]}function ne(mt){return Tt(this.__data__,mt)>-1}function be(mt,Nt){var ar=this.__data__,xr=Tt(ar,mt);return xr<0?ar.push([mt,Nt]):ar[xr][1]=Nt,this}vr.prototype.clear=_r,vr.prototype.delete=Yr,vr.prototype.get=tr,vr.prototype.has=ne,vr.prototype.set=be;function De(mt){var Nt=-1,ar=mt?mt.length:0;for(this.clear();++Nt<ar;){var xr=mt[Nt];this.set(xr[0],xr[1])}}function at(){this.__data__={hash:new Ae,map:new(Jt||vr),string:new Ae}}function kt(mt){return $t(this,mt).delete(mt)}function jt(mt){return $t(this,mt).get(mt)}function w(mt){return $t(this,mt).has(mt)}function F(mt,Nt){return $t(this,mt).set(mt,Nt),this}De.prototype.clear=at,De.prototype.delete=kt,De.prototype.get=jt,De.prototype.has=w,De.prototype.set=F;function de(mt){var Nt=-1,ar=mt?mt.length:0;for(this.__data__=new De;++Nt<ar;)this.add(mt[Nt])}function Ue(mt){return this.__data__.set(mt,b),this}function Qe(mt){return this.__data__.has(mt)}de.prototype.add=de.prototype.push=Ue,de.prototype.has=Qe;function Tt(mt,Nt){for(var ar=mt.length;ar--;)if(At(mt[ar][0],Nt))return ar;return-1}function Dt(mt){if(!pr(mt)||Mr(mt))return!1;var Nt=_t(mt)||ot(mt)?ue:N;return Nt.test(Or(mt))}function H(mt,Nt,ar){var xr=-1,xn=xe,In=mt.length,Ei=!0,Ai=[],Bi=Ai;if(ar)Ei=!1,xn=se;else if(In>=G){var aa=Nt?null:Qt(mt);if(aa)return tt(aa);Ei=!1,xn=Mt,Bi=new de}else Bi=Nt?[]:Ai;e:for(;++xr<In;){var hi=mt[xr],V=Nt?Nt(hi):hi;if(hi=ar||hi!==0?hi:0,Ei&&V===V){for(var te=Bi.length;te--;)if(Bi[te]===V)continue e;Nt&&Bi.push(V),Ai.push(hi)}else xn(Bi,V,ar)||(Bi!==Ai&&Bi.push(V),Ai.push(hi))}return Ai}var Qt=ce&&1/tt(new ce([,-0]))[1]==p?function(mt){return new ce(mt)}:en;function $t(mt,Nt){var ar=mt.__data__;return Tr(Nt)?ar[typeof Nt=="string"?"string":"hash"]:ar.map}function wr(mt,Nt){var ar=wt(mt,Nt);return Dt(ar)?ar:void 0}function Tr(mt){var Nt=typeof mt;return Nt=="string"||Nt=="number"||Nt=="symbol"||Nt=="boolean"?mt!=="__proto__":mt===null}function Mr(mt){return!!Ie&&Ie in mt}function Or(mt){if(mt!=null){try{return pt.call(mt)}catch(Nt){}try{return mt+""}catch(Nt){}}return""}function Je(mt){return mt&&mt.length?H(mt):[]}function At(mt,Nt){return mt===Nt||mt!==mt&&Nt!==Nt}function _t(mt){var Nt=pr(mt)?re.call(mt):"";return Nt==S||Nt==L}function pr(mt){var Nt=typeof mt;return!!mt&&(Nt=="object"||Nt=="function")}function en(){}ft.exports=Je},49029:function(ft){var C=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function y(G){return G.match(C)||[]}ft.exports=y},29750:function(ft){function C(y,G,b){return y===y&&(b!==void 0&&(y=y<=b?y:b),G!==void 0&&(y=y>=G?y:G)),y}ft.exports=C},18674:function(ft){function C(y){return function(G){return y==null?void 0:y[G]}}ft.exports=C},98805:function(ft,C,y){var G=y(40180),b=y(62689),p=y(83140),S=y(79833);function L(X){return function(N){N=S(N);var q=b(N)?p(N):void 0,K=q?q[0]:N.charAt(0),ae=q?G(q,1).join(""):N.slice(1);return K[X]()+ae}}ft.exports=L},35393:function(ft,C,y){var G=y(62663),b=y(53816),p=y(58748),S="['\u2019]",L=RegExp(S,"g");function X(N){return function(q){return G(p(b(q).replace(L,"")),N,"")}}ft.exports=X},69389:function(ft,C,y){var G=y(18674),b={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=G(b);ft.exports=p},93157:function(ft){var C=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function y(G){return C.test(G)}ft.exports=y},2757:function(ft){var C="\\ud800-\\udfff",y="\\u0300-\\u036f",G="\\ufe20-\\ufe2f",b="\\u20d0-\\u20ff",p=y+G+b,S="\\u2700-\\u27bf",L="a-z\\xdf-\\xf6\\xf8-\\xff",X="\\xac\\xb1\\xd7\\xf7",N="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",q="\\u2000-\\u206f",K=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ae="A-Z\\xc0-\\xd6\\xd8-\\xde",xe="\\ufe0e\\ufe0f",se=X+N+q+K,Ft="['\u2019]",zt="["+se+"]",Wt="["+p+"]",Mt="\\d+",wt="["+S+"]",ot="["+L+"]",tt="[^"+C+se+Mt+S+L+ae+"]",Yt="\\ud83c[\\udffb-\\udfff]",ke="(?:"+Wt+"|"+Yt+")",Ne="[^"+C+"]",Be="(?:\\ud83c[\\udde6-\\uddff]){2}",Ie="[\\ud800-\\udbff][\\udc00-\\udfff]",pt="["+ae+"]",oe="\\u200d",re="(?:"+ot+"|"+tt+")",ue="(?:"+pt+"|"+tt+")",it="(?:"+Ft+"(?:d|ll|m|re|s|t|ve))?",Jt="(?:"+Ft+"(?:D|LL|M|RE|S|T|VE))?",ce=ke+"?",$e="["+xe+"]?",Ae="(?:"+oe+"(?:"+[Ne,Be,Ie].join("|")+")"+$e+ce+")*",Ce="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Pe="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",et=$e+ce+Ae,Se="(?:"+[wt,Be,Ie].join("|")+")"+et,Pt=RegExp([pt+"?"+ot+"+"+it+"(?="+[zt,pt,"$"].join("|")+")",ue+"+"+Jt+"(?="+[zt,pt+re,"$"].join("|")+")",pt+"?"+re+"+"+it,pt+"+"+Jt,Pe,Ce,Mt,Se].join("|"),"g");function vr(_r){return _r.match(Pt)||[]}ft.exports=vr},68929:function(ft,C,y){var G=y(48403),b=y(35393),p=b(function(S,L,X){return L=L.toLowerCase(),S+(X?G(L):L)});ft.exports=p},48403:function(ft,C,y){var G=y(79833),b=y(11700);function p(S){return b(G(S).toLowerCase())}ft.exports=p},74691:function(ft,C,y){var G=y(29750),b=y(14841);function p(S,L,X){return X===void 0&&(X=L,L=void 0),X!==void 0&&(X=b(X),X=X===X?X:0),L!==void 0&&(L=b(L),L=L===L?L:0),G(b(S),L,X)}ft.exports=p},53816:function(ft,C,y){var G=y(69389),b=y(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,S="\\u0300-\\u036f",L="\\ufe20-\\ufe2f",X="\\u20d0-\\u20ff",N=S+L+X,q="["+N+"]",K=RegExp(q,"g");function ae(xe){return xe=b(xe),xe&&xe.replace(p,G).replace(K,"")}ft.exports=ae},14293:function(ft){function C(y){return y==null}ft.exports=C},81763:function(ft,C,y){var G=y(44239),b=y(37005),p="[object Number]";function S(L){return typeof L=="number"||b(L)&&G(L)==p}ft.exports=S},30236:function(ft,C,y){var G=y(42980),b=y(21463),p=b(function(S,L,X,N){G(S,L,X,N)});ft.exports=p},44908:function(ft,C,y){var G=y(45652);function b(p){return p&&p.length?G(p):[]}ft.exports=b},11700:function(ft,C,y){var G=y(98805),b=G("toUpperCase");ft.exports=b},58748:function(ft,C,y){var G=y(49029),b=y(93157),p=y(79833),S=y(2757);function L(X,N,q){return X=p(X),N=q?void 0:N,N===void 0?b(X)?S(X):G(X):X.match(N)||[]}ft.exports=L},6158:function(ft){(function(C,y){ft.exports=y()})(this,function(){"use strict";var C,y,G;function b(p,S){if(!C)C=S;else if(!y)y=S;else{var L="var sharedChunk = {}; ("+C+")(sharedChunk); ("+y+")(sharedChunk);",X={};C(X),G=S(X),typeof window!="undefined"&&(G.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}return b(["exports"],function(p){"use strict";function S(e,t){return e(t={exports:{}},t.exports),t.exports}var L=X;function X(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}X.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},X.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},X.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},X.prototype.solveCurveX=function(e,t){var r,f,v,m,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(m=this.sampleCurveX(v)-e,Math.abs(m)<t)return v;var P=this.sampleCurveDerivativeX(v);if(Math.abs(P)<1e-6)break;v-=m/P}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(m=this.sampleCurveX(v),Math.abs(m-e)<t)return v;e>m?r=v:f=v,v=.5*(f-r)+r}return v},X.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var N=q;function q(e,t){this.x=e,this.y=t}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(e){return e instanceof q?e:Array.isArray(e)?new q(e[0],e[1]):e};var K=typeof self!="undefined"?self:{},ae=Math.pow(2,53)-1;function xe(e,t,r,f){var v=new L(e,t,r,f);return function(m){return v.solve(m)}}var se=xe(.25,.1,.25,1);function Ft(e,t,r){return Math.min(r,Math.max(t,e))}function zt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Wt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var x in m)e[x]=m[x]}return e}var Mt=1;function wt(){return Mt++}function ot(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function tt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Yt(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function ke(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Ne(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function Be(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Ie(e){return Array.isArray(e)?e.map(Ie):typeof e=="object"&&e?Ne(e,Ie):e}var pt={};function oe(e){pt[e]||(typeof console!="undefined"&&console.warn(e),pt[e]=!0)}function re(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function ue(e){for(var t=0,r=0,f=e.length,v=f-1,m=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(m=e[r]).x)*(m.y+x.y);return t}function it(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Jt(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,m,x){var P=m||x;return t[v]=!P||P.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ce=null;function $e(e){if(ce==null){var t=e.navigator?e.navigator.userAgent:null;ce=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ce}function Ae(e){try{var t=K[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var Ce,Pe,et,Se,Pt=K.performance&&K.performance.now?K.performance.now.bind(K.performance):Date.now.bind(Date),vr=K.requestAnimationFrame||K.mozRequestAnimationFrame||K.webkitRequestAnimationFrame||K.msRequestAnimationFrame,_r=K.cancelAnimationFrame||K.mozCancelAnimationFrame||K.webkitCancelAnimationFrame||K.msCancelAnimationFrame,Yr={now:Pt,frame:function(e){var t=vr(e);return{cancel:function(){return _r(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=K.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return Ce||(Ce=K.document.createElement("a")),Ce.href=e,Ce.href},hardwareConcurrency:K.navigator&&K.navigator.hardwareConcurrency||4,get devicePixelRatio(){return K.devicePixelRatio},get prefersReducedMotion(){return!!K.matchMedia&&(Pe==null&&(Pe=K.matchMedia("(prefers-reduced-motion: reduce)")),Pe.matches)}},tr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ne={supported:!1,testSupport:function(e){!be&&Se&&(De?at(e):et=e)}},be=!1,De=!1;function at(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Se),e.isContextLost())return;ne.supported=!0}catch(r){}e.deleteTexture(t),be=!0}K.document&&((Se=K.document.createElement("img")).onload=function(){et&&at(et),et=null,De=!0},Se.onerror=function(){be=!0,et=null},Se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var kt="01",jt=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function w(e){return e.indexOf("mapbox:")===0}jt.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},jt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},jt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},jt.prototype.normalizeStyleURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},jt.prototype.normalizeGlyphsURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},jt.prototype.normalizeSourceURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},jt.prototype.normalizeSpriteURL=function(e,t,r,f){var v=Qe(e);return w(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,Tt(v))},jt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!w(e))return e;var r=Qe(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Yr.devicePixelRatio>=2||t===512?"@2x":"")+(ne.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var m=0,x=v;m<x.length;m+=1){var P=x[m].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(r.params)||tr.ACCESS_TOKEN;return tr.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},jt.prototype.canonicalizeTileURL=function(e,t){var r=Qe(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(m){return!m.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},jt.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&w(t),f=[],v=0,m=e.tiles||[];v<m.length;v+=1){var x=m[v];de(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},jt.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=Qe(tr.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!tr.REQUIRE_ACCESS_TOKEN)return Tt(e);if(!(t=t||tr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(m){return m.indexOf("access_token")===-1}),e.params.push("access_token="+t),Tt(e)};var F=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function de(e){return F.test(e)}var Ue=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qe(e){var t=e.match(Ue);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Tt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Dt(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(K.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var H=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};H.prototype.getStorageKey=function(e){var t,r=Dt(tr.ACCESS_TOKEN);return t=r&&r.u?K.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):tr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},H.prototype.fetchEventData=function(){var e=Ae("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=K.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=K.localStorage.getItem(r);v&&(this.anonId=v)}catch(m){oe("Unable to read from LocalStorage")}},H.prototype.saveEventData=function(){var e=Ae("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{K.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&K.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){oe("Unable to write to LocalStorage")}},H.prototype.processRequests=function(e){},H.prototype.postEvent=function(e,t,r,f){var v=this;if(tr.EVENTS_URL){var m=Qe(tr.EVENTS_URL);m.params.push("access_token="+(f||tr.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:kt,userId:this.anonId},P=t?Wt(x,t):x,k={url:Tt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=hi(k,function(j){v.pendingRequest=null,r(j),v.saveEventData(),v.processRequests(f)})}},H.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Qt,$t,wr=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,m){this.skuToken=v,(tr.EVENTS_URL&&m||tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return w(x)||de(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},m)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),m=v.id,x=v.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),tt(this.anonId)||(this.anonId=ot()),this.postEvent(x,{skuToken:this.skuToken},function(P){P||m&&(f.success[m]=!0)},r))}},t}(H),Tr=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){tr.EVENTS_URL&&tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return w(v)||de(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Dt(tr.ACCESS_TOKEN),m=v?v.u:tr.ACCESS_TOKEN,x=m!==this.eventData.tokenU;tt(this.anonId)||(this.anonId=ot(),x=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),j=new Date(P),W=(P-this.eventData.lastSuccess)/864e5;x=x||W>=1||W<-1||k.getDate()!==j.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function($){$||(f.eventData.lastSuccess=P,f.eventData.tokenU=m)},r)}},t}(H)),Mr=Tr.postTurnstileEvent.bind(Tr),Or=new wr,Je=Or.postMapLoadEvent.bind(Or),At=500,_t=50;function pr(){K.caches&&!Qt&&(Qt=K.caches.open("mapbox-tiles"))}function en(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var mt,Nt=1/0;function ar(){return mt==null&&(mt=K.OffscreenCanvas&&new K.OffscreenCanvas(1,1).getContext("2d")&&typeof K.createImageBitmap=="function"),mt}var xr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(xr);var xn=function(e){function t(r,f,v){f===401&&de(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),In=it()?function(){return self.worker&&self.worker.referrer}:function(){return(K.location.protocol==="blob:"?K.parent:K).location.href},Ei,Ai,Bi=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(In())&&!/^\w+:/.test(r))){if(K.fetch&&K.Request&&K.AbortController&&K.Request.prototype.hasOwnProperty("signal"))return function(f,v){var m,x=new K.AbortController,P=new K.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:In(),signal:x.signal}),k=!1,j=!1,W=(m=P.url).indexOf("sku=")>0&&de(m);f.type==="json"&&P.headers.set("Accept","application/json");var $=function(pe,Ge,Xe){if(!j){if(pe&&pe.message!=="SecurityError"&&oe(pe),Ge&&Xe)return ie(Ge);var vt=Date.now();K.fetch(P).then(function(nt){if(nt.ok){var Rt=W?nt.clone():null;return ie(nt,Rt,vt)}return v(new xn(nt.statusText,nt.status,f.url))}).catch(function(nt){nt.code!==20&&v(new Error(nt.message))})}},ie=function(pe,Ge,Xe){(f.type==="arrayBuffer"?pe.arrayBuffer():f.type==="json"?pe.json():pe.text()).then(function(vt){j||(Ge&&Xe&&function(nt,Rt,Kt){if(pr(),Qt){var sr={status:Rt.status,statusText:Rt.statusText,headers:new K.Headers};Rt.headers.forEach(function(Ir,rn){return sr.headers.set(rn,Ir)});var hr=Jt(Rt.headers.get("Cache-Control")||"");hr["no-store"]||(hr["max-age"]&&sr.headers.set("Expires",new Date(Kt+1e3*hr["max-age"]).toUTCString()),new Date(sr.headers.get("Expires")).getTime()-Kt<42e4||function(Ir,rn){if($t===void 0)try{new Response(new ReadableStream),$t=!0}catch(pn){$t=!1}$t?rn(Ir.body):Ir.blob().then(rn)}(Rt,function(Ir){var rn=new K.Response(Ir,sr);pr(),Qt&&Qt.then(function(pn){return pn.put(en(nt.url),rn)}).catch(function(pn){return oe(pn.message)})}))}}(P,Ge,Xe),k=!0,v(null,vt,pe.headers.get("Cache-Control"),pe.headers.get("Expires")))}).catch(function(vt){j||v(new Error(vt.message))})};return W?function(pe,Ge){if(pr(),!Qt)return Ge(null);var Xe=en(pe.url);Qt.then(function(vt){vt.match(Xe).then(function(nt){var Rt=function(Kt){if(!Kt)return!1;var sr=new Date(Kt.headers.get("Expires")||0),hr=Jt(Kt.headers.get("Cache-Control")||"");return sr>Date.now()&&!hr["no-cache"]}(nt);vt.delete(Xe),Rt&&vt.put(Xe,nt.clone()),Ge(null,nt,Rt)}).catch(Ge)}).catch(Ge)}(P,$):$(null,null),{cancel:function(){j=!0,k||x.abort()}}}(e,t);if(it()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var m=new K.XMLHttpRequest;for(var x in m.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(m.responseType="arraybuffer"),f.headers)m.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=f.credentials==="include",m.onerror=function(){v(new Error(m.statusText))},m.onload=function(){if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){var P=m.response;if(f.type==="json")try{P=JSON.parse(m.response)}catch(k){return v(k)}v(null,P,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else v(new xn(m.statusText,m.status,f.url))},m.send(f.body),{cancel:function(){return m.abort()}}}(e,t)},aa=function(e,t){return Bi(Wt(e,{type:"arrayBuffer"}),t)},hi=function(e,t){return Bi(Wt(e,{method:"POST"}),t)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ei=[],Ai=0;var te=function(e,t){if(ne.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ai>=tr.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ei.push(r),r}Ai++;var f=!1,v=function(){if(!f)for(f=!0,Ai--;Ei.length&&Ai<tr.MAX_PARALLEL_IMAGE_REQUESTS;){var x=Ei.shift();x.cancelled||(x.cancel=te(x.requestParameters,x.callback).cancel)}},m=aa(e,function(x,P,k,j){v(),x?t(x):P&&(ar()?function(W,$){var ie=new K.Blob([new Uint8Array(W)],{type:"image/png"});K.createImageBitmap(ie).then(function(pe){$(null,pe)}).catch(function(pe){$(new Error("Could not load image because of "+pe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,t):function(W,$,ie,pe){var Ge=new K.Image,Xe=K.URL;Ge.onload=function(){$(null,Ge),Xe.revokeObjectURL(Ge.src),Ge.onload=null,K.requestAnimationFrame(function(){Ge.src=V})},Ge.onerror=function(){return $(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var vt=new K.Blob([new Uint8Array(W)],{type:"image/png"});Ge.cacheControl=ie,Ge.expires=pe,Ge.src=W.byteLength?Xe.createObjectURL(vt):V}(P,t,k,j))});return{cancel:function(){m.cancel(),v()}}};function le(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function we(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var je=function(e,t){t===void 0&&(t={}),Wt(this,t),this.type=e},ht=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Wt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(je),xt=function(){};xt.prototype.on=function(e,t){return this._listeners=this._listeners||{},le(e,t,this._listeners),this},xt.prototype.off=function(e,t){return we(e,t,this._listeners),we(e,t,this._oneTimeListeners),this},xt.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},le(e,t,this._oneTimeListeners),this},xt.prototype.fire=function(e,t){typeof e=="string"&&(e=new je(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var m=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];m<x.length;m+=1){var P=x[m];we(r,P,this._oneTimeListeners),P.call(this,e)}var k=this._eventedParent;k&&(Wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(e))}else e instanceof ht&&console.error(e.error);return this},xt.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},xt.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ke=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function Ut(e){var t=e.value;return t?[new Ke(e.key,t,"constants have been deprecated as of v8")]:[]}function Fr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var x in m)e[x]=m[x]}return e}function jr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Xt(e){if(Array.isArray(e))return e.map(Xt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Xt(e[r]);return t}return jr(e)}var mr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Hr=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};Hr.prototype.concat=function(e){return new Hr(this,e)},Hr.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Hr.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var gn={kind:"null"},gr={kind:"number"},vn={kind:"string"},$r={kind:"boolean"},cn={kind:"color"},pi={kind:"object"},fn={kind:"value"},gi={kind:"collator"},Wi={kind:"formatted"},vi={kind:"resolvedImage"};function Ri(e,t){return{kind:"array",itemType:e,N:t}}function Ii(e){if(e.kind==="array"){var t=Ii(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var go=[gn,gr,vn,$r,cn,Wi,pi,Ri(fn),vi];function ji(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ji(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=go;r<f.length;r+=1)if(!ji(f[r],t))return null}}return"Expected "+Ii(e)+" but found "+Ii(t)+" instead."}function Rn(e,t){return t.some(function(r){return r.kind===e.kind})}function Dn(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var ui=S(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(P){return(P=Math.round(P))<0?0:P>255?255:P}function v(P){return f(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function m(P){return(k=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:k>1?1:k;var k}function x(P,k,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?P+(k-P)*j*6:2*j<1?k:3*j<2?P+(k-P)*(2/3-j)*6:P}try{t.parseCSSColor=function(P){var k,j=P.replace(/ /g,"").toLowerCase();if(j in r)return r[j].slice();if(j[0]==="#")return j.length===4?(k=parseInt(j.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:j.length===7&&(k=parseInt(j.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var W=j.indexOf("("),$=j.indexOf(")");if(W!==-1&&$+1===j.length){var ie=j.substr(0,W),pe=j.substr(W+1,$-(W+1)).split(","),Ge=1;switch(ie){case"rgba":if(pe.length!==4)return null;Ge=m(pe.pop());case"rgb":return pe.length!==3?null:[v(pe[0]),v(pe[1]),v(pe[2]),Ge];case"hsla":if(pe.length!==4)return null;Ge=m(pe.pop());case"hsl":if(pe.length!==3)return null;var Xe=(parseFloat(pe[0])%360+360)%360/360,vt=m(pe[1]),nt=m(pe[2]),Rt=nt<=.5?nt*(vt+1):nt+vt-nt*vt,Kt=2*nt-Rt;return[f(255*x(Kt,Rt,Xe+1/3)),f(255*x(Kt,Rt,Xe)),f(255*x(Kt,Rt,Xe-1/3)),Ge];default:return null}}return null}}catch(P){}}).parseCSSColor,Vn=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Vn.parse=function(e){if(e){if(e instanceof Vn)return e;if(typeof e=="string"){var t=ui(e);if(t)return new Vn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Vn.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Vn.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Vn.black=new Vn(0,0,0,1),Vn.white=new Vn(1,1,1,1),Vn.transparent=new Vn(0,0,0,0),Vn.red=new Vn(1,0,0,1);var za=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};za.prototype.compare=function(e,t){return this.collator.compare(e,t)},za.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ds=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},Di=function(e){this.sections=e};Di.fromString=function(e){return new Di([new ds(e,null,null,null,null)])},Di.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},Di.factory=function(e){return e instanceof Di?e:Di.fromString(e)},Di.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},Di.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var Na=function(e){this.name=e.name,this.available=e.available};function Eu(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function fu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Vn||e instanceof za||e instanceof Di||e instanceof Na)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!fu(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!fu(e[f]))return!1;return!0}return!1}function ya(e){if(e===null)return gn;if(typeof e=="string")return vn;if(typeof e=="boolean")return $r;if(typeof e=="number")return gr;if(e instanceof Vn)return cn;if(e instanceof za)return gi;if(e instanceof Di)return Wi;if(e instanceof Na)return vi;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var m=ya(v[f]);if(t){if(t===m)continue;t=fn;break}t=m}return Ri(t||fn,r)}return pi}function lo(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Vn||e instanceof Di||e instanceof Na?e.toString():JSON.stringify(e)}Na.prototype.toString=function(){return this.name},Na.fromString=function(e){return e?new Na({name:e,available:!1}):null},Na.prototype.serialize=function(){return["image",this.name]};var Ga=function(e,t){this.type=e,this.value=t};Ga.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!fu(e[1]))return t.error("invalid value");var r=e[1],f=ya(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Ga(f,r)},Ga.prototype.evaluate=function(){return this.value},Ga.prototype.eachChild=function(){},Ga.prototype.outputDefined=function(){return!0},Ga.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vn?["rgba"].concat(this.value.toArray()):this.value instanceof Di?this.value.serialize():this.value};var Ha=function(e){this.name="ExpressionEvaluationError",this.message=e};Ha.prototype.toJSON=function(){return this.message};var Xo={string:vn,number:gr,boolean:$r,object:pi},oa=function(e,t){this.type=e,this.args=t};oa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var m,x;if(e.length>2){var P=e[1];if(typeof P!="string"||!(P in Xo)||P==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=Xo[P],f++}else m=fn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=Ri(m,x)}else r=Xo[v];for(var k=[];f<e.length;f++){var j=t.parse(e[f],f,fn);if(!j)return null;k.push(j)}return new oa(r,k)},oa.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ji(this.type,ya(r)))return r;if(t===this.args.length-1)throw new Ha("Expected value to be of type "+Ii(this.type)+", but found "+Ii(ya(r))+" instead.")}return null},oa.prototype.eachChild=function(e){this.args.forEach(e)},oa.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},oa.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Wa=function(e){this.type=Wi,this.sections=e};Wa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,m=1;m<=e.length-1;++m){var x=e[m];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var P=null;if(x["font-scale"]&&!(P=t.parse(x["font-scale"],1,gr)))return null;var k=null;if(x["text-font"]&&!(k=t.parse(x["text-font"],1,Ri(vn))))return null;var j=null;if(x["text-color"]&&!(j=t.parse(x["text-color"],1,cn)))return null;var W=f[f.length-1];W.scale=P,W.font=k,W.textColor=j}else{var $=t.parse(e[m],1,fn);if(!$)return null;var ie=$.type.kind;if(ie!=="string"&&ie!=="value"&&ie!=="null"&&ie!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:$,scale:null,font:null,textColor:null})}}return new Wa(f)},Wa.prototype.evaluate=function(e){return new Di(this.sections.map(function(t){var r=t.content.evaluate(e);return ya(r)===vi?new ds("",r,null,null,null):new ds(lo(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Wa.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Wa.prototype.outputDefined=function(){return!1},Wa.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var wa=function(e){this.type=vi,this.input=e};wa.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vn);return r?new wa(r):t.error("No image name provided.")},wa.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=Na.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},wa.prototype.eachChild=function(e){e(this.input)},wa.prototype.outputDefined=function(){return!1},wa.prototype.serialize=function(){return["image",this.input.serialize()]};var _a={"to-boolean":$r,"to-color":cn,"to-number":gr,"to-string":vn},ra=function(e,t){this.type=e,this.args=t};ra.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=_a[r],v=[],m=1;m<e.length;m++){var x=t.parse(e[m],m,fn);if(!x)return null;v.push(x)}return new ra(f,v)},ra.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Vn)return t;if(typeof t=="string"){var m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Eu(t[0],t[1],t[2],t[3])))return new Vn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ha(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,P=0,k=this.args;P<k.length;P+=1){if((x=k[P].evaluate(e))===null)return 0;var j=Number(x);if(!isNaN(j))return j}throw new Ha("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?Di.fromString(lo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Na.fromString(lo(this.args[0].evaluate(e))):lo(this.args[0].evaluate(e))},ra.prototype.eachChild=function(e){this.args.forEach(e)},ra.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ra.prototype.serialize=function(){if(this.type.kind==="formatted")return new Wa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new wa(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var sl=["Unknown","Point","LineString","Polygon"],ts=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ts.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ts.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?sl[this.feature.type]:this.feature.type:null},ts.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ts.prototype.canonicalID=function(){return this.canonical},ts.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ts.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Vn.parse(e)),t};var to=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};to.prototype.evaluate=function(e){return this._evaluate(e,this.args)},to.prototype.eachChild=function(e){this.args.forEach(e)},to.prototype.outputDefined=function(){return!1},to.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},to.parse=function(e,t){var r,f=e[0],v=to.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=x.filter(function($n){var Tn=$n[0];return!Array.isArray(Tn)||Tn.length===e.length-1}),k=null,j=0,W=P;j<W.length;j+=1){var $=W[j],ie=$[0],pe=$[1];k=new li(t.registry,t.path,null,t.scope);for(var Ge=[],Xe=!1,vt=1;vt<e.length;vt++){var nt=e[vt],Rt=Array.isArray(ie)?ie[vt-1]:ie.type,Kt=k.parse(nt,1+Ge.length,Rt);if(!Kt){Xe=!0;break}Ge.push(Kt)}if(!Xe)if(Array.isArray(ie)&&ie.length!==Ge.length)k.error("Expected "+ie.length+" arguments, but found "+Ge.length+" instead.");else{for(var sr=0;sr<Ge.length;sr++){var hr=Array.isArray(ie)?ie[sr]:ie.type,Ir=Ge[sr];k.concat(sr+1).checkSubtype(hr,Ir.type)}if(k.errors.length===0)return new to(f,m,pe,Ge)}}if(P.length===1)(r=t.errors).push.apply(r,k.errors);else{for(var rn=(P.length?P:x).map(function($n){var Tn;return Tn=$n[0],Array.isArray(Tn)?"("+Tn.map(Ii).join(", ")+")":"("+Ii(Tn.type)+"...)"}).join(" | "),pn=[],Yn=1;Yn<e.length;Yn++){var Sn=t.parse(e[Yn],1+pn.length);if(!Sn)return null;pn.push(Ii(Sn.type))}t.error("Expected arguments of type "+rn+", but found ("+pn.join(", ")+") instead.")}return null},to.register=function(e,t){for(var r in to.definitions=t,t)e[r]=to};var Oa=function(e,t,r){this.type=gi,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function fa(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function he(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Oe(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function gt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function fr(e,t){for(var r,f,v,m,x,P,k,j=!1,W=0,$=t.length;W<$;W++)for(var ie=t[W],pe=0,Ge=ie.length;pe<Ge-1;pe++){if((m=(r=e)[0]-(f=ie[pe])[0])*(k=r[1]-(v=ie[pe+1])[1])-(P=r[0]-v[0])*(x=r[1]-f[1])==0&&m*P<=0&&x*k<=0)return!1;gt(e,ie[pe],ie[pe+1])&&(j=!j)}return j}function tn(e,t){for(var r=0;r<t.length;r++)if(fr(e,t[r]))return!0;return!1}function kn(e,t,r,f){var v=f[0]-r[0],m=f[1]-r[1],x=(e[0]-r[0])*m-v*(e[1]-r[1]),P=(t[0]-r[0])*m-v*(t[1]-r[1]);return x>0&&P<0||x<0&&P>0}function Zi(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var m=v[f],x=0;x<m.length-1;++x)if(($=[(W=m[x+1])[0]-(j=m[x])[0],W[1]-j[1]])[0]*(ie=[(k=t)[0]-(P=e)[0],k[1]-P[1]])[1]-$[1]*ie[0]!=0&&kn(P,k,j,W)&&kn(j,W,P,k))return!0;var P,k,j,W,$,ie;return!1}function Xi(e,t){for(var r=0;r<e.length;++r)if(!fr(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Zi(e[f],e[f+1],t))return!1;return!0}function Xa(e,t){for(var r=0;r<t.length;r++)if(Xi(e,t[r]))return!0;return!1}function Ya(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var m=[],x=0;x<e[v].length;x++){var P=Oe(e[v][x],r);fa(t,P),m.push(P)}f.push(m)}return f}function Yo(e,t,r){for(var f=[],v=0;v<e.length;v++){var m=Ya(e[v],t,r);f.push(m)}return f}function Ss(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,m=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;m===0&&(m=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=m}fa(t,e)}function Hl(e,t,r,f){for(var v=8192*Math.pow(2,f.z),m=[8192*f.x,8192*f.y],x=[],P=0,k=e;P<k.length;P+=1)for(var j=0,W=k[P];j<W.length;j+=1){var $=W[j],ie=[$.x+m[0],$.y+m[1]];Ss(ie,t,r,v),x.push(ie)}return x}function Xu(e,t,r,f){for(var v,m=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],P=[],k=0,j=e;k<j.length;k+=1){for(var W=[],$=0,ie=j[k];$<ie.length;$+=1){var pe=ie[$],Ge=[pe.x+x[0],pe.y+x[1]];fa(t,Ge),W.push(Ge)}P.push(W)}if(t[2]-t[0]<=m/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var Xe=0,vt=P;Xe<vt.length;Xe+=1)for(var nt=0,Rt=vt[Xe];nt<Rt.length;nt+=1)Ss(Rt[nt],t,r,m)}return P}Oa.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,$r);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,$r);if(!v)return null;var m=null;return r.locale&&!(m=t.parse(r.locale,1,vn))?null:new Oa(f,v,m)},Oa.prototype.evaluate=function(e){return new za(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Oa.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Oa.prototype.outputDefined=function(){return!1},Oa.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var ko=function(e,t){this.type=$r,this.geojson=e,this.geometries=t};function Ls(e){if(e instanceof to&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof ko)return!1;var t=!0;return e.eachChild(function(r){t&&!Ls(r)&&(t=!1)}),t}function co(e){if(e instanceof to&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!co(r)&&(t=!1)}),t}function Rs(e,t){if(e instanceof to&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!Rs(f,t)&&(r=!1)}),r}ko.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(fu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ko(r,r.features[f].geometry)}else if(r.type==="Feature"){var m=r.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ko(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new ko(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ko.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var x=Ya(r.coordinates,v,m),P=Hl(t.geometry(),f,v,m);if(!he(f,v))return!1;for(var k=0,j=P;k<j.length;k+=1)if(!fr(j[k],x))return!1}if(r.type==="MultiPolygon"){var W=Yo(r.coordinates,v,m),$=Hl(t.geometry(),f,v,m);if(!he(f,v))return!1;for(var ie=0,pe=$;ie<pe.length;ie+=1)if(!tn(pe[ie],W))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var x=Ya(r.coordinates,v,m),P=Xu(t.geometry(),f,v,m);if(!he(f,v))return!1;for(var k=0,j=P;k<j.length;k+=1)if(!Xi(j[k],x))return!1}if(r.type==="MultiPolygon"){var W=Yo(r.coordinates,v,m),$=Xu(t.geometry(),f,v,m);if(!he(f,v))return!1;for(var ie=0,pe=$;ie<pe.length;ie+=1)if(!Xa(pe[ie],W))return!1}return!0}(e,this.geometries)}return!1},ko.prototype.eachChild=function(){},ko.prototype.outputDefined=function(){return!0},ko.prototype.serialize=function(){return["within",this.geojson]};var La=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};La.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new La(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},La.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},La.prototype.eachChild=function(){},La.prototype.outputDefined=function(){return!1},La.prototype.serialize=function(){return["var",this.name]};var li=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new Hr),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(m){return"["+m+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function ul(e,t){for(var r,f=e.length-1,v=0,m=f,x=0;v<=m;)if((r=e[x=Math.floor((v+m)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new Ha("Input is not a number.");m=x-1}return 0}li.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},li.prototype._parse=function(e,t){function r(j,W,$){return $==="assert"?new oa(W,[j]):$==="coerce"?new ra(W,[j]):j}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var m=v.parse(e,this);if(!m)return null;if(this.expectedType){var x=this.expectedType,P=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||P.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(x,P))return null}else m=r(m,x,t.typeAnnotation||"coerce");else m=r(m,x,t.typeAnnotation||"assert")}if(!(m instanceof Ga)&&m.type.kind!=="resolvedImage"&&function j(W){if(W instanceof La)return j(W.boundExpression);if(W instanceof to&&W.name==="error"||W instanceof Oa||W instanceof ko)return!1;var $=W instanceof ra||W instanceof oa,ie=!0;return W.eachChild(function(pe){ie=$?ie&&j(pe):ie&&pe instanceof Ga}),!!ie&&Ls(W)&&Rs(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var k=new ts;try{m=new Ga(m.type,m.evaluate(k))}catch(j){return this.error(j.message),null}}return m}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},li.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new li(this.registry,f,t||null,v,this.errors)},li.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new mr(f,e))},li.prototype.checkSubtype=function(e,t){var r=ji(e,t);return r&&this.error(r),r};var xa=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var m=v[f],x=m[1];this.labels.push(m[0]),this.outputs.push(x)}};function Nn(e,t,r){return e*(1-r)+t*r}xa.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var m=1;m<e.length;m+=2){var x=m===1?-1/0:e[m],P=e[m+1],k=m,j=m+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var W=t.parse(P,j,v);if(!W)return null;v=v||W.type,f.push([x,W])}return new xa(v,r,f)},xa.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[ul(t,f)].evaluate(e)},xa.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},xa.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},xa.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Ys=Object.freeze({__proto__:null,number:Nn,color:function(e,t,r){return new Vn(Nn(e.r,t.r,r),Nn(e.g,t.g,r),Nn(e.b,t.b,r),Nn(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Nn(f,t[v],r)})}}),Wl=6/29*3*(6/29),fo=Math.PI/180,Ze=180/Math.PI;function Ot(e){return e>.008856451679035631?Math.pow(e,1/3):e/Wl+4/29}function br(e){return e>6/29?e*e*e:Wl*(e-4/29)}function On(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Hi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ba(e){var t=Hi(e.r),r=Hi(e.g),f=Hi(e.b),v=Ot((.4124564*t+.3575761*r+.1804375*f)/.95047),m=Ot((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*m-16,a:500*(v-m),b:200*(m-Ot((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function Za(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*br(t),r=.95047*br(r),f=1.08883*br(f),new Vn(On(3.2404542*r-1.5371385*t-.4985314*f),On(-.969266*r+1.8760108*t+.041556*f),On(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function na(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var Ra={forward:ba,reverse:Za,interpolate:function(e,t,r){return{l:Nn(e.l,t.l,r),a:Nn(e.a,t.a,r),b:Nn(e.b,t.b,r),alpha:Nn(e.alpha,t.alpha,r)}}},Fo={forward:function(e){var t=ba(e),r=t.l,f=t.a,v=t.b,m=Math.atan2(v,f)*Ze;return{h:m<0?m+360:m,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*fo,r=e.c;return Za({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:na(e.h,t.h,r),c:Nn(e.c,t.c,r),l:Nn(e.l,t.l,r),alpha:Nn(e.alpha,t.alpha,r)}}},Mo=Object.freeze({__proto__:null,lab:Ra,hcl:Fo}),yi=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var m=0,x=v;m<x.length;m+=1){var P=x[m],k=P[1];this.labels.push(P[0]),this.outputs.push(k)}};function Yu(e,t,r,f){var v=f-r,m=e-r;return v===0?0:t===1?m/v:(Math.pow(t,m)-1)/(Math.pow(t,v)-1)}yi.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=Yu(t,e.base,r,f);else if(e.name==="linear")v=Yu(t,1,r,f);else if(e.name==="cubic-bezier"){var m=e.controlPoints;v=new L(m[0],m[1],m[2],m[3]).solve(Yu(t,1,r,f))}return v},yi.parse=function(e,t){var r=e[0],f=e[1],v=e[2],m=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var P=f.slice(1);if(P.length!==4||P.some(function(vt){return typeof vt!="number"||vt<0||vt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,gr)))return null;var k=[],j=null;r==="interpolate-hcl"||r==="interpolate-lab"?j=cn:t.expectedType&&t.expectedType.kind!=="value"&&(j=t.expectedType);for(var W=0;W<m.length;W+=2){var $=m[W],ie=m[W+1],pe=W+3,Ge=W+4;if(typeof $!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',pe);if(k.length&&k[k.length-1][0]>=$)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',pe);var Xe=t.parse(ie,Ge,j);if(!Xe)return null;j=j||Xe.type,k.push([$,Xe])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new yi(j,r,f,v,k):t.error("Type "+Ii(j)+" is not interpolatable.")},yi.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var m=ul(t,f),x=yi.interpolationFactor(this.interpolation,f,t[m],t[m+1]),P=r[m].evaluate(e),k=r[m+1].evaluate(e);return this.operator==="interpolate"?Ys[this.type.kind.toLowerCase()](P,k,x):this.operator==="interpolate-hcl"?Fo.reverse(Fo.interpolate(Fo.forward(P),Fo.forward(k),x)):Ra.reverse(Ra.interpolate(Ra.forward(P),Ra.forward(k),x))},yi.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},yi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},yi.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var hu=function(e,t){this.type=e,this.args=t};hu.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],m=0,x=e.slice(1);m<x.length;m+=1){var P=t.parse(x[m],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!P)return null;r=r||P.type,v.push(P)}var k=f&&v.some(function(j){return ji(f,j.type)});return new hu(k?fn:r,v)},hu.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,m=this.args;v<m.length&&(f++,(r=m[v].evaluate(e))&&r instanceof Na&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},hu.prototype.eachChild=function(e){this.args.forEach(e)},hu.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},hu.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ko=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Ko.prototype.evaluate=function(e){return this.result.evaluate(e)},Ko.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Ko.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var m=t.parse(e[f+1],f+1);if(!m)return null;r.push([v,m])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new Ko(r,x):null},Ko.prototype.outputDefined=function(){return this.result.outputDefined()},Ko.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var ll=function(e,t,r){this.type=e,this.index=t,this.input=r};ll.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,gr),f=t.parse(e[2],2,Ri(t.expectedType||fn));return r&&f?new ll(f.type.itemType,r,f):null},ll.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Ha("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Ha("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Ha("Array index must be an integer, but found "+t+" instead.");return r[t]},ll.prototype.eachChild=function(e){e(this.index),e(this.input)},ll.prototype.outputDefined=function(){return!1},ll.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Eo=function(e,t){this.type=$r,this.needle=e,this.haystack=t};Eo.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,fn),f=t.parse(e[2],2,fn);return r&&f?Rn(r.type,[$r,vn,gr,gn,fn])?new Eo(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(r.type)+" instead"):null},Eo.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Dn(t,["boolean","string","number","null"]))throw new Ha("Expected first argument to be of type boolean, string, number or null, but found "+Ii(ya(t))+" instead.");if(!Dn(r,["string","array"]))throw new Ha("Expected second argument to be of type array or string, but found "+Ii(ya(r))+" instead.");return r.indexOf(t)>=0},Eo.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Eo.prototype.outputDefined=function(){return!0},Eo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Es=function(e,t,r){this.type=gr,this.needle=e,this.haystack=t,this.fromIndex=r};Es.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,fn),f=t.parse(e[2],2,fn);if(!r||!f)return null;if(!Rn(r.type,[$r,vn,gr,gn,fn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ii(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,gr);return v?new Es(r,f,v):null}return new Es(r,f)},Es.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Dn(t,["boolean","string","number","null"]))throw new Ha("Expected first argument to be of type boolean, string, number or null, but found "+Ii(ya(t))+" instead.");if(!Dn(r,["string","array"]))throw new Ha("Expected second argument to be of type array or string, but found "+Ii(ya(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},Es.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},Es.prototype.outputDefined=function(){return!1},Es.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Io=function(e,t,r,f,v,m){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=m};Io.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},m=[],x=2;x<e.length-1;x+=2){var P=e[x],k=e[x+1];Array.isArray(P)||(P=[P]);var j=t.concat(x);if(P.length===0)return j.error("Expected at least one branch label.");for(var W=0,$=P;W<$.length;W+=1){var ie=$[W];if(typeof ie!="number"&&typeof ie!="string")return j.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return j.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ie=="number"&&Math.floor(ie)!==ie)return j.error("Numeric branch labels must be integer values.");if(r){if(j.checkSubtype(r,ya(ie)))return null}else r=ya(ie);if(v[String(ie)]!==void 0)return j.error("Branch labels must be unique.");v[String(ie)]=m.length}var pe=t.parse(k,x,f);if(!pe)return null;f=f||pe.type,m.push(pe)}var Ge=t.parse(e[1],1,fn);if(!Ge)return null;var Xe=t.parse(e[e.length-1],e.length-1,f);return Xe?Ge.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ge.type)?null:new Io(r,f,Ge,v,m,Xe):null},Io.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(ya(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Io.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Io.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Io.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,m=Object.keys(this.cases).sort();v<m.length;v+=1){var x=m[v];($=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[$][1].push(x)}for(var P=function(pe){return e.inputType.kind==="number"?Number(pe):pe},k=0,j=r;k<j.length;k+=1){var W=j[k],$=W[0],ie=W[1];t.push(ie.length===1?P(ie[0]):ie.map(P)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var pu=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};pu.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var m=t.parse(e[v],v,$r);if(!m)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([m,x]),r=r||x.type}var P=t.parse(e[e.length-1],e.length-1,r);return P?new pu(r,f,P):null},pu.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},pu.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},pu.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},pu.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ds=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function lc(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function qc(e,t,r,f){return f.compare(t,r)===0}function Ta(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(m,x,P){this.type=$r,this.lhs=m,this.rhs=x,this.collator=P,this.hasUntypedArgument=m.type.kind==="value"||x.type.kind==="value"}return v.parse=function(m,x){if(m.length!==3&&m.length!==4)return x.error("Expected two or three arguments.");var P=m[0],k=x.parse(m[1],1,fn);if(!k)return null;if(!lc(P,k.type))return x.concat(1).error('"'+P+`" comparisons are not supported for type '`+Ii(k.type)+"'.");var j=x.parse(m[2],2,fn);if(!j)return null;if(!lc(P,j.type))return x.concat(2).error('"'+P+`" comparisons are not supported for type '`+Ii(j.type)+"'.");if(k.type.kind!==j.type.kind&&k.type.kind!=="value"&&j.type.kind!=="value")return x.error("Cannot compare types '"+Ii(k.type)+"' and '"+Ii(j.type)+"'.");f&&(k.type.kind==="value"&&j.type.kind!=="value"?k=new oa(j.type,[k]):k.type.kind!=="value"&&j.type.kind==="value"&&(j=new oa(k.type,[j])));var W=null;if(m.length===4){if(k.type.kind!=="string"&&j.type.kind!=="string"&&k.type.kind!=="value"&&j.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!(W=x.parse(m[3],3,gi)))return null}return new v(k,j,W)},v.prototype.evaluate=function(m){var x=this.lhs.evaluate(m),P=this.rhs.evaluate(m);if(f&&this.hasUntypedArgument){var k=ya(x),j=ya(P);if(k.kind!==j.kind||k.kind!=="string"&&k.kind!=="number")throw new Ha('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+k.kind+", "+j.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var W=ya(x),$=ya(P);if(W.kind!=="string"||$.kind!=="string")return t(m,x,P)}return this.collator?r(m,x,P,this.collator.evaluate(m)):t(m,x,P)},v.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var m=[e];return this.eachChild(function(x){m.push(x.serialize())}),m},v}()}Ds.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,fn),f=t.parse(e[2],2,gr);if(!r||!f)return null;if(!Rn(r.type,[Ri(fn),vn,fn]))return t.error("Expected first argument to be of type array or string, but found "+Ii(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,gr);return v?new Ds(r.type,r,f,v):null}return new Ds(r.type,r,f)},Ds.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Dn(t,["string","array"]))throw new Ha("Expected first argument to be of type array or string, but found "+Ii(ya(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},Ds.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},Ds.prototype.outputDefined=function(){return!1},Ds.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var bf=Ta("==",function(e,t,r){return t===r},qc),ku=Ta("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!qc(0,t,r,f)}),Cl=Ta("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),Lc=Ta(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),cc=Ta("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),ro=Ta(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),cl=function(e,t,r,f,v){this.type=vn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};cl.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,vn)))return null;var m=null;if(f.currency&&!(m=t.parse(f.currency,1,vn)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,gr)))return null;var P=null;return f["max-fraction-digits"]&&!(P=t.parse(f["max-fraction-digits"],1,gr))?null:new cl(r,v,m,x,P)},cl.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},cl.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},cl.prototype.outputDefined=function(){return!1},cl.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var fl=function(e){this.type=gr,this.input=e};fl.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Ii(r.type)+" instead."):new fl(r):null},fl.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Ha("Expected value to be of type string or array, but found "+Ii(ya(t))+" instead.")},fl.prototype.eachChild=function(e){e(this.input)},fl.prototype.outputDefined=function(){return!1},fl.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var rs={"==":bf,"!=":ku,">":Lc,"<":Cl,">=":ro,"<=":cc,array:oa,at:ll,boolean:oa,case:pu,coalesce:hu,collator:Oa,format:Wa,image:wa,in:Eo,"index-of":Es,interpolate:yi,"interpolate-hcl":yi,"interpolate-lab":yi,length:fl,let:Ko,literal:Ga,match:Io,number:oa,"number-format":cl,object:oa,slice:Ds,step:xa,string:oa,"to-boolean":ra,"to-color":ra,"to-number":ra,"to-string":ra,var:La,within:ko};function fc(e,t){var r=t[0],f=t[1],v=t[2],m=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=m?m.evaluate(e):1,P=Eu(r,f,v,x);if(P)throw new Ha(P);return new Vn(r/255*x,f/255*x,v/255*x,x)}function Ku(e,t){return e in t}function Ks(e,t){var r=t[e];return r===void 0?null:r}function $o(e){return{type:e}}function Rc(e){return{result:"success",value:e}}function wu(e){return{result:"error",value:e}}function $u(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function Df(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function hl(e){return!!e.expression&&e.expression.interpolated}function Sa(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Ju(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Xl(e){return e}function Yl(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function $s(e,t,r,f,v){return Yl(typeof r===v?f[r]:void 0,e.default,t.default)}function Dc(e,t,r){if(Sa(r)!=="number")return Yl(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=ul(e.stops.map(function(m){return m[0]}),r);return e.stops[v][1]}function Kl(e,t,r){var f=e.base!==void 0?e.base:1;if(Sa(r)!=="number")return Yl(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var m=ul(e.stops.map(function($){return $[0]}),r),x=function($,ie,pe,Ge){var Xe=Ge-pe,vt=$-pe;return Xe===0?0:ie===1?vt/Xe:(Math.pow(ie,vt)-1)/(Math.pow(ie,Xe)-1)}(r,f,e.stops[m][0],e.stops[m+1][0]),P=e.stops[m][1],k=e.stops[m+1][1],j=Ys[t.type]||Xl;if(e.colorSpace&&e.colorSpace!=="rgb"){var W=Mo[e.colorSpace];j=function($,ie){return W.reverse(W.interpolate(W.forward($),W.forward(ie),x))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var $=[],ie=arguments.length;ie--;)$[ie]=arguments[ie];var pe=P.evaluate.apply(void 0,$),Ge=k.evaluate.apply(void 0,$);if(pe!==void 0&&Ge!==void 0)return j(pe,Ge,x)}}:j(P,k,x)}function $l(e,t,r){return t.type==="color"?r=Vn.parse(r):t.type==="formatted"?r=Di.fromString(r.toString()):t.type==="resolvedImage"?r=Na.fromString(r.toString()):Sa(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Yl(r,e.default,t.default)}to.register(rs,{error:[{kind:"error"},[vn],function(e,t){throw new Ha(t[0].evaluate(e))}],typeof:[vn,[fn],function(e,t){return Ii(ya(t[0].evaluate(e)))}],"to-rgba":[Ri(gr,4),[cn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[cn,[gr,gr,gr],fc],rgba:[cn,[gr,gr,gr,gr],fc],has:{type:$r,overloads:[[[vn],function(e,t){return Ku(t[0].evaluate(e),e.properties())}],[[vn,pi],function(e,t){var r=t[1];return Ku(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:fn,overloads:[[[vn],function(e,t){return Ks(t[0].evaluate(e),e.properties())}],[[vn,pi],function(e,t){var r=t[1];return Ks(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[fn,[vn],function(e,t){return Ks(t[0].evaluate(e),e.featureState||{})}],properties:[pi,[],function(e){return e.properties()}],"geometry-type":[vn,[],function(e){return e.geometryType()}],id:[fn,[],function(e){return e.id()}],zoom:[gr,[],function(e){return e.globals.zoom}],"heatmap-density":[gr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[gr,[],function(e){return e.globals.lineProgress||0}],accumulated:[fn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[gr,$o(gr),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[gr,$o(gr),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:gr,overloads:[[[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[gr],function(e,t){return-t[0].evaluate(e)}]]},"/":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[gr,[],function(){return Math.LN2}],pi:[gr,[],function(){return Math.PI}],e:[gr,[],function(){return Math.E}],"^":[gr,[gr,gr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[gr,[gr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[gr,[gr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[gr,[gr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[gr,[gr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[gr,[gr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[gr,[gr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[gr,[gr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[gr,$o(gr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[gr,$o(gr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[gr,[gr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[gr,[gr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[gr,[gr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[gr,[gr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[$r,[vn,fn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[$r,[fn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[$r,[vn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[$r,[vn,fn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<m}],"filter-id-<":[$r,[fn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[$r,[vn,fn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>m}],"filter-id->":[$r,[fn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[$r,[vn,fn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<=m}],"filter-id-<=":[$r,[fn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[$r,[vn,fn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>=m}],"filter-id->=":[$r,[fn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[$r,[fn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[$r,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[$r,[Ri(vn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[$r,[Ri(fn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[$r,[vn,Ri(fn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[$r,[vn,Ri(fn)],function(e,t){var r=t[0],f=t[1];return function(v,m,x,P){for(;x<=P;){var k=x+P>>1;if(m[k]===v)return!0;m[k]>v?P=k-1:x=k+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:$r,overloads:[[[$r,$r],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[$o($r),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:$r,overloads:[[[$r,$r],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[$o($r),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[$r,[$r],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[$r,[vn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[vn,$o(fn),function(e,t){return t.map(function(r){return lo(r.evaluate(e))}).join("")}],"resolved-locale":[vn,[gi],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Qu=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ts,this._defaultValue=t?function(r){return r.type==="color"&&Ju(r.default)?new Vn(0,0,0,0):r.type==="color"?Vn.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Tu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in rs}function Pl(e,t){var r=new li(rs,[],t?function(v){var m={color:cn,string:vn,number:gr,enum:vn,boolean:$r,formatted:Wi,resolvedImage:vi};return v.type==="array"?Ri(m[v.value]||fn,v.length):m[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Rc(new Qu(f,t)):wu(r.errors)}Qu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},Qu.prototype.evaluate=function(e,t,r,f,v,m){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Ha("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Ml=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!co(t.expression)};Ml.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},Ml.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)};var pl=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!co(t.expression),this.interpolationType=f};function kc(e,t){if((e=Pl(e,t)).result==="error")return e;var r=e.value.expression,f=Ls(r);if(!f&&!$u(t))return wu([new mr("","data expressions not supported")]);var v=Rs(r,["zoom"]);if(!v&&!Df(t))return wu([new mr("","zoom expressions not supported")]);var m=function x(P){var k=null;if(P instanceof Ko)k=x(P.result);else if(P instanceof hu)for(var j=0,W=P.args;j<W.length&&!(k=x(W[j]));j+=1);else(P instanceof xa||P instanceof yi)&&P.input instanceof to&&P.input.name==="zoom"&&(k=P);return k instanceof mr||P.eachChild(function($){var ie=x($);ie instanceof mr?k=ie:!k&&ie?k=new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&ie&&k!==ie&&(k=new mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(r);return m||v?m instanceof mr?wu([m]):m instanceof yi&&!hl(t)?wu([new mr("",'"interpolate" expressions cannot be used with this property')]):Rc(m?new pl(f?"camera":"composite",e.value,m.labels,m instanceof yi?m.interpolation:void 0):new Ml(f?"constant":"source",e.value)):wu([new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}pl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},pl.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)},pl.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?yi.interpolationFactor(this.interpolationType,e,t,r):0};var dl=function(e,t){this._parameters=e,this._specification=t,Fr(this,function r(f,v){var m,x,P,k=v.type==="color",j=f.stops&&typeof f.stops[0][0]=="object",W=j||!(j||f.property!==void 0),$=f.type||(hl(v)?"exponential":"interval");if(k&&((f=Fr({},f)).stops&&(f.stops=f.stops.map(function(Sn){return[Sn[0],Vn.parse(Sn[1])]})),f.default=Vn.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!Mo[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if($==="exponential")m=Kl;else if($==="interval")m=Dc;else if($==="categorical"){m=$s,x=Object.create(null);for(var ie=0,pe=f.stops;ie<pe.length;ie+=1){var Ge=pe[ie];x[Ge[0]]=Ge[1]}P=typeof f.stops[0][0]}else{if($!=="identity")throw new Error('Unknown function type "'+$+'"');m=$l}if(j){for(var Xe={},vt=[],nt=0;nt<f.stops.length;nt++){var Rt=f.stops[nt],Kt=Rt[0].zoom;Xe[Kt]===void 0&&(Xe[Kt]={zoom:Kt,type:f.type,property:f.property,default:f.default,stops:[]},vt.push(Kt)),Xe[Kt].stops.push([Rt[0].value,Rt[1]])}for(var sr=[],hr=0,Ir=vt;hr<Ir.length;hr+=1){var rn=Ir[hr];sr.push([Xe[rn].zoom,r(Xe[rn],v)])}var pn={name:"linear"};return{kind:"composite",interpolationType:pn,interpolationFactor:yi.interpolationFactor.bind(void 0,pn),zoomStops:sr.map(function(Sn){return Sn[0]}),evaluate:function(Sn,$n){var Tn=Sn.zoom;return Kl({stops:sr,base:f.base},v,Tn).evaluate(Tn,$n)}}}if(W){var Yn=$==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:Yn,interpolationFactor:yi.interpolationFactor.bind(void 0,Yn),zoomStops:f.stops.map(function(Sn){return Sn[0]}),evaluate:function(Sn){return m(f,v,Sn.zoom,x,P)}}}return{kind:"source",evaluate:function(Sn,$n){var Tn=$n&&$n.properties?$n.properties[f.property]:void 0;return Tn===void 0?Yl(f.default,v.default):m(f,v,Tn,x,P)}}}(this._parameters,this._specification))};function Js(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},m=e.style,x=e.styleSpec,P=[],k=Sa(r);if(k!=="object")return[new Ke(t,r,"object expected, "+k+" found")];for(var j in r){var W=j.split(".")[0],$=f[W]||f["*"],ie=void 0;if(v[W])ie=v[W];else if(f[W])ie=zi;else if(v["*"])ie=v["*"];else{if(!f["*"]){P.push(new Ke(t,r[j],'unknown property "'+j+'"'));continue}ie=zi}P=P.concat(ie({key:(t&&t+".")+j,value:r[j],valueSpec:$,style:m,styleSpec:x,object:r,objectKey:j},r))}for(var pe in f)v[pe]||f[pe].required&&f[pe].default===void 0&&r[pe]===void 0&&P.push(new Ke(t,r,'missing required property "'+pe+'"'));return P}function Il(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,m=e.key,x=e.arrayElementValidator||zi;if(Sa(t)!=="array")return[new Ke(m,t,"array expected, "+Sa(t)+" found")];if(r.length&&t.length!==r.length)return[new Ke(m,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Ke(m,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var P={type:r.value,values:r.values};v.$version<7&&(P.function=r.function),Sa(r.value)==="object"&&(P=r.value);for(var k=[],j=0;j<t.length;j++)k=k.concat(x({array:t,arrayIndex:j,value:t[j],valueSpec:P,style:f,styleSpec:v,key:m+"["+j+"]"}));return k}function ef(e){var t=e.key,r=e.value,f=e.valueSpec,v=Sa(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Ke(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Ke(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Ke(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function tf(e){var t,r,f,v=e.valueSpec,m=jr(e.value.type),x={},P=m!=="categorical"&&e.value.property===void 0,k=!P,j=Sa(e.value.stops)==="array"&&Sa(e.value.stops[0])==="array"&&Sa(e.value.stops[0][0])==="object",W=Js({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(pe){if(m==="identity")return[new Ke(pe.key,pe.value,'identity function may not have a "stops" property')];var Ge=[],Xe=pe.value;return Ge=Ge.concat(Il({key:pe.key,value:Xe,valueSpec:pe.valueSpec,style:pe.style,styleSpec:pe.styleSpec,arrayElementValidator:$})),Sa(Xe)==="array"&&Xe.length===0&&Ge.push(new Ke(pe.key,Xe,"array must have at least one stop")),Ge},default:function(pe){return zi({key:pe.key,value:pe.value,valueSpec:v,style:pe.style,styleSpec:pe.styleSpec})}}});return m==="identity"&&P&&W.push(new Ke(e.key,e.value,'missing required property "property"')),m==="identity"||e.value.stops||W.push(new Ke(e.key,e.value,'missing required property "stops"')),m==="exponential"&&e.valueSpec.expression&&!hl(e.valueSpec)&&W.push(new Ke(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(k&&!$u(e.valueSpec)?W.push(new Ke(e.key,e.value,"property functions not supported")):P&&!Df(e.valueSpec)&&W.push(new Ke(e.key,e.value,"zoom functions not supported"))),m!=="categorical"&&!j||e.value.property!==void 0||W.push(new Ke(e.key,e.value,'"property" property is required')),W;function $(pe){var Ge=[],Xe=pe.value,vt=pe.key;if(Sa(Xe)!=="array")return[new Ke(vt,Xe,"array expected, "+Sa(Xe)+" found")];if(Xe.length!==2)return[new Ke(vt,Xe,"array length 2 expected, length "+Xe.length+" found")];if(j){if(Sa(Xe[0])!=="object")return[new Ke(vt,Xe,"object expected, "+Sa(Xe[0])+" found")];if(Xe[0].zoom===void 0)return[new Ke(vt,Xe,"object stop key must have zoom")];if(Xe[0].value===void 0)return[new Ke(vt,Xe,"object stop key must have value")];if(f&&f>jr(Xe[0].zoom))return[new Ke(vt,Xe[0].zoom,"stop zoom values must appear in ascending order")];jr(Xe[0].zoom)!==f&&(f=jr(Xe[0].zoom),r=void 0,x={}),Ge=Ge.concat(Js({key:vt+"[0]",value:Xe[0],valueSpec:{zoom:{}},style:pe.style,styleSpec:pe.styleSpec,objectElementValidators:{zoom:ef,value:ie}}))}else Ge=Ge.concat(ie({key:vt+"[0]",value:Xe[0],valueSpec:{},style:pe.style,styleSpec:pe.styleSpec},Xe));return Tu(Xt(Xe[1]))?Ge.concat([new Ke(vt+"[1]",Xe[1],"expressions are not allowed in function stops.")]):Ge.concat(zi({key:vt+"[1]",value:Xe[1],valueSpec:v,style:pe.style,styleSpec:pe.styleSpec}))}function ie(pe,Ge){var Xe=Sa(pe.value),vt=jr(pe.value),nt=pe.value!==null?pe.value:Ge;if(t){if(Xe!==t)return[new Ke(pe.key,nt,Xe+" stop domain type must match previous stop domain type "+t)]}else t=Xe;if(Xe!=="number"&&Xe!=="string"&&Xe!=="boolean")return[new Ke(pe.key,nt,"stop domain value must be a number, string, or boolean")];if(Xe!=="number"&&m!=="categorical"){var Rt="number expected, "+Xe+" found";return $u(v)&&m===void 0&&(Rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(pe.key,nt,Rt)]}return m!=="categorical"||Xe!=="number"||isFinite(vt)&&Math.floor(vt)===vt?m!=="categorical"&&Xe==="number"&&r!==void 0&&vt<r?[new Ke(pe.key,nt,"stop domain values must appear in ascending order")]:(r=vt,m==="categorical"&&vt in x?[new Ke(pe.key,nt,"stop domain values must be unique")]:(x[vt]=!0,[])):[new Ke(pe.key,nt,"integer expected, found "+vt)]}}function pa(e){var t=(e.expressionContext==="property"?kc:Pl)(Xt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Ke(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Ke(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!co(r))return[new Ke(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!co(r))return[new Ke(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Rs(r,["zoom","feature-state"]))return[new Ke(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!Ls(r))return[new Ke(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(jr(r))===-1&&v.push(new Ke(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(jr(r))===-1&&v.push(new Ke(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function hc(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!hc(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}dl.deserialize=function(e){return new dl(e._parameters,e._specification)},dl.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var qu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ol(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};hc(e)||(e=Fu(e));var t=Pl(e,qu);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function pc(e,t){return e<t?-1:e>t?1:0}function Fu(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Fc(e[1],e[2],"=="):r==="!="?Ll(Fc(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Fc(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Fu))):r==="all"?["all"].concat(e.slice(1).map(Fu)):r==="none"?["all"].concat(e.slice(1).map(Fu).map(Ll)):r==="in"?rf(e[1],e.slice(2)):r==="!in"?Ll(rf(e[1],e.slice(2))):r==="has"?nf(e[1]):r==="!has"?Ll(nf(e[1])):r!=="within"||e}function Fc(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function rf(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(pc)]]:["filter-in-small",e,["literal",t]]}}function nf(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ll(e){return["!",e]}function zc(e){return hc(Xt(e.value))?pa(Fr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Sa(f)!=="array")return[new Ke(v,f,"array expected, "+Sa(f)+" found")];var m,x=r.styleSpec,P=[];if(f.length<1)return[new Ke(v,f,"filter array must have at least 1 element")];switch(P=P.concat(Jl({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),jr(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&jr(f[1])==="$type"&&P.push(new Ke(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&P.push(new Ke(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(m=Sa(f[1]))!=="string"&&P.push(new Ke(v+"[1]",f[1],"string expected, "+m+" found"));for(var k=2;k<f.length;k++)m=Sa(f[k]),jr(f[1])==="$type"?P=P.concat(Jl({key:v+"["+k+"]",value:f[k],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&P.push(new Ke(v+"["+k+"]",f[k],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var j=1;j<f.length;j++)P=P.concat(t({key:v+"["+j+"]",value:f[j],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=Sa(f[1]),f.length!==2?P.push(new Ke(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="string"&&P.push(new Ke(v+"[1]",f[1],"string expected, "+m+" found"));break;case"within":m=Sa(f[1]),f.length!==2?P.push(new Ke(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="object"&&P.push(new Ke(v+"[1]",f[1],"object expected, "+m+" found"))}return P}(e)}function Nc(e,t){var r=e.key,f=e.style,v=e.styleSpec,m=e.value,x=e.objectKey,P=v[t+"_"+e.layerType];if(!P)return[];var k=x.match(/^(.*)-transition$/);if(t==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return zi({key:r,value:m,valueSpec:v.transition,style:f,styleSpec:v});var j,W=e.valueSpec||P[x];if(!W)return[new Ke(r,m,'unknown property "'+x+'"')];if(Sa(m)==="string"&&$u(W)&&!W.tokens&&(j=/^{([^}]+)}$/.exec(m)))return[new Ke(r,m,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(j[1])+" }`.")];var $=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&$.push(new Ke(r,m,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Ju(Xt(m))&&jr(m.type)==="identity"&&$.push(new Ke(r,m,'"text-font" does not support identity functions'))),$.concat(zi({key:e.key,value:m,valueSpec:W,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function Bc(e){return Nc(e,"paint")}function vl(e){return Nc(e,"layout")}function Uc(e){var t=[],r=e.value,f=e.key,v=e.style,m=e.styleSpec;r.type||r.ref||t.push(new Ke(f,r,'either "type" or "ref" is required'));var x,P=jr(r.type),k=jr(r.ref);if(r.id)for(var j=jr(r.id),W=0;W<e.arrayIndex;W++){var $=v.layers[W];jr($.id)===j&&t.push(new Ke(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+$.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ge){Ge in r&&t.push(new Ke(f,r[Ge],'"'+Ge+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ge){jr(Ge.id)===k&&(x=Ge)}),x?x.ref?t.push(new Ke(f,r.ref,"ref cannot reference another ref layer")):P=jr(x.type):t.push(new Ke(f,r.ref,'ref layer "'+k+'" not found'));else if(P!=="background")if(r.source){var ie=v.sources&&v.sources[r.source],pe=ie&&jr(ie.type);ie?pe==="vector"&&P==="raster"?t.push(new Ke(f,r.source,'layer "'+r.id+'" requires a raster source')):pe==="raster"&&P!=="raster"?t.push(new Ke(f,r.source,'layer "'+r.id+'" requires a vector source')):pe!=="vector"||r["source-layer"]?pe==="raster-dem"&&P!=="hillshade"?t.push(new Ke(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!r.paint||!r.paint["line-gradient"]||pe==="geojson"&&ie.lineMetrics||t.push(new Ke(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Ke(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Ke(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Ke(f,r,'missing required property "source"'));return t=t.concat(Js({key:f,value:r,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return zi({key:f+".type",value:r.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:zc,layout:function(Ge){return Js({layer:r,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(Xe){return vl(Fr({layerType:P},Xe))}}})},paint:function(Ge){return Js({layer:r,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(Xe){return Bc(Fr({layerType:P},Xe))}}})}}}))}function zu(e){var t=e.value,r=e.key,f=Sa(t);return f!=="string"?[new Ke(r,t,"string expected, "+f+" found")]:[]}var Da={promoteId:function(e){var t=e.key,r=e.value;if(Sa(r)==="string")return zu({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,zu({key:t+"."+v,value:r[v]}));return f}};function Ql(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Ke(r,t,'"type" is required')];var m,x=jr(t.type);switch(x){case"vector":case"raster":case"raster-dem":return Js({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Da});case"geojson":if(m=Js({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Da}),t.cluster)for(var P in t.clusterProperties){var k=t.clusterProperties[P],j=k[0],W=typeof j=="string"?[j,["accumulated"],["get",P]]:j;m.push.apply(m,pa({key:r+"."+P+".map",value:k[1],expressionContext:"cluster-map"})),m.push.apply(m,pa({key:r+"."+P+".reduce",value:W,expressionContext:"cluster-reduce"}))}return m;case"video":return Js({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return Js({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Ke(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Nu(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,m=[],x=Sa(t);if(t===void 0)return m;if(x!=="object")return m.concat([new Ke("light",t,"object expected, "+x+" found")]);for(var P in t){var k=P.match(/^(.*)-transition$/);m=m.concat(k&&f[k[1]]&&f[k[1]].transition?zi({key:P,value:t[P],valueSpec:r.transition,style:v,styleSpec:r}):f[P]?zi({key:P,value:t[P],valueSpec:f[P],style:v,styleSpec:r}):[new Ke(P,t[P],'unknown property "'+P+'"')])}return m}var el={"*":function(){return[]},array:Il,boolean:function(e){var t=e.value,r=e.key,f=Sa(t);return f!=="boolean"?[new Ke(r,t,"boolean expected, "+f+" found")]:[]},number:ef,color:function(e){var t=e.key,r=e.value,f=Sa(r);return f!=="string"?[new Ke(t,r,"color expected, "+f+" found")]:ui(r)===null?[new Ke(t,r,'color expected, "'+r+'" found')]:[]},constants:Ut,enum:Jl,filter:zc,function:tf,layer:Uc,object:Js,source:Ql,light:Nu,string:zu,formatted:function(e){return zu(e).length===0?[]:pa(e)},resolvedImage:function(e){return zu(e).length===0?[]:pa(e)}};function zi(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&Ju(jr(t))?tf(e):r.expression&&Tu(Xt(t))?pa(e):r.type&&el[r.type]?el[r.type](e):Js(Fr({},e,{valueSpec:r.type?f[r.type]:r}))}function Pa(e){var t=e.value,r=e.key,f=zu(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Ke(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Ke(r,t,'"glyphs" url must include a "{range}" token'))),f}function Ma(e,t){t===void 0&&(t=ge);var r=[];return r=r.concat(zi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),e.constants&&(r=r.concat(Ut({key:"constants",value:e.constants,style:e,styleSpec:t}))),ql(r)}function ql(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function Rl(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return ql(e.apply(this,t))}}Ma.source=Rl(Ql),Ma.light=Rl(Nu),Ma.layer=Rl(Uc),Ma.filter=Rl(zc),Ma.paintProperty=Rl(Bc),Ma.layoutProperty=Rl(vl);var ec=Ma,Sf=ec.light,Ef=ec.paintProperty,Dl=ec.layoutProperty;function Bu(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new ht(new Error(v[f].message))),r=!0;return r}var Uu=no;function no(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var m=0;m<this.d*this.d;m++){var x=v[3+m],P=v[3+m+1];f.push(x===P?null:v.subarray(x,P))}var k=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],k),this.bboxes=v.subarray(k),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var j=0;j<this.d*this.d;j++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var W=r/t*e;this.min=-W,this.max=e+W}no.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},no.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},no.prototype._insertCell=function(e,t,r,f,v,m){this.cells[v].push(m)},no.prototype.query=function(e,t,r,f,v){var m=this.min,x=this.max;if(e<=m&&t<=m&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(e,t,r,f,this._queryCell,P,{},v),P},no.prototype._queryCell=function(e,t,r,f,v,m,x,P){var k=this.cells[v];if(k!==null)for(var j=this.keys,W=this.bboxes,$=0;$<k.length;$++){var ie=k[$];if(x[ie]===void 0){var pe=4*ie;(P?P(W[pe+0],W[pe+1],W[pe+2],W[pe+3]):e<=W[pe+2]&&t<=W[pe+3]&&r>=W[pe+0]&&f>=W[pe+1])?(x[ie]=!0,m.push(j[ie])):x[ie]=!1}}},no.prototype._forEachCell=function(e,t,r,f,v,m,x,P){for(var k=this._convertToCellCoord(e),j=this._convertToCellCoord(t),W=this._convertToCellCoord(r),$=this._convertToCellCoord(f),ie=k;ie<=W;ie++)for(var pe=j;pe<=$;pe++){var Ge=this.d*pe+ie;if((!P||P(this._convertFromCellCoord(ie),this._convertFromCellCoord(pe),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(pe+1)))&&v.call(this,e,t,r,f,Ge,m,x,P))return}},no.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},no.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},no.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var m=t,x=0;x<e.length;x++){var P=e[x];v[3+x]=m,v.set(P,m),m+=P.length}return v[3+e.length]=m,v.set(this.keys,m),v[3+e.length+1]=m+=this.keys.length,v.set(this.bboxes,m),m+=this.bboxes.length,v.buffer};var vs=K.ImageData,ml=K.ImageBitmap,ho={};function En(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ho[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var ks in En("Object",Object),Uu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Uu.deserialize=function(e){return new Uu(e.buffer)},En("Grid",Uu),En("Color",Vn),En("Error",Error),En("ResolvedImage",Na),En("StylePropertyFunction",dl),En("StyleExpression",Qu,{omit:["_evaluator"]}),En("ZoomDependentExpression",pl),En("ZoomConstantExpression",Ml),En("CompoundExpression",to,{omit:["_evaluate"]}),rs)rs[ks]._classRegistryKey||En("Expression_"+ks,rs[ks]);function tc(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function gl(e){return ml&&e instanceof ml}function Qs(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(tc(e)||gl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof vs)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,m=e;v<m.length;v+=1)f.push(Qs(m[v],t));return f}if(typeof e=="object"){var x=e.constructor,P=x._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var k=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var j in e)if(e.hasOwnProperty(j)&&!(ho[P].omit.indexOf(j)>=0)){var W=e[j];k[j]=ho[P].shallow.indexOf(j)>=0?W:Qs(W,t)}e instanceof Error&&(k.message=e.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(k.$name=P),k}throw new Error("can't serialize object of type "+typeof e)}function Zs(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||tc(e)||gl(e)||ArrayBuffer.isView(e)||e instanceof vs)return e;if(Array.isArray(e))return e.map(Zs);if(typeof e=="object"){var t=e.$name||"Object",r=ho[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,m=Object.keys(e);v<m.length;v+=1){var x=m[v];if(x!=="$name"){var P=e[x];f[x]=ho[t].shallow.indexOf(x)>=0?P:Zs(P)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var yl=function(){this.first=!0};yl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var Jr={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function jc(e){for(var t=0,r=e;t<r.length;t+=1)if(dc(r[t].charCodeAt(0)))return!0;return!1}function dc(e){return!(e!==746&&e!==747&&(e<4352||!(Jr["Bopomofo Extended"](e)||Jr.Bopomofo(e)||Jr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Jr["CJK Compatibility Ideographs"](e)||Jr["CJK Compatibility"](e)||Jr["CJK Radicals Supplement"](e)||Jr["CJK Strokes"](e)||!(!Jr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Jr["CJK Unified Ideographs Extension A"](e)||Jr["CJK Unified Ideographs"](e)||Jr["Enclosed CJK Letters and Months"](e)||Jr["Hangul Compatibility Jamo"](e)||Jr["Hangul Jamo Extended-A"](e)||Jr["Hangul Jamo Extended-B"](e)||Jr["Hangul Jamo"](e)||Jr["Hangul Syllables"](e)||Jr.Hiragana(e)||Jr["Ideographic Description Characters"](e)||Jr.Kanbun(e)||Jr["Kangxi Radicals"](e)||Jr["Katakana Phonetic Extensions"](e)||Jr.Katakana(e)&&e!==12540||!(!Jr["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Jr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Jr["Unified Canadian Aboriginal Syllabics"](e)||Jr["Unified Canadian Aboriginal Syllabics Extended"](e)||Jr["Vertical Forms"](e)||Jr["Yijing Hexagram Symbols"](e)||Jr["Yi Syllables"](e)||Jr["Yi Radicals"](e))))}function tl(e){return!(dc(e)||function(t){return!!(Jr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Jr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Jr["Letterlike Symbols"](t)||Jr["Number Forms"](t)||Jr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Jr["Control Pictures"](t)&&t!==9251||Jr["Optical Character Recognition"](t)||Jr["Enclosed Alphanumerics"](t)||Jr["Geometric Shapes"](t)||Jr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Jr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Jr["CJK Symbols and Punctuation"](t)||Jr.Katakana(t)||Jr["Private Use Area"](t)||Jr["CJK Compatibility Forms"](t)||Jr["Small Form Variants"](t)||Jr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function qs(e){return e>=1424&&e<=2303||Jr["Arabic Presentation Forms-A"](e)||Jr["Arabic Presentation Forms-B"](e)}function ws(e,t){return!(!t&&qs(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Jr.Khmer(e))}function vc(e){for(var t=0,r=e;t<r.length;t+=1)if(qs(r[t].charCodeAt(0)))return!0;return!1}var mc=null,Fs="unavailable",ju=null,_l=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Fs="error"),mc&&mc(e)};function kl(){af.fire(new je("pluginStateChange",{pluginStatus:Fs,pluginURL:ju}))}var af=new xt,Zc=function(){return Fs},Au=function(){if(Fs!=="deferred"||!ju)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fs="loading",kl(),ju&&aa({url:ju},function(e){e?_l(e):(Fs="loaded",kl())})},eu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Fs==="loaded"||eu.applyArabicShaping!=null},isLoading:function(){return Fs==="loading"},setState:function(e){Fs=e.pluginStatus,ju=e.pluginURL},isParsed:function(){return eu.applyArabicShaping!=null&&eu.processBidirectionalText!=null&&eu.processStyledBidirectionalText!=null},getPluginURL:function(){return ju}},ki=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yl,this.transition={})};ki.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!ws(v[f].charCodeAt(0),r))return!1;return!0}(e,eu.isLoaded())},ki.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ki.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Zu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(Ju(r))return new dl(r,f);if(Tu(r)){var v=kc(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var m=r;return typeof r=="string"&&f.type==="color"&&(m=Vn.parse(r)),{kind:"constant",evaluate:function(){return m}}}(t===void 0?e.specification.default:t,e.specification)};Zu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Zu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var ns=function(e){this.property=e,this.value=new Zu(e,void 0)};ns.prototype.transitioned=function(e,t){return new xl(this.property,this.value,t,Wt({},e.transition,this.transition),e.now)},ns.prototype.untransitioned=function(){return new xl(this.property,this.value,null,{},0)};var Oo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Oo.prototype.getValue=function(e){return Ie(this._values[e].value.value)},Oo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ns(this._values[e].property)),this._values[e].value=new Zu(this._values[e].property,t===null?void 0:Ie(t))},Oo.prototype.getTransition=function(e){return Ie(this._values[e].transition)},Oo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ns(this._values[e].property)),this._values[e].transition=Ie(t)||void 0},Oo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var m=this.getTransition(f);m!==void 0&&(e[f+"-transition"]=m)}return e},Oo.prototype.transitioned=function(e,t){for(var r=new rl(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var m=v[f];r._values[m]=this._values[m].transitioned(e,t._values[m])}return r},Oo.prototype.untransitioned=function(){for(var e=new rl(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var xl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};xl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),m=this.prior;if(m){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return m.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,r),v,function(P){if(P<=0)return 0;if(P>=1)return 1;var k=P*P,j=k*P;return 4*(P<.5?j:3*(P-k)+j-.75)}(x))}return v};var rl=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};rl.prototype.possiblyEvaluate=function(e,t,r){for(var f=new nl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var x=m[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},rl.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var du=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};du.prototype.getValue=function(e){return Ie(this._values[e].value)},du.prototype.setValue=function(e,t){this._values[e]=new Zu(this._values[e].property,t===null?void 0:Ie(t))},du.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},du.prototype.possiblyEvaluate=function(e,t,r){for(var f=new nl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var x=m[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var ms=function(e,t,r){this.property=e,this.value=t,this.parameters=r};ms.prototype.isConstant=function(){return this.value.kind==="constant"},ms.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},ms.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var nl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};nl.prototype.get=function(e){return this._values[e]};var Un=function(e){this.specification=e};Un.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Un.prototype.interpolate=function(e,t,r){var f=Ys[this.specification.type];return f?f(e,t,r):e};var Pn=function(e,t){this.specification=e,this.overrides=t};Pn.prototype.possiblyEvaluate=function(e,t,r,f){return new ms(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Pn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new ms(this,{kind:"constant",value:void 0},e.parameters);var f=Ys[this.specification.type];return f?new ms(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Pn.prototype.evaluate=function(e,t,r,f,v,m){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,m)};var rc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,m){if(r.value===void 0)return new ms(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,m),P=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,k=this._calculate(P,P,P,f);return new ms(this,{kind:"constant",value:k},f)}if(r.expression.kind==="camera"){var j=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new ms(this,{kind:"constant",value:j},f)}return new ms(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,m,x,P){if(r.kind==="source"){var k=r.evaluate(f,v,m,x,P);return this._calculate(k,k,k,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,m),r.evaluate({zoom:Math.floor(f.zoom)},v,m),r.evaluate({zoom:Math.floor(f.zoom)+1},v,m),f):r.value},t.prototype._calculate=function(r,f,v,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Pn),is=function(e){this.specification=e};is.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new ki(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ki(Math.floor(t.zoom),t)),e.expression.evaluate(new ki(Math.floor(t.zoom+1),t)),t)}},is.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},is.prototype.interpolate=function(e){return e};var yo=function(e){this.specification=e};yo.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},yo.prototype.interpolate=function(){return!1};var zo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new Zu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new ns(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};En("DataDrivenProperty",Pn),En("DataConstantProperty",Un),En("CrossFadedDataDrivenProperty",rc),En("CrossFadedProperty",is),En("ColorRampProperty",yo);var vu=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new du(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Oo(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nl(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Dl,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return ke(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Ef,"layers."+this.id+".paint."+r,r,f,v))return!1;if(ke(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var m=this._transitionablePaint._values[r],x=m.property.specification["property-type"]==="cross-faded-data-driven",P=m.value.isDataDriven(),k=m.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var j=this._transitionablePaint._values[r].value;return j.isDataDriven()||P||x||this._handleOverridablePaintPropertyUpdate(r,k,j)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Be(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,m,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&Bu(this,r.call(ec,{key:f,layerType:this.type,objectKey:v,value:m,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof ms&&$u(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(xt),Vs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Fl=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Yi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function wo(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var m=Vs[v.type].BYTES_PER_ELEMENT,x=r=of(r,Math.max(t,m)),P=v.components||1;return f=Math.max(f,m),r+=m*P,{name:v.name,type:v.type,components:P,offset:x}}),size:of(r,Math.max(f,t)),alignment:t}}function of(e,t){return Math.ceil(e/t)*t}Yi.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Yi.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Yi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Yi.prototype.clear=function(){this.length=0},Yi.prototype.resize=function(e){this.reserve(e),this.length=e},Yi.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Yi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.int16[m+0]=f,this.int16[m+1]=v,r},t}(Yi);bl.prototype.bytesPerElement=4,En("StructArrayLayout2i4",bl);var gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var P=4*r;return this.int16[P+0]=f,this.int16[P+1]=v,this.int16[P+2]=m,this.int16[P+3]=x,r},t}(Yi);gc.prototype.bytesPerElement=8,En("StructArrayLayout4i8",gc);var Cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P){var k=this.length;return this.resize(k+1),this.emplace(k,r,f,v,m,x,P)},t.prototype.emplace=function(r,f,v,m,x,P,k){var j=6*r;return this.int16[j+0]=f,this.int16[j+1]=v,this.int16[j+2]=m,this.int16[j+3]=x,this.int16[j+4]=P,this.int16[j+5]=k,r},t}(Yi);Cu.prototype.bytesPerElement=12,En("StructArrayLayout2i4i12",Cu);var Ts=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P){var k=this.length;return this.resize(k+1),this.emplace(k,r,f,v,m,x,P)},t.prototype.emplace=function(r,f,v,m,x,P,k){var j=4*r,W=8*r;return this.int16[j+0]=f,this.int16[j+1]=v,this.uint8[W+4]=m,this.uint8[W+5]=x,this.uint8[W+6]=P,this.uint8[W+7]=k,r},t}(Yi);Ts.prototype.bytesPerElement=8,En("StructArrayLayout2i4ub8",Ts);var il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.float32[m+0]=f,this.float32[m+1]=v,r},t}(Yi);il.prototype.bytesPerElement=8,En("StructArrayLayout2f8",il);var Pu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P,k,j,W,$){var ie=this.length;return this.resize(ie+1),this.emplace(ie,r,f,v,m,x,P,k,j,W,$)},t.prototype.emplace=function(r,f,v,m,x,P,k,j,W,$,ie){var pe=10*r;return this.uint16[pe+0]=f,this.uint16[pe+1]=v,this.uint16[pe+2]=m,this.uint16[pe+3]=x,this.uint16[pe+4]=P,this.uint16[pe+5]=k,this.uint16[pe+6]=j,this.uint16[pe+7]=W,this.uint16[pe+8]=$,this.uint16[pe+9]=ie,r},t}(Yi);Pu.prototype.bytesPerElement=20,En("StructArrayLayout10ui20",Pu);var yc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P,k,j,W,$,ie,pe){var Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,r,f,v,m,x,P,k,j,W,$,ie,pe)},t.prototype.emplace=function(r,f,v,m,x,P,k,j,W,$,ie,pe,Ge){var Xe=12*r;return this.int16[Xe+0]=f,this.int16[Xe+1]=v,this.int16[Xe+2]=m,this.int16[Xe+3]=x,this.uint16[Xe+4]=P,this.uint16[Xe+5]=k,this.uint16[Xe+6]=j,this.uint16[Xe+7]=W,this.int16[Xe+8]=$,this.int16[Xe+9]=ie,this.int16[Xe+10]=pe,this.int16[Xe+11]=Ge,r},t}(Yi);yc.prototype.bytesPerElement=24,En("StructArrayLayout4i4ui4i24",yc);var nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=m,r},t}(Yi);nc.prototype.bytesPerElement=12,En("StructArrayLayout3f12",nc);var _c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(Yi);_c.prototype.bytesPerElement=4,En("StructArrayLayout1ul4",_c);var Vc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P,k,j,W){var $=this.length;return this.resize($+1),this.emplace($,r,f,v,m,x,P,k,j,W)},t.prototype.emplace=function(r,f,v,m,x,P,k,j,W,$){var ie=10*r,pe=5*r;return this.int16[ie+0]=f,this.int16[ie+1]=v,this.int16[ie+2]=m,this.int16[ie+3]=x,this.int16[ie+4]=P,this.int16[ie+5]=k,this.uint32[pe+3]=j,this.uint16[ie+8]=W,this.uint16[ie+9]=$,r},t}(Yi);Vc.prototype.bytesPerElement=20,En("StructArrayLayout6i1ul2ui20",Vc);var zl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P){var k=this.length;return this.resize(k+1),this.emplace(k,r,f,v,m,x,P)},t.prototype.emplace=function(r,f,v,m,x,P,k){var j=6*r;return this.int16[j+0]=f,this.int16[j+1]=v,this.int16[j+2]=m,this.int16[j+3]=x,this.int16[j+4]=P,this.int16[j+5]=k,r},t}(Yi);zl.prototype.bytesPerElement=12,En("StructArrayLayout2i2i2i12",zl);var tu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x){var P=this.length;return this.resize(P+1),this.emplace(P,r,f,v,m,x)},t.prototype.emplace=function(r,f,v,m,x,P){var k=4*r,j=8*r;return this.float32[k+0]=f,this.float32[k+1]=v,this.float32[k+2]=m,this.int16[j+6]=x,this.int16[j+7]=P,r},t}(Yi);tu.prototype.bytesPerElement=16,En("StructArrayLayout2f1f2i16",tu);var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var P=12*r,k=3*r;return this.uint8[P+0]=f,this.uint8[P+1]=v,this.float32[k+1]=m,this.float32[k+2]=x,r},t}(Yi);xc.prototype.bytesPerElement=12,En("StructArrayLayout2ub2f12",xc);var al=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=m,r},t}(Yi);al.prototype.bytesPerElement=6,En("StructArrayLayout3ui6",al);var Mu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe,vt,nt,Rt){var Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,r,f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe,vt,nt,Rt)},t.prototype.emplace=function(r,f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe,vt,nt,Rt,Kt){var sr=24*r,hr=12*r,Ir=48*r;return this.int16[sr+0]=f,this.int16[sr+1]=v,this.uint16[sr+2]=m,this.uint16[sr+3]=x,this.uint32[hr+2]=P,this.uint32[hr+3]=k,this.uint32[hr+4]=j,this.uint16[sr+10]=W,this.uint16[sr+11]=$,this.uint16[sr+12]=ie,this.float32[hr+7]=pe,this.float32[hr+8]=Ge,this.uint8[Ir+36]=Xe,this.uint8[Ir+37]=vt,this.uint8[Ir+38]=nt,this.uint32[hr+10]=Rt,this.int16[sr+22]=Kt,r},t}(Yi);Mu.prototype.bytesPerElement=48,En("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Mu);var Nl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe,vt,nt,Rt,Kt,sr,hr,Ir,rn,pn,Yn,Sn,$n,Tn,Ni){var fi=this.length;return this.resize(fi+1),this.emplace(fi,r,f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe,vt,nt,Rt,Kt,sr,hr,Ir,rn,pn,Yn,Sn,$n,Tn,Ni)},t.prototype.emplace=function(r,f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe,vt,nt,Rt,Kt,sr,hr,Ir,rn,pn,Yn,Sn,$n,Tn,Ni,fi){var Zn=34*r,Ji=17*r;return this.int16[Zn+0]=f,this.int16[Zn+1]=v,this.int16[Zn+2]=m,this.int16[Zn+3]=x,this.int16[Zn+4]=P,this.int16[Zn+5]=k,this.int16[Zn+6]=j,this.int16[Zn+7]=W,this.uint16[Zn+8]=$,this.uint16[Zn+9]=ie,this.uint16[Zn+10]=pe,this.uint16[Zn+11]=Ge,this.uint16[Zn+12]=Xe,this.uint16[Zn+13]=vt,this.uint16[Zn+14]=nt,this.uint16[Zn+15]=Rt,this.uint16[Zn+16]=Kt,this.uint16[Zn+17]=sr,this.uint16[Zn+18]=hr,this.uint16[Zn+19]=Ir,this.uint16[Zn+20]=rn,this.uint16[Zn+21]=pn,this.uint16[Zn+22]=Yn,this.uint32[Ji+12]=Sn,this.float32[Ji+13]=$n,this.float32[Ji+14]=Tn,this.float32[Ji+15]=Ni,this.float32[Ji+16]=fi,r},t}(Yi);Nl.prototype.bytesPerElement=68,En("StructArrayLayout8i15ui1ul4f68",Nl);var mu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(Yi);mu.prototype.bytesPerElement=4,En("StructArrayLayout1f4",mu);var ru=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=m,r},t}(Yi);ru.prototype.bytesPerElement=6,En("StructArrayLayout3i6",ru);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=m,r},t}(Yi);bc.prototype.bytesPerElement=8,En("StructArrayLayout1ul2ui8",bc);var Sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.uint16[m+0]=f,this.uint16[m+1]=v,r},t}(Yi);Sc.prototype.bytesPerElement=4,En("StructArrayLayout2ui4",Sc);var Gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(Yi);Gc.prototype.bytesPerElement=2,En("StructArrayLayout1ui2",Gc);var Ec=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var P=4*r;return this.float32[P+0]=f,this.float32[P+1]=v,this.float32[P+2]=m,this.float32[P+3]=x,r},t}(Yi);Ec.prototype.bytesPerElement=16,En("StructArrayLayout4f16",Ec);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new N(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(Fl);n.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(Vc);En("CollisionBoxArray",u);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(Fl);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(Mu);En("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(Fl);g.prototype.size=68;var E=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(Nl);En("SymbolInstanceArray",E);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(mu);En("GlyphOffsetArray",T);var R=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(ru);En("SymbolLineVertexArray",R);var Z=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(Fl);Z.prototype.size=8;var ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new Z(this,r)},t}(bc);En("FeatureIndexArray",ee);var ve=wo([{name:"a_pos",components:2,type:"Int16"}],4).members,_e=function(e){e===void 0&&(e=[]),this.segments=e};function Ee(e,t){return 256*(e=Ft(Math.floor(e),0,255))+Ft(Math.floor(t),0,255)}_e.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>_e.MAX_VERTEX_ARRAY_LENGTH&&oe("Max vertices per segment is "+_e.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>_e.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},_e.prototype.get=function(){return this.segments},_e.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},_e.simpleSegment=function(e,t,r,f){return new _e([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},_e.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,En("SegmentVector",_e);var We=wo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),He=S(function(e){e.exports=function(t,r){var f,v,m,x,P,k,j,W;for(v=t.length-(f=3&t.length),m=r,P=3432918353,k=461845907,W=0;W<v;)j=255&t.charCodeAt(W)|(255&t.charCodeAt(++W))<<8|(255&t.charCodeAt(++W))<<16|(255&t.charCodeAt(++W))<<24,++W,m=27492+(65535&(x=5*(65535&(m=(m^=j=(65535&(j=(j=(65535&j)*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(j=0,f){case 3:j^=(255&t.charCodeAt(W+2))<<16;case 2:j^=(255&t.charCodeAt(W+1))<<8;case 1:m^=j=(65535&(j=(j=(65535&(j^=255&t.charCodeAt(W)))*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*k+(((j>>>16)*k&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),lt=S(function(e){e.exports=function(t,r){for(var f,v=t.length,m=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:m^=(255&t.charCodeAt(x+2))<<16;case 2:m^=(255&t.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),Fe=He,st=lt;Fe.murmur3=He,Fe.murmur2=st;var bt=function(){this.ids=[],this.positions=[],this.indexed=!1};bt.prototype.add=function(e,t,r,f){this.ids.push(ur(e)),this.positions.push(t,r,f)},bt.prototype.getPositions=function(e){for(var t=ur(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var m=[];this.ids[r]===t;)m.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return m},bt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(m,x,P,k){for(;P<k;){for(var j=m[P+k>>1],W=P-1,$=k+1;;){do W++;while(m[W]<j);do $--;while(m[$]>j);if(W>=$)break;or(m,W,$),or(x,3*W,3*$),or(x,3*W+1,3*$+1),or(x,3*W+2,3*$+2)}$-P<k-$?(v(m,x,P,$),P=$+1):(v(m,x,$+1,k),k=$)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},bt.deserialize=function(e){var t=new bt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Gt=Math.pow(2,53)-1;function ur(e){var t=+e;return!isNaN(t)&&t<=Gt?t:Fe(String(e))}function or(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}En("FeaturePositionMap",bt);var lr=function(e,t){this.gl=e.gl,this.location=t},Rr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(lr),nn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(lr),Qr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(lr),yn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(lr),jn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(lr),Xn=function(e){function t(r,f){e.call(this,r,f),this.current=Vn.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(lr),Hn=new Float32Array(16),Ki=function(e){function t(r,f){e.call(this,r,f),this.current=Hn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(lr);function bn(e){return[Ee(255*e.r,255*e.g),Ee(255*e.b,255*e.a)]}var ai=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};ai.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},ai.prototype.getBinding=function(e,t,r){return this.type==="color"?new Xn(e,t):new nn(e,t)};var _i=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};_i.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},_i.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},_i.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new jn(e,t):new nn(e,t)};var ii=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};ii.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.paintVertexArray.length,x=this.expression.evaluate(new ki(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(m,e,x)},ii.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},ii.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=bn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var m=e;m<t;m++)this.paintVertexArray.emplace(m,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},ii.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ii.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ri=function(e,t,r,f,v,m){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new m};ri.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.expression.evaluate(new ki(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new ki(this.zoom+1),t,{},f,[],v),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,m,x)},ri.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),m=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,m)},ri.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=bn(r),m=bn(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],m[0],m[1]);else{for(var P=e;P<t;P++)this.paintVertexArray.emplace(P,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},ri.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ri.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=Ft(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},ri.prototype.getBinding=function(e,t,r){return new nn(e,t)};var xi=function(e,t,r,f,v,m){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=m,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};xi.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},xi.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},xi.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],m=f[r.mid],x=f[r.max];if(v&&m&&x)for(var P=e;P<t;P++)this.zoomInPaintVertexArray.emplace(P,m.tl[0],m.tl[1],m.br[0],m.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],m.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,m.tl[0],m.tl[1],m.br[0],m.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],m.pixelRatio,x.pixelRatio)}},xi.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,We.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,We.members,this.expression.isStateDependent))},xi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ei=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var m=e.paint.get(v);if(m instanceof ms&&$u(m.property.specification)){var x=_o(v,e.type),P=m.value,k=m.property.specification.type,j=m.property.useIntegerZoom,W=m.property.specification["property-type"],$=W==="cross-faded"||W==="cross-faded-data-driven";if(P.kind==="constant")this.binders[v]=$?new _i(P.value,x):new ai(P.value,x,k),f.push("/u_"+v);else if(P.kind==="source"||$){var ie=Ka(v,k,"source");this.binders[v]=$?new xi(P,k,j,t,ie,e.id):new ii(P,x,k,ie),f.push("/a_"+v)}else{var pe=Ka(v,k,"composite");this.binders[v]=new ri(P,x,k,j,t,pe),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};ei.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof ii||t instanceof ri?t.maxValue:0},ei.prototype.populatePaintArrays=function(e,t,r,f,v){for(var m in this.binders){var x=this.binders[m];(x instanceof ii||x instanceof ri||x instanceof xi)&&x.populatePaintArray(e,t,r,f,v)}},ei.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof _i&&f.setConstantPatternPositions(e,t)}},ei.prototype.updatePaintArrays=function(e,t,r,f,v){var m=!1;for(var x in e)for(var P=0,k=t.getPositions(x);P<k.length;P+=1){var j=k[P],W=r.feature(j.index);for(var $ in this.binders){var ie=this.binders[$];if((ie instanceof ii||ie instanceof ri||ie instanceof xi)&&ie.expression.isStateDependent===!0){var pe=f.paint.get($);ie.expression=pe.value,ie.updatePaintArray(j.start,j.end,W,e[x],v),m=!0}}}return m},ei.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof ai||r instanceof _i)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},ei.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ii||r instanceof ri)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof xi)for(var v=0;v<We.members.length;v++)e.push(We.members[v].name)}return e},ei.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ai||r instanceof _i||r instanceof ri)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},ei.prototype.getPaintVertexBuffers=function(){return this._buffers},ei.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof ai||v instanceof _i||v instanceof ri)for(var m=0,x=v.uniformNames;m<x.length;m+=1){var P=x[m];if(t[P]){var k=v.getBinding(e,t[P],P);r.push({name:P,property:f,binding:k})}}}return r},ei.prototype.setUniforms=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1){var x=m[v],P=x.name,k=x.property;this.binders[k].setUniform(x.binding,f,r.get(k),P)}},ei.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof xi){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof ii||r instanceof ri)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ei.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof ii||r instanceof ri||r instanceof xi)&&r.upload(e)}this.updatePaintBuffers()},ei.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof ii||t instanceof ri||t instanceof xi)&&t.destroy()}};var Qn=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var m=v[f];this.programConfigurations[m.id]=new ei(m,t,r)}this.needsUpload=!1,this._featureMap=new bt,this._bufferOffset=0};function _o(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function Ka(e,t,r){var f={color:{source:il,composite:Ec},number:{source:mu,composite:il}},v=function(m){return{"line-pattern":{source:Pu,composite:Pu},"fill-pattern":{source:Pu,composite:Pu},"fill-extrusion-pattern":{source:Pu,composite:Pu}}[m]}(e);return v&&v[r]||f[t][r]}Qn.prototype.populatePaintArrays=function(e,t,r,f,v,m){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,m);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Qn.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,m=r;v<m.length;v+=1){var x=m[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},Qn.prototype.get=function(e){return this.programConfigurations[e]},Qn.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Qn.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},En("ConstantBinder",ai),En("CrossFadedConstantBinder",_i),En("SourceExpressionBinder",ii),En("CrossFadedCompositeBinder",xi),En("CompositeExpressionBinder",ri),En("ProgramConfiguration",ei,{omit:["_buffers"]}),En("ProgramConfigurationSet",Qn);var as=Math.pow(2,14)-1,No=-as-1;function $a(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],m=0;m<v.length;m++){var x=v[m],P=Math.round(x.x*t),k=Math.round(x.y*t);x.x=Ft(P,No,as),x.y=Ft(k,No,as),(P<x.x||P>x.x+1||k<x.y||k>x.y+1)&&oe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function io(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?$a(e):[]}}function gs(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Bo=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new bl,this.indexArray=new al,this.segments=new _e,this.programConfigurations=new Qn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Iu(e,t){for(var r=0;r<e.length;r++)if(gu(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(gu(e,t[f]))return!0;return!!Sl(e,t)}function os(e,t,r){return!!gu(e,t)||!!zs(t,e,r)}function Gs(e,t){if(e.length===1)return Bl(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(gu(e,f[v]))return!0;for(var m=0;m<e.length;m++)if(Bl(t,e[m]))return!0;for(var x=0;x<t.length;x++)if(Sl(e,t[x]))return!0;return!1}function Hs(e,t,r){if(e.length>1){if(Sl(e,t))return!0;for(var f=0;f<t.length;f++)if(zs(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(zs(e[v],t,r))return!0;return!1}function Sl(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],m=0;m<t.length-1;m++)if(El(f,v,t[m],t[m+1]))return!0;return!1}function El(e,t,r,f){return re(e,r,f)!==re(t,r,f)&&re(e,t,r)!==re(e,t,f)}function zs(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(Vu(e,t[v-1],t[v])<f)return!0;return!1}function Vu(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Bl(e,t){for(var r,f,v,m=!1,x=0;x<e.length;x++)for(var P=0,k=(r=e[x]).length-1;P<r.length;k=P++)(f=r[P]).y>t.y!=(v=r[k]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(m=!m);return m}function gu(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var m=e[f],x=e[v];m.y>t.y!=x.y>t.y&&t.x<(x.x-m.x)*(t.y-m.y)/(x.y-m.y)+m.x&&(r=!r)}return r}function wl(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var m=re(e,t,r[0]);return m!==re(e,t,r[1])||m!==re(e,t,r[2])||m!==re(e,t,r[3])}function nu(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function ao(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ou(e,t,r,f,v){if(!t[0]&&!t[1])return e;var m=N.convert(t)._mult(v);r==="viewport"&&m._rotate(-f);for(var x=[],P=0;P<e.length;P++)x.push(e[P].sub(m));return x}Bo.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],m=null;f.type==="circle"&&(m=f.layout.get("circle-sort-key"));for(var x=0,P=e;x<P.length;x+=1){var k=P[x],j=k.feature,W=k.id,$=k.index,ie=k.sourceLayerIndex,pe=this.layers[0]._featureFilter.needGeometry,Ge=io(j,pe);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),Ge,r)){var Xe=m?m.evaluate(Ge,{},r):void 0,vt={id:W,properties:j.properties,type:j.type,sourceLayerIndex:ie,index:$,geometry:pe?Ge.geometry:$a(j),patterns:{},sortKey:Xe};v.push(vt)}}m&&v.sort(function(pn,Yn){return pn.sortKey-Yn.sortKey});for(var nt=0,Rt=v;nt<Rt.length;nt+=1){var Kt=Rt[nt],sr=Kt.geometry,hr=Kt.index,Ir=Kt.sourceLayerIndex,rn=e[hr].feature;this.addFeature(Kt,sr,hr,r),t.featureIndex.insert(rn,sr,hr,Ir,this.index)}},Bo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Bo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Bo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bo.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ve),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Bo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Bo.prototype.addFeature=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1)for(var x=0,P=m[v];x<P.length;x+=1){var k=P[x],j=k.x,W=k.y;if(!(j<0||j>=8192||W<0||W>=8192)){var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ie=$.vertexLength;gs(this.layoutVertexArray,j,W,-1,-1),gs(this.layoutVertexArray,j,W,1,-1),gs(this.layoutVertexArray,j,W,1,1),gs(this.layoutVertexArray,j,W,-1,1),this.indexArray.emplaceBack(ie,ie+1,ie+2),this.indexArray.emplaceBack(ie,ie+3,ie+2),$.vertexLength+=4,$.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},En("CircleBucket",Bo,{omit:["layers"]});var yu=new zo({"circle-sort-key":new Pn(ge.layout_circle["circle-sort-key"])}),As={paint:new zo({"circle-radius":new Pn(ge.paint_circle["circle-radius"]),"circle-color":new Pn(ge.paint_circle["circle-color"]),"circle-blur":new Pn(ge.paint_circle["circle-blur"]),"circle-opacity":new Pn(ge.paint_circle["circle-opacity"]),"circle-translate":new Un(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Un(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Un(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Un(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pn(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pn(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pn(ge.paint_circle["circle-stroke-opacity"])}),layout:yu},$i=typeof Float32Array!="undefined"?Float32Array:Array;function Uo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xo(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3],P=t[4],k=t[5],j=t[6],W=t[7],$=t[8],ie=t[9],pe=t[10],Ge=t[11],Xe=t[12],vt=t[13],nt=t[14],Rt=t[15],Kt=r[0],sr=r[1],hr=r[2],Ir=r[3];return e[0]=Kt*f+sr*P+hr*$+Ir*Xe,e[1]=Kt*v+sr*k+hr*ie+Ir*vt,e[2]=Kt*m+sr*j+hr*pe+Ir*nt,e[3]=Kt*x+sr*W+hr*Ge+Ir*Rt,e[4]=(Kt=r[4])*f+(sr=r[5])*P+(hr=r[6])*$+(Ir=r[7])*Xe,e[5]=Kt*v+sr*k+hr*ie+Ir*vt,e[6]=Kt*m+sr*j+hr*pe+Ir*nt,e[7]=Kt*x+sr*W+hr*Ge+Ir*Rt,e[8]=(Kt=r[8])*f+(sr=r[9])*P+(hr=r[10])*$+(Ir=r[11])*Xe,e[9]=Kt*v+sr*k+hr*ie+Ir*vt,e[10]=Kt*m+sr*j+hr*pe+Ir*nt,e[11]=Kt*x+sr*W+hr*Ge+Ir*Rt,e[12]=(Kt=r[12])*f+(sr=r[13])*P+(hr=r[14])*$+(Ir=r[15])*Xe,e[13]=Kt*v+sr*k+hr*ie+Ir*vt,e[14]=Kt*m+sr*j+hr*pe+Ir*nt,e[15]=Kt*x+sr*W+hr*Ge+Ir*Rt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Lu,iu=xo;function _u(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*m+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*m+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*m+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*m+r[15]*x,e}Lu=new $i(3),$i!=Float32Array&&(Lu[0]=0,Lu[1]=0,Lu[2]=0),function(){var e=new $i(4);$i!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Gu=(function(){var e=new $i(2);$i!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,As)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Bo(r)},t.prototype.queryRadius=function(r){var f=r;return nu("circle-radius",this,f)+nu("circle-stroke-width",this,f)+ao(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,P,k,j){for(var W=Ou(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,k),$=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),ie=this.paint.get("circle-pitch-alignment")==="map",pe=ie?W:function(rn,pn){return rn.map(function(Yn){return Ru(Yn,pn)})}(W,j),Ge=ie?$*k:$,Xe=0,vt=m;Xe<vt.length;Xe+=1)for(var nt=0,Rt=vt[Xe];nt<Rt.length;nt+=1){var Kt=Rt[nt],sr=ie?Kt:Ru(Kt,j),hr=Ge,Ir=_u([],[Kt.x,Kt.y,0,1],j);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?hr*=Ir[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(hr*=P.cameraToCenterDistance/Ir[3]),os(pe,sr,hr))return!0}return!1},t}(vu));function Ru(e,t){var r=_u([],[e.x,e.y,0,1],t);return new N(r[0]/r[3],r[1]/r[3])}var Ws=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Bo);function au(e,t,r,f){var v=t.width,m=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*m*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*m*r);return e.width=v,e.height=m,e.data=f,e}function Tl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var m=au({},{width:f,height:v},r);sf(e,m,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=m.data}}function sf(e,t,r,f,v,m){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,P=t.data,k=0;k<v.height;k++)for(var j=((r.y+k)*e.width+r.x)*m,W=((f.y+k)*t.width+f.x)*m,$=0;$<v.width*m;$++)P[W+$]=x[j+$];return t}En("HeatmapBucket",Ws,{omit:["layers"]});var xu=function(e,t){au(this,e,1,t)};xu.prototype.resize=function(e){Tl(this,e,1)},xu.prototype.clone=function(){return new xu({width:this.width,height:this.height},new Uint8Array(this.data))},xu.copy=function(e,t,r,f,v){sf(e,t,r,f,v,1)};var da=function(e,t){au(this,e,4,t)};da.prototype.resize=function(e){Tl(this,e,4)},da.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},da.prototype.clone=function(){return new da({width:this.width,height:this.height},new Uint8Array(this.data))},da.copy=function(e,t,r,f,v){sf(e,t,r,f,v,4)},En("AlphaImage",xu),En("RGBAImage",da);var vh={paint:new zo({"heatmap-radius":new Pn(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pn(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Un(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yo(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Un(ge.paint_heatmap["heatmap-opacity"])})};function Hf(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new da({width:r,height:f}),m=function(Ge,Xe,vt){t[e.evaluationKey]=vt;var nt=e.expression.evaluate(t);v.data[Ge+Xe+0]=Math.floor(255*nt.r/nt.a),v.data[Ge+Xe+1]=Math.floor(255*nt.g/nt.a),v.data[Ge+Xe+2]=Math.floor(255*nt.b/nt.a),v.data[Ge+Xe+3]=Math.floor(255*nt.a)};if(e.clips)for(var x=0,P=0;x<f;++x,P+=4*r)for(var k=0,j=0;k<r;k++,j+=4){var W=k/(r-1),$=e.clips[x];m(P,j,$.start*(1-W)+$.end*W)}else for(var ie=0,pe=0;ie<r;ie++,pe+=4)m(0,pe,ie/(r-1));return v}var Wf=function(e){function t(r){e.call(this,r,vh),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Ws(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Hf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(vu),Ul={paint:new zo({"hillshade-illumination-direction":new Un(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Un(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Un(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Un(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Un(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Un(ge.paint_hillshade["hillshade-accent-color"])})},kf=function(e){function t(r){e.call(this,r,Ul)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(vu),mh=wo([{name:"a_pos",components:2,type:"Int16"}],4).members,ic=wf,Ff=wf;function wf(e,t,r){r=r||2;var f,v,m,x,P,k,j,W=t&&t.length,$=W?t[0]*r:e.length,ie=Xf(e,0,$,r,!0),pe=[];if(!ie||ie.next===ie.prev)return pe;if(W&&(ie=function(Xe,vt,nt,Rt){var Kt,sr,hr,Ir=[];for(Kt=0,sr=vt.length;Kt<sr;Kt++)(hr=Xf(Xe,vt[Kt]*Rt,Kt<sr-1?vt[Kt+1]*Rt:Xe.length,Rt,!1))===hr.next&&(hr.steiner=!0),Ir.push(qf(hr));for(Ir.sort(Jf),Kt=0;Kt<Ir.length;Kt++)ou(Ir[Kt],nt),nt=jl(nt,nt.next);return nt}(e,t,ie,r)),e.length>80*r){f=m=e[0],v=x=e[1];for(var Ge=r;Ge<$;Ge+=r)(P=e[Ge])<f&&(f=P),(k=e[Ge+1])<v&&(v=k),P>m&&(m=P),k>x&&(x=k);j=(j=Math.max(m-f,x-v))!==0?1/j:0}return Hc(ie,pe,r,f,v,j),pe}function Xf(e,t,r,f,v){var m,x;if(v===J(e,t,r,f)>0)for(m=t;m<r;m+=f)x=B(m,e[m],e[m+1],x);else for(m=r-f;m>=t;m-=f)x=B(m,e[m],e[m+1],x);return x&&uf(x,x.next)&&(M(x),x=x.next),x}function jl(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!uf(f,f.next)&&oo(f.prev,f,f.next)!==0)f=f.next;else{if(M(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function Hc(e,t,r,f,v,m,x){if(e){!x&&m&&function(W,$,ie,pe){var Ge=W;do Ge.z===null&&(Ge.z=Qf(Ge.x,Ge.y,$,ie,pe)),Ge.prevZ=Ge.prev,Ge.nextZ=Ge.next,Ge=Ge.next;while(Ge!==W);Ge.prevZ.nextZ=null,Ge.prevZ=null,function(Xe){var vt,nt,Rt,Kt,sr,hr,Ir,rn,pn=1;do{for(nt=Xe,Xe=null,sr=null,hr=0;nt;){for(hr++,Rt=nt,Ir=0,vt=0;vt<pn&&(Ir++,Rt=Rt.nextZ);vt++);for(rn=pn;Ir>0||rn>0&&Rt;)Ir!==0&&(rn===0||!Rt||nt.z<=Rt.z)?(Kt=nt,nt=nt.nextZ,Ir--):(Kt=Rt,Rt=Rt.nextZ,rn--),sr?sr.nextZ=Kt:Xe=Kt,Kt.prevZ=sr,sr=Kt;nt=Rt}sr.nextZ=null,pn*=2}while(hr>1)}(Ge)}(e,f,v,m);for(var P,k,j=e;e.prev!==e.next;)if(P=e.prev,k=e.next,m?Yf(e,f,v,m):zf(e))t.push(P.i/r),t.push(e.i/r),t.push(k.i/r),M(e),e=k.next,j=k.next;else if((e=k)===j){x?x===1?Hc(e=Kf(jl(e),t,r),t,r,f,v,m,2):x===2&&$f(e,t,r,f,v,m):Hc(jl(e),t,r,f,v,m,1);break}}}function zf(e){var t=e.prev,r=e,f=e.next;if(oo(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(jo(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&oo(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function Yf(e,t,r,f){var v=e.prev,m=e,x=e.next;if(oo(v,m,x)>=0)return!1;for(var P=v.x>m.x?v.x>x.x?v.x:x.x:m.x>x.x?m.x:x.x,k=v.y>m.y?v.y>x.y?v.y:x.y:m.y>x.y?m.y:x.y,j=Qf(v.x<m.x?v.x<x.x?v.x:x.x:m.x<x.x?m.x:x.x,v.y<m.y?v.y<x.y?v.y:x.y:m.y<x.y?m.y:x.y,t,r,f),W=Qf(P,k,t,r,f),$=e.prevZ,ie=e.nextZ;$&&$.z>=j&&ie&&ie.z<=W;){if($!==e.prev&&$!==e.next&&jo(v.x,v.y,m.x,m.y,x.x,x.y,$.x,$.y)&&oo($.prev,$,$.next)>=0||($=$.prevZ,ie!==e.prev&&ie!==e.next&&jo(v.x,v.y,m.x,m.y,x.x,x.y,ie.x,ie.y)&&oo(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;$&&$.z>=j;){if($!==e.prev&&$!==e.next&&jo(v.x,v.y,m.x,m.y,x.x,x.y,$.x,$.y)&&oo($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;ie&&ie.z<=W;){if(ie!==e.prev&&ie!==e.next&&jo(v.x,v.y,m.x,m.y,x.x,x.y,ie.x,ie.y)&&oo(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function Kf(e,t,r){var f=e;do{var v=f.prev,m=f.next.next;!uf(v,m)&&lf(v,f,f.next,m)&&wc(v,m)&&wc(m,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(m.i/r),M(f),M(f.next),f=e=m),f=f.next}while(f!==e);return jl(f)}function $f(e,t,r,f,v,m){var x=e;do{for(var P=x.next.next;P!==x.prev;){if(x.i!==P.i&&Tf(x,P)){var k=z(x,P);return x=jl(x,x.next),k=jl(k,k.next),Hc(x,t,r,f,v,m),void Hc(k,t,r,f,v,m)}P=P.next}x=x.next}while(x!==e)}function Jf(e,t){return e.x-t.x}function ou(e,t){if(t=function(f,v){var m,x=v,P=f.x,k=f.y,j=-1/0;do{if(k<=x.y&&k>=x.next.y&&x.next.y!==x.y){var W=x.x+(k-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(W<=P&&W>j){if(j=W,W===P){if(k===x.y)return x;if(k===x.next.y)return x.next}m=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!m)return null;if(P===j)return m;var $,ie=m,pe=m.x,Ge=m.y,Xe=1/0;x=m;do P>=x.x&&x.x>=pe&&P!==x.x&&jo(k<Ge?P:j,k,pe,Ge,k<Ge?j:P,k,x.x,x.y)&&($=Math.abs(k-x.y)/(P-x.x),wc(x,f)&&($<Xe||$===Xe&&(x.x>m.x||x.x===m.x&&Nf(m,x)))&&(m=x,Xe=$)),x=x.next;while(x!==ie);return m}(e,t)){var r=z(t,e);jl(t,t.next),jl(r,r.next)}}function Nf(e,t){return oo(e.prev,e,t.prev)<0&&oo(t.next,e,e.next)<0}function Qf(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function qf(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function jo(e,t,r,f,v,m,x,P){return(v-x)*(t-P)-(e-x)*(m-P)>=0&&(e-x)*(f-P)-(r-x)*(t-P)>=0&&(r-x)*(m-P)-(v-x)*(f-P)>=0}function Tf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&lf(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(wc(e,t)&&wc(t,e)&&function(r,f){var v=r,m=!1,x=(r.x+f.x)/2,P=(r.y+f.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&x<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(m=!m),v=v.next;while(v!==r);return m}(e,t)&&(oo(e.prev,e,t.prev)||oo(e,t.prev,t))||uf(e,t)&&oo(e.prev,e,e.next)>0&&oo(t.prev,t,t.next)>0)}function oo(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function uf(e,t){return e.x===t.x&&e.y===t.y}function lf(e,t,r,f){var v=ac(oo(e,t,r)),m=ac(oo(e,t,f)),x=ac(oo(r,f,e)),P=ac(oo(r,f,t));return v!==m&&x!==P||!(v!==0||!Wc(e,r,t))||!(m!==0||!Wc(e,f,t))||!(x!==0||!Wc(r,e,f))||!(P!==0||!Wc(r,t,f))}function Wc(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function ac(e){return e>0?1:e<0?-1:0}function wc(e,t){return oo(e.prev,e,e.next)<0?oo(e,t,e.next)>=0&&oo(e,e.prev,t)>=0:oo(e,t,e.prev)<0||oo(e,e.next,t)<0}function z(e,t){var r=new O(e.i,e.x,e.y),f=new O(t.i,t.x,t.y),v=e.next,m=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,m.next=f,f.prev=m,f}function B(e,t,r,f){var v=new O(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function O(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function J(e,t,r,f){for(var v=0,m=t,x=r-f;m<r;m+=f)v+=(e[x]-e[m])*(e[m+1]+e[x+1]),x=m;return v}function me(e,t,r,f,v){(function m(x,P,k,j,W){for(;j>k;){if(j-k>600){var $=j-k+1,ie=P-k+1,pe=Math.log($),Ge=.5*Math.exp(2*pe/3),Xe=.5*Math.sqrt(pe*Ge*($-Ge)/$)*(ie-$/2<0?-1:1);m(x,P,Math.max(k,Math.floor(P-ie*Ge/$+Xe)),Math.min(j,Math.floor(P+($-ie)*Ge/$+Xe)),W)}var vt=x[P],nt=k,Rt=j;for(qe(x,k,P),W(x[j],vt)>0&&qe(x,k,j);nt<Rt;){for(qe(x,nt,Rt),nt++,Rt--;W(x[nt],vt)<0;)nt++;for(;W(x[Rt],vt)>0;)Rt--}W(x[k],vt)===0?qe(x,k,Rt):qe(x,++Rt,j),Rt<=P&&(k=Rt+1),P<=Rt&&(j=Rt-1)}})(e,t,r||0,f||e.length-1,v||Et)}function qe(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function Et(e,t){return e<t?-1:e>t?1:0}function St(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,m=[],x=0;x<r;x++){var P=ue(e[x]);P!==0&&(e[x].area=Math.abs(P),v===void 0&&(v=P<0),v===P<0?(f&&m.push(f),f=[e[x]]):f.push(e[x]))}if(f&&m.push(f),t>1)for(var k=0;k<m.length;k++)m[k].length<=t||(me(m[k],t,1,m[k].length-1,yr),m[k]=m[k].slice(0,t));return m}function yr(e,t){return t.area-e.area}function Br(e,t,r){for(var f=r.patternDependencies,v=!1,m=0,x=t;m<x.length;m+=1){var P=x[m].paint.get(e+"-pattern");P.isConstant()||(v=!0);var k=P.constantOr(null);k&&(v=!0,f[k.to]=!0,f[k.from]=!0)}return v}function Mn(e,t,r,f,v){for(var m=v.patternDependencies,x=0,P=t;x<P.length;x+=1){var k=P[x],j=k.paint.get(e+"-pattern").value;if(j.kind!=="constant"){var W=j.evaluate({zoom:f-1},r,{},v.availableImages),$=j.evaluate({zoom:f},r,{},v.availableImages),ie=j.evaluate({zoom:f+1},r,{},v.availableImages);$=$&&$.name?$.name:$,ie=ie&&ie.name?ie.name:ie,m[W=W&&W.name?W.name:W]=!0,m[$]=!0,m[ie]=!0,r.patterns[k.id]={min:W,mid:$,max:ie}}}return r}wf.deviation=function(e,t,r,f){var v=t&&t.length,m=Math.abs(J(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,P=t.length;x<P;x++)m-=Math.abs(J(e,t[x]*r,x<P-1?t[x+1]*r:e.length,r));var k=0;for(x=0;x<f.length;x+=3){var j=f[x]*r,W=f[x+1]*r,$=f[x+2]*r;k+=Math.abs((e[j]-e[$])*(e[W+1]-e[j+1])-(e[j]-e[W])*(e[$+1]-e[j+1]))}return m===0&&k===0?0:Math.abs((k-m)/m)},wf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var m=0;m<e[v].length;m++)for(var x=0;x<t;x++)r.vertices.push(e[v][m][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},ic.default=Ff;var Bn=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bl,this.indexArray=new al,this.indexArray2=new Sc,this.programConfigurations=new Qn(e.layers,e.zoom),this.segments=new _e,this.segments2=new _e,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Bn.prototype.populate=function(e,t,r){this.hasPattern=Br("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],m=0,x=e;m<x.length;m+=1){var P=x[m],k=P.feature,j=P.id,W=P.index,$=P.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,pe=io(k,ie);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),pe,r)){var Ge=f?f.evaluate(pe,{},r,t.availableImages):void 0,Xe={id:j,properties:k.properties,type:k.type,sourceLayerIndex:$,index:W,geometry:ie?pe.geometry:$a(k),patterns:{},sortKey:Ge};v.push(Xe)}}f&&v.sort(function(rn,pn){return rn.sortKey-pn.sortKey});for(var vt=0,nt=v;vt<nt.length;vt+=1){var Rt=nt[vt],Kt=Rt.geometry,sr=Rt.index,hr=Rt.sourceLayerIndex;if(this.hasPattern){var Ir=Mn("fill",this.layers,Rt,this.zoom,t);this.patternFeatures.push(Ir)}else this.addFeature(Rt,Kt,sr,r,{});t.featureIndex.insert(e[sr].feature,Kt,sr,hr,this.index)}},Bn.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Bn.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},Bn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Bn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Bn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Bn.prototype.addFeature=function(e,t,r,f,v){for(var m=0,x=St(t,500);m<x.length;m+=1){for(var P=x[m],k=0,j=0,W=P;j<W.length;j+=1)k+=W[j].length;for(var $=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),ie=$.vertexLength,pe=[],Ge=[],Xe=0,vt=P;Xe<vt.length;Xe+=1){var nt=vt[Xe];if(nt.length!==0){nt!==P[0]&&Ge.push(pe.length/2);var Rt=this.segments2.prepareSegment(nt.length,this.layoutVertexArray,this.indexArray2),Kt=Rt.vertexLength;this.layoutVertexArray.emplaceBack(nt[0].x,nt[0].y),this.indexArray2.emplaceBack(Kt+nt.length-1,Kt),pe.push(nt[0].x),pe.push(nt[0].y);for(var sr=1;sr<nt.length;sr++)this.layoutVertexArray.emplaceBack(nt[sr].x,nt[sr].y),this.indexArray2.emplaceBack(Kt+sr-1,Kt+sr),pe.push(nt[sr].x),pe.push(nt[sr].y);Rt.vertexLength+=nt.length,Rt.primitiveLength+=nt.length}}for(var hr=ic(pe,Ge),Ir=0;Ir<hr.length;Ir+=3)this.indexArray.emplaceBack(ie+hr[Ir],ie+hr[Ir+1],ie+hr[Ir+2]);$.vertexLength+=k,$.primitiveLength+=hr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},En("FillBucket",Bn,{omit:["layers","patternFeatures"]});var ci=new zo({"fill-sort-key":new Pn(ge.layout_fill["fill-sort-key"])}),Si={paint:new zo({"fill-antialias":new Un(ge.paint_fill["fill-antialias"]),"fill-opacity":new Pn(ge.paint_fill["fill-opacity"]),"fill-color":new Pn(ge.paint_fill["fill-color"]),"fill-outline-color":new Pn(ge.paint_fill["fill-outline-color"]),"fill-translate":new Un(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Un(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new rc(ge.paint_fill["fill-pattern"])}),layout:ci},Ci=function(e){function t(r){e.call(this,r,Si)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Bn(r)},t.prototype.queryRadius=function(){return ao(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,P,k){return Gs(Ou(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,k),m)},t.prototype.isTileClipped=function(){return!0},t}(vu),va=wo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Pi=Ja;function Ja(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(Zo,this,t)}function Zo(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var m=f.readVarint()+f.pos;f.pos<m;){var x=v._keys[f.readVarint()],P=v._values[f.readVarint()];v.properties[x]=P}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Vo(e){for(var t,r,f=0,v=0,m=e.length,x=m-1;v<m;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}Ja.types=["Unknown","Point","LineString","Polygon"],Ja.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,m=0,x=0,P=[];e.pos<r;){if(v<=0){var k=e.readVarint();f=7&k,v=k>>3}if(v--,f===1||f===2)m+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&P.push(t),t=[]),t.push(new N(m,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&P.push(t),P},Ja.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,m=0,x=1/0,P=-1/0,k=1/0,j=-1/0;e.pos<t;){if(f<=0){var W=e.readVarint();r=7&W,f=W>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>P&&(P=v),(m+=e.readSVarint())<k&&(k=m),m>j&&(j=m);else if(r!==7)throw new Error("unknown command "+r)}return[x,k,P,j]},Ja.prototype.toGeoJSON=function(e,t,r){var f,v,m=this.extent*Math.pow(2,r),x=this.extent*e,P=this.extent*t,k=this.loadGeometry(),j=Ja.types[this.type];function W(pe){for(var Ge=0;Ge<pe.length;Ge++){var Xe=pe[Ge];pe[Ge]=[360*(Xe.x+x)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(Xe.y+P)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(f=0;f<k.length;f++)$[f]=k[f][0];W(k=$);break;case 2:for(f=0;f<k.length;f++)W(k[f]);break;case 3:for(k=function(pe){var Ge=pe.length;if(Ge<=1)return[pe];for(var Xe,vt,nt=[],Rt=0;Rt<Ge;Rt++){var Kt=Vo(pe[Rt]);Kt!==0&&(vt===void 0&&(vt=Kt<0),vt===Kt<0?(Xe&&nt.push(Xe),Xe=[pe[Rt]]):Xe.push(pe[Rt]))}return Xe&&nt.push(Xe),nt}(k),f=0;f<k.length;f++)for(v=0;v<k[f].length;v++)W(k[f][v])}k.length===1?k=k[0]:j="Multi"+j;var ie={type:"Feature",geometry:{type:j,coordinates:k},properties:this.properties};return"id"in this&&(ie.id=this.id),ie};var ys=bo;function bo(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Aa,this,t),this.length=this._features.length}function Aa(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,m=f.readVarint()+f.pos;f.pos<m;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function Ea(e,t,r){if(e===3){var f=new ys(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}bo.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Pi(this._pbf,t,this.extent,this._keys,this._values)};var Lo={VectorTile:function(e,t){this.layers=e.readFields(Ea,{},t)},VectorTileFeature:Pi,VectorTileLayer:ys},Qa=Lo.VectorTileFeature.types,qa=Math.pow(2,13);function Jo(e,t,r,f,v,m,x,P){e.emplaceBack(t,r,2*Math.floor(f*qa)+x,v*qa*2,m*qa*2,Math.round(P))}var ss=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Cu,this.indexArray=new al,this.programConfigurations=new Qn(e.layers,e.zoom),this.segments=new _e,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Tc(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}ss.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=Br("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var m=v[f],x=m.feature,P=m.id,k=m.index,j=m.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,$=io(x,W);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),$,r)){var ie={id:P,sourceLayerIndex:j,index:k,geometry:W?$.geometry:$a(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Mn("fill-extrusion",this.layers,ie,this.zoom,t)):this.addFeature(ie,ie.geometry,k,r,{}),t.featureIndex.insert(x,ie.geometry,k,j,this.index,!0)}}},ss.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},ss.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,va),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ss.prototype.addFeature=function(e,t,r,f,v){for(var m=0,x=St(t,500);m<x.length;m+=1){for(var P=x[m],k=0,j=0,W=P;j<W.length;j+=1)k+=W[j].length;for(var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ie=0,pe=P;ie<pe.length;ie+=1){var Ge=pe[ie];if(Ge.length!==0&&!((Ji=Ge).every(function(Mi){return Mi.x<0})||Ji.every(function(Mi){return Mi.x>8192})||Ji.every(function(Mi){return Mi.y<0})||Ji.every(function(Mi){return Mi.y>8192})))for(var Xe=0,vt=0;vt<Ge.length;vt++){var nt=Ge[vt];if(vt>=1){var Rt=Ge[vt-1];if(!Tc(nt,Rt)){$.vertexLength+4>_e.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Kt=nt.sub(Rt)._perp()._unit(),sr=Rt.dist(nt);Xe+sr>32768&&(Xe=0),Jo(this.layoutVertexArray,nt.x,nt.y,Kt.x,Kt.y,0,0,Xe),Jo(this.layoutVertexArray,nt.x,nt.y,Kt.x,Kt.y,0,1,Xe),Jo(this.layoutVertexArray,Rt.x,Rt.y,Kt.x,Kt.y,0,0,Xe+=sr),Jo(this.layoutVertexArray,Rt.x,Rt.y,Kt.x,Kt.y,0,1,Xe);var hr=$.vertexLength;this.indexArray.emplaceBack(hr,hr+2,hr+1),this.indexArray.emplaceBack(hr+1,hr+2,hr+3),$.vertexLength+=4,$.primitiveLength+=2}}}}if($.vertexLength+k>_e.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),Qa[e.type]==="Polygon"){for(var Ir=[],rn=[],pn=$.vertexLength,Yn=0,Sn=P;Yn<Sn.length;Yn+=1){var $n=Sn[Yn];if($n.length!==0){$n!==P[0]&&rn.push(Ir.length/2);for(var Tn=0;Tn<$n.length;Tn++){var Ni=$n[Tn];Jo(this.layoutVertexArray,Ni.x,Ni.y,0,0,1,1,0),Ir.push(Ni.x),Ir.push(Ni.y)}}}for(var fi=ic(Ir,rn),Zn=0;Zn<fi.length;Zn+=3)this.indexArray.emplaceBack(pn+fi[Zn],pn+fi[Zn+2],pn+fi[Zn+1]);$.primitiveLength+=fi.length/3,$.vertexLength+=k}}var Ji;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},En("FillExtrusionBucket",ss,{omit:["layers","features"]});var oc={paint:new zo({"fill-extrusion-opacity":new Un(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pn(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Un(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Un(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rc(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pn(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pn(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Un(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Cs=function(e){function t(r){e.call(this,r,oc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new ss(r)},t.prototype.queryRadius=function(){return ao(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,P,k,j){var W=Ou(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,k),$=this.paint.get("fill-extrusion-height").evaluate(f,v),ie=this.paint.get("fill-extrusion-base").evaluate(f,v),pe=function(Xe,vt,nt,Rt){for(var Kt=[],sr=0,hr=Xe;sr<hr.length;sr+=1){var Ir=hr[sr],rn=[Ir.x,Ir.y,0,1];_u(rn,rn,vt),Kt.push(new N(rn[0]/rn[3],rn[1]/rn[3]))}return Kt}(W,j),Ge=function(Xe,vt,nt,Rt){for(var Kt=[],sr=[],hr=Rt[8]*vt,Ir=Rt[9]*vt,rn=Rt[10]*vt,pn=Rt[11]*vt,Yn=Rt[8]*nt,Sn=Rt[9]*nt,$n=Rt[10]*nt,Tn=Rt[11]*nt,Ni=0,fi=Xe;Ni<fi.length;Ni+=1){for(var Zn=[],Ji=[],Mi=0,ca=fi[Ni];Mi<ca.length;Mi+=1){var Jn=ca[Mi],ha=Jn.x,po=Jn.y,Ao=Rt[0]*ha+Rt[4]*po+Rt[12],So=Rt[1]*ha+Rt[5]*po+Rt[13],la=Rt[2]*ha+Rt[6]*po+Rt[14],Co=Rt[3]*ha+Rt[7]*po+Rt[15],Ro=la+rn,Us=Co+pn,uu=Ao+Yn,js=So+Sn,Du=la+$n,Po=Co+Tn,es=new N((Ao+hr)/Us,(So+Ir)/Us);es.z=Ro/Us,Zn.push(es);var ta=new N(uu/Po,js/Po);ta.z=Du/Po,Ji.push(ta)}Kt.push(Zn),sr.push(Ji)}return[Kt,sr]}(m,ie,$,j);return function(Xe,vt,nt){var Rt=1/0;Gs(nt,vt)&&(Rt=us(nt,vt[0]));for(var Kt=0;Kt<vt.length;Kt++)for(var sr=vt[Kt],hr=Xe[Kt],Ir=0;Ir<sr.length-1;Ir++){var rn=sr[Ir],pn=[rn,sr[Ir+1],hr[Ir+1],hr[Ir],rn];Iu(nt,pn)&&(Rt=Math.min(Rt,us(nt,pn)))}return Rt!==1/0&&Rt}(Ge[0],Ge[1],pe)},t}(vu);function Xs(e,t){return e.x*t.x+e.y*t.y}function us(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var m=t[f],x=e[0],P=r.sub(v),k=m.sub(v),j=x.sub(v),W=Xs(P,P),$=Xs(P,k),ie=Xs(k,k),pe=Xs(j,P),Ge=Xs(j,k),Xe=W*ie-$*$,vt=(ie*pe-$*Ge)/Xe,nt=(W*Ge-$*pe)/Xe,Rt=v.z*(1-vt-nt)+r.z*vt+m.z*nt;if(isFinite(Rt))return Rt}return 1/0}for(var Kt=1/0,sr=0,hr=t;sr<hr.length;sr+=1)Kt=Math.min(Kt,hr[sr].z);return Kt}var su=wo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,hp=wo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,pp=Lo.VectorTileFeature.types,Hp=Math.cos(Math.PI/180*37.5),Nh=Math.pow(2,14)/.5,bu=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Ts,this.layoutVertexArray2=new il,this.indexArray=new al,this.programConfigurations=new Qn(e.layers,e.zoom),this.segments=new _e,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};bu.prototype.populate=function(e,t,r){this.hasPattern=Br("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],m=0,x=e;m<x.length;m+=1){var P=x[m],k=P.feature,j=P.id,W=P.index,$=P.sourceLayerIndex,ie=this.layers[0]._featureFilter.needGeometry,pe=io(k,ie);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),pe,r)){var Ge=f?f.evaluate(pe,{},r):void 0,Xe={id:j,properties:k.properties,type:k.type,sourceLayerIndex:$,index:W,geometry:ie?pe.geometry:$a(k),patterns:{},sortKey:Ge};v.push(Xe)}}f&&v.sort(function(rn,pn){return rn.sortKey-pn.sortKey});for(var vt=0,nt=v;vt<nt.length;vt+=1){var Rt=nt[vt],Kt=Rt.geometry,sr=Rt.index,hr=Rt.sourceLayerIndex;if(this.hasPattern){var Ir=Mn("line",this.layers,Rt,this.zoom,t);this.patternFeatures.push(Ir)}else this.addFeature(Rt,Kt,sr,r,{});t.featureIndex.insert(e[sr].feature,Kt,sr,hr,this.index)}},bu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},bu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},bu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bu.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,hp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,su),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},bu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},bu.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},bu.prototype.addFeature=function(e,t,r,f,v){var m=this.layers[0].layout,x=m.get("line-join").evaluate(e,{}),P=m.get("line-cap"),k=m.get("line-miter-limit"),j=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var W=0,$=t;W<$.length;W+=1)this.addLine($[W],e,x,P,k,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},bu.prototype.addLine=function(e,t,r,f,v,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=pp[t.type]==="Polygon",k=e.length;k>=2&&e[k-1].equals(e[k-2]);)k--;for(var j=0;j<k-1&&e[j].equals(e[j+1]);)j++;if(!(k<(P?3:2))){r==="bevel"&&(v=1.05);var W,$=this.overscaling<=16?122880/(512*this.overscaling):0,ie=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),pe=void 0,Ge=void 0,Xe=void 0,vt=void 0;this.e1=this.e2=-1,P&&(vt=e[j].sub(W=e[k-2])._unit()._perp());for(var nt=j;nt<k;nt++)if(!(Ge=nt===k-1?P?e[j+1]:void 0:e[nt+1])||!e[nt].equals(Ge)){vt&&(Xe=vt),W&&(pe=W),W=e[nt],vt=Ge?Ge.sub(W)._unit()._perp():Xe;var Rt=(Xe=Xe||vt).add(vt);Rt.x===0&&Rt.y===0||Rt._unit();var Kt=Xe.x*vt.x+Xe.y*vt.y,sr=Rt.x*vt.x+Rt.y*vt.y,hr=sr!==0?1/sr:1/0,Ir=2*Math.sqrt(2-2*sr),rn=sr<Hp&&pe&&Ge,pn=Xe.x*vt.y-Xe.y*vt.x>0;if(rn&&nt>j){var Yn=W.dist(pe);if(Yn>2*$){var Sn=W.sub(W.sub(pe)._mult($/Yn)._round());this.updateDistance(pe,Sn),this.addCurrentVertex(Sn,Xe,0,0,ie),pe=Sn}}var $n=pe&&Ge,Tn=$n?r:P?"butt":f;if($n&&Tn==="round"&&(hr<m?Tn="miter":hr<=2&&(Tn="fakeround")),Tn==="miter"&&hr>v&&(Tn="bevel"),Tn==="bevel"&&(hr>2&&(Tn="flipbevel"),hr<v&&(Tn="miter")),pe&&this.updateDistance(pe,W),Tn==="miter")Rt._mult(hr),this.addCurrentVertex(W,Rt,0,0,ie);else if(Tn==="flipbevel"){if(hr>100)Rt=vt.mult(-1);else{var Ni=hr*Xe.add(vt).mag()/Xe.sub(vt).mag();Rt._perp()._mult(Ni*(pn?-1:1))}this.addCurrentVertex(W,Rt,0,0,ie),this.addCurrentVertex(W,Rt.mult(-1),0,0,ie)}else if(Tn==="bevel"||Tn==="fakeround"){var fi=-Math.sqrt(hr*hr-1),Zn=pn?fi:0,Ji=pn?0:fi;if(pe&&this.addCurrentVertex(W,Xe,Zn,Ji,ie),Tn==="fakeround")for(var Mi=Math.round(180*Ir/Math.PI/20),ca=1;ca<Mi;ca++){var Jn=ca/Mi;if(Jn!==.5){var ha=Jn-.5;Jn+=Jn*ha*(Jn-1)*((1.0904+Kt*(Kt*(3.55645-1.43519*Kt)-3.2452))*ha*ha+(.848013+Kt*(.215638*Kt-1.06021)))}var po=vt.sub(Xe)._mult(Jn)._add(Xe)._unit()._mult(pn?-1:1);this.addHalfVertex(W,po.x,po.y,!1,pn,0,ie)}Ge&&this.addCurrentVertex(W,vt,-Zn,-Ji,ie)}else if(Tn==="butt")this.addCurrentVertex(W,Rt,0,0,ie);else if(Tn==="square"){var Ao=pe?1:-1;this.addCurrentVertex(W,Rt,Ao,Ao,ie)}else Tn==="round"&&(pe&&(this.addCurrentVertex(W,Xe,0,0,ie),this.addCurrentVertex(W,Xe,1,1,ie,!0)),Ge&&(this.addCurrentVertex(W,vt,-1,-1,ie,!0),this.addCurrentVertex(W,vt,0,0,ie)));if(rn&&nt<k-1){var So=W.dist(Ge);if(So>2*$){var la=W.add(Ge.sub(W)._mult($/So)._round());this.updateDistance(W,la),this.addCurrentVertex(la,vt,0,0,ie),W=la}}}}},bu.prototype.addCurrentVertex=function(e,t,r,f,v,m){m===void 0&&(m=!1);var x=t.y*f-t.x,P=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,m,!1,r,v),this.addHalfVertex(e,x,P,m,!0,-f,v),this.distance>Nh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,m))},bu.prototype.addHalfVertex=function(e,t,r,f,v,m,x){var P=.5*(this.lineClips?this.scaledDistance*(Nh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(m===0?0:m<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),x.primitiveLength++),v?this.e2=k:this.e1=k},bu.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},bu.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},En("LineBucket",bu,{omit:["layers","patternFeatures"]});var dp=new zo({"line-cap":new Un(ge.layout_line["line-cap"]),"line-join":new Pn(ge.layout_line["line-join"]),"line-miter-limit":new Un(ge.layout_line["line-miter-limit"]),"line-round-limit":new Un(ge.layout_line["line-round-limit"]),"line-sort-key":new Pn(ge.layout_line["line-sort-key"])}),vp={paint:new zo({"line-opacity":new Pn(ge.paint_line["line-opacity"]),"line-color":new Pn(ge.paint_line["line-color"]),"line-translate":new Un(ge.paint_line["line-translate"]),"line-translate-anchor":new Un(ge.paint_line["line-translate-anchor"]),"line-width":new Pn(ge.paint_line["line-width"]),"line-gap-width":new Pn(ge.paint_line["line-gap-width"]),"line-offset":new Pn(ge.paint_line["line-offset"]),"line-blur":new Pn(ge.paint_line["line-blur"]),"line-dasharray":new is(ge.paint_line["line-dasharray"]),"line-pattern":new rc(ge.paint_line["line-pattern"]),"line-gradient":new yo(ge.paint_line["line-gradient"])}),layout:dp},gh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new ki(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,m){return f=Wt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,m)},t}(Pn))(vp.paint.properties["line-width"].specification);gh.useIntegerZoom=!0;var Bh=function(e){function t(r){e.call(this,r,vp),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof xa,this.gradientVersion=(this.gradientVersion+1)%ae)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=gh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new bu(r)},t.prototype.queryRadius=function(r){var f=r,v=Uh(nu("line-width",this,f),nu("line-gap-width",this,f)),m=nu("line-offset",this,f);return v/2+Math.abs(m)+ao(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,P,k){var j=Ou(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,k),W=k/2*Uh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),$=this.paint.get("line-offset").evaluate(f,v);return $&&(m=function(ie,pe){for(var Ge=[],Xe=new N(0,0),vt=0;vt<ie.length;vt++){for(var nt=ie[vt],Rt=[],Kt=0;Kt<nt.length;Kt++){var sr=nt[Kt],hr=nt[Kt+1],Ir=Kt===0?Xe:sr.sub(nt[Kt-1])._unit()._perp(),rn=Kt===nt.length-1?Xe:hr.sub(sr)._unit()._perp(),pn=Ir._add(rn)._unit();pn._mult(1/(pn.x*rn.x+pn.y*rn.y)),Rt.push(pn._mult(pe)._add(sr))}Ge.push(Rt)}return Ge}(m,$*k)),function(ie,pe,Ge){for(var Xe=0;Xe<pe.length;Xe++){var vt=pe[Xe];if(ie.length>=3){for(var nt=0;nt<vt.length;nt++)if(gu(ie,vt[nt]))return!0}if(Hs(ie,vt,Ge))return!0}return!1}(j,m,W)},t.prototype.isTileClipped=function(){return!0},t}(vu);function Uh(e,t){return t>0?t+2*e:e}var jh=wo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zh=wo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Vh=(wo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),wo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),yh=(wo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),wo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),mp=wo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function gp(e,t,r){return e.sections.forEach(function(f){f.text=function(v,m,x){var P=m.layout.get("text-transform").evaluate(x,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),eu.applyArabicShaping&&(v=eu.applyArabicShaping(v)),v}(f.text,t,r)}),e}wo([{name:"triangle",components:3,type:"Uint16"}]),wo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),wo([{type:"Float32",name:"offsetX"}]),wo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},_h=function(e,t,r,f,v){var m,x,P=8*v-f-1,k=(1<<P)-1,j=k>>1,W=-7,$=r?v-1:0,ie=r?-1:1,pe=e[t+$];for($+=ie,m=pe&(1<<-W)-1,pe>>=-W,W+=P;W>0;m=256*m+e[t+$],$+=ie,W-=8);for(x=m&(1<<-W)-1,m>>=-W,W+=f;W>0;x=256*x+e[t+$],$+=ie,W-=8);if(m===0)m=1-j;else{if(m===k)return x?NaN:1/0*(pe?-1:1);x+=Math.pow(2,f),m-=j}return(pe?-1:1)*x*Math.pow(2,m-f)},U=function(e,t,r,f,v,m){var x,P,k,j=8*m-v-1,W=(1<<j)-1,$=W>>1,ie=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,pe=f?0:m-1,Ge=f?1:-1,Xe=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(P=isNaN(t)?1:0,x=W):(x=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-x))<1&&(x--,k*=2),(t+=x+$>=1?ie/k:ie*Math.pow(2,1-$))*k>=2&&(x++,k/=2),x+$>=W?(P=0,x=W):x+$>=1?(P=(t*k-1)*Math.pow(2,v),x+=$):(P=t*Math.pow(2,$-1)*Math.pow(2,v),x=0));v>=8;e[r+pe]=255&P,pe+=Ge,P/=256,v-=8);for(x=x<<v|P,j+=v;j>0;e[r+pe]=255&x,pe+=Ge,x/=256,j-=8);e[r+pe-Ge]|=128*Xe},Te=ze;function ze(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ze.Varint=0,ze.Fixed64=1,ze.Bytes=2,ze.Fixed32=5;var nr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Ar(e){return e.type===ze.Bytes?e.readVarint()+e.pos:e.pos+1}function qt(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function dr(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function Zr(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Kr(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function qr(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Wr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function on(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function hn(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Vr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function sn(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Zt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function cr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Gr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function mn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Dr(e,t,r){e===1&&r.readMessage(wn,t)}function wn(e,t,r){if(e===3){var f=r.readMessage(Nr,{}),v=f.width,m=f.height,x=f.left,P=f.top,k=f.advance;t.push({id:f.id,bitmap:new xu({width:v+6,height:m+6},f.bitmap),metrics:{width:v,height:m,left:x,top:P,advance:k}})}}function Nr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function un(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var m=v[f];t+=m.w*m.h,r=Math.max(r,m.w)}e.sort(function(Xe,vt){return vt.h-Xe.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],P=0,k=0,j=0,W=e;j<W.length;j+=1)for(var $=W[j],ie=x.length-1;ie>=0;ie--){var pe=x[ie];if(!($.w>pe.w||$.h>pe.h)){if($.x=pe.x,$.y=pe.y,k=Math.max(k,$.y+$.h),P=Math.max(P,$.x+$.w),$.w===pe.w&&$.h===pe.h){var Ge=x.pop();ie<x.length&&(x[ie]=Ge)}else $.h===pe.h?(pe.x+=$.w,pe.w-=$.w):$.w===pe.w?(pe.y+=$.h,pe.h-=$.h):(x.push({x:pe.x+$.w,y:pe.y,w:pe.w-$.w,h:$.h}),pe.y+=$.h,pe.h-=$.h);break}}return{w:P,h:k,fill:t/(P*k)||0}}ze.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,m=this.pos;this.type=7&f,e(v,t,this),this.pos===m&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=cr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=mn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=cr(this.buf,this.pos)+4294967296*cr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=cr(this.buf,this.pos)+4294967296*mn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=_h(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=_h(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,m,x){var P,k,j=x.buf;if(P=(112&(k=j[x.pos++]))>>4,k<128||(P|=(127&(k=j[x.pos++]))<<3,k<128)||(P|=(127&(k=j[x.pos++]))<<10,k<128)||(P|=(127&(k=j[x.pos++]))<<17,k<128)||(P|=(127&(k=j[x.pos++]))<<24,k<128)||(P|=(1&(k=j[x.pos++]))<<31,k<128))return qt(v,P,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&nr?function(r,f,v){return nr.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var m="",x=f;x<v;){var P,k,j,W=r[x],$=null,ie=W>239?4:W>223?3:W>191?2:1;if(x+ie>v)break;ie===1?W<128&&($=W):ie===2?(192&(P=r[x+1]))==128&&($=(31&W)<<6|63&P)<=127&&($=null):ie===3?(k=r[x+2],(192&(P=r[x+1]))==128&&(192&k)==128&&(($=(15&W)<<12|(63&P)<<6|63&k)<=2047||$>=55296&&$<=57343)&&($=null)):ie===4&&(k=r[x+2],j=r[x+3],(192&(P=r[x+1]))==128&&(192&k)==128&&(192&j)==128&&(($=(15&W)<<18|(63&P)<<12|(63&k)<<6|63&j)<=65535||$>=1114112)&&($=null)),$===null?($=65533,ie=1):$>65535&&($-=65536,m+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),m+=String.fromCharCode($),x+=ie}return m}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ze.Bytes)return e.push(this.readVarint(t));var r=Ar(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ze.Bytes)return e.push(this.readSVarint());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ze.Bytes)return e.push(this.readBoolean());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ze.Bytes)return e.push(this.readFloat());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ze.Bytes)return e.push(this.readDouble());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed32());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed32());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed64());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed64());var t=Ar(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ze.Varint)for(;this.buf[this.pos++]>127;);else if(t===ze.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ze.Fixed32)this.pos+=4;else{if(t!==ze.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Gr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Gr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Gr(this.buf,-1&e,this.pos),Gr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Gr(this.buf,-1&e,this.pos),Gr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,x,P){P.buf[P.pos++]=127&m|128,m>>>=7,P.buf[P.pos++]=127&m|128,m>>>=7,P.buf[P.pos++]=127&m|128,m>>>=7,P.buf[P.pos++]=127&m|128,P.buf[P.pos]=127&(m>>>=7)}(f,0,r),function(m,x){var P=(7&m)<<4;x.buf[x.pos++]|=P|((m>>>=3)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,m){for(var x,P,k=0;k<v.length;k++){if((x=v.charCodeAt(k))>55295&&x<57344){if(!P){x>56319||k+1===v.length?(f[m++]=239,f[m++]=191,f[m++]=189):P=x;continue}if(x<56320){f[m++]=239,f[m++]=191,f[m++]=189,P=x;continue}x=P-55296<<10|x-56320|65536,P=null}else P&&(f[m++]=239,f[m++]=191,f[m++]=189,P=null);x<128?f[m++]=x:(x<2048?f[m++]=x>>6|192:(x<65536?f[m++]=x>>12|224:(f[m++]=x>>18|240,f[m++]=x>>12&63|128),f[m++]=x>>6&63|128),f[m++]=63&x|128)}return m}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&dr(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),U(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),U(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&dr(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,ze.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Zr,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Kr,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,on,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,qr,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Wr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,hn,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Vr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,sn,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Zt,t)},writeBytesField:function(e,t){this.writeTag(e,ze.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ze.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ze.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var kr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,m=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=m,this.content=x,this.version=f},an={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};an.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},an.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},an.tlbr.get=function(){return this.tl.concat(this.br)},an.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(kr.prototype,an);var Kn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var m=un(v),x=new da({width:m.w||1,height:m.h||1});for(var P in e){var k=e[P],j=r[P].paddedRect;da.copy(k.data,x,{x:0,y:0},{x:j.x+1,y:j.y+1},k.data)}for(var W in t){var $=t[W],ie=f[W].paddedRect,pe=ie.x+1,Ge=ie.y+1,Xe=$.data.width,vt=$.data.height;da.copy($.data,x,{x:0,y:0},{x:pe,y:Ge},$.data),da.copy($.data,x,{x:0,y:vt-1},{x:pe,y:Ge-1},{width:Xe,height:1}),da.copy($.data,x,{x:0,y:0},{x:pe,y:Ge+vt},{width:Xe,height:1}),da.copy($.data,x,{x:Xe-1,y:0},{x:pe-1,y:Ge},{width:1,height:vt}),da.copy($.data,x,{x:0,y:0},{x:pe+Xe,y:Ge},{width:1,height:vt})}this.image=x,this.iconPositions=r,this.patternPositions=f};Kn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],m={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(m),t[f]=new kr(m,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Kn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Kn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},En("ImagePosition",kr),En("ImageAtlas",Kn);var Wn={horizontal:1,vertical:2,horizontalOnly:3},ln=function(){this.scale=1,this.fontStack="",this.imageName=null};ln.forText=function(e,t){var r=new ln;return r.scale=e||1,r.fontStack=t,r},ln.forImage=function(e){var t=new ln;return t.imageName=e,t};var zr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Lr(e,t,r,f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe){var vt,nt=zr.fromFeature(e,v);$===Wn.vertical&&nt.verticalizePunctuation();var Rt=eu.processBidirectionalText,Kt=eu.processStyledBidirectionalText;if(Rt&&nt.sections.length===1){vt=[];for(var sr=0,hr=Rt(nt.toString(),sa(nt,j,m,t,f,pe,Ge));sr<hr.length;sr+=1){var Ir=hr[sr],rn=new zr;rn.text=Ir,rn.sections=nt.sections;for(var pn=0;pn<Ir.length;pn++)rn.sectionIndex.push(0);vt.push(rn)}}else if(Kt){vt=[];for(var Yn=0,Sn=Kt(nt.text,nt.sectionIndex,sa(nt,j,m,t,f,pe,Ge));Yn<Sn.length;Yn+=1){var $n=Sn[Yn],Tn=new zr;Tn.text=$n[0],Tn.sectionIndex=$n[1],Tn.sections=nt.sections,vt.push(Tn)}}else vt=function(Zn,Ji){for(var Mi=[],ca=Zn.text,Jn=0,ha=0,po=Ji;ha<po.length;ha+=1){var Ao=po[ha];Mi.push(Zn.substring(Jn,Ao)),Jn=Ao}return Jn<ca.length&&Mi.push(Zn.substring(Jn,ca.length)),Mi}(nt,sa(nt,j,m,t,f,pe,Ge));var Ni=[],fi={positionedLines:Ni,text:nt.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(Zn,Ji,Mi,ca,Jn,ha,po,Ao,So,la,Co,Ro){for(var Us=0,uu=-17,js=0,Du=0,Po=Ao==="right"?1:Ao==="left"?0:.5,es=0,ta=0,Ba=Jn;ta<Ba.length;ta+=1){var Ia=Ba[ta];Ia.trim();var Qi=Ia.getMaxScale(),lu=24*(Qi-1),Os={positionedGlyphs:[],lineOffset:0};Zn.positionedLines[es]=Os;var vo=Os.positionedGlyphs,cs=0;if(Ia.length()){for(var fs=0;fs<Ia.length();fs++){var ga=Ia.getSection(fs),Yc=Ia.getSectionIndex(fs),Vl=Ia.getCharCode(fs),df=0,hs=null,vf=null,Cc=null,bh=24,nh=!(So===Wn.horizontal||!Co&&!dc(Vl)||Co&&(oi[Vl]||(If=Vl,Jr.Arabic(If)||Jr["Arabic Supplement"](If)||Jr["Arabic Extended-A"](If)||Jr["Arabic Presentation Forms-A"](If)||Jr["Arabic Presentation Forms-B"](If))));if(ga.imageName){var Uf=ca[ga.imageName];if(!Uf)continue;Cc=ga.imageName,Zn.iconsInText=Zn.iconsInText||!0,vf=Uf.paddedRect;var Pc=Uf.displaySize;ga.scale=24*ga.scale/Ro,df=lu+(24-Pc[1]*ga.scale),bh=(hs={width:Pc[0],height:Pc[1],left:1,top:-3,advance:nh?Pc[1]:Pc[0]}).advance;var Sh=nh?Pc[0]*ga.scale-24*Qi:Pc[1]*ga.scale-24*Qi;Sh>0&&Sh>cs&&(cs=Sh)}else{var Eh=Mi[ga.fontStack],ih=Eh&&Eh[Vl];if(ih&&ih.rect)vf=ih.rect,hs=ih.metrics;else{var Wh=Ji[ga.fontStack],wh=Wh&&Wh[Vl];if(!wh)continue;hs=wh.metrics}df=24*(Qi-ga.scale)}nh?(Zn.verticalizable=!0,vo.push({glyph:Vl,imageName:Cc,x:Us,y:uu+df,vertical:nh,scale:ga.scale,fontStack:ga.fontStack,sectionIndex:Yc,metrics:hs,rect:vf}),Us+=bh*ga.scale+la):(vo.push({glyph:Vl,imageName:Cc,x:Us,y:uu+df,vertical:nh,scale:ga.scale,fontStack:ga.fontStack,sectionIndex:Yc,metrics:hs,rect:vf}),Us+=hs.advance*ga.scale+la)}vo.length!==0&&(js=Math.max(Us-la,js),Ps(vo,0,vo.length-1,Po,cs)),Us=0;var Xh=ha*Qi+cs;Os.lineOffset=Math.max(cs,lu),uu+=Xh,Du=Math.max(Xh,Du),++es}else uu+=ha,++es}var If,ah=uu- -17,oh=Go(po),jf=oh.horizontalAlign,mf=oh.verticalAlign;(function(Yh,wp,Mc,sh,Zf,Th,Ah,Kc,Kh){var uh,Tp=(wp-Mc)*Zf;uh=Th!==Ah?-Kc*sh- -17:(-sh*Kh+.5)*Ah;for(var Ch=0,$h=Yh;Ch<$h.length;Ch+=1)for(var lh=0,Jh=$h[Ch].positionedGlyphs;lh<Jh.length;lh+=1){var Ph=Jh[lh];Ph.x+=Tp,Ph.y+=uh}})(Zn.positionedLines,Po,jf,mf,js,Du,ha,ah,Jn.length),Zn.top+=-mf*ah,Zn.bottom=Zn.top+ah,Zn.left+=-jf*js,Zn.right=Zn.left+js}(fi,t,r,f,vt,x,P,k,$,j,ie,Xe),!function(Zn){for(var Ji=0,Mi=Zn;Ji<Mi.length;Ji+=1)if(Mi[Ji].positionedGlyphs.length!==0)return!1;return!0}(Ni)&&fi}zr.fromFeature=function(e,t){for(var r=new zr,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},zr.prototype.length=function(){return this.text.length},zr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},zr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},zr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},zr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&tl(f)&&!cf[e[r+1]]||v&&tl(v)&&!cf[e[r-1]]||!cf[e[r]]?e[r]:cf[e[r]]}return t}(this.text)},zr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&oi[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&oi[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},zr.prototype.substring=function(e,t){var r=new zr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},zr.prototype.toString=function(){return this.text},zr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},zr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(ln.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},zr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(ln.forImage(t)),this.sectionIndex.push(this.sections.length-1)):oe("Reached maximum number of images 6401")}else oe("Can't add FormattedSection with an empty image.")},zr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var oi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ti={};function Ln(e,t,r,f,v,m){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/m+v:0}var P=r[t.fontStack],k=P&&P[e];return k?k.metrics.advance*t.scale+v:0}function Vi(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function wi(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function Fi(e,t,r,f,v,m){for(var x=null,P=Vi(t,r,v,m),k=0,j=f;k<j.length;k+=1){var W=j[k],$=Vi(t-W.x,r,v,m)+W.badness;$<=P&&(x=W,P=$)}return{index:e,x:t,priorBreak:x,badness:P}}function sa(e,t,r,f,v,m,x){if(m!=="point")return[];if(!e)return[];for(var P,k=[],j=function(vt,nt,Rt,Kt,sr,hr){for(var Ir=0,rn=0;rn<vt.length();rn++){var pn=vt.getSection(rn);Ir+=Ln(vt.getCharCode(rn),pn,Kt,sr,nt,hr)}return Ir/Math.max(1,Math.ceil(Ir/Rt))}(e,t,r,f,v,x),W=e.text.indexOf("\u200B")>=0,$=0,ie=0;ie<e.length();ie++){var pe=e.getSection(ie),Ge=e.getCharCode(ie);if(oi[Ge]||($+=Ln(Ge,pe,f,v,t,x)),ie<e.length()-1){var Xe=!((P=Ge)<11904||!(Jr["Bopomofo Extended"](P)||Jr.Bopomofo(P)||Jr["CJK Compatibility Forms"](P)||Jr["CJK Compatibility Ideographs"](P)||Jr["CJK Compatibility"](P)||Jr["CJK Radicals Supplement"](P)||Jr["CJK Strokes"](P)||Jr["CJK Symbols and Punctuation"](P)||Jr["CJK Unified Ideographs Extension A"](P)||Jr["CJK Unified Ideographs"](P)||Jr["Enclosed CJK Letters and Months"](P)||Jr["Halfwidth and Fullwidth Forms"](P)||Jr.Hiragana(P)||Jr["Ideographic Description Characters"](P)||Jr["Kangxi Radicals"](P)||Jr["Katakana Phonetic Extensions"](P)||Jr.Katakana(P)||Jr["Vertical Forms"](P)||Jr["Yi Radicals"](P)||Jr["Yi Syllables"](P)));(ti[Ge]||Xe||pe.imageName)&&k.push(Fi(ie+1,$,j,k,wi(Ge,e.getCharCode(ie+1),Xe&&W),!1))}}return function vt(nt){return nt?vt(nt.priorBreak).concat(nt.index):[]}(Fi(e.length(),$,j,k,0,!0))}function Go(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Ps(e,t,r,f,v){if(f||v)for(var m=e[r],x=(e[r].x+m.metrics.advance*m.scale)*f,P=t;P<=r;P++)e[P].x-=x,e[P].y+=v}function ea(e,t,r,f,v,m){var x,P=e.image;if(P.content){var k=P.content,j=P.pixelRatio||1;x=[k[0]/j,k[1]/j,P.displaySize[0]-k[2]/j,P.displaySize[1]-k[3]/j]}var W,$,ie,pe,Ge=t.left*m,Xe=t.right*m;r==="width"||r==="both"?(pe=v[0]+Ge-f[3],$=v[0]+Xe+f[1]):$=(pe=v[0]+(Ge+Xe-P.displaySize[0])/2)+P.displaySize[0];var vt=t.top*m,nt=t.bottom*m;return r==="height"||r==="both"?(W=v[1]+vt-f[0],ie=v[1]+nt+f[2]):ie=(W=v[1]+(vt+nt-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:W,right:$,bottom:ie,left:pe,collisionPadding:x}}ti[10]=!0,ti[32]=!0,ti[38]=!0,ti[40]=!0,ti[41]=!0,ti[43]=!0,ti[45]=!0,ti[47]=!0,ti[173]=!0,ti[183]=!0,ti[8203]=!0,ti[8208]=!0,ti[8211]=!0,ti[8231]=!0;var To=function(e){function t(r,f,v,m){e.call(this,r,f),this.angle=v,m!==void 0&&(this.segment=m)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(N);function Va(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ki(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,m=0;m<f.length&&f[m]<=e;)m++;for(var x=m=Math.max(0,m-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var P=f[m],k=f[x];return r.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:k,minSize:r.evaluate(new ki(P)),maxSize:r.evaluate(new ki(k)),interpolationType:v}}function Ho(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Nn(v/128,r.upperSize/128,t.uSizeT):f}function Qo(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,m=v?Ft(yi.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Nn(e.minSize,e.maxSize,m):r=m}return{uSizeT:r,uSize:f}}En("Anchor",To);var _s=Object.freeze({__proto__:null,getSizeData:Va,evaluateSizeForFeature:Ho,evaluateSizeForZoom:Qo,SIZE_PACK_FACTOR:128});function Ms(e,t,r,f,v){if(t.segment===void 0)return!0;for(var m=t,x=t.segment+1,P=0;P>-r/2;){if(--x<0)return!1;P-=e[x].dist(m),m=e[x]}P+=e[x].dist(e[x+1]),x++;for(var k=[],j=0;P<r/2;){var W=e[x],$=e[x+1];if(!$)return!1;var ie=e[x-1].angleTo(W)-W.angleTo($);for(ie=Math.abs((ie+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:ie}),j+=ie;P-k[0].distance>f;)j-=k.shift().angleDelta;if(j>v)return!1;x++,P+=W.dist($)}return!0}function Ns(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Wo(e,t,r){return e?.6*t*r:0}function Oi(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Is(e,t,r,f,v,m){for(var x=Wo(r,v,m),P=Oi(r,f)*m,k=0,j=Ns(e)/2,W=0;W<e.length-1;W++){var $=e[W],ie=e[W+1],pe=$.dist(ie);if(k+pe>j){var Ge=(j-k)/pe,Xe=Nn($.x,ie.x,Ge),vt=Nn($.y,ie.y,Ge),nt=new To(Xe,vt,ie.angleTo($),W);return nt._round(),!x||Ms(e,nt,P,x,t)?nt:void 0}k+=pe}}function ma(e,t,r,f,v,m,x,P,k){var j=Wo(f,m,x),W=Oi(f,v),$=W*x,ie=e[0].x===0||e[0].x===k||e[0].y===0||e[0].y===k;return t-$<t/4&&(t=$+t/4),function pe(Ge,Xe,vt,nt,Rt,Kt,sr,hr,Ir){for(var rn=Kt/2,pn=Ns(Ge),Yn=0,Sn=Xe-vt,$n=[],Tn=0;Tn<Ge.length-1;Tn++){for(var Ni=Ge[Tn],fi=Ge[Tn+1],Zn=Ni.dist(fi),Ji=fi.angleTo(Ni);Sn+vt<Yn+Zn;){var Mi=((Sn+=vt)-Yn)/Zn,ca=Nn(Ni.x,fi.x,Mi),Jn=Nn(Ni.y,fi.y,Mi);if(ca>=0&&ca<Ir&&Jn>=0&&Jn<Ir&&Sn-rn>=0&&Sn+rn<=pn){var ha=new To(ca,Jn,Ji,Tn);ha._round(),nt&&!Ms(Ge,ha,Kt,nt,Rt)||$n.push(ha)}}Yn+=Zn}return hr||$n.length||sr||($n=pe(Ge,Yn/2,vt,nt,Rt,Kt,sr,!0,Ir)),$n}(e,ie?t/2*P%t:(W/2+2*m)*x*P%t,t,j,r,$,ie,!1,k)}function ni(e,t,r,f,v){for(var m=[],x=0;x<e.length;x++)for(var P=e[x],k=void 0,j=0;j<P.length-1;j++){var W=P[j],$=P[j+1];W.x<t&&$.x<t||(W.x<t?W=new N(t,W.y+(t-W.x)/($.x-W.x)*($.y-W.y))._round():$.x<t&&($=new N(t,W.y+(t-W.x)/($.x-W.x)*($.y-W.y))._round()),W.y<r&&$.y<r||(W.y<r?W=new N(W.x+(r-W.y)/($.y-W.y)*($.x-W.x),r)._round():$.y<r&&($=new N(W.x+(r-W.y)/($.y-W.y)*($.x-W.x),r)._round()),W.x>=f&&$.x>=f||(W.x>=f?W=new N(f,W.y+(f-W.x)/($.x-W.x)*($.y-W.y))._round():$.x>=f&&($=new N(f,W.y+(f-W.x)/($.x-W.x)*($.y-W.y))._round()),W.y>=v&&$.y>=v||(W.y>=v?W=new N(W.x+(v-W.y)/($.y-W.y)*($.x-W.x),v)._round():$.y>=v&&($=new N(W.x+(v-W.y)/($.y-W.y)*($.x-W.x),v)._round()),k&&W.equals(k[k.length-1])||m.push(k=[W]),k.push($)))))}return m}function Gi(e,t,r,f){var v=[],m=e.image,x=m.pixelRatio,P=m.paddedRect.w-2,k=m.paddedRect.h-2,j=e.right-e.left,W=e.bottom-e.top,$=m.stretchX||[[0,P]],ie=m.stretchY||[[0,k]],pe=function(ca,Jn){return ca+Jn[1]-Jn[0]},Ge=$.reduce(pe,0),Xe=ie.reduce(pe,0),vt=P-Ge,nt=k-Xe,Rt=0,Kt=Ge,sr=0,hr=Xe,Ir=0,rn=vt,pn=0,Yn=nt;if(m.content&&f){var Sn=m.content;Rt=ia($,0,Sn[0]),sr=ia(ie,0,Sn[1]),Kt=ia($,Sn[0],Sn[2]),hr=ia(ie,Sn[1],Sn[3]),Ir=Sn[0]-Rt,pn=Sn[1]-sr,rn=Sn[2]-Sn[0]-Kt,Yn=Sn[3]-Sn[1]-hr}var $n=function(ca,Jn,ha,po){var Ao=Su(ca.stretch-Rt,Kt,j,e.left),So=sc(ca.fixed-Ir,rn,ca.stretch,Ge),la=Su(Jn.stretch-sr,hr,W,e.top),Co=sc(Jn.fixed-pn,Yn,Jn.stretch,Xe),Ro=Su(ha.stretch-Rt,Kt,j,e.left),Us=sc(ha.fixed-Ir,rn,ha.stretch,Ge),uu=Su(po.stretch-sr,hr,W,e.top),js=sc(po.fixed-pn,Yn,po.stretch,Xe),Du=new N(Ao,la),Po=new N(Ro,la),es=new N(Ro,uu),ta=new N(Ao,uu),Ba=new N(So/x,Co/x),Ia=new N(Us/x,js/x),Qi=t*Math.PI/180;if(Qi){var lu=Math.sin(Qi),Os=Math.cos(Qi),vo=[Os,-lu,lu,Os];Du._matMult(vo),Po._matMult(vo),ta._matMult(vo),es._matMult(vo)}var cs=ca.stretch+ca.fixed,fs=Jn.stretch+Jn.fixed;return{tl:Du,tr:Po,bl:ta,br:es,tex:{x:m.paddedRect.x+1+cs,y:m.paddedRect.y+1+fs,w:ha.stretch+ha.fixed-cs,h:po.stretch+po.fixed-fs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ba,pixelOffsetBR:Ia,minFontScaleX:rn/x/j,minFontScaleY:Yn/x/W,isSDF:r}};if(f&&(m.stretchX||m.stretchY))for(var Tn=qo($,vt,Ge),Ni=qo(ie,nt,Xe),fi=0;fi<Tn.length-1;fi++)for(var Zn=Tn[fi],Ji=Tn[fi+1],Mi=0;Mi<Ni.length-1;Mi++)v.push($n(Zn,Ni[Mi],Ji,Ni[Mi+1]));else v.push($n({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return v}function ia(e,t,r){for(var f=0,v=0,m=e;v<m.length;v+=1){var x=m[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function qo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,m=e;v<m.length;v+=1){var x=m[v],P=x[0],k=x[1],j=f[f.length-1];f.push({fixed:P-j.stretch,stretch:j.stretch}),f.push({fixed:P-j.stretch,stretch:j.stretch+(k-P)})}return f.push({fixed:t+1,stretch:r}),f}function Su(e,t,r,f){return e/t*r+f}function sc(e,t,r,f){return e-t*r/f}var Ve=function(e,t,r,f,v,m,x,P,k,j){if(this.boxStartIndex=e.length,k){var W=m.top,$=m.bottom,ie=m.collisionPadding;ie&&(W-=ie[1],$+=ie[3]);var pe=$-W;pe>0&&(pe=Math.max(10,pe),this.circleDiameter=pe)}else{var Ge=m.top*x-P,Xe=m.bottom*x+P,vt=m.left*x-P,nt=m.right*x+P,Rt=m.collisionPadding;if(Rt&&(vt-=Rt[0]*x,Ge-=Rt[1]*x,nt+=Rt[2]*x,Xe+=Rt[3]*x),j){var Kt=new N(vt,Ge),sr=new N(nt,Ge),hr=new N(vt,Xe),Ir=new N(nt,Xe),rn=j*Math.PI/180;Kt._rotate(rn),sr._rotate(rn),hr._rotate(rn),Ir._rotate(rn),vt=Math.min(Kt.x,sr.x,hr.x,Ir.x),nt=Math.max(Kt.x,sr.x,hr.x,Ir.x),Ge=Math.min(Kt.y,sr.y,hr.y,Ir.y),Xe=Math.max(Kt.y,sr.y,hr.y,Ir.y)}e.emplaceBack(t.x,t.y,vt,Ge,nt,Xe,r,f,v)}this.boxEndIndex=e.length},ir=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=er),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function er(e,t){return e<t?-1:e>t?1:0}function An(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,m=-1/0,x=-1/0,P=e[0],k=0;k<P.length;k++){var j=P[k];(!k||j.x<f)&&(f=j.x),(!k||j.y<v)&&(v=j.y),(!k||j.x>m)&&(m=j.x),(!k||j.y>x)&&(x=j.y)}var W=Math.min(m-f,x-v),$=W/2,ie=new ir([],Ui);if(W===0)return new N(f,v);for(var pe=f;pe<m;pe+=W)for(var Ge=v;Ge<x;Ge+=W)ie.push(new Re(pe+$,Ge+$,$,e));for(var Xe=function(Rt){for(var Kt=0,sr=0,hr=0,Ir=Rt[0],rn=0,pn=Ir.length,Yn=pn-1;rn<pn;Yn=rn++){var Sn=Ir[rn],$n=Ir[Yn],Tn=Sn.x*$n.y-$n.x*Sn.y;sr+=(Sn.x+$n.x)*Tn,hr+=(Sn.y+$n.y)*Tn,Kt+=3*Tn}return new Re(sr/Kt,hr/Kt,0,Rt)}(e),vt=ie.length;ie.length;){var nt=ie.pop();(nt.d>Xe.d||!Xe.d)&&(Xe=nt,r&&console.log("found best %d after %d probes",Math.round(1e4*nt.d)/1e4,vt)),nt.max-Xe.d<=t||(ie.push(new Re(nt.p.x-($=nt.h/2),nt.p.y-$,$,e)),ie.push(new Re(nt.p.x+$,nt.p.y-$,$,e)),ie.push(new Re(nt.p.x-$,nt.p.y+$,$,e)),ie.push(new Re(nt.p.x+$,nt.p.y+$,$,e)),vt+=4)}return r&&(console.log("num probes: "+vt),console.log("best distance: "+Xe.d)),Xe.p}function Ui(e,t){return t.max-e.max}function Re(e,t,r,f){this.p=new N(e,t),this.h=r,this.d=function(v,m){for(var x=!1,P=1/0,k=0;k<m.length;k++)for(var j=m[k],W=0,$=j.length,ie=$-1;W<$;ie=W++){var pe=j[W],Ge=j[ie];pe.y>v.y!=Ge.y>v.y&&v.x<(Ge.x-pe.x)*(v.y-pe.y)/(Ge.y-pe.y)+pe.x&&(x=!x),P=Math.min(P,Vu(v,pe,Ge))}return(x?1:-1)*Math.sqrt(P)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}ir.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},ir.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},ir.prototype.peek=function(){return this.data[0]},ir.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,m=t[v];if(r(f,m)>=0)break;t[e]=m,e=v}t[e]=f},ir.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var m=1+(e<<1),x=t[m],P=m+1;if(P<this.length&&r(t[P],x)<0&&(m=P,x=t[P]),r(x,v)>=0)break;t[e]=x,e=m}t[e]=v};var ye=Number.POSITIVE_INFINITY;function ut(e,t){return t[1]!==ye?function(r,f,v){var m=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":m=-f;break;case"top-left":case"bottom-left":case"left":m=f}return[m,x]}(e,t[0],t[1]):function(r,f){var v=0,m=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=x-7;break;case"bottom-right":case"bottom-left":m=7-x;break;case"bottom":m=7-f;break;case"top":m=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,m]}(e,t[0])}function Lt(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Vt(e,t,r,f,v,m,x,P,k,j,W,$,ie,pe,Ge){var Xe=function(sr,hr,Ir,rn,pn,Yn,Sn,$n){for(var Tn=rn.layout.get("text-rotate").evaluate(Yn,{})*Math.PI/180,Ni=[],fi=0,Zn=hr.positionedLines;fi<Zn.length;fi+=1)for(var Ji=Zn[fi],Mi=0,ca=Ji.positionedGlyphs;Mi<ca.length;Mi+=1){var Jn=ca[Mi];if(Jn.rect){var ha=Jn.rect||{},po=4,Ao=!0,So=1,la=0,Co=(pn||$n)&&Jn.vertical,Ro=Jn.metrics.advance*Jn.scale/2;if($n&&hr.verticalizable&&(la=Ji.lineOffset/2-(Jn.imageName?-(24-Jn.metrics.width*Jn.scale)/2:24*(Jn.scale-1))),Jn.imageName){var Us=Sn[Jn.imageName];Ao=Us.sdf,po=1/(So=Us.pixelRatio)}var uu=pn?[Jn.x+Ro,Jn.y]:[0,0],js=pn?[0,0]:[Jn.x+Ro+Ir[0],Jn.y+Ir[1]-la],Du=[0,0];Co&&(Du=js,js=[0,0]);var Po=(Jn.metrics.left-po)*Jn.scale-Ro+js[0],es=(-Jn.metrics.top-po)*Jn.scale+js[1],ta=Po+ha.w*Jn.scale/So,Ba=es+ha.h*Jn.scale/So,Ia=new N(Po,es),Qi=new N(ta,es),lu=new N(Po,Ba),Os=new N(ta,Ba);if(Co){var vo=new N(-Ro,Ro- -17),cs=-Math.PI/2,fs=12-Ro,ga=new N(22-fs,-(Jn.imageName?fs:0)),Yc=new(Function.prototype.bind.apply(N,[null].concat(Du)));Ia._rotateAround(cs,vo)._add(ga)._add(Yc),Qi._rotateAround(cs,vo)._add(ga)._add(Yc),lu._rotateAround(cs,vo)._add(ga)._add(Yc),Os._rotateAround(cs,vo)._add(ga)._add(Yc)}if(Tn){var Vl=Math.sin(Tn),df=Math.cos(Tn),hs=[df,-Vl,Vl,df];Ia._matMult(hs),Qi._matMult(hs),lu._matMult(hs),Os._matMult(hs)}var vf=new N(0,0),Cc=new N(0,0);Ni.push({tl:Ia,tr:Qi,bl:lu,br:Os,tex:ha,writingMode:hr.writingMode,glyphOffset:uu,sectionIndex:Jn.sectionIndex,isSDF:Ao,pixelOffsetTL:vf,pixelOffsetBR:Cc,minFontScaleX:0,minFontScaleY:0})}}return Ni}(0,r,P,v,m,x,f,e.allowVerticalPlacement),vt=e.textSizeData,nt=null;vt.kind==="source"?(nt=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&oe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):vt.kind==="composite"&&((nt=[128*pe.compositeTextSizes[0].evaluate(x,{},Ge),128*pe.compositeTextSizes[1].evaluate(x,{},Ge)])[0]>32640||nt[1]>32640)&&oe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Xe,nt,P,m,x,j,t,k.lineStartIndex,k.lineLength,ie,Ge);for(var Rt=0,Kt=W;Rt<Kt.length;Rt+=1)$[Kt[Rt]]=e.text.placedSymbolArray.length-1;return 4*Xe.length}function yt(e){for(var t in e)return e[t];return null}function dt(e,t,r,f){var v=e.compareText;if(t in v){for(var m=v[t],x=m.length-1;x>=0;x--)if(f.dist(m[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var Ct=Lo.VectorTileFeature.types,Le=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rt(e,t,r,f,v,m,x,P,k,j,W,$,ie){var pe=P?Math.min(32640,Math.round(P[0])):0,Ge=P?Math.min(32640,Math.round(P[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),m,x,(pe<<1)+(k?1:0),Ge,16*j,16*W,256*$,256*ie)}function Me(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function It(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(vc(r[t].text))return!0;return!1}var Ht=function(e){this.layoutVertexArray=new yc,this.indexArray=new al,this.programConfigurations=e,this.segments=new _e,this.dynamicLayoutVertexArray=new nc,this.opacityVertexArray=new _c,this.placedSymbolArray=new h};Ht.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ht.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Zh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Le,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},Ht.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},En("SymbolBuffers",Ht);var Cr=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new _e,this.collisionVertexArray=new xc};Cr.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Vh.members,!0)},Cr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},En("CollisionBuffers",Cr);var rr=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Uo([]),this.placementViewportMatrix=Uo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Va(this.zoom,t["text-size"]),this.iconSizeData=Va(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(m){return Wn[m]})),this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id}),this.sourceID=e.sourceID};rr.prototype.createArrays=function(){this.text=new Ht(new Qn(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Ht(new Qn(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new E},rr.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,(r||f)&&v){var x=cf[e.charAt(m)];x&&(t[x.charCodeAt(0)]=!0)}},rr.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,m=v.get("text-font"),x=v.get("text-field"),P=v.get("icon-image"),k=(x.value.kind!=="constant"||x.value.value instanceof Di&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),j=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],k||j){for(var $=t.iconDependencies,ie=t.glyphDependencies,pe=t.availableImages,Ge=new ki(this.zoom),Xe=0,vt=e;Xe<vt.length;Xe+=1){var nt=vt[Xe],Rt=nt.feature,Kt=nt.id,sr=nt.index,hr=nt.sourceLayerIndex,Ir=f._featureFilter.needGeometry,rn=io(Rt,Ir);if(f._featureFilter.filter(Ge,rn,r)){Ir||(rn.geometry=$a(Rt));var pn=void 0;if(k){var Yn=f.getValueAndResolveTokens("text-field",rn,r,pe),Sn=Di.factory(Yn);It(Sn)&&(this.hasRTLText=!0),(!this.hasRTLText||Zc()==="unavailable"||this.hasRTLText&&eu.isParsed())&&(pn=gp(Sn,f,rn))}var $n=void 0;if(j){var Tn=f.getValueAndResolveTokens("icon-image",rn,r,pe);$n=Tn instanceof Na?Tn:Na.fromString(Tn)}if(pn||$n){var Ni=this.sortFeaturesByKey?W.evaluate(rn,{},r):void 0;if(this.features.push({id:Kt,text:pn,icon:$n,index:sr,sourceLayerIndex:hr,geometry:rn.geometry,properties:Rt.properties,type:Ct[Rt.type],sortKey:Ni}),$n&&($[$n.name]=!0),pn){var fi=m.evaluate(rn,{},r).join(","),Zn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wn.vertical)>=0;for(var Ji=0,Mi=pn.sections;Ji<Mi.length;Ji+=1){var ca=Mi[Ji];if(ca.image)$[ca.image.name]=!0;else{var Jn=jc(pn.toString()),ha=ca.fontStack||fi,po=ie[ha]=ie[ha]||{};this.calculateGlyphDependencies(ca.text,po,Zn,this.allowVerticalPlacement,Jn)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Ao){var So={},la={},Co=[],Ro=0;function Us(vo){Co.push(Ao[vo]),Ro++}function uu(vo,cs,fs){var ga=la[vo];return delete la[vo],la[cs]=ga,Co[ga].geometry[0].pop(),Co[ga].geometry[0]=Co[ga].geometry[0].concat(fs[0]),ga}function js(vo,cs,fs){var ga=So[cs];return delete So[cs],So[vo]=ga,Co[ga].geometry[0].shift(),Co[ga].geometry[0]=fs[0].concat(Co[ga].geometry[0]),ga}function Du(vo,cs,fs){var ga=fs?cs[0][cs[0].length-1]:cs[0][0];return vo+":"+ga.x+":"+ga.y}for(var Po=0;Po<Ao.length;Po++){var es=Ao[Po],ta=es.geometry,Ba=es.text?es.text.toString():null;if(Ba){var Ia=Du(Ba,ta),Qi=Du(Ba,ta,!0);if(Ia in la&&Qi in So&&la[Ia]!==So[Qi]){var lu=js(Ia,Qi,ta),Os=uu(Ia,Qi,Co[lu].geometry);delete So[Ia],delete la[Qi],la[Du(Ba,Co[Os].geometry,!0)]=Os,Co[lu].geometry=null}else Ia in la?uu(Ia,Qi,ta):Qi in So?js(Ia,Qi,ta):(Us(Po),So[Ia]=Ro-1,la[Qi]=Ro-1)}else Us(Po)}return Co.filter(function(vo){return vo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Ao,So){return Ao.sortKey-So.sortKey})}},rr.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},rr.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},rr.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},rr.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},rr.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},rr.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},rr.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),m={},x=e.segment+1;x<t.length;x++)m[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var P=e.segment||0;P>=0;P--)m[P]={x:t[P].x,y:t[P].y,tileUnitDistanceFromAnchor:v},P>0&&(v+=t[P-1].dist(t[P]));for(var k=0;k<t.length;k++){var j=m[k];this.lineVertexArray.emplaceBack(j.x,j.y,j.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},rr.prototype.addSymbols=function(e,t,r,f,v,m,x,P,k,j,W,$){for(var ie=e.indexArray,pe=e.layoutVertexArray,Ge=e.segments.prepareSegment(4*t.length,pe,ie,this.canOverlap?m.sortKey:void 0),Xe=this.glyphOffsetArray.length,vt=Ge.vertexLength,nt=this.allowVerticalPlacement&&x===Wn.vertical?Math.PI/2:0,Rt=m.text&&m.text.sections,Kt=0;Kt<t.length;Kt++){var sr=t[Kt],hr=sr.tl,Ir=sr.tr,rn=sr.bl,pn=sr.br,Yn=sr.tex,Sn=sr.pixelOffsetTL,$n=sr.pixelOffsetBR,Tn=sr.minFontScaleX,Ni=sr.minFontScaleY,fi=sr.glyphOffset,Zn=sr.isSDF,Ji=sr.sectionIndex,Mi=Ge.vertexLength,ca=fi[1];rt(pe,P.x,P.y,hr.x,ca+hr.y,Yn.x,Yn.y,r,Zn,Sn.x,Sn.y,Tn,Ni),rt(pe,P.x,P.y,Ir.x,ca+Ir.y,Yn.x+Yn.w,Yn.y,r,Zn,$n.x,Sn.y,Tn,Ni),rt(pe,P.x,P.y,rn.x,ca+rn.y,Yn.x,Yn.y+Yn.h,r,Zn,Sn.x,$n.y,Tn,Ni),rt(pe,P.x,P.y,pn.x,ca+pn.y,Yn.x+Yn.w,Yn.y+Yn.h,r,Zn,$n.x,$n.y,Tn,Ni),Me(e.dynamicLayoutVertexArray,P,nt),ie.emplaceBack(Mi,Mi+1,Mi+2),ie.emplaceBack(Mi+1,Mi+2,Mi+3),Ge.vertexLength+=4,Ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(fi[0]),Kt!==t.length-1&&Ji===t[Kt+1].sectionIndex||e.programConfigurations.populatePaintArrays(pe.length,m,m.index,{},$,Rt&&Rt[Ji])}e.placedSymbolArray.emplaceBack(P.x,P.y,Xe,this.glyphOffsetArray.length-Xe,vt,k,j,P.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,W)},rr.prototype._addCollisionDebugVertex=function(e,t,r,f,v,m){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(m.x),Math.round(m.y))},rr.prototype.addCollisionDebugVertices=function(e,t,r,f,v,m,x){var P=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),k=P.vertexLength,j=v.layoutVertexArray,W=v.collisionVertexArray,$=x.anchorX,ie=x.anchorY;this._addCollisionDebugVertex(j,W,m,$,ie,new N(e,t)),this._addCollisionDebugVertex(j,W,m,$,ie,new N(r,t)),this._addCollisionDebugVertex(j,W,m,$,ie,new N(r,f)),this._addCollisionDebugVertex(j,W,m,$,ie,new N(e,f)),P.vertexLength+=4;var pe=v.indexArray;pe.emplaceBack(k,k+1),pe.emplaceBack(k+1,k+2),pe.emplaceBack(k+2,k+3),pe.emplaceBack(k+3,k),P.primitiveLength+=4},rr.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var m=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,f?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,r)}},rr.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cr(zl,yh.members,Sc),this.iconCollisionBox=new Cr(zl,yh.members,Sc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},rr.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,m,x,P,k){for(var j={},W=t;W<r;W++){var $=e.get(W);j.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},j.textFeatureIndex=$.featureIndex;break}for(var ie=f;ie<v;ie++){var pe=e.get(ie);j.verticalTextBox={x1:pe.x1,y1:pe.y1,x2:pe.x2,y2:pe.y2,anchorPointX:pe.anchorPointX,anchorPointY:pe.anchorPointY},j.verticalTextFeatureIndex=pe.featureIndex;break}for(var Ge=m;Ge<x;Ge++){var Xe=e.get(Ge);j.iconBox={x1:Xe.x1,y1:Xe.y1,x2:Xe.x2,y2:Xe.y2,anchorPointX:Xe.anchorPointX,anchorPointY:Xe.anchorPointY},j.iconFeatureIndex=Xe.featureIndex;break}for(var vt=P;vt<k;vt++){var nt=e.get(vt);j.verticalIconBox={x1:nt.x1,y1:nt.y1,x2:nt.x2,y2:nt.y2,anchorPointX:nt.anchorPointX,anchorPointY:nt.anchorPointY},j.verticalIconFeatureIndex=nt.featureIndex;break}return j},rr.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},rr.prototype.hasTextData=function(){return this.text.segments.get().length>0},rr.prototype.hasIconData=function(){return this.icon.segments.get().length>0},rr.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},rr.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},rr.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},rr.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},rr.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],m=[],x=0;x<this.symbolInstances.length;++x){m.push(x);var P=this.symbolInstances.get(x);f.push(0|Math.round(t*P.anchorX+r*P.anchorY)),v.push(P.featureIndex)}return m.sort(function(k,j){return f[k]-f[j]||v[j]-v[k]}),m},rr.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},rr.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(m,x,P){m>=0&&P.indexOf(m)===x&&t.addIndicesForPlacedSymbol(t.text,m)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},En("SymbolBucket",rr,{omit:["layers","collisionBoxArray","features","compareText"]}),rr.MAX_GLYPHS=65535,rr.addDynamicAttributes=Me;var Er=new zo({"symbol-placement":new Un(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Un(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Un(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pn(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Un(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Un(ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Un(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Un(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Un(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pn(ge.layout_symbol["icon-size"]),"icon-text-fit":new Un(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Un(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pn(ge.layout_symbol["icon-image"]),"icon-rotate":new Pn(ge.layout_symbol["icon-rotate"]),"icon-padding":new Un(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Un(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new Pn(ge.layout_symbol["icon-offset"]),"icon-anchor":new Pn(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Un(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Un(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Un(ge.layout_symbol["text-rotation-alignment"]),"text-field":new Pn(ge.layout_symbol["text-field"]),"text-font":new Pn(ge.layout_symbol["text-font"]),"text-size":new Pn(ge.layout_symbol["text-size"]),"text-max-width":new Pn(ge.layout_symbol["text-max-width"]),"text-line-height":new Un(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new Pn(ge.layout_symbol["text-letter-spacing"]),"text-justify":new Pn(ge.layout_symbol["text-justify"]),"text-radial-offset":new Pn(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Un(ge.layout_symbol["text-variable-anchor"]),"text-anchor":new Pn(ge.layout_symbol["text-anchor"]),"text-max-angle":new Un(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Un(ge.layout_symbol["text-writing-mode"]),"text-rotate":new Pn(ge.layout_symbol["text-rotate"]),"text-padding":new Un(ge.layout_symbol["text-padding"]),"text-keep-upright":new Un(ge.layout_symbol["text-keep-upright"]),"text-transform":new Pn(ge.layout_symbol["text-transform"]),"text-offset":new Pn(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Un(ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Un(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Un(ge.layout_symbol["text-optional"])}),Xr={paint:new zo({"icon-opacity":new Pn(ge.paint_symbol["icon-opacity"]),"icon-color":new Pn(ge.paint_symbol["icon-color"]),"icon-halo-color":new Pn(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pn(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pn(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Un(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Un(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pn(ge.paint_symbol["text-opacity"]),"text-color":new Pn(ge.paint_symbol["text-color"],{runtimeType:cn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Pn(ge.paint_symbol["text-halo-color"]),"text-halo-width":new Pn(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new Pn(ge.paint_symbol["text-halo-blur"]),"text-translate":new Un(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Un(ge.paint_symbol["text-translate-anchor"])}),layout:Er},Fn=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e};Fn.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Fn.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Fn.prototype.outputDefined=function(){return!1},Fn.prototype.serialize=function(){return null},En("FormatSectionOverride",Fn,{omit:["defaultValue"]});var bi=function(e){function t(r){e.call(this,r,Xr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var m=[],x=0,P=v;x<P.length;x+=1){var k=P[x];m.indexOf(k)<0&&m.push(k)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,m){var x=this.layout.get(r).evaluate(f,{},v,m),P=this._unevaluatedLayout._values[r];return P.isDataDriven()||Tu(P.value)||!x?x:function(k,j){return j.replace(/{([^{}]+)}/g,function(W,$){return $ in k?String(k[$]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new rr(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=Xr.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var m,x=this.paint.get(v),P=new Fn(x),k=new Qu(P,x.property.specification);m=x.value.kind==="constant"||x.value.kind==="source"?new Ml("source",k):new pl("composite",k,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new ms(x.property,m,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),m=Xr.paint.properties[f],x=!1,P=function(W){for(var $=0,ie=W;$<ie.length;$+=1)if(m.overrides&&m.overrides.hasOverride(ie[$]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Di)P(v.value.value.sections);else if(v.value.kind==="source"){var k=function(W){x||(W instanceof Ga&&ya(W.value)===Wi?P(W.value.sections):W instanceof Wa?P(W.sections):W.eachChild(k))},j=v.value;j._styleExpression&&k(j._styleExpression.expression)}return x},t}(vu),zn={paint:new zo({"background-color":new Un(ge.paint_background["background-color"]),"background-pattern":new is(ge.paint_background["background-pattern"]),"background-opacity":new Un(ge.paint_background["background-opacity"])})},si=function(e){function t(r){e.call(this,r,zn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(vu),Ti={paint:new zo({"raster-opacity":new Un(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Un(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Un(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Un(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Un(ge.paint_raster["raster-saturation"]),"raster-contrast":new Un(ge.paint_raster["raster-contrast"]),"raster-resampling":new Un(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Un(ge.paint_raster["raster-fade-duration"])})},ua=function(e){function t(r){e.call(this,r,Ti)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(vu),eo=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(vu),ls={circle:Gu,heatmap:Wf,hillshade:kf,fill:Ci,"fill-extrusion":Cs,line:Bh,symbol:bi,background:si,raster:ua},xh=K.HTMLImageElement,Hu=K.HTMLCanvasElement,Af=K.HTMLVideoElement,ol=K.ImageData,Cf=K.ImageBitmap,eh=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};eh.prototype.update=function(e,t,r){var f=e.width,v=e.height,m=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,P=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!t||t.premultiply!==!1)),m)this.size=[f,v],e instanceof xh||e instanceof Hu||e instanceof Af||e instanceof ol||Cf&&e instanceof Cf?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,e):P.texImage2D(P.TEXTURE_2D,0,this.format,f,v,0,this.format,P.UNSIGNED_BYTE,e.data);else{var k=r||{x:0,y:0},j=k.x,W=k.y;e instanceof xh||e instanceof Hu||e instanceof Af||e instanceof ol||Cf&&e instanceof Cf?P.texSubImage2D(P.TEXTURE_2D,0,j,W,P.RGBA,P.UNSIGNED_BYTE,e):P.texSubImage2D(P.TEXTURE_2D,0,j,W,f,v,P.RGBA,P.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},eh.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},eh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},eh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var yp=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};yp.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},yp.prototype.remove=function(){delete this._channel,this._callback=function(){}};var th=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Yt(["receive","process"],this),this.invoker=new yp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=it()?e:K};function Wp(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}th.prototype.send=function(e,t,r,f,v){var m=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var P=$e(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:Qs(t,P)},P),{cancel:function(){r&&delete m.callbacks[x],m.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:m.mapId})}}},th.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else it()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},th.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},th.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Zs(t.error)):f(null,Zs(t.data)))}else{var v=!1,m=$e(this.globalScope)?void 0:[],x=t.hasCallback?function(W,$){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:W?Qs(W):null,data:Qs($,m)},m)}:function(W){v=!0},P=null,k=Zs(t.data);if(this.parent[t.type])P=this.parent[t.type](t.sourceMapId,k,x);else if(this.parent.getWorkerSource){var j=t.type.split(".");P=this.parent.getWorkerSource(t.sourceMapId,j[0],k.source)[j[1]](k,x)}else x(new Error("Could not find function "+t.type));!v&&P&&P.cancel&&(this.cancelCallbacks[e]=P.cancel)}},th.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var xs=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};xs.prototype.setNorthEast=function(e){return this._ne=e instanceof so?new so(e.lng,e.lat):so.convert(e),this},xs.prototype.setSouthWest=function(e){return this._sw=e instanceof so?new so(e.lng,e.lat):so.convert(e),this},xs.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof so)t=e,r=e;else{if(!(e instanceof xs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xs.convert(e)):this.extend(so.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new so(t.lng,t.lat),this._ne=new so(r.lng,r.lat)),this},xs.prototype.getCenter=function(){return new so((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},xs.prototype.getSouthWest=function(){return this._sw},xs.prototype.getNorthEast=function(){return this._ne},xs.prototype.getNorthWest=function(){return new so(this.getWest(),this.getNorth())},xs.prototype.getSouthEast=function(){return new so(this.getEast(),this.getSouth())},xs.prototype.getWest=function(){return this._sw.lng},xs.prototype.getSouth=function(){return this._sw.lat},xs.prototype.getEast=function(){return this._ne.lng},xs.prototype.getNorth=function(){return this._ne.lat},xs.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},xs.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},xs.prototype.isEmpty=function(){return!(this._sw&&this._ne)},xs.prototype.contains=function(e){var t=so.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},xs.convert=function(e){return!e||e instanceof xs?e:new xs(e)};var so=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};so.prototype.wrap=function(){return new so(zt(this.lng,-180,180),this.lat)},so.prototype.toArray=function(){return[this.lng,this.lat]},so.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},so.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},so.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new xs(new so(this.lng-r,this.lat-t),new so(this.lng+r,this.lat+t))},so.convert=function(e){if(e instanceof so)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new so(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new so(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var _p=2*Math.PI*63710088e-1;function Zl(e){return _p*Math.cos(e*Math.PI/180)}function Gh(e){return(180+e)/360}function xp(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Xp(e,t){return e/Zl(t)}function bp(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Xc=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Xc.fromLngLat=function(e,t){t===void 0&&(t=0);var r=so.convert(e);return new Xc(Gh(r.lng),xp(r.lat),Xp(t,r.lat))},Xc.prototype.toLngLat=function(){return new so(360*this.x-180,bp(this.y))},Xc.prototype.toAltitude=function(){return this.z*Zl(bp(this.y))},Xc.prototype.meterInMercatorCoordinateUnits=function(){return 1/_p*(e=bp(this.y),1/Math.cos(e*Math.PI/180));var e};var ff=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Pf(0,e,e,t,r)};ff.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},ff.prototype.url=function(e,t){var r,f,v,m,x,P=(f=this.y,v=this.z,m=Wp(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=Wp(256*(r+1),256*(f+1),v),m[0]+","+m[1]+","+x[0]+","+x[1]),k=function(j,W,$){for(var ie,pe="",Ge=j;Ge>0;Ge--)pe+=(W&(ie=1<<Ge-1)?1:0)+($&ie?2:0);return pe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",P)},ff.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new N(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},ff.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Sp=function(e,t){this.wrap=e,this.canonical=t,this.key=Pf(e,t.z,t.z,t.x,t.y)},bs=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new ff(r,+f,+v),this.key=Pf(t,e,r,f,v)};function Pf(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var m=1<<r;return(m*m*e+m*v+f).toString(36)+r.toString(36)+t.toString(36)}bs.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},bs.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new bs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bs(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},bs.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Pf(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Pf(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},bs.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},bs.prototype.children=function(e){if(this.overscaledZ>=e)return[new bs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new bs(t,this.wrap,t,r,f),new bs(t,this.wrap,t,r+1,f),new bs(t,this.wrap,t,r,f+1),new bs(t,this.wrap,t,r+1,f+1)]},bs.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},bs.prototype.wrapped=function(){return new bs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},bs.prototype.unwrapTo=function(e){return new bs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},bs.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},bs.prototype.toUnwrapped=function(){return new Sp(this.wrap,this.canonical)},bs.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},bs.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Xc(e.x-this.wrap,e.y))},En("CanonicalTileID",ff),En("OverscaledTileID",bs,{omit:["posMatrix"]});var Ac=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return oe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Ac.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Ac.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ac.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Ac.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Ac.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Ac.prototype.getPixels=function(){return new da({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ac.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,m=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:m=x-1;break;case 1:x=m+1}for(var P=-t*this.dim,k=-r*this.dim,j=m;j<x;j++)for(var W=f;W<v;W++)this.data[this._idx(W,j)]=e.data[this._idx(W+P,j+k)]},En("DEMData",Ac);var Hh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Hh.prototype.encode=function(e){return this._stringToNumber[e]},Hh.prototype.decode=function(e){return this._numberToString[e]};var Bf=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Mf={geometry:{configurable:!0}};Mf.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Mf.geometry.set=function(e){this._geometry=e},Bf.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Bf.prototype,Mf);var rh=function(){this.state={},this.stateChanges={},this.deletedStates={}};rh.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Wt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var m in this.deletedStates[e][f]={},this.state[e][f])r[m]||(this.deletedStates[e][f][m]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},rh.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},rh.prototype.getState=function(e,t){var r=String(t),f=Wt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var m in v)delete f[m]}return f},rh.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},rh.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var m in this.stateChanges[f])this.state[f][m]||(this.state[f][m]={}),Wt(this.state[f][m],this.stateChanges[f][m]),v[m]=this.state[f][m];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var P={};if(this.deletedStates[x]===null)for(var k in this.state[x])P[k]={},this.state[x][k]={};else for(var j in this.deletedStates[x]){if(this.deletedStates[x][j]===null)this.state[x][j]={};else for(var W=0,$=Object.keys(this.deletedStates[x][j]);W<$.length;W+=1)delete this.state[x][j][$[W]];P[j]=this.state[x][j]}r[x]=r[x]||{},Wt(r[x],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var ie in e)e[ie].setFeatureState(r,t)};var hf=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Uu(8192,16,0),this.grid3D=new Uu(8192,16,0),this.featureIndexArray=new ee,this.promoteId=t};function Yp(e,t,r,f,v){return Ne(e,function(m,x){var P=t instanceof nl?t.get(x):null;return P&&P.evaluate?P.evaluate(r,f,v):P})}function Kp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,m=0,x=e;m<x.length;m+=1){var P=x[m];t=Math.min(t,P.x),r=Math.min(r,P.y),f=Math.max(f,P.x),v=Math.max(v,P.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function $p(e,t){return t-e}hf.prototype.insert=function(e,t,r,f,v,m){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var P=m?this.grid3D:this.grid,k=0;k<t.length;k++){for(var j=t[k],W=[1/0,1/0,-1/0,-1/0],$=0;$<j.length;$++){var ie=j[$];W[0]=Math.min(W[0],ie.x),W[1]=Math.min(W[1],ie.y),W[2]=Math.max(W[2],ie.x),W[3]=Math.max(W[3],ie.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&P.insert(x,W[0],W[1],W[2],W[3])}},hf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Lo.VectorTile(new Te(this.rawTileData)).layers,this.sourceLayerCoder=new Hh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},hf.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var m=e.params||{},x=8192/e.tileSize/e.scale,P=Ol(m.filter),k=e.queryGeometry,j=e.queryPadding*x,W=Kp(k),$=this.grid.query(W.minX-j,W.minY-j,W.maxX+j,W.maxY+j),ie=Kp(e.cameraQueryGeometry),pe=this.grid3D.query(ie.minX-j,ie.minY-j,ie.maxX+j,ie.maxY+j,function(sr,hr,Ir,rn){return function(pn,Yn,Sn,$n,Tn){for(var Ni=0,fi=pn;Ni<fi.length;Ni+=1){var Zn=fi[Ni];if(Yn<=Zn.x&&Sn<=Zn.y&&$n>=Zn.x&&Tn>=Zn.y)return!0}var Ji=[new N(Yn,Sn),new N(Yn,Tn),new N($n,Tn),new N($n,Sn)];if(pn.length>2){for(var Mi=0,ca=Ji;Mi<ca.length;Mi+=1)if(gu(pn,ca[Mi]))return!0}for(var Jn=0;Jn<pn.length-1;Jn++)if(wl(pn[Jn],pn[Jn+1],Ji))return!0;return!1}(e.cameraQueryGeometry,sr-j,hr-j,Ir+j,rn+j)}),Ge=0,Xe=pe;Ge<Xe.length;Ge+=1)$.push(Xe[Ge]);$.sort($p);for(var vt,nt={},Rt=function(sr){var hr=$[sr];if(hr!==vt){vt=hr;var Ir=v.featureIndexArray.get(hr),rn=null;v.loadMatchingFeature(nt,Ir.bucketIndex,Ir.sourceLayerIndex,Ir.featureIndex,P,m.layers,m.availableImages,t,r,f,function(pn,Yn,Sn){return rn||(rn=$a(pn)),Yn.queryIntersectsFeature(k,pn,Sn,rn,v.z,e.transform,x,e.pixelPosMatrix)})}},Kt=0;Kt<$.length;Kt++)Rt(Kt);return nt},hf.prototype.loadMatchingFeature=function(e,t,r,f,v,m,x,P,k,j,W){var $=this.bucketLayerIDs[t];if(!m||function(pn,Yn){for(var Sn=0;Sn<pn.length;Sn++)if(Yn.indexOf(pn[Sn])>=0)return!0;return!1}(m,$)){var ie=this.sourceLayerCoder.decode(r),pe=this.vtLayers[ie].feature(f);if(v.needGeometry){var Ge=io(pe,!0);if(!v.filter(new ki(this.tileID.overscaledZ),Ge,this.tileID.canonical))return}else if(!v.filter(new ki(this.tileID.overscaledZ),pe))return;for(var Xe=this.getId(pe,ie),vt=0;vt<$.length;vt++){var nt=$[vt];if(!(m&&m.indexOf(nt)<0)){var Rt=P[nt];if(Rt){var Kt={};Xe!==void 0&&j&&(Kt=j.getState(Rt.sourceLayer||"_geojsonTileLayer",Xe));var sr=Wt({},k[nt]);sr.paint=Yp(sr.paint,Rt.paint,pe,Kt,x),sr.layout=Yp(sr.layout,Rt.layout,pe,Kt,x);var hr=!W||W(pe,Rt,Kt);if(hr){var Ir=new Bf(pe,this.z,this.x,this.y,Xe);Ir.layer=sr;var rn=e[nt];rn===void 0&&(rn=e[nt]=[]),rn.push({featureIndex:f,feature:Ir,intersectionZ:hr})}}}}}},hf.prototype.lookupSymbolFeatures=function(e,t,r,f,v,m,x,P){var k={};this.loadVTLayers();for(var j=Ol(v),W=0,$=e;W<$.length;W+=1)this.loadMatchingFeature(k,r,f,$[W],j,m,x,P,t);return k},hf.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},hf.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},En("FeatureIndex",hf,{omit:["rawTileData","sourceLayerCoder"]});var Bs=function(e,t){this.tileID=e,this.uid=wt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Bs.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Yr.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Bs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Bs.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(j,W){var $={};if(!W)return $;for(var ie=function(){var Xe=Ge[pe],vt=Xe.layerIds.map(function(Kt){return W.getLayer(Kt)}).filter(Boolean);if(vt.length!==0){Xe.layers=vt,Xe.stateDependentLayerIds&&(Xe.stateDependentLayers=Xe.stateDependentLayerIds.map(function(Kt){return vt.filter(function(sr){return sr.id===Kt})[0]}));for(var nt=0,Rt=vt;nt<Rt.length;nt+=1)$[Rt[nt].id]=Xe}},pe=0,Ge=j;pe<Ge.length;pe+=1)ie();return $}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof rr){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var x=this.buckets[m];if(x instanceof rr&&x.hasRTLText){this.hasRTLText=!0,eu.isLoading()||eu.isLoaded()||Zc()!=="deferred"||Au();break}}for(var P in this.queryPadding=0,this.buckets){var k=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(P).queryRadius(k))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Bs.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Bs.prototype.getBucket=function(e){return this.buckets[e.id]},Bs.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new eh(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new eh(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Bs.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Bs.prototype.queryRenderedFeatures=function(e,t,r,f,v,m,x,P,k,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:m,tileSize:this.tileSize,pixelPosMatrix:j,transform:P,params:x,queryPadding:this.queryPadding*k},e,t,r):{}},Bs.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",m=f._geojsonTileLayer||f[v];if(m)for(var x=Ol(t&&t.filter),P=this.tileID.canonical,k=P.z,j=P.x,W=P.y,$={z:k,x:j,y:W},ie=0;ie<m.length;ie++){var pe=m.feature(ie);if(x.needGeometry){var Ge=io(pe,!0);if(!x.filter(new ki(this.tileID.overscaledZ),Ge,this.tileID.canonical))continue}else if(!x.filter(new ki(this.tileID.overscaledZ),pe))continue;var Xe=r.getId(pe,v),vt=new Bf(pe,k,j,W,Xe);vt.tile=$,e.push(vt)}}},Bs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Bs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Bs.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=Jt(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var m=this.expirationTime-t;m?this.expirationTime=f+Math.max(m,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Bs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Bs.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],m=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[m],P=e[m];if(x&&P&&Object.keys(P).length!==0){v.update(P,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=t&&t.style&&t.style.getLayer(f);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}}},Bs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Bs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Yr.now()},Bs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Bs.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Yr.now()+e},Bs.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Bs.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var m=0,x=t;m<x.length;m+=1)if(v[x[m]])return!0}}return!1};var pf=K.performance,Ep=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},pf.mark(this._marks.start)};Ep.prototype.finish=function(){pf.mark(this._marks.end);var e=pf.getEntriesByName(this._marks.measure);return e.length===0&&(pf.measure(this._marks.measure,this._marks.start,this._marks.end),e=pf.getEntriesByName(this._marks.measure),pf.clearMarks(this._marks.start),pf.clearMarks(this._marks.end),pf.clearMeasures(this._marks.measure)),e},p.Actor=th,p.AlphaImage=xu,p.CanonicalTileID=ff,p.CollisionBoxArray=u,p.Color=Vn,p.DEMData=Ac,p.DataConstantProperty=Un,p.DictionaryCoder=Hh,p.EXTENT=8192,p.ErrorEvent=ht,p.EvaluationParameters=ki,p.Event=je,p.Evented=xt,p.FeatureIndex=hf,p.FillBucket=Bn,p.FillExtrusionBucket=ss,p.ImageAtlas=Kn,p.ImagePosition=kr,p.LineBucket=bu,p.LngLat=so,p.LngLatBounds=xs,p.MercatorCoordinate=Xc,p.ONE_EM=24,p.OverscaledTileID=bs,p.Point=N,p.Point$1=N,p.Properties=zo,p.Protobuf=Te,p.RGBAImage=da,p.RequestManager=jt,p.RequestPerformance=Ep,p.ResourceType=xr,p.SegmentVector=_e,p.SourceFeatureState=rh,p.StructArrayLayout1ui2=Gc,p.StructArrayLayout2f1f2i16=tu,p.StructArrayLayout2i4=bl,p.StructArrayLayout3ui6=al,p.StructArrayLayout4i8=gc,p.SymbolBucket=rr,p.Texture=eh,p.Tile=Bs,p.Transitionable=Oo,p.Uniform1f=nn,p.Uniform1i=Rr,p.Uniform2f=Qr,p.Uniform3f=yn,p.Uniform4f=jn,p.UniformColor=Xn,p.UniformMatrix4f=Ki,p.UnwrappedTileID=Sp,p.ValidationError=Ke,p.WritingMode=Wn,p.ZoomHistory=yl,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Me,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),m=null;e.forEach(function(x,P){t(x,function(k,j){k&&(m=k),v[P]=j,--f==0&&r(m,v)})})},p.bezier=xe,p.bindAll=Yt,p.browser=Yr,p.cacheEntryPossiblyAdded=function(e){++Nt>_t&&(e.getActor().send("enforceCacheSizeLimit",At),Nt=0)},p.clamp=Ft,p.clearTileCache=function(e){var t=K.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=ni,p.clone=function(e){var t=new $i(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ie,p.clone$2=function(e){var t=new $i(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=mp,p.config=tr,p.create=function(){var e=new $i(16);return $i!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new $i(9);return $i!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new $i(4);return $i!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=S,p.createExpression=Pl,p.createLayout=wo,p.createStyleLayer=function(e){return e.type==="custom"?new eo(e):new ls[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],m=t[2],x=r[0],P=r[1],k=r[2];return e[0]=v*k-m*P,e[1]=m*x-f*k,e[2]=f*P-v*x,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=se,p.emitValidationErrors=Bu,p.endsWith=ke,p.enforceCacheSizeLimit=function(e){pr(),Qt&&Qt.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Ho,p.evaluateSizeForZoom=Qo,p.evaluateVariableOffset=ut,p.evented=af,p.extend=Wt,p.featureFilter=Ol,p.filterObject=Be,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Go,p.getAnchorJustification=Lt,p.getArrayBuffer=aa,p.getImage=te,p.getJSON=function(e,t){return Bi(Wt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=Zc,p.getReferrer=In,p.getVideo=function(e,t){var r,f,v=K.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var m=0;m<e.length;m++){var x=K.document.createElement("source");r=e[m],f=void 0,(f=K.document.createElement("a")).href=r,(f.protocol!==K.document.location.protocol||f.host!==K.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[m],v.appendChild(x)}return{cancel:function(){}}},p.identity=Uo,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],m=t[3],x=t[4],P=t[5],k=t[6],j=t[7],W=t[8],$=t[9],ie=t[10],pe=t[11],Ge=t[12],Xe=t[13],vt=t[14],nt=t[15],Rt=r*P-f*x,Kt=r*k-v*x,sr=r*j-m*x,hr=f*k-v*P,Ir=f*j-m*P,rn=v*j-m*k,pn=W*Xe-$*Ge,Yn=W*vt-ie*Ge,Sn=W*nt-pe*Ge,$n=$*vt-ie*Xe,Tn=$*nt-pe*Xe,Ni=ie*nt-pe*vt,fi=Rt*Ni-Kt*Tn+sr*$n+hr*Sn-Ir*Yn+rn*pn;return fi?(e[0]=(P*Ni-k*Tn+j*$n)*(fi=1/fi),e[1]=(v*Tn-f*Ni-m*$n)*fi,e[2]=(Xe*rn-vt*Ir+nt*hr)*fi,e[3]=(ie*Ir-$*rn-pe*hr)*fi,e[4]=(k*Sn-x*Ni-j*Yn)*fi,e[5]=(r*Ni-v*Sn+m*Yn)*fi,e[6]=(vt*sr-Ge*rn-nt*Kt)*fi,e[7]=(W*rn-ie*sr+pe*Kt)*fi,e[8]=(x*Tn-P*Sn+j*pn)*fi,e[9]=(f*Sn-r*Tn-m*pn)*fi,e[10]=(Ge*Ir-Xe*sr+nt*Rt)*fi,e[11]=($*sr-W*Ir-pe*Rt)*fi,e[12]=(P*Yn-x*$n-k*pn)*fi,e[13]=(r*$n-f*Yn+v*pn)*fi,e[14]=(Xe*Kt-Ge*hr-vt*Rt)*fi,e[15]=(W*hr-$*Kt+ie*Rt)*fi,e):null},p.isChar=Jr,p.isMapboxURL=w,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Bi,p.mapObject=Ne,p.mercatorXfromLng=Gh,p.mercatorYfromLat=xp,p.mercatorZfromAltitude=Xp,p.mul=iu,p.multiply=xo,p.mvt=Lo,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],m=r*r+f*f+v*v;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e},p.number=Nn,p.offscreenCanvasSupported=ar,p.ortho=function(e,t,r,f,v,m,x){var P=1/(t-r),k=1/(f-v),j=1/(m-x);return e[0]=-2*P,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*k,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*j,e[11]=0,e[12]=(t+r)*P,e[13]=(v+f)*k,e[14]=(x+m)*j,e[15]=1,e},p.parseGlyphPBF=function(e){return new Te(e).readFields(Dr,[])},p.pbf=Te,p.performSymbolLayout=function(e,t,r,f,v,m,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var P=e.layers[0].layout,k=e.layers[0]._unevaluatedLayout._values,j={};if(e.textSizeData.kind==="composite"){var W=e.textSizeData,$=W.maxZoom;j.compositeTextSizes=[k["text-size"].possiblyEvaluate(new ki(W.minZoom),x),k["text-size"].possiblyEvaluate(new ki($),x)]}if(e.iconSizeData.kind==="composite"){var ie=e.iconSizeData,pe=ie.maxZoom;j.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new ki(ie.minZoom),x),k["icon-size"].possiblyEvaluate(new ki(pe),x)]}j.layoutTextSize=k["text-size"].possiblyEvaluate(new ki(e.zoom+1),x),j.layoutIconSize=k["icon-size"].possiblyEvaluate(new ki(e.zoom+1),x),j.textMaxSize=k["text-size"].possiblyEvaluate(new ki(18));for(var Ge=24*P.get("text-line-height"),Xe=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",vt=P.get("text-keep-upright"),nt=P.get("text-size"),Rt=function(){var hr=sr[Kt],Ir=P.get("text-font").evaluate(hr,{},x).join(","),rn=nt.evaluate(hr,{},x),pn=j.layoutTextSize.evaluate(hr,{},x),Yn=j.layoutIconSize.evaluate(hr,{},x),Sn={horizontal:{},vertical:void 0},$n=hr.text,Tn=[0,0];if($n){var Ni=$n.toString(),fi=24*P.get("text-letter-spacing").evaluate(hr,{},x),Zn=function(ta){for(var Ba=0,Ia=ta;Ba<Ia.length;Ba+=1)if(Qi=Ia[Ba].charCodeAt(0),Jr.Arabic(Qi)||Jr["Arabic Supplement"](Qi)||Jr["Arabic Extended-A"](Qi)||Jr["Arabic Presentation Forms-A"](Qi)||Jr["Arabic Presentation Forms-B"](Qi))return!1;var Qi;return!0}(Ni)?fi:0,Ji=P.get("text-anchor").evaluate(hr,{},x),Mi=P.get("text-variable-anchor");if(!Mi){var ca=P.get("text-radial-offset").evaluate(hr,{},x);Tn=ca?ut(Ji,[24*ca,ye]):P.get("text-offset").evaluate(hr,{},x).map(function(ta){return 24*ta})}var Jn=Xe?"center":P.get("text-justify").evaluate(hr,{},x),ha=P.get("symbol-placement"),po=ha==="point"?24*P.get("text-max-width").evaluate(hr,{},x):0,Ao=function(){e.allowVerticalPlacement&&jc(Ni)&&(Sn.vertical=Lr($n,t,r,v,Ir,po,Ge,Ji,"left",Zn,Tn,Wn.vertical,!0,ha,pn,rn))};if(!Xe&&Mi){for(var So=Jn==="auto"?Mi.map(function(ta){return Lt(ta)}):[Jn],la=!1,Co=0;Co<So.length;Co++){var Ro=So[Co];if(!Sn.horizontal[Ro])if(la)Sn.horizontal[Ro]=Sn.horizontal[0];else{var Us=Lr($n,t,r,v,Ir,po,Ge,"center",Ro,Zn,Tn,Wn.horizontal,!1,ha,pn,rn);Us&&(Sn.horizontal[Ro]=Us,la=Us.positionedLines.length===1)}}Ao()}else{Jn==="auto"&&(Jn=Lt(Ji));var uu=Lr($n,t,r,v,Ir,po,Ge,Ji,Jn,Zn,Tn,Wn.horizontal,!1,ha,pn,rn);uu&&(Sn.horizontal[Jn]=uu),Ao(),jc(Ni)&&Xe&&vt&&(Sn.vertical=Lr($n,t,r,v,Ir,po,Ge,Ji,Jn,Zn,Tn,Wn.vertical,!1,ha,pn,rn))}}var js=void 0,Du=!1;if(hr.icon&&hr.icon.name){var Po=f[hr.icon.name];Po&&(js=function(ta,Ba,Ia){var Qi=Go(Ia),lu=Ba[0]-ta.displaySize[0]*Qi.horizontalAlign,Os=Ba[1]-ta.displaySize[1]*Qi.verticalAlign;return{image:ta,top:Os,bottom:Os+ta.displaySize[1],left:lu,right:lu+ta.displaySize[0]}}(v[hr.icon.name],P.get("icon-offset").evaluate(hr,{},x),P.get("icon-anchor").evaluate(hr,{},x)),Du=Po.sdf,e.sdfIcons===void 0?e.sdfIcons=Po.sdf:e.sdfIcons!==Po.sdf&&oe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Po.pixelRatio!==e.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var es=yt(Sn.horizontal)||Sn.vertical;e.iconsInText=!!es&&es.iconsInText,(es||js)&&function(ta,Ba,Ia,Qi,lu,Os,vo,cs,fs,ga,Yc){var Vl=Os.textMaxSize.evaluate(Ba,{});Vl===void 0&&(Vl=vo);var df,hs=ta.layers[0].layout,vf=hs.get("icon-offset").evaluate(Ba,{},Yc),Cc=yt(Ia.horizontal),bh=vo/24,nh=ta.tilePixelRatio*bh,Uf=ta.tilePixelRatio*Vl/24,Pc=ta.tilePixelRatio*cs,Sh=ta.tilePixelRatio*hs.get("symbol-spacing"),Eh=hs.get("text-padding")*ta.tilePixelRatio,ih=hs.get("icon-padding")*ta.tilePixelRatio,Wh=hs.get("text-max-angle")/180*Math.PI,wh=hs.get("text-rotation-alignment")==="map"&&hs.get("symbol-placement")!=="point",Xh=hs.get("icon-rotation-alignment")==="map"&&hs.get("symbol-placement")!=="point",If=hs.get("symbol-placement"),ah=Sh/2,oh=hs.get("icon-text-fit");Qi&&oh!=="none"&&(ta.allowVerticalPlacement&&Ia.vertical&&(df=ea(Qi,Ia.vertical,oh,hs.get("icon-text-fit-padding"),vf,bh)),Cc&&(Qi=ea(Qi,Cc,oh,hs.get("icon-text-fit-padding"),vf,bh)));var jf=function(Ih,qh){qh.x<0||qh.x>=8192||qh.y<0||qh.y>=8192||function(Do,Gl,Oh,Of,ep,cu,tp,$c,ka,Lh,Lf,Rf,Cp,Qp,Rh,qp,ed,Pp,Mp,td,Al,rp,Ip,Jc,rd){var nd,Vf,ch,fh,hh,ph=Do.addToLineVertexArray(Gl,Oh),id=0,Op=0,ad=0,od=0,Lp=-1,np=-1,gf={},sd=Fe(""),Rp=0,Dp=0;if($c._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Rp=(nd=$c.layout.get("text-offset").evaluate(Al,{},Jc).map(function(dh){return 24*dh}))[0],Dp=nd[1]):(Rp=24*$c.layout.get("text-radial-offset").evaluate(Al,{},Jc),Dp=ye),Do.allowVerticalPlacement&&Of.vertical){var ud=$c.layout.get("text-rotate").evaluate(Al,{},Jc)+90;fh=new Ve(ka,Gl,Lh,Lf,Rf,Of.vertical,Cp,Qp,Rh,ud),tp&&(hh=new Ve(ka,Gl,Lh,Lf,Rf,tp,ed,Pp,Rh,ud))}if(ep){var kp=$c.layout.get("icon-rotate").evaluate(Al,{}),Fp=$c.layout.get("icon-text-fit")!=="none",ld=Gi(ep,kp,Ip,Fp),zp=tp?Gi(tp,kp,Ip,Fp):void 0;ch=new Ve(ka,Gl,Lh,Lf,Rf,ep,ed,Pp,!1,kp),id=4*ld.length;var cd=Do.iconSizeData,Dh=null;cd.kind==="source"?(Dh=[128*$c.layout.get("icon-size").evaluate(Al,{})])[0]>32640&&oe(Do.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):cd.kind==="composite"&&((Dh=[128*rp.compositeIconSizes[0].evaluate(Al,{},Jc),128*rp.compositeIconSizes[1].evaluate(Al,{},Jc)])[0]>32640||Dh[1]>32640)&&oe(Do.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Do.addSymbols(Do.icon,ld,Dh,td,Mp,Al,!1,Gl,ph.lineStartIndex,ph.lineLength,-1,Jc),Lp=Do.icon.placedSymbolArray.length-1,zp&&(Op=4*zp.length,Do.addSymbols(Do.icon,zp,Dh,td,Mp,Al,Wn.vertical,Gl,ph.lineStartIndex,ph.lineLength,-1,Jc),np=Do.icon.placedSymbolArray.length-1)}for(var fd in Of.horizontal){var ip=Of.horizontal[fd];if(!Vf){sd=Fe(ip.text);var Ld=$c.layout.get("text-rotate").evaluate(Al,{},Jc);Vf=new Ve(ka,Gl,Lh,Lf,Rf,ip,Cp,Qp,Rh,Ld)}var hd=ip.positionedLines.length===1;if(ad+=Vt(Do,Gl,ip,cu,$c,Rh,Al,qp,ph,Of.vertical?Wn.horizontal:Wn.horizontalOnly,hd?Object.keys(Of.horizontal):[fd],gf,Lp,rp,Jc),hd)break}Of.vertical&&(od+=Vt(Do,Gl,Of.vertical,cu,$c,Rh,Al,qp,ph,Wn.vertical,["vertical"],gf,np,rp,Jc));var pd=Vf?Vf.boxStartIndex:Do.collisionBoxArray.length,Rd=Vf?Vf.boxEndIndex:Do.collisionBoxArray.length,Dd=fh?fh.boxStartIndex:Do.collisionBoxArray.length,kd=fh?fh.boxEndIndex:Do.collisionBoxArray.length,dd=ch?ch.boxStartIndex:Do.collisionBoxArray.length,Fd=ch?ch.boxEndIndex:Do.collisionBoxArray.length,zd=hh?hh.boxStartIndex:Do.collisionBoxArray.length,Nd=hh?hh.boxEndIndex:Do.collisionBoxArray.length,Qc=-1,ap=function(dh,md){return dh&&dh.circleDiameter?Math.max(dh.circleDiameter,md):md};Qc=ap(Vf,Qc),Qc=ap(fh,Qc),Qc=ap(ch,Qc);var vd=(Qc=ap(hh,Qc))>-1?1:0;vd&&(Qc*=rd/24),Do.glyphOffsetArray.length>=rr.MAX_GLYPHS&&oe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Al.sortKey!==void 0&&Do.addToSortKeyRanges(Do.symbolInstances.length,Al.sortKey),Do.symbolInstances.emplaceBack(Gl.x,Gl.y,gf.right>=0?gf.right:-1,gf.center>=0?gf.center:-1,gf.left>=0?gf.left:-1,gf.vertical||-1,Lp,np,sd,pd,Rd,Dd,kd,dd,Fd,zd,Nd,Lh,ad,od,id,Op,vd,0,Cp,Rp,Dp,Qc)}(ta,qh,Ih,Ia,Qi,lu,df,ta.layers[0],ta.collisionBoxArray,Ba.index,Ba.sourceLayerIndex,ta.index,nh,Eh,wh,fs,Pc,ih,Xh,vf,Ba,Os,ga,Yc,vo)};if(If==="line")for(var mf=0,Yh=ni(Ba.geometry,0,0,8192,8192);mf<Yh.length;mf+=1)for(var wp=Yh[mf],Mc=0,sh=ma(wp,Sh,Wh,Ia.vertical||Cc,Qi,24,Uf,ta.overscaling,8192);Mc<sh.length;Mc+=1){var Zf=sh[Mc];Cc&&dt(ta,Cc.text,ah,Zf)||jf(wp,Zf)}else if(If==="line-center")for(var Th=0,Ah=Ba.geometry;Th<Ah.length;Th+=1){var Kc=Ah[Th];if(Kc.length>1){var Kh=Is(Kc,Wh,Ia.vertical||Cc,Qi,24,Uf);Kh&&jf(Kc,Kh)}}else if(Ba.type==="Polygon")for(var uh=0,Tp=St(Ba.geometry,0);uh<Tp.length;uh+=1){var Ch=Tp[uh],$h=An(Ch,16);jf(Ch[0],new To($h.x,$h.y,0))}else if(Ba.type==="LineString")for(var lh=0,Jh=Ba.geometry;lh<Jh.length;lh+=1){var Ph=Jh[lh];jf(Ph,new To(Ph[0].x,Ph[0].y,0))}else if(Ba.type==="Point")for(var Jp=0,Ap=Ba.geometry;Jp<Ap.length;Jp+=1)for(var Qh=0,Od=Ap[Jp];Qh<Od.length;Qh+=1){var Mh=Od[Qh];jf([Mh],new To(Mh.x,Mh.y,0))}}(e,hr,Sn,js,f,j,pn,Yn,Tn,Du,x)},Kt=0,sr=e.features;Kt<sr.length;Kt+=1)Rt();m&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var m,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(m=1/(f-v)),e[14]=2*v*f*m):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=eu,p.polygonIntersectsPolygon=Iu,p.postMapLoadEvent=Je,p.postTurnstileEvent=Mr,p.potpack=un,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=En,p.registerForPluginStateChange=function(e){return e({pluginStatus:Fs,pluginURL:ju}),af.on("pluginStateChange",e),e},p.renderColorRamp=Hf,p.rotate=function(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3],P=Math.sin(r),k=Math.cos(r);return e[0]=f*k+m*P,e[1]=v*k+x*P,e[2]=f*-P+m*k,e[3]=v*-P+x*k,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[4],x=t[5],P=t[6],k=t[7],j=t[8],W=t[9],$=t[10],ie=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*v+j*f,e[5]=x*v+W*f,e[6]=P*v+$*f,e[7]=k*v+ie*f,e[8]=j*v-m*f,e[9]=W*v-x*f,e[10]=$*v-P*f,e[11]=ie*v-k*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[0],x=t[1],P=t[2],k=t[3],j=t[4],W=t[5],$=t[6],ie=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*v+j*f,e[1]=x*v+W*f,e[2]=P*v+$*f,e[3]=k*v+ie*f,e[4]=j*v-m*f,e[5]=W*v-x*f,e[6]=$*v-P*f,e[7]=ie*v-k*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],m=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){At=e,_t=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Fs==="deferred"||Fs==="loading"||Fs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ju=Yr.resolveURL(e),Fs="deferred",mc=t,kl(),r||Au()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=ge,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=_s,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],m=t[2];return e[0]=f*r[0]+v*r[3]+m*r[6],e[1]=f*r[1]+v*r[4]+m*r[7],e[2]=f*r[2]+v*r[5]+m*r[8],e},p.transformMat4=_u,p.translate=function(e,t,r){var f,v,m,x,P,k,j,W,$,ie,pe,Ge,Xe=r[0],vt=r[1],nt=r[2];return t===e?(e[12]=t[0]*Xe+t[4]*vt+t[8]*nt+t[12],e[13]=t[1]*Xe+t[5]*vt+t[9]*nt+t[13],e[14]=t[2]*Xe+t[6]*vt+t[10]*nt+t[14],e[15]=t[3]*Xe+t[7]*vt+t[11]*nt+t[15]):(v=t[1],m=t[2],x=t[3],P=t[4],k=t[5],j=t[6],W=t[7],$=t[8],ie=t[9],pe=t[10],Ge=t[11],e[0]=f=t[0],e[1]=v,e[2]=m,e[3]=x,e[4]=P,e[5]=k,e[6]=j,e[7]=W,e[8]=$,e[9]=ie,e[10]=pe,e[11]=Ge,e[12]=f*Xe+P*vt+$*nt+t[12],e[13]=v*Xe+k*vt+ie*nt+t[13],e[14]=m*Xe+j*vt+pe*nt+t[14],e[15]=x*Xe+W*vt+Ge*nt+t[15]),e},p.triggerPluginCompletionEvent=_l,p.uniqueId=wt,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=Sf,p.validateStyle=ec,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Lo,p.version="1.13.1",p.warnOnce=oe,p.webpSupported=ne,p.window=K,p.wrap=zt}),b(["./shared"],function(p){"use strict";function S(V){var te=typeof V;if(te==="number"||te==="boolean"||te==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var le="[",we=0,je=V;we<je.length;we+=1)le+=S(je[we])+",";return le+"]"}for(var ht=Object.keys(V).sort(),xt="{",ge=0;ge<ht.length;ge++)xt+=JSON.stringify(ht[ge])+":"+S(V[ht[ge]])+",";return xt+"}"}function L(V){for(var te="",le=0,we=p.refProperties;le<we.length;le+=1)te+="/"+S(V[we[le]]);return te}var X=function(V){this.keyCache={},V&&this.replace(V)};X.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},X.prototype.update=function(V,te){for(var le=this,we=0,je=V;we<je.length;we+=1){var ht=je[we];this._layerConfigs[ht.id]=ht;var xt=this._layers[ht.id]=p.createStyleLayer(ht);xt._featureFilter=p.featureFilter(xt.filter),this.keyCache[ht.id]&&delete this.keyCache[ht.id]}for(var ge=0,Ke=te;ge<Ke.length;ge+=1){var Ut=Ke[ge];delete this.keyCache[Ut],delete this._layerConfigs[Ut],delete this._layers[Ut]}this.familiesBySource={};for(var Fr=0,jr=function($r,cn){for(var pi={},fn=0;fn<$r.length;fn++){var gi=cn&&cn[$r[fn].id]||L($r[fn]);cn&&(cn[$r[fn].id]=gi);var Wi=pi[gi];Wi||(Wi=pi[gi]=[]),Wi.push($r[fn])}var vi=[];for(var Ri in pi)vi.push(pi[Ri]);return vi}(p.values(this._layerConfigs),this.keyCache);Fr<jr.length;Fr+=1){var Xt=jr[Fr].map(function($r){return le._layers[$r.id]}),mr=Xt[0];if(mr.visibility!=="none"){var Hr=mr.source||"",gn=this.familiesBySource[Hr];gn||(gn=this.familiesBySource[Hr]={});var gr=mr.sourceLayer||"_geojsonTileLayer",vn=gn[gr];vn||(vn=gn[gr]=[]),vn.push(Xt)}}};var N=function(V){var te={},le=[];for(var we in V){var je=V[we],ht=te[we]={};for(var xt in je){var ge=je[+xt];if(ge&&ge.bitmap.width!==0&&ge.bitmap.height!==0){var Ke={x:0,y:0,w:ge.bitmap.width+2,h:ge.bitmap.height+2};le.push(Ke),ht[xt]={rect:Ke,metrics:ge.metrics}}}}var Ut=p.potpack(le),Fr=new p.AlphaImage({width:Ut.w||1,height:Ut.h||1});for(var jr in V){var Xt=V[jr];for(var mr in Xt){var Hr=Xt[+mr];if(Hr&&Hr.bitmap.width!==0&&Hr.bitmap.height!==0){var gn=te[jr][mr].rect;p.AlphaImage.copy(Hr.bitmap,Fr,{x:0,y:0},{x:gn.x+1,y:gn.y+1},Hr.bitmap)}}}this.image=Fr,this.positions=te};p.register("GlyphAtlas",N);var q=function(V){this.tileID=new p.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function K(V,te,le){for(var we=new p.EvaluationParameters(te),je=0,ht=V;je<ht.length;je+=1)ht[je].recalculate(we,le)}function ae(V,te){var le=p.getArrayBuffer(V.request,function(we,je,ht,xt){we?te(we):je&&te(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(je)),rawData:je,cacheControl:ht,expires:xt})});return function(){le.cancel(),te()}}q.prototype.parse=function(V,te,le,we,je){var ht=this;this.status="parsing",this.data=V,this.collisionBoxArray=new p.CollisionBoxArray;var xt=new p.DictionaryCoder(Object.keys(V.layers).sort()),ge=new p.FeatureIndex(this.tileID,this.promoteId);ge.bucketLayerIDs=[];var Ke,Ut,Fr,jr,Xt={},mr={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:le},Hr=te.familiesBySource[this.source];for(var gn in Hr){var gr=V.layers[gn];if(gr){gr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+gn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var vn=xt.encode(gn),$r=[],cn=0;cn<gr.length;cn++){var pi=gr.feature(cn),fn=ge.getId(pi,gn);$r.push({feature:pi,id:fn,index:cn,sourceLayerIndex:vn})}for(var gi=0,Wi=Hr[gn];gi<Wi.length;gi+=1){var vi=Wi[gi],Ri=vi[0];Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(K(vi,this.zoom,le),(Xt[Ri.id]=Ri.createBucket({index:ge.bucketLayerIDs.length,layers:vi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vn,sourceID:this.source})).populate($r,mr,this.tileID.canonical),ge.bucketLayerIDs.push(vi.map(function(Dn){return Dn.id})))}}}var Ii=p.mapObject(mr.glyphDependencies,function(Dn){return Object.keys(Dn).map(Number)});Object.keys(Ii).length?we.send("getGlyphs",{uid:this.uid,stacks:Ii},function(Dn,ui){Ke||(Ke=Dn,Ut=ui,Rn.call(ht))}):Ut={};var go=Object.keys(mr.iconDependencies);go.length?we.send("getImages",{icons:go,source:this.source,tileID:this.tileID,type:"icons"},function(Dn,ui){Ke||(Ke=Dn,Fr=ui,Rn.call(ht))}):Fr={};var ji=Object.keys(mr.patternDependencies);function Rn(){if(Ke)return je(Ke);if(Ut&&Fr&&jr){var Dn=new N(Ut),ui=new p.ImageAtlas(Fr,jr);for(var Vn in Xt){var za=Xt[Vn];za instanceof p.SymbolBucket?(K(za.layers,this.zoom,le),p.performSymbolLayout(za,Ut,Dn.positions,Fr,ui.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):za.hasPattern&&(za instanceof p.LineBucket||za instanceof p.FillBucket||za instanceof p.FillExtrusionBucket)&&(K(za.layers,this.zoom,le),za.addFeatures(mr,this.tileID.canonical,ui.patternPositions))}this.status="done",je(null,{buckets:p.values(Xt).filter(function(ds){return!ds.isEmpty()}),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dn.image,imageAtlas:ui,glyphMap:this.returnDependencies?Ut:null,iconMap:this.returnDependencies?Fr:null,glyphPositions:this.returnDependencies?Dn.positions:null})}}ji.length?we.send("getImages",{icons:ji,source:this.source,tileID:this.tileID,type:"patterns"},function(Dn,ui){Ke||(Ke=Dn,jr=ui,Rn.call(ht))}):jr={},Rn.call(this)};var xe=function(V,te,le,we){this.actor=V,this.layerIndex=te,this.availableImages=le,this.loadVectorData=we||ae,this.loading={},this.loaded={}};xe.prototype.loadTile=function(V,te){var le=this,we=V.uid;this.loading||(this.loading={});var je=!!(V&&V.request&&V.request.collectResourceTiming)&&new p.RequestPerformance(V.request),ht=this.loading[we]=new q(V);ht.abort=this.loadVectorData(V,function(xt,ge){if(delete le.loading[we],xt||!ge)return ht.status="done",le.loaded[we]=ht,te(xt);var Ke=ge.rawData,Ut={};ge.expires&&(Ut.expires=ge.expires),ge.cacheControl&&(Ut.cacheControl=ge.cacheControl);var Fr={};if(je){var jr=je.finish();jr&&(Fr.resourceTiming=JSON.parse(JSON.stringify(jr)))}ht.vectorTile=ge.vectorTile,ht.parse(ge.vectorTile,le.layerIndex,le.availableImages,le.actor,function(Xt,mr){if(Xt||!mr)return te(Xt);te(null,p.extend({rawTileData:Ke.slice(0)},mr,Ut,Fr))}),le.loaded=le.loaded||{},le.loaded[we]=ht})},xe.prototype.reloadTile=function(V,te){var le=this,we=this.loaded,je=V.uid,ht=this;if(we&&we[je]){var xt=we[je];xt.showCollisionBoxes=V.showCollisionBoxes;var ge=function(Ke,Ut){var Fr=xt.reloadCallback;Fr&&(delete xt.reloadCallback,xt.parse(xt.vectorTile,ht.layerIndex,le.availableImages,ht.actor,Fr)),te(Ke,Ut)};xt.status==="parsing"?xt.reloadCallback=ge:xt.status==="done"&&(xt.vectorTile?xt.parse(xt.vectorTile,this.layerIndex,this.availableImages,this.actor,ge):ge())}},xe.prototype.abortTile=function(V,te){var le=this.loading,we=V.uid;le&&le[we]&&le[we].abort&&(le[we].abort(),delete le[we]),te()},xe.prototype.removeTile=function(V,te){var le=this.loaded,we=V.uid;le&&le[we]&&delete le[we],te()};var se=p.window.ImageBitmap,Ft=function(){this.loaded={}};function zt(V,te){if(V.length!==0){Wt(V[0],te);for(var le=1;le<V.length;le++)Wt(V[le],!te)}}function Wt(V,te){for(var le=0,we=0,je=V.length,ht=je-1;we<je;ht=we++)le+=(V[we][0]-V[ht][0])*(V[ht][1]+V[we][1]);le>=0!=!!te&&V.reverse()}Ft.prototype.loadTile=function(V,te){var le=V.uid,we=V.encoding,je=V.rawImageData,ht=se&&je instanceof se?this.getImageData(je):je,xt=new p.DEMData(le,ht,we);this.loaded=this.loaded||{},this.loaded[le]=xt,te(null,xt)},Ft.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var te=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:te.width,height:te.height},te.data)},Ft.prototype.removeTile=function(V){var te=this.loaded,le=V.uid;te&&te[le]&&delete te[le]};var Mt=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,wt=function(V){this._feature=V,this.extent=p.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};wt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],te=0,le=this._feature.geometry;te<le.length;te+=1){var we=le[te];V.push([new p.Point$1(we[0],we[1])])}return V}for(var je=[],ht=0,xt=this._feature.geometry;ht<xt.length;ht+=1){for(var ge=[],Ke=0,Ut=xt[ht];Ke<Ut.length;Ke+=1){var Fr=Ut[Ke];ge.push(new p.Point$1(Fr[0],Fr[1]))}je.push(ge)}return je},wt.prototype.toGeoJSON=function(V,te,le){return Mt.call(this,V,te,le)};var ot=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=V.length,this._features=V};ot.prototype.feature=function(V){return new wt(this._features[V])};var tt=p.vectorTile.VectorTileFeature,Yt=ke;function ke(V,te){this.options=te||{},this.features=V,this.length=V.length}function Ne(V,te){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=te||4096}ke.prototype.feature=function(V){return new Ne(this.features[V],this.options.extent)},Ne.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var te=0;te<V.length;te++){for(var le=V[te],we=[],je=0;je<le.length;je++)we.push(new p.Point$1(le[je][0],le[je][1]));this.geometry.push(we)}return this.geometry},Ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,te=1/0,le=-1/0,we=1/0,je=-1/0,ht=0;ht<V.length;ht++)for(var xt=V[ht],ge=0;ge<xt.length;ge++){var Ke=xt[ge];te=Math.min(te,Ke.x),le=Math.max(le,Ke.x),we=Math.min(we,Ke.y),je=Math.max(je,Ke.y)}return[te,we,le,je]},Ne.prototype.toGeoJSON=tt.prototype.toGeoJSON;var Be=pt,Ie=Yt;function pt(V){var te=new p.pbf;return function(le,we){for(var je in le.layers)we.writeMessage(3,oe,le.layers[je])}(V,te),te.finish()}function oe(V,te){var le;te.writeVarintField(15,V.version||1),te.writeStringField(1,V.name||""),te.writeVarintField(5,V.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<V.length;le++)we.feature=V.feature(le),te.writeMessage(2,re,we);var je=we.keys;for(le=0;le<je.length;le++)te.writeStringField(3,je[le]);var ht=we.values;for(le=0;le<ht.length;le++)te.writeMessage(4,$e,ht[le])}function re(V,te){var le=V.feature;le.id!==void 0&&te.writeVarintField(1,le.id),te.writeMessage(2,ue,V),te.writeVarintField(3,le.type),te.writeMessage(4,ce,le)}function ue(V,te){var le=V.feature,we=V.keys,je=V.values,ht=V.keycache,xt=V.valuecache;for(var ge in le.properties){var Ke=ht[ge];Ke===void 0&&(we.push(ge),ht[ge]=Ke=we.length-1),te.writeVarint(Ke);var Ut=le.properties[ge],Fr=typeof Ut;Fr!=="string"&&Fr!=="boolean"&&Fr!=="number"&&(Ut=JSON.stringify(Ut));var jr=Fr+":"+Ut,Xt=xt[jr];Xt===void 0&&(je.push(Ut),xt[jr]=Xt=je.length-1),te.writeVarint(Xt)}}function it(V,te){return(te<<3)+(7&V)}function Jt(V){return V<<1^V>>31}function ce(V,te){for(var le=V.loadGeometry(),we=V.type,je=0,ht=0,xt=le.length,ge=0;ge<xt;ge++){var Ke=le[ge],Ut=1;we===1&&(Ut=Ke.length),te.writeVarint(it(1,Ut));for(var Fr=we===3?Ke.length-1:Ke.length,jr=0;jr<Fr;jr++){jr===1&&we!==1&&te.writeVarint(it(2,Fr-1));var Xt=Ke[jr].x-je,mr=Ke[jr].y-ht;te.writeVarint(Jt(Xt)),te.writeVarint(Jt(mr)),je+=Xt,ht+=mr}we===3&&te.writeVarint(it(7,1))}}function $e(V,te){var le=typeof V;le==="string"?te.writeStringField(1,V):le==="boolean"?te.writeBooleanField(7,V):le==="number"&&(V%1!=0?te.writeDoubleField(3,V):V<0?te.writeSVarintField(6,V):te.writeVarintField(5,V))}function Ae(V,te,le,we){Ce(V,le,we),Ce(te,2*le,2*we),Ce(te,2*le+1,2*we+1)}function Ce(V,te,le){var we=V[te];V[te]=V[le],V[le]=we}function Pe(V,te,le,we){var je=V-le,ht=te-we;return je*je+ht*ht}Be.fromVectorTileJs=pt,Be.fromGeojsonVt=function(V,te){te=te||{};var le={};for(var we in V)le[we]=new Yt(V[we].features,te),le[we].name=we,le[we].version=te.version,le[we].extent=te.extent;return pt({layers:le})},Be.GeoJSONWrapper=Ie;var et=function(V){return V[0]},Se=function(V){return V[1]},Pt=function(V,te,le,we,je){te===void 0&&(te=et),le===void 0&&(le=Se),we===void 0&&(we=64),je===void 0&&(je=Float64Array),this.nodeSize=we,this.points=V;for(var ht=V.length<65536?Uint16Array:Uint32Array,xt=this.ids=new ht(V.length),ge=this.coords=new je(2*V.length),Ke=0;Ke<V.length;Ke++)xt[Ke]=Ke,ge[2*Ke]=te(V[Ke]),ge[2*Ke+1]=le(V[Ke]);(function Ut(Fr,jr,Xt,mr,Hr,gn){if(!(Hr-mr<=Xt)){var gr=mr+Hr>>1;(function vn($r,cn,pi,fn,gi,Wi){for(;gi>fn;){if(gi-fn>600){var vi=gi-fn+1,Ri=pi-fn+1,Ii=Math.log(vi),go=.5*Math.exp(2*Ii/3),ji=.5*Math.sqrt(Ii*go*(vi-go)/vi)*(Ri-vi/2<0?-1:1);vn($r,cn,pi,Math.max(fn,Math.floor(pi-Ri*go/vi+ji)),Math.min(gi,Math.floor(pi+(vi-Ri)*go/vi+ji)),Wi)}var Rn=cn[2*pi+Wi],Dn=fn,ui=gi;for(Ae($r,cn,fn,pi),cn[2*gi+Wi]>Rn&&Ae($r,cn,fn,gi);Dn<ui;){for(Ae($r,cn,Dn,ui),Dn++,ui--;cn[2*Dn+Wi]<Rn;)Dn++;for(;cn[2*ui+Wi]>Rn;)ui--}cn[2*fn+Wi]===Rn?Ae($r,cn,fn,ui):Ae($r,cn,++ui,gi),ui<=pi&&(fn=ui+1),pi<=ui&&(gi=ui-1)}})(Fr,jr,gr,mr,Hr,gn%2),Ut(Fr,jr,Xt,mr,gr-1,gn+1),Ut(Fr,jr,Xt,gr+1,Hr,gn+1)}})(xt,ge,we,0,xt.length-1,0)};Pt.prototype.range=function(V,te,le,we){return function(je,ht,xt,ge,Ke,Ut,Fr){for(var jr,Xt,mr=[0,je.length-1,0],Hr=[];mr.length;){var gn=mr.pop(),gr=mr.pop(),vn=mr.pop();if(gr-vn<=Fr)for(var $r=vn;$r<=gr;$r++)Xt=ht[2*$r+1],(jr=ht[2*$r])>=xt&&jr<=Ke&&Xt>=ge&&Xt<=Ut&&Hr.push(je[$r]);else{var cn=Math.floor((vn+gr)/2);Xt=ht[2*cn+1],(jr=ht[2*cn])>=xt&&jr<=Ke&&Xt>=ge&&Xt<=Ut&&Hr.push(je[cn]);var pi=(gn+1)%2;(gn===0?xt<=jr:ge<=Xt)&&(mr.push(vn),mr.push(cn-1),mr.push(pi)),(gn===0?Ke>=jr:Ut>=Xt)&&(mr.push(cn+1),mr.push(gr),mr.push(pi))}}return Hr}(this.ids,this.coords,V,te,le,we,this.nodeSize)},Pt.prototype.within=function(V,te,le){return function(we,je,ht,xt,ge,Ke){for(var Ut=[0,we.length-1,0],Fr=[],jr=ge*ge;Ut.length;){var Xt=Ut.pop(),mr=Ut.pop(),Hr=Ut.pop();if(mr-Hr<=Ke)for(var gn=Hr;gn<=mr;gn++)Pe(je[2*gn],je[2*gn+1],ht,xt)<=jr&&Fr.push(we[gn]);else{var gr=Math.floor((Hr+mr)/2),vn=je[2*gr],$r=je[2*gr+1];Pe(vn,$r,ht,xt)<=jr&&Fr.push(we[gr]);var cn=(Xt+1)%2;(Xt===0?ht-ge<=vn:xt-ge<=$r)&&(Ut.push(Hr),Ut.push(gr-1),Ut.push(cn)),(Xt===0?ht+ge>=vn:xt+ge>=$r)&&(Ut.push(gr+1),Ut.push(mr),Ut.push(cn))}}return Fr}(this.ids,this.coords,V,te,le,this.nodeSize)};var vr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},_r=function(V){this.options=kt(Object.create(vr),V),this.trees=new Array(this.options.maxZoom+1)};function Yr(V,te,le,we,je){return{x:V,y:te,zoom:1/0,id:le,parentId:-1,numPoints:we,properties:je}}function tr(V,te){var le=V.geometry.coordinates,we=le[1];return{x:De(le[0]),y:at(we),zoom:1/0,index:te,parentId:-1}}function ne(V){return{type:"Feature",id:V.id,properties:be(V),geometry:{type:"Point",coordinates:[(we=V.x,360*(we-.5)),(te=V.y,le=(180-360*te)*Math.PI/180,360*Math.atan(Math.exp(le))/Math.PI-90)]}};var te,le,we}function be(V){var te=V.numPoints,le=te>=1e4?Math.round(te/1e3)+"k":te>=1e3?Math.round(te/100)/10+"k":te;return kt(kt({},V.properties),{cluster:!0,cluster_id:V.id,point_count:te,point_count_abbreviated:le})}function De(V){return V/360+.5}function at(V){var te=Math.sin(V*Math.PI/180),le=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return le<0?0:le>1?1:le}function kt(V,te){for(var le in te)V[le]=te[le];return V}function jt(V){return V.x}function w(V){return V.y}function F(V,te,le,we,je,ht){var xt=je-le,ge=ht-we;if(xt!==0||ge!==0){var Ke=((V-le)*xt+(te-we)*ge)/(xt*xt+ge*ge);Ke>1?(le=je,we=ht):Ke>0&&(le+=xt*Ke,we+=ge*Ke)}return(xt=V-le)*xt+(ge=te-we)*ge}function de(V,te,le,we){var je={id:V===void 0?null:V,type:te,geometry:le,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ht){var xt=ht.geometry,ge=ht.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")Ue(ht,xt);else if(ge==="Polygon"||ge==="MultiLineString")for(var Ke=0;Ke<xt.length;Ke++)Ue(ht,xt[Ke]);else if(ge==="MultiPolygon")for(Ke=0;Ke<xt.length;Ke++)for(var Ut=0;Ut<xt[Ke].length;Ut++)Ue(ht,xt[Ke][Ut])}(je),je}function Ue(V,te){for(var le=0;le<te.length;le+=3)V.minX=Math.min(V.minX,te[le]),V.minY=Math.min(V.minY,te[le+1]),V.maxX=Math.max(V.maxX,te[le]),V.maxY=Math.max(V.maxY,te[le+1])}function Qe(V,te,le,we){if(te.geometry){var je=te.geometry.coordinates,ht=te.geometry.type,xt=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),ge=[],Ke=te.id;if(le.promoteId?Ke=te.properties[le.promoteId]:le.generateId&&(Ke=we||0),ht==="Point")Tt(je,ge);else if(ht==="MultiPoint")for(var Ut=0;Ut<je.length;Ut++)Tt(je[Ut],ge);else if(ht==="LineString")Dt(je,ge,xt,!1);else if(ht==="MultiLineString"){if(le.lineMetrics){for(Ut=0;Ut<je.length;Ut++)Dt(je[Ut],ge=[],xt,!1),V.push(de(Ke,"LineString",ge,te.properties));return}H(je,ge,xt,!1)}else if(ht==="Polygon")H(je,ge,xt,!0);else{if(ht!=="MultiPolygon"){if(ht==="GeometryCollection"){for(Ut=0;Ut<te.geometry.geometries.length;Ut++)Qe(V,{id:Ke,geometry:te.geometry.geometries[Ut],properties:te.properties},le,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ut=0;Ut<je.length;Ut++){var Fr=[];H(je[Ut],Fr,xt,!0),ge.push(Fr)}}V.push(de(Ke,ht,ge,te.properties))}}function Tt(V,te){te.push(Qt(V[0])),te.push($t(V[1])),te.push(0)}function Dt(V,te,le,we){for(var je,ht,xt=0,ge=0;ge<V.length;ge++){var Ke=Qt(V[ge][0]),Ut=$t(V[ge][1]);te.push(Ke),te.push(Ut),te.push(0),ge>0&&(xt+=we?(je*Ut-Ke*ht)/2:Math.sqrt(Math.pow(Ke-je,2)+Math.pow(Ut-ht,2))),je=Ke,ht=Ut}var Fr=te.length-3;te[2]=1,function jr(Xt,mr,Hr,gn){for(var gr,vn=gn,$r=Hr-mr>>1,cn=Hr-mr,pi=Xt[mr],fn=Xt[mr+1],gi=Xt[Hr],Wi=Xt[Hr+1],vi=mr+3;vi<Hr;vi+=3){var Ri=F(Xt[vi],Xt[vi+1],pi,fn,gi,Wi);if(Ri>vn)gr=vi,vn=Ri;else if(Ri===vn){var Ii=Math.abs(vi-$r);Ii<cn&&(gr=vi,cn=Ii)}}vn>gn&&(gr-mr>3&&jr(Xt,mr,gr,gn),Xt[gr+2]=vn,Hr-gr>3&&jr(Xt,gr,Hr,gn))}(te,0,Fr,le),te[Fr+2]=1,te.size=Math.abs(xt),te.start=0,te.end=te.size}function H(V,te,le,we){for(var je=0;je<V.length;je++){var ht=[];Dt(V[je],ht,le,we),te.push(ht)}}function Qt(V){return V/360+.5}function $t(V){var te=Math.sin(V*Math.PI/180),le=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return le<0?0:le>1?1:le}function wr(V,te,le,we,je,ht,xt,ge){if(we/=te,ht>=(le/=te)&&xt<we)return V;if(xt<le||ht>=we)return null;for(var Ke=[],Ut=0;Ut<V.length;Ut++){var Fr=V[Ut],jr=Fr.geometry,Xt=Fr.type,mr=je===0?Fr.minX:Fr.minY,Hr=je===0?Fr.maxX:Fr.maxY;if(mr>=le&&Hr<we)Ke.push(Fr);else if(!(Hr<le||mr>=we)){var gn=[];if(Xt==="Point"||Xt==="MultiPoint")Tr(jr,gn,le,we,je);else if(Xt==="LineString")Mr(jr,gn,le,we,je,!1,ge.lineMetrics);else if(Xt==="MultiLineString")Je(jr,gn,le,we,je,!1);else if(Xt==="Polygon")Je(jr,gn,le,we,je,!0);else if(Xt==="MultiPolygon")for(var gr=0;gr<jr.length;gr++){var vn=[];Je(jr[gr],vn,le,we,je,!0),vn.length&&gn.push(vn)}if(gn.length){if(ge.lineMetrics&&Xt==="LineString"){for(gr=0;gr<gn.length;gr++)Ke.push(de(Fr.id,Xt,gn[gr],Fr.tags));continue}Xt!=="LineString"&&Xt!=="MultiLineString"||(gn.length===1?(Xt="LineString",gn=gn[0]):Xt="MultiLineString"),Xt!=="Point"&&Xt!=="MultiPoint"||(Xt=gn.length===3?"Point":"MultiPoint"),Ke.push(de(Fr.id,Xt,gn,Fr.tags))}}}return Ke.length?Ke:null}function Tr(V,te,le,we,je){for(var ht=0;ht<V.length;ht+=3){var xt=V[ht+je];xt>=le&&xt<=we&&(te.push(V[ht]),te.push(V[ht+1]),te.push(V[ht+2]))}}function Mr(V,te,le,we,je,ht,xt){for(var ge,Ke,Ut=Or(V),Fr=je===0?_t:pr,jr=V.start,Xt=0;Xt<V.length-3;Xt+=3){var mr=V[Xt],Hr=V[Xt+1],gn=V[Xt+2],gr=V[Xt+3],vn=V[Xt+4],$r=je===0?mr:Hr,cn=je===0?gr:vn,pi=!1;xt&&(ge=Math.sqrt(Math.pow(mr-gr,2)+Math.pow(Hr-vn,2))),$r<le?cn>le&&(Ke=Fr(Ut,mr,Hr,gr,vn,le),xt&&(Ut.start=jr+ge*Ke)):$r>we?cn<we&&(Ke=Fr(Ut,mr,Hr,gr,vn,we),xt&&(Ut.start=jr+ge*Ke)):At(Ut,mr,Hr,gn),cn<le&&$r>=le&&(Ke=Fr(Ut,mr,Hr,gr,vn,le),pi=!0),cn>we&&$r<=we&&(Ke=Fr(Ut,mr,Hr,gr,vn,we),pi=!0),!ht&&pi&&(xt&&(Ut.end=jr+ge*Ke),te.push(Ut),Ut=Or(V)),xt&&(jr+=ge)}var fn=V.length-3;mr=V[fn],Hr=V[fn+1],gn=V[fn+2],($r=je===0?mr:Hr)>=le&&$r<=we&&At(Ut,mr,Hr,gn),fn=Ut.length-3,ht&&fn>=3&&(Ut[fn]!==Ut[0]||Ut[fn+1]!==Ut[1])&&At(Ut,Ut[0],Ut[1],Ut[2]),Ut.length&&te.push(Ut)}function Or(V){var te=[];return te.size=V.size,te.start=V.start,te.end=V.end,te}function Je(V,te,le,we,je,ht){for(var xt=0;xt<V.length;xt++)Mr(V[xt],te,le,we,je,ht,!1)}function At(V,te,le,we){V.push(te),V.push(le),V.push(we)}function _t(V,te,le,we,je,ht){var xt=(ht-te)/(we-te);return V.push(ht),V.push(le+(je-le)*xt),V.push(1),xt}function pr(V,te,le,we,je,ht){var xt=(ht-le)/(je-le);return V.push(te+(we-te)*xt),V.push(ht),V.push(1),xt}function en(V,te){for(var le=[],we=0;we<V.length;we++){var je,ht=V[we],xt=ht.type;if(xt==="Point"||xt==="MultiPoint"||xt==="LineString")je=mt(ht.geometry,te);else if(xt==="MultiLineString"||xt==="Polygon"){je=[];for(var ge=0;ge<ht.geometry.length;ge++)je.push(mt(ht.geometry[ge],te))}else if(xt==="MultiPolygon")for(je=[],ge=0;ge<ht.geometry.length;ge++){for(var Ke=[],Ut=0;Ut<ht.geometry[ge].length;Ut++)Ke.push(mt(ht.geometry[ge][Ut],te));je.push(Ke)}le.push(de(ht.id,xt,je,ht.tags))}return le}function mt(V,te){var le=[];le.size=V.size,V.start!==void 0&&(le.start=V.start,le.end=V.end);for(var we=0;we<V.length;we+=3)le.push(V[we]+te,V[we+1],V[we+2]);return le}function Nt(V,te){if(V.transformed)return V;var le,we,je,ht=1<<V.z,xt=V.x,ge=V.y;for(le=0;le<V.features.length;le++){var Ke=V.features[le],Ut=Ke.geometry,Fr=Ke.type;if(Ke.geometry=[],Fr===1)for(we=0;we<Ut.length;we+=2)Ke.geometry.push(ar(Ut[we],Ut[we+1],te,ht,xt,ge));else for(we=0;we<Ut.length;we++){var jr=[];for(je=0;je<Ut[we].length;je+=2)jr.push(ar(Ut[we][je],Ut[we][je+1],te,ht,xt,ge));Ke.geometry.push(jr)}}return V.transformed=!0,V}function ar(V,te,le,we,je,ht){return[Math.round(le*(V*we-je)),Math.round(le*(te*we-ht))]}function xr(V,te,le,we,je){for(var ht=te===je.maxZoom?0:je.tolerance/((1<<te)*je.extent),xt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:we,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<V.length;ge++){xt.numFeatures++,xn(xt,V[ge],ht,je);var Ke=V[ge].minX,Ut=V[ge].minY,Fr=V[ge].maxX,jr=V[ge].maxY;Ke<xt.minX&&(xt.minX=Ke),Ut<xt.minY&&(xt.minY=Ut),Fr>xt.maxX&&(xt.maxX=Fr),jr>xt.maxY&&(xt.maxY=jr)}return xt}function xn(V,te,le,we){var je=te.geometry,ht=te.type,xt=[];if(ht==="Point"||ht==="MultiPoint")for(var ge=0;ge<je.length;ge+=3)xt.push(je[ge]),xt.push(je[ge+1]),V.numPoints++,V.numSimplified++;else if(ht==="LineString")In(xt,je,V,le,!1,!1);else if(ht==="MultiLineString"||ht==="Polygon")for(ge=0;ge<je.length;ge++)In(xt,je[ge],V,le,ht==="Polygon",ge===0);else if(ht==="MultiPolygon")for(var Ke=0;Ke<je.length;Ke++){var Ut=je[Ke];for(ge=0;ge<Ut.length;ge++)In(xt,Ut[ge],V,le,!0,ge===0)}if(xt.length){var Fr=te.tags||null;if(ht==="LineString"&&we.lineMetrics){for(var jr in Fr={},te.tags)Fr[jr]=te.tags[jr];Fr.mapbox_clip_start=je.start/je.size,Fr.mapbox_clip_end=je.end/je.size}var Xt={geometry:xt,type:ht==="Polygon"||ht==="MultiPolygon"?3:ht==="LineString"||ht==="MultiLineString"?2:1,tags:Fr};te.id!==null&&(Xt.id=te.id),V.features.push(Xt)}}function In(V,te,le,we,je,ht){var xt=we*we;if(we>0&&te.size<(je?xt:we))le.numPoints+=te.length/3;else{for(var ge=[],Ke=0;Ke<te.length;Ke+=3)(we===0||te[Ke+2]>xt)&&(le.numSimplified++,ge.push(te[Ke]),ge.push(te[Ke+1])),le.numPoints++;je&&function(Ut,Fr){for(var jr=0,Xt=0,mr=Ut.length,Hr=mr-2;Xt<mr;Hr=Xt,Xt+=2)jr+=(Ut[Xt]-Ut[Hr])*(Ut[Xt+1]+Ut[Hr+1]);if(jr>0===Fr)for(Xt=0,mr=Ut.length;Xt<mr/2;Xt+=2){var gn=Ut[Xt],gr=Ut[Xt+1];Ut[Xt]=Ut[mr-2-Xt],Ut[Xt+1]=Ut[mr-1-Xt],Ut[mr-2-Xt]=gn,Ut[mr-1-Xt]=gr}}(ge,ht),V.push(ge)}}function Ei(V,te){var le=(te=this.options=function(je,ht){for(var xt in ht)je[xt]=ht[xt];return je}(Object.create(this.options),te)).debug;if(le&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var we=function(je,ht){var xt=[];if(je.type==="FeatureCollection")for(var ge=0;ge<je.features.length;ge++)Qe(xt,je.features[ge],ht,ge);else Qe(xt,je.type==="Feature"?je:{geometry:je},ht);return xt}(V,te);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(we=function(je,ht){var xt=ht.buffer/ht.extent,ge=je,Ke=wr(je,1,-1-xt,xt,0,-1,2,ht),Ut=wr(je,1,1-xt,2+xt,0,-1,2,ht);return(Ke||Ut)&&(ge=wr(je,1,-xt,1+xt,0,-1,2,ht)||[],Ke&&(ge=en(Ke,1).concat(ge)),Ut&&(ge=ge.concat(en(Ut,-1)))),ge}(we,te)).length&&this.splitTile(we,0,0,0),le&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ai(V,te,le){return 32*((1<<V)*le+te)+V}function Bi(V,te){var le=V.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);var we=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!we)return te(null,null);var je=new ot(we.features),ht=Be(je);ht.byteOffset===0&&ht.byteLength===ht.buffer.byteLength||(ht=new Uint8Array(ht)),te(null,{vectorTile:je,rawData:ht.buffer})}_r.prototype.load=function(V){var te=this.options,le=te.log,we=te.minZoom,je=te.maxZoom,ht=te.nodeSize;le&&console.time("total time");var xt="prepare "+V.length+" points";le&&console.time(xt),this.points=V;for(var ge=[],Ke=0;Ke<V.length;Ke++)V[Ke].geometry&&ge.push(tr(V[Ke],Ke));this.trees[je+1]=new Pt(ge,jt,w,ht,Float32Array),le&&console.timeEnd(xt);for(var Ut=je;Ut>=we;Ut--){var Fr=+Date.now();ge=this._cluster(ge,Ut),this.trees[Ut]=new Pt(ge,jt,w,ht,Float32Array),le&&console.log("z%d: %d clusters in %dms",Ut,ge.length,+Date.now()-Fr)}return le&&console.timeEnd("total time"),this},_r.prototype.getClusters=function(V,te){var le=((V[0]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,V[1])),je=V[2]===180?180:((V[2]+180)%360+360)%360-180,ht=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)le=-180,je=180;else if(le>je){var xt=this.getClusters([le,we,180,ht],te),ge=this.getClusters([-180,we,je,ht],te);return xt.concat(ge)}for(var Ke=this.trees[this._limitZoom(te)],Ut=[],Fr=0,jr=Ke.range(De(le),at(ht),De(je),at(we));Fr<jr.length;Fr+=1){var Xt=Ke.points[jr[Fr]];Ut.push(Xt.numPoints?ne(Xt):this.points[Xt.index])}return Ut},_r.prototype.getChildren=function(V){var te=this._getOriginId(V),le=this._getOriginZoom(V),we="No cluster with the specified id.",je=this.trees[le];if(!je)throw new Error(we);var ht=je.points[te];if(!ht)throw new Error(we);for(var xt=this.options.radius/(this.options.extent*Math.pow(2,le-1)),ge=[],Ke=0,Ut=je.within(ht.x,ht.y,xt);Ke<Ut.length;Ke+=1){var Fr=je.points[Ut[Ke]];Fr.parentId===V&&ge.push(Fr.numPoints?ne(Fr):this.points[Fr.index])}if(ge.length===0)throw new Error(we);return ge},_r.prototype.getLeaves=function(V,te,le){var we=[];return this._appendLeaves(we,V,te=te||10,le=le||0,0),we},_r.prototype.getTile=function(V,te,le){var we=this.trees[this._limitZoom(V)],je=Math.pow(2,V),ht=this.options,xt=ht.radius/ht.extent,ge=(le-xt)/je,Ke=(le+1+xt)/je,Ut={features:[]};return this._addTileFeatures(we.range((te-xt)/je,ge,(te+1+xt)/je,Ke),we.points,te,le,je,Ut),te===0&&this._addTileFeatures(we.range(1-xt/je,ge,1,Ke),we.points,je,le,je,Ut),te===je-1&&this._addTileFeatures(we.range(0,ge,xt/je,Ke),we.points,-1,le,je,Ut),Ut.features.length?Ut:null},_r.prototype.getClusterExpansionZoom=function(V){for(var te=this._getOriginZoom(V)-1;te<=this.options.maxZoom;){var le=this.getChildren(V);if(te++,le.length!==1)break;V=le[0].properties.cluster_id}return te},_r.prototype._appendLeaves=function(V,te,le,we,je){for(var ht=0,xt=this.getChildren(te);ht<xt.length;ht+=1){var ge=xt[ht],Ke=ge.properties;if(Ke&&Ke.cluster?je+Ke.point_count<=we?je+=Ke.point_count:je=this._appendLeaves(V,Ke.cluster_id,le,we,je):je<we?je++:V.push(ge),V.length===le)break}return je},_r.prototype._addTileFeatures=function(V,te,le,we,je,ht){for(var xt=0,ge=V;xt<ge.length;xt+=1){var Ke=te[ge[xt]],Ut=Ke.numPoints,Fr={type:1,geometry:[[Math.round(this.options.extent*(Ke.x*je-le)),Math.round(this.options.extent*(Ke.y*je-we))]],tags:Ut?be(Ke):this.points[Ke.index].properties},jr=void 0;Ut?jr=Ke.id:this.options.generateId?jr=Ke.index:this.points[Ke.index].id&&(jr=this.points[Ke.index].id),jr!==void 0&&(Fr.id=jr),ht.features.push(Fr)}},_r.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},_r.prototype._cluster=function(V,te){for(var le=[],we=this.options,je=we.reduce,ht=we.minPoints,xt=we.radius/(we.extent*Math.pow(2,te)),ge=0;ge<V.length;ge++){var Ke=V[ge];if(!(Ke.zoom<=te)){Ke.zoom=te;for(var Ut=this.trees[te+1],Fr=Ut.within(Ke.x,Ke.y,xt),jr=Ke.numPoints||1,Xt=jr,mr=0,Hr=Fr;mr<Hr.length;mr+=1){var gn=Ut.points[Hr[mr]];gn.zoom>te&&(Xt+=gn.numPoints||1)}if(Xt>=ht){for(var gr=Ke.x*jr,vn=Ke.y*jr,$r=je&&jr>1?this._map(Ke,!0):null,cn=(ge<<5)+(te+1)+this.points.length,pi=0,fn=Fr;pi<fn.length;pi+=1){var gi=Ut.points[fn[pi]];if(!(gi.zoom<=te)){gi.zoom=te;var Wi=gi.numPoints||1;gr+=gi.x*Wi,vn+=gi.y*Wi,gi.parentId=cn,je&&($r||($r=this._map(Ke,!0)),je($r,this._map(gi)))}}Ke.parentId=cn,le.push(Yr(gr/Xt,vn/Xt,cn,Xt,$r))}else if(le.push(Ke),Xt>1)for(var vi=0,Ri=Fr;vi<Ri.length;vi+=1){var Ii=Ut.points[Ri[vi]];Ii.zoom<=te||(Ii.zoom=te,le.push(Ii))}}}return le},_r.prototype._getOriginId=function(V){return V-this.points.length>>5},_r.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},_r.prototype._map=function(V,te){if(V.numPoints)return te?kt({},V.properties):V.properties;var le=this.points[V.index].properties,we=this.options.map(le);return te&&we===le?kt({},we):we},Ei.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ei.prototype.splitTile=function(V,te,le,we,je,ht,xt){for(var ge=[V,te,le,we],Ke=this.options,Ut=Ke.debug;ge.length;){we=ge.pop(),le=ge.pop(),te=ge.pop(),V=ge.pop();var Fr=1<<te,jr=Ai(te,le,we),Xt=this.tiles[jr];if(!Xt&&(Ut>1&&console.time("creation"),Xt=this.tiles[jr]=xr(V,te,le,we,Ke),this.tileCoords.push({z:te,x:le,y:we}),Ut)){Ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,le,we,Xt.numFeatures,Xt.numPoints,Xt.numSimplified),console.timeEnd("creation"));var mr="z"+te;this.stats[mr]=(this.stats[mr]||0)+1,this.total++}if(Xt.source=V,je){if(te===Ke.maxZoom||te===je)continue;var Hr=1<<je-te;if(le!==Math.floor(ht/Hr)||we!==Math.floor(xt/Hr))continue}else if(te===Ke.indexMaxZoom||Xt.numPoints<=Ke.indexMaxPoints)continue;if(Xt.source=null,V.length!==0){Ut>1&&console.time("clipping");var gn,gr,vn,$r,cn,pi,fn=.5*Ke.buffer/Ke.extent,gi=.5-fn,Wi=.5+fn,vi=1+fn;gn=gr=vn=$r=null,cn=wr(V,Fr,le-fn,le+Wi,0,Xt.minX,Xt.maxX,Ke),pi=wr(V,Fr,le+gi,le+vi,0,Xt.minX,Xt.maxX,Ke),V=null,cn&&(gn=wr(cn,Fr,we-fn,we+Wi,1,Xt.minY,Xt.maxY,Ke),gr=wr(cn,Fr,we+gi,we+vi,1,Xt.minY,Xt.maxY,Ke),cn=null),pi&&(vn=wr(pi,Fr,we-fn,we+Wi,1,Xt.minY,Xt.maxY,Ke),$r=wr(pi,Fr,we+gi,we+vi,1,Xt.minY,Xt.maxY,Ke),pi=null),Ut>1&&console.timeEnd("clipping"),ge.push(gn||[],te+1,2*le,2*we),ge.push(gr||[],te+1,2*le,2*we+1),ge.push(vn||[],te+1,2*le+1,2*we),ge.push($r||[],te+1,2*le+1,2*we+1)}}},Ei.prototype.getTile=function(V,te,le){var we=this.options,je=we.extent,ht=we.debug;if(V<0||V>24)return null;var xt=1<<V,ge=Ai(V,te=(te%xt+xt)%xt,le);if(this.tiles[ge])return Nt(this.tiles[ge],je);ht>1&&console.log("drilling down to z%d-%d-%d",V,te,le);for(var Ke,Ut=V,Fr=te,jr=le;!Ke&&Ut>0;)Ut--,Fr=Math.floor(Fr/2),jr=Math.floor(jr/2),Ke=this.tiles[Ai(Ut,Fr,jr)];return Ke&&Ke.source?(ht>1&&console.log("found parent tile z%d-%d-%d",Ut,Fr,jr),ht>1&&console.time("drilling down"),this.splitTile(Ke.source,Ut,Fr,jr,V,te,le),ht>1&&console.timeEnd("drilling down"),this.tiles[ge]?Nt(this.tiles[ge],je):null):null};var aa=function(V){function te(le,we,je,ht){V.call(this,le,we,je,Bi),ht&&(this.loadGeoJSON=ht)}return V&&(te.__proto__=V),(te.prototype=Object.create(V&&V.prototype)).constructor=te,te.prototype.loadData=function(le,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=we,this._pendingLoadDataParams=le,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},te.prototype._loadData=function(){var le=this;if(this._pendingCallback&&this._pendingLoadDataParams){var we=this._pendingCallback,je=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ht=!!(je&&je.request&&je.request.collectResourceTiming)&&new p.RequestPerformance(je.request);this.loadGeoJSON(je,function(xt,ge){if(xt||!ge)return we(xt);if(typeof ge!="object")return we(new Error("Input data given to '"+je.source+"' is not a valid GeoJSON object."));(function Xt(mr,Hr){var gn,gr=mr&&mr.type;if(gr==="FeatureCollection")for(gn=0;gn<mr.features.length;gn++)Xt(mr.features[gn],Hr);else if(gr==="GeometryCollection")for(gn=0;gn<mr.geometries.length;gn++)Xt(mr.geometries[gn],Hr);else if(gr==="Feature")Xt(mr.geometry,Hr);else if(gr==="Polygon")zt(mr.coordinates,Hr);else if(gr==="MultiPolygon")for(gn=0;gn<mr.coordinates.length;gn++)zt(mr.coordinates[gn],Hr);return mr})(ge,!0);try{if(je.filter){var Ke=p.createExpression(je.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ke.result==="error")throw new Error(Ke.value.map(function(Xt){return Xt.key+": "+Xt.message}).join(", "));var Ut=ge.features.filter(function(Xt){return Ke.value.evaluate({zoom:0},Xt)});ge={type:"FeatureCollection",features:Ut}}le._geoJSONIndex=je.cluster?new _r(function(Xt){var mr=Xt.superclusterOptions,Hr=Xt.clusterProperties;if(!Hr||!mr)return mr;for(var gn={},gr={},vn={accumulated:null,zoom:0},$r={properties:null},cn=Object.keys(Hr),pi=0,fn=cn;pi<fn.length;pi+=1){var gi=fn[pi],Wi=Hr[gi],vi=Wi[0],Ri=p.createExpression(Wi[1]),Ii=p.createExpression(typeof vi=="string"?[vi,["accumulated"],["get",gi]]:vi);gn[gi]=Ri.value,gr[gi]=Ii.value}return mr.map=function(go){$r.properties=go;for(var ji={},Rn=0,Dn=cn;Rn<Dn.length;Rn+=1){var ui=Dn[Rn];ji[ui]=gn[ui].evaluate(vn,$r)}return ji},mr.reduce=function(go,ji){$r.properties=ji;for(var Rn=0,Dn=cn;Rn<Dn.length;Rn+=1){var ui=Dn[Rn];vn.accumulated=go[ui],go[ui]=gr[ui].evaluate(vn,$r)}},mr}(je)).load(ge.features):function(Xt,mr){return new Ei(Xt,mr)}(ge,je.geojsonVtOptions)}catch(Xt){return we(Xt)}le.loaded={};var Fr={};if(ht){var jr=ht.finish();jr&&(Fr.resourceTiming={},Fr.resourceTiming[je.source]=JSON.parse(JSON.stringify(jr)))}we(null,Fr)})}},te.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},te.prototype.reloadTile=function(le,we){var je=this.loaded;return je&&je[le.uid]?V.prototype.reloadTile.call(this,le,we):this.loadTile(le,we)},te.prototype.loadGeoJSON=function(le,we){if(le.request)p.getJSON(le.request,we);else{if(typeof le.data!="string")return we(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."));try{return we(null,JSON.parse(le.data))}catch(je){return we(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."))}}},te.prototype.removeSource=function(le,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),we()},te.prototype.getClusterExpansionZoom=function(le,we){try{we(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(je){we(je)}},te.prototype.getClusterChildren=function(le,we){try{we(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(je){we(je)}},te.prototype.getClusterLeaves=function(le,we){try{we(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(je){we(je)}},te}(xe),hi=function(V){var te=this;this.self=V,this.actor=new p.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:xe,geojson:aa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(le,we){if(te.workerSourceTypes[le])throw new Error('Worker source with name "'+le+'" already registered.');te.workerSourceTypes[le]=we},this.self.registerRTLTextPlugin=function(le){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=le.applyArabicShaping,p.plugin.processBidirectionalText=le.processBidirectionalText,p.plugin.processStyledBidirectionalText=le.processStyledBidirectionalText}};return hi.prototype.setReferrer=function(V,te){this.referrer=te},hi.prototype.setImages=function(V,te,le){for(var we in this.availableImages[V]=te,this.workerSources[V]){var je=this.workerSources[V][we];for(var ht in je)je[ht].availableImages=te}le()},hi.prototype.setLayers=function(V,te,le){this.getLayerIndex(V).replace(te),le()},hi.prototype.updateLayers=function(V,te,le){this.getLayerIndex(V).update(te.layers,te.removedIds),le()},hi.prototype.loadTile=function(V,te,le){this.getWorkerSource(V,te.type,te.source).loadTile(te,le)},hi.prototype.loadDEMTile=function(V,te,le){this.getDEMWorkerSource(V,te.source).loadTile(te,le)},hi.prototype.reloadTile=function(V,te,le){this.getWorkerSource(V,te.type,te.source).reloadTile(te,le)},hi.prototype.abortTile=function(V,te,le){this.getWorkerSource(V,te.type,te.source).abortTile(te,le)},hi.prototype.removeTile=function(V,te,le){this.getWorkerSource(V,te.type,te.source).removeTile(te,le)},hi.prototype.removeDEMTile=function(V,te){this.getDEMWorkerSource(V,te.source).removeTile(te)},hi.prototype.removeSource=function(V,te,le){if(this.workerSources[V]&&this.workerSources[V][te.type]&&this.workerSources[V][te.type][te.source]){var we=this.workerSources[V][te.type][te.source];delete this.workerSources[V][te.type][te.source],we.removeSource!==void 0?we.removeSource(te,le):le()}},hi.prototype.loadWorkerSource=function(V,te,le){try{this.self.importScripts(te.url),le()}catch(we){le(we.toString())}},hi.prototype.syncRTLPluginState=function(V,te,le){try{p.plugin.setState(te);var we=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&we!=null){this.self.importScripts(we);var je=p.plugin.isParsed();le(je?void 0:new Error("RTL Text Plugin failed to import scripts from "+we),je)}}catch(ht){le(ht.toString())}},hi.prototype.getAvailableImages=function(V){var te=this.availableImages[V];return te||(te=[]),te},hi.prototype.getLayerIndex=function(V){var te=this.layerIndexes[V];return te||(te=this.layerIndexes[V]=new X),te},hi.prototype.getWorkerSource=function(V,te,le){var we=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][te]||(this.workerSources[V][te]={}),this.workerSources[V][te][le]||(this.workerSources[V][te][le]=new this.workerSourceTypes[te]({send:function(je,ht,xt){we.actor.send(je,ht,xt,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][te][le]},hi.prototype.getDEMWorkerSource=function(V,te){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][te]||(this.demWorkerSources[V][te]=new Ft),this.demWorkerSources[V][te]},hi.prototype.enforceCacheSizeLimit=function(V,te){p.enforceCacheSizeLimit(te)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new hi(self)),hi}),b(["./shared"],function(p){"use strict";var S=p.createCommonjsModule(function(n){function u(g){return!a(g)}function a(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,Z=new Blob([""],{type:"text/javascript"}),ee=URL.createObjectURL(Z);try{R=new Worker(ee),T=!0}catch(ve){T=!1}return R&&R.terminate(),URL.revokeObjectURL(ee),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var Z=R.getImageData(0,0,1,1);return Z&&Z.width===T.width}()?(h[E=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[E]=function(T){var R=function(ee){var ve=document.createElement("canvas"),_e=Object.create(u.webGLContextAttributes);return _e.failIfMajorPerformanceCaveat=ee,ve.probablySupportsContext?ve.probablySupportsContext("webgl",_e)||ve.probablySupportsContext("experimental-webgl",_e):ve.supportsContext?ve.supportsContext("webgl",_e)||ve.supportsContext("experimental-webgl",_e):ve.getContext("webgl",_e)||ve.getContext("experimental-webgl",_e)}(T);if(!R)return!1;var Z=R.createShader(R.VERTEX_SHADER);return!(!Z||R.isContextLost())&&(R.shaderSource(Z,"void main() {}"),R.compileShader(Z),R.getShaderParameter(Z,R.COMPILE_STATUS)===!0)}(E)),h[E]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var E}n.exports?n.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=a);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),L={create:function(n,u,a){var h=p.window.document.createElement(n);return u!==void 0&&(h.className=u),a&&a.appendChild(h),h},createNS:function(n,u){return p.window.document.createElementNS(n,u)}},X=p.window.document&&p.window.document.documentElement.style;function N(n){if(!X)return n[0];for(var u=0;u<n.length;u++)if(n[u]in X)return n[u];return n[0]}var q,K=N(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);L.disableDrag=function(){X&&K&&(q=X[K],X[K]="none")},L.enableDrag=function(){X&&K&&(X[K]=q)};var ae=N(["transform","WebkitTransform"]);L.setTransform=function(n,u){n.style[ae]=u};var xe=!1;try{var se=Object.defineProperty({},"passive",{get:function(){xe=!0}});p.window.addEventListener("test",se,se),p.window.removeEventListener("test",se,se)}catch(n){xe=!1}L.addEventListener=function(n,u,a,h){h===void 0&&(h={}),n.addEventListener(u,a,"passive"in h&&xe?h:h.capture)},L.removeEventListener=function(n,u,a,h){h===void 0&&(h={}),n.removeEventListener(u,a,"passive"in h&&xe?h:h.capture)};var Ft=function(n){n.preventDefault(),n.stopPropagation(),p.window.removeEventListener("click",Ft,!0)};function zt(n){var u=n.userImage;return!!(u&&u.render&&u.render())&&(n.data.replace(new Uint8Array(u.data.buffer)),!0)}L.suppressClick=function(){p.window.addEventListener("click",Ft,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",Ft,!0)},0)},L.mousePos=function(n,u){var a=n.getBoundingClientRect();return new p.Point(u.clientX-a.left-n.clientLeft,u.clientY-a.top-n.clientTop)},L.touchPos=function(n,u){for(var a=n.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new p.Point(u[g].clientX-a.left-n.clientLeft,u[g].clientY-a.top-n.clientTop));return h},L.mouseButton=function(n){return p.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},L.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var Wt=function(n){function u(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,g=this.requestors;h<g.length;h+=1){var E=g[h];this._notify(E.ids,E.callback)}this.requestors=[]}},u.prototype.getImage=function(a){return this.images[a]},u.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},u.prototype._validate=function(a,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(a,h){if(!a)return!0;for(var g=0,E=0,T=a;E<T.length;E+=1){var R=T[E];if(R[0]<g||R[1]<R[0]||h<R[1])return!1;g=R[1]}return!0},u.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},u.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},u.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(a,h){var g=!0;if(!this.isLoaded())for(var E=0,T=a;E<T.length;E+=1)this.images[T[E]]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})},u.prototype._notify=function(a,h){for(var g={},E=0,T=a;E<T.length;E+=1){var R=T[E];this.images[R]||this.fire(new p.Event("styleimagemissing",{id:R}));var Z=this.images[R];Z?g[R]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:Boolean(Z.userImage&&Z.userImage.render)}:p.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},u.prototype.getPattern=function(a){var h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var E={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new p.ImagePosition(E,g);this.patterns[a]={bin:E,position:T}}return this._updatePatternAtlas(),this.patterns[a].position},u.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var g=p.potpack(a),E=g.w,T=g.h,R=this.atlasImage;for(var Z in R.resize({width:E||1,height:T||1}),this.patterns){var ee=this.patterns[Z].bin,ve=ee.x+1,_e=ee.y+1,Ee=this.images[Z].data,We=Ee.width,He=Ee.height;p.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve,y:_e},{width:We,height:He}),p.RGBAImage.copy(Ee,R,{x:0,y:He-1},{x:ve,y:_e-1},{width:We,height:1}),p.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve,y:_e+He},{width:We,height:1}),p.RGBAImage.copy(Ee,R,{x:We-1,y:0},{x:ve-1,y:_e},{width:1,height:He}),p.RGBAImage.copy(Ee,R,{x:0,y:0},{x:ve+We,y:_e},{width:1,height:He})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(a){for(var h=0,g=a;h<g.length;h+=1){var E=g[h];if(!this.callbackDispatchedThisFrame[E]){this.callbackDispatchedThisFrame[E]=!0;var T=this.images[E];zt(T)&&this.updateImage(E,T)}}},u}(p.Evented),Mt=tt,wt=tt,ot=1e20;function tt(n,u,a,h,g,E){this.fontSize=n||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=E||"normal",this.radius=a||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Yt(n,u,a,h,g,E,T){for(var R=0;R<u;R++){for(var Z=0;Z<a;Z++)h[Z]=n[Z*u+R];for(ke(h,g,E,T,a),Z=0;Z<a;Z++)n[Z*u+R]=g[Z]}for(Z=0;Z<a;Z++){for(R=0;R<u;R++)h[R]=n[Z*u+R];for(ke(h,g,E,T,u),R=0;R<u;R++)n[Z*u+R]=Math.sqrt(g[R])}}function ke(n,u,a,h,g){a[0]=0,h[0]=-ot,h[1]=+ot;for(var E=1,T=0;E<g;E++){for(var R=(n[E]+E*E-(n[a[T]]+a[T]*a[T]))/(2*E-2*a[T]);R<=h[T];)T--,R=(n[E]+E*E-(n[a[T]]+a[T]*a[T]))/(2*E-2*a[T]);a[++T]=E,h[T]=R,h[T+1]=+ot}for(E=0,T=0;E<g;E++){for(;h[T+1]<E;)T++;u[E]=(E-a[T])*(E-a[T])+n[a[T]]}}tt.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?ot:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?ot:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(Yt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Yt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},Mt.default=wt;var Ne=function(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}};Ne.prototype.setURL=function(n){this.url=n},Ne.prototype.getGlyphs=function(n,u){var a=this,h=[];for(var g in n)for(var E=0,T=n[g];E<T.length;E+=1)h.push({stack:g,id:T[E]});p.asyncAll(h,function(R,Z){var ee=R.stack,ve=R.id,_e=a.entries[ee];_e||(_e=a.entries[ee]={glyphs:{},requests:{},ranges:{}});var Ee=_e.glyphs[ve];if(Ee===void 0){if(Ee=a._tinySDF(_e,ee,ve))return _e.glyphs[ve]=Ee,void Z(null,{stack:ee,id:ve,glyph:Ee});var We=Math.floor(ve/256);if(256*We>65535)Z(new Error("glyphs > 65535 not supported"));else if(_e.ranges[We])Z(null,{stack:ee,id:ve,glyph:Ee});else{var He=_e.requests[We];He||(He=_e.requests[We]=[],Ne.loadGlyphRange(ee,We,a.url,a.requestManager,function(lt,Fe){if(Fe){for(var st in Fe)a._doesCharSupportLocalGlyph(+st)||(_e.glyphs[+st]=Fe[+st]);_e.ranges[We]=!0}for(var bt=0,Gt=He;bt<Gt.length;bt+=1)(0,Gt[bt])(lt,Fe);delete _e.requests[We]})),He.push(function(lt,Fe){lt?Z(lt):Fe&&Z(null,{stack:ee,id:ve,glyph:Fe[ve]||null})})}}else Z(null,{stack:ee,id:ve,glyph:Ee})},function(R,Z){if(R)u(R);else if(Z){for(var ee={},ve=0,_e=Z;ve<_e.length;ve+=1){var Ee=_e[ve],We=Ee.stack,He=Ee.id,lt=Ee.glyph;(ee[We]||(ee[We]={}))[He]=lt&&{id:lt.id,bitmap:lt.bitmap.clone(),metrics:lt.metrics}}u(null,ee)}})},Ne.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](n)||p.isChar["Hangul Syllables"](n)||p.isChar.Hiragana(n)||p.isChar.Katakana(n))},Ne.prototype._tinySDF=function(n,u,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var g=n.tinySDF;if(!g){var E="400";/bold/i.test(u)?E="900":/medium/i.test(u)?E="500":/light/i.test(u)&&(E="200"),g=n.tinySDF=new Ne.TinySDF(24,3,8,.25,h,E)}return{id:a,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Ne.loadGlyphRange=function(n,u,a,h,g){var E=256*u,T=E+255,R=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",n).replace("{range}",E+"-"+T),p.ResourceType.Glyphs);p.getArrayBuffer(R,function(Z,ee){if(Z)g(Z);else if(ee){for(var ve={},_e=0,Ee=p.parseGlyphPBF(ee);_e<Ee.length;_e+=1){var We=Ee[_e];ve[We.id]=We}g(null,ve)}})},Ne.TinySDF=Mt;var Be=function(){this.specification=p.styleSpec.light.position};Be.prototype.possiblyEvaluate=function(n,u){return p.sphericalToCartesian(n.expression.evaluate(u))},Be.prototype.interpolate=function(n,u,a){return{x:p.number(n.x,u.x,a),y:p.number(n.y,u.y,a),z:p.number(n.z,u.z,a)}};var Ie=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new Be,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),pt=function(n){function u(a){n.call(this),this._transitionable=new p.Transitionable(Ie),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,a,h))for(var g in a){var E=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),E):this._transitionable.setValue(g,E)}},u.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},u.prototype._validate=function(a,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),oe=function(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};oe.prototype.getDash=function(n,u){var a=n.join(",")+String(u);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(n,u)),this.dashEntry[a]},oe.prototype.getDashRanges=function(n,u,a){var h=[],g=n.length%2==1?-n[n.length-1]*a:0,E=n[0]*a,T=!0;h.push({left:g,right:E,isDash:T,zeroLength:n[0]===0});for(var R=n[0],Z=1;Z<n.length;Z++){var ee=n[Z];h.push({left:g=R*a,right:E=(R+=ee)*a,isDash:T=!T,zeroLength:ee===0})}return h},oe.prototype.addRoundDash=function(n,u,a){for(var h=u/2,g=-a;g<=a;g++)for(var E=this.width*(this.nextRow+a+g),T=0,R=n[T],Z=0;Z<this.width;Z++){Z/R.right>1&&(R=n[++T]);var ee=Math.abs(Z-R.left),ve=Math.abs(Z-R.right),_e=Math.min(ee,ve),Ee=void 0,We=g/a*(h+1);if(R.isDash){var He=h-Math.abs(We);Ee=Math.sqrt(_e*_e+He*He)}else Ee=h-Math.sqrt(_e*_e+We*We);this.data[E+Z]=Math.max(0,Math.min(255,Ee+128))}},oe.prototype.addRegularDash=function(n){for(var u=n.length-1;u>=0;--u){var a=n[u],h=n[u+1];a.zeroLength?n.splice(u,1):h&&h.isDash===a.isDash&&(h.left=a.left,n.splice(u,1))}var g=n[0],E=n[n.length-1];g.isDash===E.isDash&&(g.left=E.left-this.width,E.right=g.right+this.width);for(var T=this.width*this.nextRow,R=0,Z=n[R],ee=0;ee<this.width;ee++){ee/Z.right>1&&(Z=n[++R]);var ve=Math.abs(ee-Z.left),_e=Math.abs(ee-Z.right),Ee=Math.min(ve,_e);this.data[T+ee]=Math.max(0,Math.min(255,(Z.isDash?Ee:-Ee)+128))}},oe.prototype.addDash=function(n,u){var a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,E=0;E<n.length;E++)g+=n[E];if(g!==0){var T=this.width/g,R=this.getDashRanges(n,this.width,T);u?this.addRoundDash(R,T,a):this.addRegularDash(R)}var Z={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:g};return this.nextRow+=h,this.dirty=!0,Z},oe.prototype.bind=function(n){var u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var re=function n(u,a){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var E=new n.Actor(h[g],a,this.id);E.name="Worker "+g,this.actors.push(E)}};function ue(n,u,a){var h=function(g,E){if(g)return a(g);if(E){var T=p.pick(p.extend(E,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(T.vectorLayers=E.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=u.canonicalizeTileset(T,n.url),a(null,T)}};return n.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(n.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,n)})}re.prototype.broadcast=function(n,u,a){p.asyncAll(this.actors,function(h,g){h.send(n,u,g)},a=a||function(){})},re.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},re.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},re.Actor=p.Actor;var it=function(n,u,a){this.bounds=p.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=a||24};it.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},it.prototype.contains=function(n){var u=Math.pow(2,n.z),a=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),E=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=a&&n.x<g&&n.y>=h&&n.y<E};var Jt=function(n){function u(a,h,g,E){if(n.call(this),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new it(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles,a.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},u.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),E={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,Z){return delete a.request,a.aborted?h(null):R&&R.status!==404?h(R):(Z&&Z.resourceTiming&&(a.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&a.setExpiryData(Z),a.loadVectorData(Z,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}E.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",E,T.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",E,T.bind(this)))},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),ce=function(n){function u(a,h,g,E){n.call(this),this.id=a,this.dispatcher=g,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new it(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.loadTile=function(a,h){var g=this,E=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(E,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){g.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var Z=g.map.painter.context,ee=Z.gl;a.texture=g.map.painter.getTileTexture(R.width),a.texture?a.texture.update(R,{useMipmap:!0}):(a.texture=new p.Texture(Z,R,ee.RGBA,{useMipmap:!0}),a.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),a.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},u.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),$e=function(n){function u(a,h,g,E){n.call(this,a,h,g,E),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function E(T,R){T&&(a.state="errored",h(T)),R&&(a.dem=R,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){this.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var Z=p.window.ImageBitmap&&R instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?R:p.browser.getImageData(R,1),ee={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",ee,E.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},u.prototype._getNeighboringTiles=function(a){var h=a.canonical,g=Math.pow(2,h.z),E=(h.x-1+g)%g,T=h.x===0?a.wrap-1:a.wrap,R=(h.x+1+g)%g,Z=h.x+1===g?a.wrap+1:a.wrap,ee={};return ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,E,h.y).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,Z,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,E,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,Z,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,E,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,Z,h.z,R,h.y+1).key]={backfilled:!1}),ee},u.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},u}(ce),Ae=function(n){function u(a,h,g,E){n.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(E),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(g.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new p.Event("data",g))}})},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var E={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(E.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",E))}}),this},u.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},u.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},u.prototype.getClusterLeaves=function(a,h,g,E){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:g},E),this},u.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),E=this._data;typeof E=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(E),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(E),this.actor.send(this.type+".loadData",g,function(T,R){h._removed||R&&R.abandoned||(h._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[h.id]&&(h._resourceTiming=R.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),a(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(a,h){var g=this,E=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(E,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete a.request,a.unloadVectorData(),a.aborted?h(null):T?h(T):(a.loadVectorData(R,g.map.painter,E==="reloadTile"),h(null))})},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},u.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Ce=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Pe=function(n){function u(a,h,g,E){n.call(this),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(a,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(E,T){g._loaded=!0,E?g.fire(new p.ErrorEvent(E)):T&&(g.image=T,a&&(g.coordinates=a),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var g=a.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,Z=1/0,ee=-1/0,ve=-1/0,_e=0,Ee=T;_e<Ee.length;_e+=1){var We=Ee[_e];R=Math.min(R,We.x),Z=Math.min(Z,We.y),ee=Math.max(ee,We.x),ve=Math.max(ve,We.y)}var He=Math.max(ee-R,ve-Z),lt=Math.max(0,Math.floor(-Math.log(He)/Math.LN2)),Fe=Math.pow(2,lt);return new p.CanonicalTileID(lt,Math.floor((R+ee)/2*Fe),Math.floor((Z+ve)/2*Fe))}(g),this.minzoom=this.maxzoom=this.tileID.z;var E=g.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(E[0].x,E[0].y,0,0),this._boundsArray.emplaceBack(E[1].x,E[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(E[3].x,E[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(E[2].x,E[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Ce.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var E=this.tiles[g];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},u.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),et=function(n){function u(a,h,g,E){n.call(this,a,h,g,E),this.roundZoom=!0,this.type="video",this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,E=h.urls;g<E.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(E[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(T,R){a._loaded=!0,T?a.fire(new p.ErrorEvent(T)):R&&(a.video=R,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Ce.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var E=this.tiles[g];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(Pe),Se=function(n){function u(a,h,g,E){n.call(this,a,h,g,E),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Ce.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[E];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var g=h[a];if(isNaN(g)||g<=0)return!0}return!1},u}(Pe),Pt={vector:Jt,raster:ce,"raster-dem":$e,geojson:Ae,video:et,image:Pe,canvas:Se};function vr(n,u){var a=p.identity([]);return p.translate(a,a,[1,1,0]),p.scale(a,a,[.5*n.width,.5*n.height,1]),p.multiply(a,a,n.calculatePosMatrix(u.toUnwrapped()))}function _r(n,u,a,h,g,E){var T=function(lt,Fe,st){if(lt)for(var bt=0,Gt=lt;bt<Gt.length;bt+=1){var ur=Fe[Gt[bt]];if(ur&&ur.source===st&&ur.type==="fill-extrusion")return!0}else for(var or in Fe){var lr=Fe[or];if(lr.source===st&&lr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,n.id),R=E.maxPitchScaleFactor(),Z=n.tilesIn(h,R,T);Z.sort(Yr);for(var ee=[],ve=0,_e=Z;ve<_e.length;ve+=1){var Ee=_e[ve];ee.push({wrappedTileID:Ee.tileID.wrapped().key,queryResults:Ee.tile.queryRenderedFeatures(u,a,n._state,Ee.queryGeometry,Ee.cameraQueryGeometry,Ee.scale,g,E,R,vr(n.transform,Ee.tileID))})}var We=function(lt){for(var Fe={},st={},bt=0,Gt=lt;bt<Gt.length;bt+=1){var ur=Gt[bt],or=ur.queryResults,lr=ur.wrappedTileID,Rr=st[lr]=st[lr]||{};for(var nn in or)for(var Qr=or[nn],yn=Rr[nn]=Rr[nn]||{},jn=Fe[nn]=Fe[nn]||[],Xn=0,Hn=Qr;Xn<Hn.length;Xn+=1){var Ki=Hn[Xn];yn[Ki.featureIndex]||(yn[Ki.featureIndex]=!0,jn.push(Ki))}}return Fe}(ee);for(var He in We)We[He].forEach(function(lt){var Fe=lt.feature,st=n.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=st});return We}function Yr(n,u){var a=n.tileID,h=u.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var tr=function(n,u){this.max=n,this.onRemove=u,this.reset()};tr.prototype.reset=function(){for(var n in this.data)for(var u=0,a=this.data[n];u<a.length;u+=1){var h=a[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},tr.prototype.add=function(n,u,a){var h=this,g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var E={value:u,timeout:void 0};if(a!==void 0&&(E.timeout=setTimeout(function(){h.remove(n,E)},a)),this.data[g].push(E),this.order.push(g),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},tr.prototype.has=function(n){return n.wrapped().key in this.data},tr.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},tr.prototype._getAndRemoveByKey=function(n){var u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value},tr.prototype.getByKey=function(n){var u=this.data[n];return u?u[0].value:null},tr.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},tr.prototype.remove=function(n,u){if(!this.has(n))return this;var a=n.wrapped().key,h=u===void 0?0:this.data[a].indexOf(u),g=this.data[a][h];return this.data[a].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(g.value),this.order.splice(this.order.indexOf(a),1),this},tr.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},tr.prototype.filter=function(n){var u=[];for(var a in this.data)for(var h=0,g=this.data[a];h<g.length;h+=1){var E=g[h];n(E.value)||u.push(E)}for(var T=0,R=u;T<R.length;T+=1){var Z=R[T];this.remove(Z.value.tileID,Z)}};var ne=function(n,u,a){this.context=n;var h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};ne.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ne.prototype.updateData=function(n){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},ne.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var be={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},De=function(n,u,a,h){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=n;var g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};De.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},De.prototype.updateData=function(n){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)},De.prototype.enableAttributes=function(n,u){for(var a=0;a<this.attributes.length;a++){var h=u.attributes[this.attributes[a].name];h!==void 0&&n.enableVertexAttribArray(h)}},De.prototype.setVertexAttribPointers=function(n,u,a){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],E=u.attributes[g.name];E!==void 0&&n.vertexAttribPointer(E,g.components,n[be[g.type]],!1,this.itemSize,g.offset+this.itemSize*(a||0))}},De.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var at=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};at.prototype.get=function(){return this.current},at.prototype.set=function(n){},at.prototype.getDefault=function(){return this.default},at.prototype.setDefault=function(){this.set(this.default)};var kt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(at),jt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},u}(at),w=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},u}(at),F=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(at),de=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},u}(at),Ue=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},u}(at),Qe=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},u}(at),Tt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},u}(at),Dt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},u}(at),H=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},u}(at),Qt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},u}(at),$t=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},u}(at),wr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},u}(at),Tr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},u}(at),Mr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(at),Or=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},u}(at),Je=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},u}(at),At=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},u}(at),_t=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},u}(at),pr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},u}(at),en=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},u}(at),mt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(at),Nt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},u}(at),ar=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(at),xr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},u}(at),xn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},u}(at),In=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},u}(at),Ei=function(n){function u(a){n.call(this,a),this.vao=a.extVertexArrayObject}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},u}(at),Ai=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},u}(at),Bi=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},u}(at),aa=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},u}(at),hi=function(n){function u(a,h){n.call(this,a),this.context=a,this.parent=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(at),V=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},u}(hi),te=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(hi),le=function(n,u,a,h){this.context=n,this.width=u,this.height=a;var g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new V(n,g),h&&(this.depthAttachment=new te(n,g))};le.prototype.destroy=function(){var n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){var a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}n.deleteFramebuffer(this.framebuffer)};var we=function(n,u,a){this.func=n,this.mask=u,this.range=a};we.ReadOnly=!1,we.ReadWrite=!0,we.disabled=new we(519,we.ReadOnly,[0,1]);var je=function(n,u,a,h,g,E){this.test=n,this.ref=u,this.mask=a,this.fail=h,this.depthFail=g,this.pass=E};je.disabled=new je({func:519,mask:0},0,0,7680,7680,7680);var ht=function(n,u,a){this.blendFunction=n,this.blendColor=u,this.mask=a};ht.disabled=new ht(ht.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),ht.unblended=new ht(ht.Replace,p.Color.transparent,[!0,!0,!0,!0]),ht.alphaBlended=new ht([1,771],p.Color.transparent,[!0,!0,!0,!0]);var xt=function(n,u,a){this.enable=n,this.mode=u,this.frontFace=a};xt.disabled=new xt(!1,1029,2305),xt.backCCW=new xt(!0,1029,2305);var ge=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new kt(this),this.clearDepth=new jt(this),this.clearStencil=new w(this),this.colorMask=new F(this),this.depthMask=new de(this),this.stencilMask=new Ue(this),this.stencilFunc=new Qe(this),this.stencilOp=new Tt(this),this.stencilTest=new Dt(this),this.depthRange=new H(this),this.depthTest=new Qt(this),this.depthFunc=new $t(this),this.blend=new wr(this),this.blendFunc=new Tr(this),this.blendColor=new Mr(this),this.blendEquation=new Or(this),this.cullFace=new Je(this),this.cullFaceSide=new At(this),this.frontFace=new _t(this),this.program=new pr(this),this.activeTexture=new en(this),this.viewport=new mt(this),this.bindFramebuffer=new Nt(this),this.bindRenderbuffer=new ar(this),this.bindTexture=new xr(this),this.bindVertexBuffer=new xn(this),this.bindElementBuffer=new In(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ei(this),this.pixelStoreUnpack=new Ai(this),this.pixelStoreUnpackPremultiplyAlpha=new Bi(this),this.pixelStoreUnpackFlipY=new aa(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};ge.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ge.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ge.prototype.createIndexBuffer=function(n,u){return new ne(this,n,u)},ge.prototype.createVertexBuffer=function(n,u,a){return new De(this,n,u,a)},ge.prototype.createRenderbuffer=function(n,u,a){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,n,u,a),this.bindRenderbuffer.set(null),g},ge.prototype.createFramebuffer=function(n,u,a){return new le(this,n,u,a)},ge.prototype.clear=function(n){var u=n.color,a=n.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)},ge.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},ge.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},ge.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},ge.prototype.setColorMode=function(n){p.deepEqual(n.blendFunction,ht.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},ge.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ke=function(n){function u(a,h,g){var E=this;n.call(this),this.id=a,this.dispatcher=g,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(E._sourceLoaded=!0),E._sourceLoaded&&!E._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(E.reload(),E.transform&&E.update(E.transform))}),this.on("error",function(){E._sourceErrored=!0}),this._source=function(T,R,Z,ee){var ve=new Pt[R.type](T,R,Z,ee);if(ve.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ve.id);return p.bindAll(["load","abort","unload","serialize","prepare"],ve),ve}(a,h,g,this),this._tiles={},this._cache=new tr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},u.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},u.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},u.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(a){return a.tileID}).sort(Ut).map(function(a){return a.key})},u.prototype.getRenderableIds=function(a){var h=this,g=[];for(var E in this._tiles)this._isIdRenderable(E,a)&&g.push(this._tiles[E]);return a?g.sort(function(T,R){var Z=T.tileID,ee=R.tileID,ve=new p.Point(Z.canonical.x,Z.canonical.y)._rotate(h.transform.angle),_e=new p.Point(ee.canonical.x,ee.canonical.y)._rotate(h.transform.angle);return Z.overscaledZ-ee.overscaledZ||_e.y-ve.y||_e.x-ve.x}).map(function(T){return T.tileID.key}):g.map(function(T){return T.tileID}).sort(Ut).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},u.prototype._reloadTile=function(a,h){var g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))},u.prototype._tileLoaded=function(a,h,g,E){if(E)return a.state="errored",void(E.status!==404?this._source.fire(new p.ErrorEvent(E,{tile:a})):this.update(this.transform));a.timeAdded=p.browser.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},u.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var E=h[g];if(a.neighboringTiles&&a.neighboringTiles[E]){var T=this.getTileByID(E);R(a,T),R(T,a)}}function R(Z,ee){Z.needsHillshadePrepare=!0;var ve=ee.tileID.canonical.x-Z.tileID.canonical.x,_e=ee.tileID.canonical.y-Z.tileID.canonical.y,Ee=Math.pow(2,Z.tileID.canonical.z),We=ee.tileID.key;ve===0&&_e===0||Math.abs(_e)>1||(Math.abs(ve)>1&&(Math.abs(ve+Ee)===1?ve+=Ee:Math.abs(ve-Ee)===1&&(ve-=Ee)),ee.dem&&Z.dem&&(Z.dem.backfillBorder(ee.dem,ve,_e),Z.neighboringTiles&&Z.neighboringTiles[We]&&(Z.neighboringTiles[We].backfilled=!0)))}},u.prototype.getTile=function(a){return this.getTileByID(a.key)},u.prototype.getTileByID=function(a){return this._tiles[a]},u.prototype._retainLoadedChildren=function(a,h,g,E){for(var T in this._tiles){var R=this._tiles[T];if(!(E[T]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>g)){for(var Z=R.tileID;R&&R.tileID.overscaledZ>h+1;){var ee=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[ee.key])&&R.hasData()&&(Z=ee)}for(var ve=Z;ve.overscaledZ>h;)if(a[(ve=ve.scaledTo(ve.overscaledZ-1)).key]){E[Z.key]=Z;break}}}},u.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var E=a.overscaledZ-1;E>=h;E--){var T=a.scaledTo(E),R=this._getLoadedTile(T);if(R)return R}},u.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},u.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,g=Math.ceil(a.height/this._source.tileSize)+1,E=Math.floor(h*g*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var g={};for(var E in this._tiles){var T=this._tiles[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),g[T.tileID.key]=T}for(var R in this._tiles=g,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},u.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Rr){return new p.OverscaledTileID(Rr.canonical.z,Rr.wrap,Rr.canonical.z,Rr.canonical.x,Rr.canonical.y)}):(g=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Rr){return h._source.hasTile(Rr)}))):g=[];var E=a.coveringZoomLevel(this._source),T=Math.max(E-u.maxOverzooming,this._source.minzoom),R=Math.max(E+u.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(g,E);if(Fr(this._source.type)){for(var ee={},ve={},_e=0,Ee=Object.keys(Z);_e<Ee.length;_e+=1){var We=Ee[_e],He=Z[We],lt=this._tiles[We];if(lt&&!(lt.fadeEndTime&&lt.fadeEndTime<=p.browser.now())){var Fe=this.findLoadedParent(He,T);Fe&&(this._addTile(Fe.tileID),ee[Fe.tileID.key]=Fe.tileID),ve[We]=He}}for(var st in this._retainLoadedChildren(ve,E,R,Z),ee)Z[st]||(this._coveredTiles[st]=!0,Z[st]=ee[st])}for(var bt in Z)this._tiles[bt].clearFadeHold();for(var Gt=0,ur=p.keysDifference(this._tiles,Z);Gt<ur.length;Gt+=1){var or=ur[Gt],lr=this._tiles[or];lr.hasSymbolBuckets&&!lr.holdingForFade()?lr.setHoldDuration(this.map._fadeDuration):lr.hasSymbolBuckets&&!lr.symbolFadeFinished()||this._removeTile(or)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},u.prototype._updateRetainedTiles=function(a,h){for(var g={},E={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),R=Math.max(h+u.maxUnderzooming,this._source.minzoom),Z={},ee=0,ve=a;ee<ve.length;ee+=1){var _e=ve[ee],Ee=this._addTile(_e);g[_e.key]=_e,Ee.hasData()||h<this._source.maxzoom&&(Z[_e.key]=_e)}this._retainLoadedChildren(Z,h,R,g);for(var We=0,He=a;We<He.length;We+=1){var lt=He[We],Fe=this._tiles[lt.key];if(!Fe.hasData()){if(h+1>this._source.maxzoom){var st=lt.children(this._source.maxzoom)[0],bt=this.getTile(st);if(bt&&bt.hasData()){g[st.key]=st;continue}}else{var Gt=lt.children(this._source.maxzoom);if(g[Gt[0].key]&&g[Gt[1].key]&&g[Gt[2].key]&&g[Gt[3].key])continue}for(var ur=Fe.wasRequested(),or=lt.overscaledZ-1;or>=T;--or){var lr=lt.scaledTo(or);if(E[lr.key]||(E[lr.key]=!0,!(Fe=this.getTile(lr))&&ur&&(Fe=this._addTile(lr)),Fe&&(g[lr.key]=lr,ur=Fe.wasRequested(),Fe.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,E=this._tiles[a].tileID;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){g=this._loadedParentTiles[E.key];break}h.push(E.key);var T=E.scaledTo(E.overscaledZ-1);if(g=this._getLoadedTile(T))break;E=T}for(var R=0,Z=h;R<Z.length;R+=1)this._loadedParentTiles[Z[R]]=g}},u.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var g=Boolean(h);return g||(h=new p.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(a,h){var g=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var E=h.getExpiryTimeout();E&&(this._timers[a]=setTimeout(function(){g._reloadTile(a,"expired"),delete g._timers[a]},E))},u.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},u.prototype.tilesIn=function(a,h,g){var E=this,T=[],R=this.transform;if(!R)return T;for(var Z=g?R.getCameraQueryGeometry(a):a,ee=a.map(function(or){return R.pointCoordinate(or)}),ve=Z.map(function(or){return R.pointCoordinate(or)}),_e=this.getIds(),Ee=1/0,We=1/0,He=-1/0,lt=-1/0,Fe=0,st=ve;Fe<st.length;Fe+=1){var bt=st[Fe];Ee=Math.min(Ee,bt.x),We=Math.min(We,bt.y),He=Math.max(He,bt.x),lt=Math.max(lt,bt.y)}for(var Gt=function(or){var lr=E._tiles[_e[or]];if(!lr.holdingForFade()){var Rr=lr.tileID,nn=Math.pow(2,R.zoom-lr.tileID.overscaledZ),Qr=h*lr.queryPadding*p.EXTENT/lr.tileSize/nn,yn=[Rr.getTilePoint(new p.MercatorCoordinate(Ee,We)),Rr.getTilePoint(new p.MercatorCoordinate(He,lt))];if(yn[0].x-Qr<p.EXTENT&&yn[0].y-Qr<p.EXTENT&&yn[1].x+Qr>=0&&yn[1].y+Qr>=0){var jn=ee.map(function(Hn){return Rr.getTilePoint(Hn)}),Xn=ve.map(function(Hn){return Rr.getTilePoint(Hn)});T.push({tile:lr,tileID:Rr,queryGeometry:jn,cameraQueryGeometry:Xn,scale:nn})}}},ur=0;ur<_e.length;ur++)Gt(ur);return T},u.prototype.getVisibleCoordinates=function(a){for(var h=this,g=this.getRenderableIds(a).map(function(Z){return h._tiles[Z].tileID}),E=0,T=g;E<T.length;E+=1){var R=T[E];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Fr(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(a,h,g){var E=this._tiles[a];E&&E.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(a,h){for(var g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(E){return!E.hasDependency(a,h)})},u}(p.Evented);function Ut(n,u){var a=Math.abs(2*n.wrap)-+(n.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return n.overscaledZ-u.overscaledZ||h-a||u.canonical.y-n.canonical.y||u.canonical.x-n.canonical.x}function Fr(n){return n==="raster"||n==="image"||n==="video"}function jr(){return new p.window.Worker(Ec.workerUrl)}Ke.maxOverzooming=10,Ke.maxUnderzooming=3;var Xt="mapboxgl_preloaded_worker_pool",mr=function(){this.active={}};mr.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<mr.workerCount;)this.workers.push(new jr);return this.active[n]=!0,this.workers.slice()},mr.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},mr.prototype.isPreloaded=function(){return!!this.active[Xt]},mr.prototype.numActive=function(){return Object.keys(this.active).length};var Hr,gn=Math.floor(p.browser.hardwareConcurrency/2);function gr(){return Hr||(Hr=new mr),Hr}function vn(n,u){var a={};for(var h in n)h!=="ref"&&(a[h]=n[h]);return p.refProperties.forEach(function(g){g in u&&(a[g]=u[g])}),a}function $r(n){n=n.slice();for(var u=Object.create(null),a=0;a<n.length;a++)u[n[a].id]=n[a];for(var h=0;h<n.length;h++)"ref"in n[h]&&(n[h]=vn(n[h],u[n[h].ref]));return n}mr.workerCount=Math.max(Math.min(gn,6),1);var cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function pi(n,u,a){a.push({command:cn.addSource,args:[n,u[n]]})}function fn(n,u,a){u.push({command:cn.removeSource,args:[n]}),a[n]=!0}function gi(n,u,a,h){fn(n,a,h),pi(n,u,a)}function Wi(n,u,a){var h;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;return!0}function vi(n,u,a,h,g,E){var T;for(T in u=u||{},n=n||{})n.hasOwnProperty(T)&&(p.deepEqual(n[T],u[T])||a.push({command:E,args:[h,T,u[T],g]}));for(T in u)u.hasOwnProperty(T)&&!n.hasOwnProperty(T)&&(p.deepEqual(n[T],u[T])||a.push({command:E,args:[h,T,u[T],g]}))}function Ri(n){return n.id}function Ii(n,u){return n[u.id]=u,n}var go=function(n,u){this.reset(n,u)};go.prototype.reset=function(n,u){this.points=n||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},go.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=p.clamp(n,0,1);for(var u=1,a=this._distances[u],h=n*this.paddedLength+this.padding;a<h&&u<this._distances.length;)a=this._distances[++u];var g=u-1,E=this._distances[g],T=a-E,R=T>0?(h-E)/T:0;return this.points[g].mult(1-R).add(this.points[u].mult(R))};var ji=function(n,u,a){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/a),this.yCellCount=Math.ceil(u/a);for(var E=0;E<this.xCellCount*this.yCellCount;E++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Rn(n,u,a,h,g){var E=p.create();return u?(p.scale(E,E,[1/g,1/g,1]),a||p.rotateZ(E,E,h.angle)):p.multiply(E,h.labelPlaneMatrix,n),E}function Dn(n,u,a,h,g){if(u){var E=p.clone(n);return p.scale(E,E,[g,g,1]),a||p.rotateZ(E,E,-h.angle),E}return h.glCoordMatrix}function ui(n,u){var a=[n.x,n.y,0,1];Ha(a,a,u);var h=a[3];return{point:new p.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function Vn(n,u){return .5+n/u*.5}function za(n,u){var a=n[0]/n[3],h=n[1]/n[3];return a>=-u[0]&&a<=u[0]&&h>=-u[1]&&h<=u[1]}function ds(n,u,a,h,g,E,T,R){var Z=h?n.textSizeData:n.iconSizeData,ee=p.evaluateSizeForZoom(Z,a.transform.zoom),ve=[256/a.width*2+1,256/a.height*2+1],_e=h?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;_e.clear();for(var Ee=n.lineVertexArray,We=h?n.text.placedSymbolArray:n.icon.placedSymbolArray,He=a.transform.width/a.transform.height,lt=!1,Fe=0;Fe<We.length;Fe++){var st=We.get(Fe);if(st.hidden||st.writingMode===p.WritingMode.vertical&&!lt)Ga(st.numGlyphs,_e);else{lt=!1;var bt=[st.anchorX,st.anchorY,0,1];if(p.transformMat4(bt,bt,u),za(bt,ve)){var Gt=Vn(a.transform.cameraToCenterDistance,bt[3]),ur=p.evaluateSizeForFeature(Z,ee,st),or=T?ur/Gt:ur*Gt,lr=new p.Point(st.anchorX,st.anchorY),Rr=ui(lr,g).point,nn={},Qr=Eu(st,or,!1,R,u,g,E,n.glyphOffsetArray,Ee,_e,Rr,lr,nn,He);lt=Qr.useVertical,(Qr.notEnoughRoom||lt||Qr.needsFlipping&&Eu(st,or,!0,R,u,g,E,n.glyphOffsetArray,Ee,_e,Rr,lr,nn,He).notEnoughRoom)&&Ga(st.numGlyphs,_e)}else Ga(st.numGlyphs,_e)}}h?n.text.dynamicLayoutVertexBuffer.updateData(_e):n.icon.dynamicLayoutVertexBuffer.updateData(_e)}function Di(n,u,a,h,g,E,T,R,Z,ee,ve){var _e=R.glyphStartIndex+R.numGlyphs,Ee=R.lineStartIndex,We=R.lineStartIndex+R.lineLength,He=u.getoffsetX(R.glyphStartIndex),lt=u.getoffsetX(_e-1),Fe=ya(n*He,a,h,g,E,T,R.segment,Ee,We,Z,ee,ve);if(!Fe)return null;var st=ya(n*lt,a,h,g,E,T,R.segment,Ee,We,Z,ee,ve);return st?{first:Fe,last:st}:null}function Na(n,u,a,h){return n===p.WritingMode.horizontal&&Math.abs(a.y-u.y)>Math.abs(a.x-u.x)*h?{useVertical:!0}:(n===p.WritingMode.vertical?u.y<a.y:u.x>a.x)?{needsFlipping:!0}:null}function Eu(n,u,a,h,g,E,T,R,Z,ee,ve,_e,Ee,We){var He,lt=u/24,Fe=n.lineOffsetX*lt,st=n.lineOffsetY*lt;if(n.numGlyphs>1){var bt=n.glyphStartIndex+n.numGlyphs,Gt=n.lineStartIndex,ur=n.lineStartIndex+n.lineLength,or=Di(lt,R,Fe,st,a,ve,_e,n,Z,E,Ee);if(!or)return{notEnoughRoom:!0};var lr=ui(or.first.point,T).point,Rr=ui(or.last.point,T).point;if(h&&!a){var nn=Na(n.writingMode,lr,Rr,We);if(nn)return nn}He=[or.first];for(var Qr=n.glyphStartIndex+1;Qr<bt-1;Qr++)He.push(ya(lt*R.getoffsetX(Qr),Fe,st,a,ve,_e,n.segment,Gt,ur,Z,E,Ee));He.push(or.last)}else{if(h&&!a){var yn=ui(_e,g).point,jn=n.lineStartIndex+n.segment+1,Xn=new p.Point(Z.getx(jn),Z.gety(jn)),Hn=ui(Xn,g),Ki=Hn.signedDistanceFromCamera>0?Hn.point:fu(_e,Xn,yn,1,g),bn=Na(n.writingMode,yn,Ki,We);if(bn)return bn}var ai=ya(lt*R.getoffsetX(n.glyphStartIndex),Fe,st,a,ve,_e,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,Z,E,Ee);if(!ai)return{notEnoughRoom:!0};He=[ai]}for(var _i=0,ii=He;_i<ii.length;_i+=1){var ri=ii[_i];p.addDynamicAttributes(ee,ri.point,ri.angle)}return{}}function fu(n,u,a,h,g){var E=ui(n.add(n.sub(u)._unit()),g).point,T=a.sub(E);return a.add(T._mult(h/T.mag()))}function ya(n,u,a,h,g,E,T,R,Z,ee,ve,_e){var Ee=h?n-u:n+u,We=Ee>0?1:-1,He=0;h&&(We*=-1,He=Math.PI),We<0&&(He+=Math.PI);for(var lt=We>0?R+T:R+T+1,Fe=g,st=g,bt=0,Gt=0,ur=Math.abs(Ee),or=[];bt+Gt<=ur;){if((lt+=We)<R||lt>=Z)return null;if(st=Fe,or.push(Fe),(Fe=_e[lt])===void 0){var lr=new p.Point(ee.getx(lt),ee.gety(lt)),Rr=ui(lr,ve);if(Rr.signedDistanceFromCamera>0)Fe=_e[lt]=Rr.point;else{var nn=lt-We;Fe=fu(bt===0?E:new p.Point(ee.getx(nn),ee.gety(nn)),lr,st,ur-bt+1,ve)}}bt+=Gt,Gt=st.dist(Fe)}var Qr=(ur-bt)/Gt,yn=Fe.sub(st),jn=yn.mult(Qr)._add(st);jn._add(yn._unit()._perp()._mult(a*We));var Xn=He+Math.atan2(Fe.y-st.y,Fe.x-st.x);return or.push(jn),{point:jn,angle:Xn,path:or}}ji.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ji.prototype.insert=function(n,u,a,h,g){this._forEachCell(u,a,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)},ji.prototype.insertCircle=function(n,u,a,h){this._forEachCell(u-h,a-h,u+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(a),this.circles.push(h)},ji.prototype._insertBoxCell=function(n,u,a,h,g,E){this.boxCells[g].push(E)},ji.prototype._insertCircleCell=function(n,u,a,h,g,E){this.circleCells[g].push(E)},ji.prototype._query=function(n,u,a,h,g,E){if(a<0||n>this.width||h<0||u>this.height)return!g&&[];var T=[];if(n<=0&&u<=0&&this.width<=a&&this.height<=h){if(g)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var ee=this.circles[3*Z],ve=this.circles[3*Z+1],_e=this.circles[3*Z+2];T.push({key:this.circleKeys[Z],x1:ee-_e,y1:ve-_e,x2:ee+_e,y2:ve+_e})}return E?T.filter(E):T}return this._forEachCell(n,u,a,h,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},E),g?T.length>0:T},ji.prototype._queryCircle=function(n,u,a,h,g){var E=n-a,T=n+a,R=u-a,Z=u+a;if(T<0||E>this.width||Z<0||R>this.height)return!h&&[];var ee=[];return this._forEachCell(E,R,T,Z,this._queryCellCircle,ee,{hitTest:h,circle:{x:n,y:u,radius:a},seenUids:{box:{},circle:{}}},g),h?ee.length>0:ee},ji.prototype.query=function(n,u,a,h,g){return this._query(n,u,a,h,!1,g)},ji.prototype.hitTest=function(n,u,a,h,g){return this._query(n,u,a,h,!0,g)},ji.prototype.hitTestCircle=function(n,u,a,h){return this._queryCircle(n,u,a,!0,h)},ji.prototype._queryCell=function(n,u,a,h,g,E,T,R){var Z=T.seenUids,ee=this.boxCells[g];if(ee!==null)for(var ve=this.bboxes,_e=0,Ee=ee;_e<Ee.length;_e+=1){var We=Ee[_e];if(!Z.box[We]){Z.box[We]=!0;var He=4*We;if(n<=ve[He+2]&&u<=ve[He+3]&&a>=ve[He+0]&&h>=ve[He+1]&&(!R||R(this.boxKeys[We]))){if(T.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[We],x1:ve[He],y1:ve[He+1],x2:ve[He+2],y2:ve[He+3]})}}}var lt=this.circleCells[g];if(lt!==null)for(var Fe=this.circles,st=0,bt=lt;st<bt.length;st+=1){var Gt=bt[st];if(!Z.circle[Gt]){Z.circle[Gt]=!0;var ur=3*Gt;if(this._circleAndRectCollide(Fe[ur],Fe[ur+1],Fe[ur+2],n,u,a,h)&&(!R||R(this.circleKeys[Gt]))){if(T.hitTest)return E.push(!0),!0;var or=Fe[ur],lr=Fe[ur+1],Rr=Fe[ur+2];E.push({key:this.circleKeys[Gt],x1:or-Rr,y1:lr-Rr,x2:or+Rr,y2:lr+Rr})}}}},ji.prototype._queryCellCircle=function(n,u,a,h,g,E,T,R){var Z=T.circle,ee=T.seenUids,ve=this.boxCells[g];if(ve!==null)for(var _e=this.bboxes,Ee=0,We=ve;Ee<We.length;Ee+=1){var He=We[Ee];if(!ee.box[He]){ee.box[He]=!0;var lt=4*He;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,_e[lt+0],_e[lt+1],_e[lt+2],_e[lt+3])&&(!R||R(this.boxKeys[He])))return E.push(!0),!0}}var Fe=this.circleCells[g];if(Fe!==null)for(var st=this.circles,bt=0,Gt=Fe;bt<Gt.length;bt+=1){var ur=Gt[bt];if(!ee.circle[ur]){ee.circle[ur]=!0;var or=3*ur;if(this._circlesCollide(st[or],st[or+1],st[or+2],Z.x,Z.y,Z.radius)&&(!R||R(this.circleKeys[ur])))return E.push(!0),!0}}},ji.prototype._forEachCell=function(n,u,a,h,g,E,T,R){for(var Z=this._convertToXCellCoord(n),ee=this._convertToYCellCoord(u),ve=this._convertToXCellCoord(a),_e=this._convertToYCellCoord(h),Ee=Z;Ee<=ve;Ee++)for(var We=ee;We<=_e;We++)if(g.call(this,n,u,a,h,this.xCellCount*We+Ee,E,T,R))return},ji.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},ji.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},ji.prototype._circlesCollide=function(n,u,a,h,g,E){var T=h-n,R=g-u,Z=a+E;return Z*Z>T*T+R*R},ji.prototype._circleAndRectCollide=function(n,u,a,h,g,E,T){var R=(E-h)/2,Z=Math.abs(n-(h+R));if(Z>R+a)return!1;var ee=(T-g)/2,ve=Math.abs(u-(g+ee));if(ve>ee+a)return!1;if(Z<=R||ve<=ee)return!0;var _e=Z-R,Ee=ve-ee;return _e*_e+Ee*Ee<=a*a};var lo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ga(n,u){for(var a=0;a<n;a++){var h=u.length;u.resize(h+4),u.float32.set(lo,3*h)}}function Ha(n,u,a){var h=u[0],g=u[1];return n[0]=a[0]*h+a[4]*g+a[12],n[1]=a[1]*h+a[5]*g+a[13],n[3]=a[3]*h+a[7]*g+a[15],n}var Xo=function(n,u,a){u===void 0&&(u=new ji(n.width+200,n.height+200,25)),a===void 0&&(a=new ji(n.width+200,n.height+200,25)),this.transform=n,this.grid=u,this.ignoredGrid=a,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function oa(n,u,a){return u*(p.EXTENT/(n.tileSize*Math.pow(2,a-n.tileID.overscaledZ)))}Xo.prototype.placeCollisionBox=function(n,u,a,h,g){var E=this.projectAndGetPerspectiveRatio(h,n.anchorPointX,n.anchorPointY),T=a*E.perspectiveRatio,R=n.x1*T+E.point.x,Z=n.y1*T+E.point.y,ee=n.x2*T+E.point.x,ve=n.y2*T+E.point.y;return!this.isInsideGrid(R,Z,ee,ve)||!u&&this.grid.hitTest(R,Z,ee,ve,g)?{box:[],offscreen:!1}:{box:[R,Z,ee,ve],offscreen:this.isOffscreen(R,Z,ee,ve)}},Xo.prototype.placeCollisionCircles=function(n,u,a,h,g,E,T,R,Z,ee,ve,_e,Ee){var We=[],He=new p.Point(u.anchorX,u.anchorY),lt=ui(He,E),Fe=Vn(this.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),st=(ee?g/Fe:g*Fe)/p.ONE_EM,bt=ui(He,T).point,Gt=Di(st,h,u.lineOffsetX*st,u.lineOffsetY*st,!1,bt,He,u,a,T,{}),ur=!1,or=!1,lr=!0;if(Gt){for(var Rr=.5*_e*Fe+Ee,nn=new p.Point(-100,-100),Qr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),yn=new go,jn=Gt.first,Xn=Gt.last,Hn=[],Ki=jn.path.length-1;Ki>=1;Ki--)Hn.push(jn.path[Ki]);for(var bn=1;bn<Xn.path.length;bn++)Hn.push(Xn.path[bn]);var ai=2.5*Rr;if(R){var _i=Hn.map(function(Hs){return ui(Hs,R)});Hn=_i.some(function(Hs){return Hs.signedDistanceFromCamera<=0})?[]:_i.map(function(Hs){return Hs.point})}var ii=[];if(Hn.length>0){for(var ri=Hn[0].clone(),xi=Hn[0].clone(),ei=1;ei<Hn.length;ei++)ri.x=Math.min(ri.x,Hn[ei].x),ri.y=Math.min(ri.y,Hn[ei].y),xi.x=Math.max(xi.x,Hn[ei].x),xi.y=Math.max(xi.y,Hn[ei].y);ii=ri.x>=nn.x&&xi.x<=Qr.x&&ri.y>=nn.y&&xi.y<=Qr.y?[Hn]:xi.x<nn.x||ri.x>Qr.x||xi.y<nn.y||ri.y>Qr.y?[]:p.clipLine([Hn],nn.x,nn.y,Qr.x,Qr.y)}for(var Qn=0,_o=ii;Qn<_o.length;Qn+=1){var Ka;yn.reset(_o[Qn],.25*Rr),Ka=yn.length<=.5*Rr?1:Math.ceil(yn.paddedLength/ai)+1;for(var as=0;as<Ka;as++){var No=as/Math.max(Ka-1,1),$a=yn.lerp(No),io=$a.x+100,gs=$a.y+100;We.push(io,gs,Rr,0);var Bo=io-Rr,Iu=gs-Rr,os=io+Rr,Gs=gs+Rr;if(lr=lr&&this.isOffscreen(Bo,Iu,os,Gs),or=or||this.isInsideGrid(Bo,Iu,os,Gs),!n&&this.grid.hitTestCircle(io,gs,Rr,ve)&&(ur=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:ur}}}}return{circles:!Z&&ur||!or?[]:We,offscreen:lr,collisionDetected:ur}},Xo.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],a=1/0,h=1/0,g=-1/0,E=-1/0,T=0,R=n;T<R.length;T+=1){var Z=R[T],ee=new p.Point(Z.x+100,Z.y+100);a=Math.min(a,ee.x),h=Math.min(h,ee.y),g=Math.max(g,ee.x),E=Math.max(E,ee.y),u.push(ee)}for(var ve={},_e={},Ee=0,We=this.grid.query(a,h,g,E).concat(this.ignoredGrid.query(a,h,g,E));Ee<We.length;Ee+=1){var He=We[Ee],lt=He.key;if(ve[lt.bucketInstanceId]===void 0&&(ve[lt.bucketInstanceId]={}),!ve[lt.bucketInstanceId][lt.featureIndex]){var Fe=[new p.Point(He.x1,He.y1),new p.Point(He.x2,He.y1),new p.Point(He.x2,He.y2),new p.Point(He.x1,He.y2)];p.polygonIntersectsPolygon(u,Fe)&&(ve[lt.bucketInstanceId][lt.featureIndex]=!0,_e[lt.bucketInstanceId]===void 0&&(_e[lt.bucketInstanceId]=[]),_e[lt.bucketInstanceId].push(lt.featureIndex))}}return _e},Xo.prototype.insertCollisionBox=function(n,u,a,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:g},n[0],n[1],n[2],n[3])},Xo.prototype.insertCollisionCircles=function(n,u,a,h,g){for(var E=u?this.ignoredGrid:this.grid,T={bucketInstanceId:a,featureIndex:h,collisionGroupID:g},R=0;R<n.length;R+=4)E.insertCircle(T,n[R],n[R+1],n[R+2])},Xo.prototype.projectAndGetPerspectiveRatio=function(n,u,a){var h=[u,a,0,1];return Ha(h,h,n),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Xo.prototype.isOffscreen=function(n,u,a,h){return a<100||n>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Xo.prototype.isInsideGrid=function(n,u,a,h){return a>=0&&n<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Xo.prototype.getViewportMatrix=function(){var n=p.identity([]);return p.translate(n,n,[-100,-100,0]),n};var Wa=function(n,u,a,h){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):h&&a?1:0,this.placed=a};Wa.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var wa=function(n,u,a,h,g){this.text=new Wa(n?n.text:null,u,a,g),this.icon=new Wa(n?n.icon:null,u,h,g)};wa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var _a=function(n,u,a){this.text=n,this.icon=u,this.skipFade=a},ra=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},sl=function(n,u,a,h,g){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=g},ts=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function to(n,u,a,h,g){var E=p.getAnchorAlignment(n),T=-(E.horizontalAlign-.5)*u,R=-(E.verticalAlign-.5)*a,Z=p.evaluateVariableOffset(n,h);return new p.Point(T+Z[0]*g,R+Z[1]*g)}function Oa(n,u,a,h,g,E){var T=n.x1,R=n.x2,Z=n.y1,ee=n.y2,ve=n.anchorPointX,_e=n.anchorPointY,Ee=new p.Point(u,a);return h&&Ee._rotate(g?E:-E),{x1:T+Ee.x,y1:Z+Ee.y,x2:R+Ee.x,y2:ee+Ee.y,anchorPointX:ve,anchorPointY:_e}}ts.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:function(a){return a.collisionGroupID===u}}}return this.collisionGroups[n]};var fa=function(n,u,a,h){this.transform=n.clone(),this.collisionIndex=new Xo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ts(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function he(n,u,a,h,g){n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0)}fa.prototype.getBucketParts=function(n,u,a,h){var g=a.getBucket(u),E=a.latestFeatureIndex;if(g&&E&&u.id===g.layerIds[0]){var T=a.collisionBoxArray,R=g.layers[0].layout,Z=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),ee=a.tileSize/p.EXTENT,ve=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),_e=R.get("text-pitch-alignment")==="map",Ee=R.get("text-rotation-alignment")==="map",We=oa(a,1,this.transform.zoom),He=Rn(ve,_e,Ee,this.transform,We),lt=null;if(_e){var Fe=Dn(ve,_e,Ee,this.transform,We);lt=p.multiply([],this.transform.labelPlaneMatrix,Fe)}this.retainedQueryData[g.bucketInstanceId]=new sl(g.bucketInstanceId,E,g.sourceLayerIndex,g.index,a.tileID);var st={bucket:g,layout:R,posMatrix:ve,textLabelPlaneMatrix:He,labelToScreenMatrix:lt,scale:Z,textPixelRatio:ee,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var bt=0,Gt=g.sortKeyRanges;bt<Gt.length;bt+=1){var ur=Gt[bt];n.push({sortKey:ur.sortKey,symbolInstanceStart:ur.symbolInstanceStart,symbolInstanceEnd:ur.symbolInstanceEnd,parameters:st})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:st})}},fa.prototype.attemptAnchorPlacement=function(n,u,a,h,g,E,T,R,Z,ee,ve,_e,Ee,We,He){var lt,Fe=[_e.textOffset0,_e.textOffset1],st=to(n,a,h,Fe,g),bt=this.collisionIndex.placeCollisionBox(Oa(u,st.x,st.y,E,T,this.transform.angle),ve,R,Z,ee.predicate);if(!He||this.collisionIndex.placeCollisionBox(Oa(He,st.x,st.y,E,T,this.transform.angle),ve,R,Z,ee.predicate).box.length!==0)return bt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(lt=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:Fe,width:a,height:h,anchor:n,textBoxScale:g,prevAnchor:lt},this.markUsedJustification(Ee,n,_e,We),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,We,_e),this.placedOrientations[_e.crossTileID]=We),{shift:st,placedGlyphBoxes:bt}):void 0},fa.prototype.placeLayerBucketPart=function(n,u,a){var h=this,g=n.parameters,E=g.bucket,T=g.layout,R=g.posMatrix,Z=g.textLabelPlaneMatrix,ee=g.labelToScreenMatrix,ve=g.textPixelRatio,_e=g.holdingForFade,Ee=g.collisionBoxArray,We=g.partiallyEvaluatedTextSize,He=g.collisionGroup,lt=T.get("text-optional"),Fe=T.get("icon-optional"),st=T.get("text-allow-overlap"),bt=T.get("icon-allow-overlap"),Gt=T.get("text-rotation-alignment")==="map",ur=T.get("text-pitch-alignment")==="map",or=T.get("icon-text-fit")!=="none",lr=T.get("symbol-z-order")==="viewport-y",Rr=st&&(bt||!E.hasIconData()||Fe),nn=bt&&(st||!E.hasTextData()||lt);!E.collisionArrays&&Ee&&E.deserializeCollisionBoxes(Ee);var Qr=function(bn,ai){if(!u[bn.crossTileID])if(_e)h.placements[bn.crossTileID]=new _a(!1,!1,!1);else{var _i,ii=!1,ri=!1,xi=!0,ei=null,Qn={box:null,offscreen:null},_o={box:null,offscreen:null},Ka=null,as=null,No=0,$a=0,io=0;ai.textFeatureIndex?No=ai.textFeatureIndex:bn.useRuntimeCollisionCircles&&(No=bn.featureIndex),ai.verticalTextFeatureIndex&&($a=ai.verticalTextFeatureIndex);var gs=ai.textBox;if(gs){var Bo=function($i){var Uo=p.WritingMode.horizontal;if(E.allowVerticalPlacement&&!$i&&h.prevPlacement){var xo=h.prevPlacement.placedOrientations[bn.crossTileID];xo&&(h.placedOrientations[bn.crossTileID]=xo,h.markUsedOrientation(E,Uo=xo,bn))}return Uo},Iu=function($i,Uo){if(E.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&ai.verticalTextBox)for(var xo=0,Lu=E.writingModes;xo<Lu.length&&(Lu[xo]===p.WritingMode.vertical?(Qn=Uo(),_o=Qn):Qn=$i(),!(Qn&&Qn.box&&Qn.box.length));xo+=1);else Qn=$i()};if(T.get("text-variable-anchor")){var os=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[bn.crossTileID]){var Gs=h.prevPlacement.variableOffsets[bn.crossTileID];os.indexOf(Gs.anchor)>0&&(os=os.filter(function($i){return $i!==Gs.anchor})).unshift(Gs.anchor)}var Hs=function($i,Uo,xo){for(var Lu=$i.x2-$i.x1,iu=$i.y2-$i.y1,_u=bn.textBoxScale,Gu=or&&!bt?Uo:null,Ru={box:[],offscreen:!1},Ws=st?2*os.length:os.length,au=0;au<Ws;++au){var Tl=h.attemptAnchorPlacement(os[au%os.length],$i,Lu,iu,_u,Gt,ur,ve,R,He,au>=os.length,bn,E,xo,Gu);if(Tl&&(Ru=Tl.placedGlyphBoxes)&&Ru.box&&Ru.box.length){ii=!0,ei=Tl.shift;break}}return Ru};Iu(function(){return Hs(gs,ai.iconBox,p.WritingMode.horizontal)},function(){var $i=ai.verticalTextBox;return E.allowVerticalPlacement&&!(Qn&&Qn.box&&Qn.box.length)&&bn.numVerticalGlyphVertices>0&&$i?Hs($i,ai.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Qn&&(ii=Qn.box,xi=Qn.offscreen);var Sl=Bo(Qn&&Qn.box);if(!ii&&h.prevPlacement){var El=h.prevPlacement.variableOffsets[bn.crossTileID];El&&(h.variableOffsets[bn.crossTileID]=El,h.markUsedJustification(E,El.anchor,bn,Sl))}}else{var zs=function($i,Uo){var xo=h.collisionIndex.placeCollisionBox($i,st,ve,R,He.predicate);return xo&&xo.box&&xo.box.length&&(h.markUsedOrientation(E,Uo,bn),h.placedOrientations[bn.crossTileID]=Uo),xo};Iu(function(){return zs(gs,p.WritingMode.horizontal)},function(){var $i=ai.verticalTextBox;return E.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&$i?zs($i,p.WritingMode.vertical):{box:null,offscreen:null}}),Bo(Qn&&Qn.box&&Qn.box.length)}}if(ii=(_i=Qn)&&_i.box&&_i.box.length>0,xi=_i&&_i.offscreen,bn.useRuntimeCollisionCircles){var Vu=E.text.placedSymbolArray.get(bn.centerJustifiedTextSymbolIndex),Bl=p.evaluateSizeForFeature(E.textSizeData,We,Vu),gu=T.get("text-padding");Ka=h.collisionIndex.placeCollisionCircles(st,Vu,E.lineVertexArray,E.glyphOffsetArray,Bl,R,Z,ee,a,ur,He.predicate,bn.collisionCircleDiameter,gu),ii=st||Ka.circles.length>0&&!Ka.collisionDetected,xi=xi&&Ka.offscreen}if(ai.iconFeatureIndex&&(io=ai.iconFeatureIndex),ai.iconBox){var wl=function($i){var Uo=or&&ei?Oa($i,ei.x,ei.y,Gt,ur,h.transform.angle):$i;return h.collisionIndex.placeCollisionBox(Uo,bt,ve,R,He.predicate)};ri=_o&&_o.box&&_o.box.length&&ai.verticalIconBox?(as=wl(ai.verticalIconBox)).box.length>0:(as=wl(ai.iconBox)).box.length>0,xi=xi&&as.offscreen}var nu=lt||bn.numHorizontalGlyphVertices===0&&bn.numVerticalGlyphVertices===0,ao=Fe||bn.numIconVertices===0;if(nu||ao?ao?nu||(ri=ri&&ii):ii=ri&&ii:ri=ii=ri&&ii,ii&&_i&&_i.box&&h.collisionIndex.insertCollisionBox(_i.box,T.get("text-ignore-placement"),E.bucketInstanceId,_o&&_o.box&&$a?$a:No,He.ID),ri&&as&&h.collisionIndex.insertCollisionBox(as.box,T.get("icon-ignore-placement"),E.bucketInstanceId,io,He.ID),Ka&&(ii&&h.collisionIndex.insertCollisionCircles(Ka.circles,T.get("text-ignore-placement"),E.bucketInstanceId,No,He.ID),a)){var Ou=E.bucketInstanceId,yu=h.collisionCircleArrays[Ou];yu===void 0&&(yu=h.collisionCircleArrays[Ou]=new ra);for(var As=0;As<Ka.circles.length;As+=4)yu.circles.push(Ka.circles[As+0]),yu.circles.push(Ka.circles[As+1]),yu.circles.push(Ka.circles[As+2]),yu.circles.push(Ka.collisionDetected?1:0)}h.placements[bn.crossTileID]=new _a(ii||Rr,ri||nn,xi||E.justReloaded),u[bn.crossTileID]=!0}};if(lr)for(var yn=E.getSortedSymbolIndexes(this.transform.angle),jn=yn.length-1;jn>=0;--jn){var Xn=yn[jn];Qr(E.symbolInstances.get(Xn),E.collisionArrays[Xn])}else for(var Hn=n.symbolInstanceStart;Hn<n.symbolInstanceEnd;Hn++)Qr(E.symbolInstances.get(Hn),E.collisionArrays[Hn]);if(a&&E.bucketInstanceId in this.collisionCircleArrays){var Ki=this.collisionCircleArrays[E.bucketInstanceId];p.invert(Ki.invProjMatrix,R),Ki.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1},fa.prototype.markUsedJustification=function(n,u,a,h){var g;g=h===p.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var E=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];E<T.length;E+=1){var R=T[E];R>=0&&(n.text.placedSymbolArray.get(R).crossTileID=g>=0&&R!==g?0:a.crossTileID)}},fa.prototype.markUsedOrientation=function(n,u,a){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,g=u===p.WritingMode.vertical?u:0,E=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];E<T.length;E+=1)n.text.placedSymbolArray.get(T[E]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=g)},fa.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(n):1,g=u?u.opacities:{},E=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var R in this.placements){var Z=this.placements[R],ee=g[R];ee?(this.opacities[R]=new wa(ee,h,Z.text,Z.icon),a=a||Z.text!==ee.text.placed||Z.icon!==ee.icon.placed):(this.opacities[R]=new wa(null,h,Z.text,Z.icon,Z.skipFade),a=a||Z.text||Z.icon)}for(var ve in g){var _e=g[ve];if(!this.opacities[ve]){var Ee=new wa(_e,h,!1,!1);Ee.isHidden()||(this.opacities[ve]=Ee,a=a||_e.text.placed||_e.icon.placed)}}for(var We in E)this.variableOffsets[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.variableOffsets[We]=E[We]);for(var He in T)this.placedOrientations[He]||!this.opacities[He]||this.opacities[He].isHidden()||(this.placedOrientations[He]=T[He]);a?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)},fa.prototype.updateLayerOpacities=function(n,u){for(var a={},h=0,g=u;h<g.length;h+=1){var E=g[h],T=E.getBucket(n);T&&E.latestFeatureIndex&&n.id===T.layerIds[0]&&this.updateBucketOpacities(T,a,E.collisionBoxArray)}},fa.prototype.updateBucketOpacities=function(n,u,a){var h=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var g=n.layers[0].layout,E=new wa(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),R=g.get("icon-allow-overlap"),Z=g.get("text-variable-anchor"),ee=g.get("text-rotation-alignment")==="map",ve=g.get("text-pitch-alignment")==="map",_e=g.get("icon-text-fit")!=="none",Ee=new wa(null,0,T&&(R||!n.hasIconData()||g.get("icon-optional")),R&&(T||!n.hasTextData()||g.get("text-optional")),!0);!n.collisionArrays&&a&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(a);for(var We=function(st,bt,Gt){for(var ur=0;ur<bt/4;ur++)st.opacityVertexArray.emplaceBack(Gt)},He=function(st){var bt=n.symbolInstances.get(st),Gt=bt.numHorizontalGlyphVertices,ur=bt.numVerticalGlyphVertices,or=bt.crossTileID,lr=h.opacities[or];u[or]?lr=E:lr||(h.opacities[or]=lr=Ee),u[or]=!0;var Rr=bt.numIconVertices>0,nn=h.placedOrientations[bt.crossTileID],Qr=nn===p.WritingMode.vertical,yn=nn===p.WritingMode.horizontal||nn===p.WritingMode.horizontalOnly;if(Gt>0||ur>0){var jn=Xa(lr.text);We(n.text,Gt,Qr?Ya:jn),We(n.text,ur,yn?Ya:jn);var Xn=lr.text.isHidden();[bt.rightJustifiedTextSymbolIndex,bt.centerJustifiedTextSymbolIndex,bt.leftJustifiedTextSymbolIndex].forEach(function(Qn){Qn>=0&&(n.text.placedSymbolArray.get(Qn).hidden=Xn||Qr?1:0)}),bt.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(bt.verticalPlacedTextSymbolIndex).hidden=Xn||yn?1:0);var Hn=h.variableOffsets[bt.crossTileID];Hn&&h.markUsedJustification(n,Hn.anchor,bt,nn);var Ki=h.placedOrientations[bt.crossTileID];Ki&&(h.markUsedJustification(n,"left",bt,Ki),h.markUsedOrientation(n,Ki,bt))}if(Rr){var bn=Xa(lr.icon),ai=!(_e&&bt.verticalPlacedIconSymbolIndex&&Qr);bt.placedIconSymbolIndex>=0&&(We(n.icon,bt.numIconVertices,ai?bn:Ya),n.icon.placedSymbolArray.get(bt.placedIconSymbolIndex).hidden=lr.icon.isHidden()),bt.verticalPlacedIconSymbolIndex>=0&&(We(n.icon,bt.numVerticalIconVertices,ai?Ya:bn),n.icon.placedSymbolArray.get(bt.verticalPlacedIconSymbolIndex).hidden=lr.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var _i=n.collisionArrays[st];if(_i){var ii=new p.Point(0,0);if(_i.textBox||_i.verticalTextBox){var ri=!0;if(Z){var xi=h.variableOffsets[or];xi?(ii=to(xi.anchor,xi.width,xi.height,xi.textOffset,xi.textBoxScale),ee&&ii._rotate(ve?h.transform.angle:-h.transform.angle)):ri=!1}_i.textBox&&he(n.textCollisionBox.collisionVertexArray,lr.text.placed,!ri||Qr,ii.x,ii.y),_i.verticalTextBox&&he(n.textCollisionBox.collisionVertexArray,lr.text.placed,!ri||yn,ii.x,ii.y)}var ei=Boolean(!yn&&_i.verticalIconBox);_i.iconBox&&he(n.iconCollisionBox.collisionVertexArray,lr.icon.placed,ei,_e?ii.x:0,_e?ii.y:0),_i.verticalIconBox&&he(n.iconCollisionBox.collisionVertexArray,lr.icon.placed,!ei,_e?ii.x:0,_e?ii.y:0)}}},lt=0;lt<n.symbolInstances.length;lt++)He(lt);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var Fe=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Fe.invProjMatrix,n.placementViewportMatrix=Fe.viewportMatrix,n.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},fa.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},fa.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},fa.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},fa.prototype.stillRecent=function(n,u){var a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>n},fa.prototype.setStale=function(){this.stale=!0};var Oe=Math.pow(2,25),gt=Math.pow(2,24),fr=Math.pow(2,17),tn=Math.pow(2,16),kn=Math.pow(2,9),Zi=Math.pow(2,8),Xi=Math.pow(2,1);function Xa(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var u=n.placed?1:0,a=Math.floor(127*n.opacity);return a*Oe+u*gt+a*fr+u*tn+a*kn+u*Zi+a*Xi+u}var Ya=0,Yo=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Yo.prototype.continuePlacement=function(n,u,a,h,g){for(var E=this._bucketParts;this._currentTileIndex<n.length;)if(u.getBucketParts(E,h,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<E.length;)if(u.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,g())return!0;return!1};var Ss=function(n,u,a,h,g,E,T){this.placement=new fa(n,g,E,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};Ss.prototype.isDone=function(){return this._done},Ss.prototype.continuePlacement=function(n,u,a){for(var h=this,g=p.browser.now(),E=function(){var Z=p.browser.now()-g;return!h._forceFullPlacement&&Z>2};this._currentPlacementIndex>=0;){var T=u[n[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Yo(T)),this._inProgressLayer.continuePlacement(a[T.source],this.placement,this._showCollisionBoxes,T,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ss.prototype.commit=function(n){return this.placement.commit(n),this.placement};var Hl=512/p.EXTENT/2,Xu=function(n,u,a){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<u.length;h++){var g=u.get(h),E=g.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}};Xu.prototype.getScaledCoordinates=function(n,u){var a=Hl/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+n.anchorX)*a),y:Math.floor((u.canonical.y*p.EXTENT+n.anchorY)*a)}},Xu.prototype.findMatches=function(n,u,a){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<n.length;g++){var E=n.get(g);if(!E.crossTileID){var T=this.indexedSymbolInstances[E.key];if(T)for(var R=this.getScaledCoordinates(E,u),Z=0,ee=T;Z<ee.length;Z+=1){var ve=ee[Z];if(Math.abs(ve.coord.x-R.x)<=h&&Math.abs(ve.coord.y-R.y)<=h&&!a[ve.crossTileID]){a[ve.crossTileID]=!0,E.crossTileID=ve.crossTileID;break}}}}};var ko=function(){this.maxCrossTileID=0};ko.prototype.generate=function(){return++this.maxCrossTileID};var Ls=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ls.prototype.handleWrapJump=function(n){var u=Math.round((n-this.lng)/360);if(u!==0)for(var a in this.indexes){var h=this.indexes[a],g={};for(var E in h){var T=h[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),g[T.tileID.key]=T}this.indexes[a]=g}this.lng=n},Ls.prototype.addBucket=function(n,u,a){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var g=this.usedCrossTileIDs[n.overscaledZ];for(var E in this.indexes){var T=this.indexes[E];if(Number(E)>n.overscaledZ)for(var R in T){var Z=T[R];Z.tileID.isChildOf(n)&&Z.findMatches(u.symbolInstances,n,g)}else{var ee=T[n.scaledTo(Number(E)).key];ee&&ee.findMatches(u.symbolInstances,n,g)}}for(var ve=0;ve<u.symbolInstances.length;ve++){var _e=u.symbolInstances.get(ve);_e.crossTileID||(_e.crossTileID=a.generate(),g[_e.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Xu(n,u.symbolInstances,u.bucketInstanceId),!0},Ls.prototype.removeBucketCrossTileIDs=function(n,u){for(var a in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[a];h<g.length;h+=1)delete this.usedCrossTileIDs[n][g[h].crossTileID]},Ls.prototype.removeStaleBuckets=function(n){var u=!1;for(var a in this.indexes){var h=this.indexes[a];for(var g in h)n[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[g]),delete h[g],u=!0)}return u};var co=function(){this.layerIndexes={},this.crossTileIDs=new ko,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};co.prototype.addLayer=function(n,u,a){var h=this.layerIndexes[n.id];h===void 0&&(h=this.layerIndexes[n.id]=new Ls);var g=!1,E={};h.handleWrapJump(a);for(var T=0,R=u;T<R.length;T+=1){var Z=R[T],ee=Z.getBucket(n);ee&&n.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(Z.tileID,ee,this.crossTileIDs)&&(g=!0),E[ee.bucketInstanceId]=!0)}return h.removeStaleBuckets(E)&&(g=!0),g},co.prototype.pruneUnusedLayers=function(n){var u={};for(var a in n.forEach(function(h){u[h]=!0}),this.layerIndexes)u[a]||delete this.layerIndexes[a]};var Rs=function(n,u){return p.emitValidationErrors(n,u&&u.filter(function(a){return a.identifier!=="source.canvas"}))},La=p.pick(cn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),li=p.pick(cn,["setCenter","setZoom","setBearing","setPitch"]),ul=function(){var n={},u=p.styleSpec.$version;for(var a in p.styleSpec.$root){var h,g=p.styleSpec.$root[a];g.required&&(h=a==="version"?u:g.type==="array"?[]:{})!=null&&(n[a]=h)}return n}(),xa=function(n){function u(a,h){var g=this;h===void 0&&(h={}),n.call(this),this.map=a,this.dispatcher=new re(gr(),this),this.imageManager=new Wt,this.imageManager.setEventedParent(this),this.glyphManager=new Ne(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new oe(256,512),this.crossTileSymbolIndex=new co,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var E=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){E.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,Z){if(p.triggerPluginCompletionEvent(R),Z&&Z.every(function(ve){return ve}))for(var ee in E.sourceCaches)E.sourceCaches[ee].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=g.sourceCaches[T.sourceId];if(R){var Z=R.getSource();if(Z&&Z.vectorLayerIds)for(var ee in g._layers){var ve=g._layers[ee];ve.source===Z.id&&g._validateLayer(ve)}}}})}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.loadURL=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var E=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var T=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(T,function(R,Z){g._request=null,R?g.fire(new p.ErrorEvent(R)):Z&&g._load(Z,E)})},u.prototype.loadJSON=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(a,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(ul,!1)},u.prototype._load=function(a,h){if(!h||!Rs(this,p.validateStyle(a))){for(var g in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(g,a.sources[g],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var E=$r(this.stylesheet.layers);this._order=E.map(function(ee){return ee.id}),this._layers={},this._serializedLayers={};for(var T=0,R=E;T<R.length;T+=1){var Z=R[T];(Z=p.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new pt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(g,E,T){var R,Z,ee,ve=p.browser.devicePixelRatio>1?"@2x":"",_e=p.getJSON(E.transformRequest(E.normalizeSpriteURL(g,ve,".json"),p.ResourceType.SpriteJSON),function(He,lt){_e=null,ee||(ee=He,R=lt,We())}),Ee=p.getImage(E.transformRequest(E.normalizeSpriteURL(g,ve,".png"),p.ResourceType.SpriteImage),function(He,lt){Ee=null,ee||(ee=He,Z=lt,We())});function We(){if(ee)T(ee);else if(R&&Z){var He=p.browser.getImageData(Z),lt={};for(var Fe in R){var st=R[Fe],bt=st.width,Gt=st.height,ur=st.x,or=st.y,lr=st.sdf,Rr=st.pixelRatio,nn=st.stretchX,Qr=st.stretchY,yn=st.content,jn=new p.RGBAImage({width:bt,height:Gt});p.RGBAImage.copy(He,jn,{x:ur,y:or},{x:0,y:0},{width:bt,height:Gt}),lt[Fe]={data:jn,pixelRatio:Rr,sdf:lr,stretchX:nn,stretchY:Qr,content:yn}}T(null,lt)}}return{cancel:function(){_e&&(_e.cancel(),_e=null),Ee&&(Ee.cancel(),Ee=null)}}}(a,this.map._requestManager,function(g,E){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(E)for(var T in E)h.imageManager.addImage(T,E[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var g=a.sourceLayer;if(g){var E=h.getSource();(E.type==="geojson"||E.vectorLayerIds&&E.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+E.id+'" as specified by style layer "'+a.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(a){for(var h=[],g=0,E=a;g<E.length;g+=1){var T=this._layers[E[g]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);for(var T in(g.length||E.length)&&this._updateWorkerLayers(g,E),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var ee={};for(var ve in this.sourceCaches){var _e=this.sourceCaches[ve];ee[ve]=_e.used,_e.used=!1}for(var Ee=0,We=this._order;Ee<We.length;Ee+=1){var He=this._layers[We[Ee]];He.recalculate(a,this._availableImages),!He.isHidden(a.zoom)&&He.source&&(this.sourceCaches[He.source].used=!0)}for(var lt in ee){var Fe=this.sourceCaches[lt];ee[lt]!==Fe.used&&Fe.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:lt}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},u.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(a){var h=this;if(this._checkLoaded(),Rs(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=$r(a.layers);var g=function(T,R){if(!T)return[{command:cn.setStyle,args:[R]}];var Z=[];try{if(!p.deepEqual(T.version,R.version))return[{command:cn.setStyle,args:[R]}];p.deepEqual(T.center,R.center)||Z.push({command:cn.setCenter,args:[R.center]}),p.deepEqual(T.zoom,R.zoom)||Z.push({command:cn.setZoom,args:[R.zoom]}),p.deepEqual(T.bearing,R.bearing)||Z.push({command:cn.setBearing,args:[R.bearing]}),p.deepEqual(T.pitch,R.pitch)||Z.push({command:cn.setPitch,args:[R.pitch]}),p.deepEqual(T.sprite,R.sprite)||Z.push({command:cn.setSprite,args:[R.sprite]}),p.deepEqual(T.glyphs,R.glyphs)||Z.push({command:cn.setGlyphs,args:[R.glyphs]}),p.deepEqual(T.transition,R.transition)||Z.push({command:cn.setTransition,args:[R.transition]}),p.deepEqual(T.light,R.light)||Z.push({command:cn.setLight,args:[R.light]});var ee={},ve=[];(function(Ee,We,He,lt){var Fe;for(Fe in We=We||{},Ee=Ee||{})Ee.hasOwnProperty(Fe)&&(We.hasOwnProperty(Fe)||fn(Fe,He,lt));for(Fe in We)We.hasOwnProperty(Fe)&&(Ee.hasOwnProperty(Fe)?p.deepEqual(Ee[Fe],We[Fe])||(Ee[Fe].type==="geojson"&&We[Fe].type==="geojson"&&Wi(Ee,We,Fe)?He.push({command:cn.setGeoJSONSourceData,args:[Fe,We[Fe].data]}):gi(Fe,We,He,lt)):pi(Fe,We,He))})(T.sources,R.sources,ve,ee);var _e=[];T.layers&&T.layers.forEach(function(Ee){ee[Ee.source]?Z.push({command:cn.removeLayer,args:[Ee.id]}):_e.push(Ee)}),Z=Z.concat(ve),function(Ee,We,He){We=We||[];var lt,Fe,st,bt,Gt,ur,or,lr=(Ee=Ee||[]).map(Ri),Rr=We.map(Ri),nn=Ee.reduce(Ii,{}),Qr=We.reduce(Ii,{}),yn=lr.slice(),jn=Object.create(null);for(lt=0,Fe=0;lt<lr.length;lt++)Qr.hasOwnProperty(st=lr[lt])?Fe++:(He.push({command:cn.removeLayer,args:[st]}),yn.splice(yn.indexOf(st,Fe),1));for(lt=0,Fe=0;lt<Rr.length;lt++)yn[yn.length-1-lt]!==(st=Rr[Rr.length-1-lt])&&(nn.hasOwnProperty(st)?(He.push({command:cn.removeLayer,args:[st]}),yn.splice(yn.lastIndexOf(st,yn.length-Fe),1)):Fe++,He.push({command:cn.addLayer,args:[Qr[st],ur=yn[yn.length-lt]]}),yn.splice(yn.length-lt,0,st),jn[st]=!0);for(lt=0;lt<Rr.length;lt++)if(bt=nn[st=Rr[lt]],Gt=Qr[st],!jn[st]&&!p.deepEqual(bt,Gt))if(p.deepEqual(bt.source,Gt.source)&&p.deepEqual(bt["source-layer"],Gt["source-layer"])&&p.deepEqual(bt.type,Gt.type)){for(or in vi(bt.layout,Gt.layout,He,st,null,cn.setLayoutProperty),vi(bt.paint,Gt.paint,He,st,null,cn.setPaintProperty),p.deepEqual(bt.filter,Gt.filter)||He.push({command:cn.setFilter,args:[st,Gt.filter]}),p.deepEqual(bt.minzoom,Gt.minzoom)&&p.deepEqual(bt.maxzoom,Gt.maxzoom)||He.push({command:cn.setLayerZoomRange,args:[st,Gt.minzoom,Gt.maxzoom]}),bt)bt.hasOwnProperty(or)&&or!=="layout"&&or!=="paint"&&or!=="filter"&&or!=="metadata"&&or!=="minzoom"&&or!=="maxzoom"&&(or.indexOf("paint.")===0?vi(bt[or],Gt[or],He,st,or.slice(6),cn.setPaintProperty):p.deepEqual(bt[or],Gt[or])||He.push({command:cn.setLayerProperty,args:[st,or,Gt[or]]}));for(or in Gt)Gt.hasOwnProperty(or)&&!bt.hasOwnProperty(or)&&or!=="layout"&&or!=="paint"&&or!=="filter"&&or!=="metadata"&&or!=="minzoom"&&or!=="maxzoom"&&(or.indexOf("paint.")===0?vi(bt[or],Gt[or],He,st,or.slice(6),cn.setPaintProperty):p.deepEqual(bt[or],Gt[or])||He.push({command:cn.setLayerProperty,args:[st,or,Gt[or]]}))}else He.push({command:cn.removeLayer,args:[st]}),ur=yn[yn.lastIndexOf(st)+1],He.push({command:cn.addLayer,args:[Gt,ur]})}(_e,R.layers,Z)}catch(Ee){console.warn("Unable to compute style diff:",Ee),Z=[{command:cn.setStyle,args:[R]}]}return Z}(this.serialize(),a).filter(function(T){return!(T.command in li)});if(g.length===0)return!1;var E=g.filter(function(T){return!(T.command in La)});if(E.length>0)throw new Error("Unimplemented: "+E.map(function(T){return T.command}).join(", ")+".");return g.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=a,!0},u.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},u.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},u.prototype.getImage=function(a){return this.imageManager.getImage(a)},u.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},u.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(a,h,g){var E=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+a,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[a]=new Ke(a,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:E.loaded(),source:T.serialize(),sourceId:a}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new p.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},u.prototype.addLayer=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var E=a.id;if(this.getLayer(E))this.fire(new p.ErrorEvent(new Error('Layer with id "'+E+'" already exists on this map')));else{var T;if(a.type==="custom"){if(Rs(this,p.validateCustomStyleLayer(a)))return;T=p.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(E,a.source),a=p.clone$1(a),a=p.extend(a,{source:E})),this._validate(p.validateStyle.layer,"layers."+E,a,{arrayIndex:-1},g))return;T=p.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[T.id]=T.serialize()}var R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(R,0,E),this._layerOrderChanged=!0,this._layers[E]=T,this._removedLayers[E]&&T.source&&T.type!=="custom"){var Z=this._removedLayers[E];delete this._removedLayers[E],Z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var g=this._order.indexOf(a);this._order.splice(g,1);var E=h?this._order.indexOf(h):this._order.length;h&&E===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(E,0,a),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(a){return this._layers[a]},u.prototype.hasLayer=function(a){return a in this._layers},u.prototype.setLayerZoomRange=function(a,h,g){this._checkLoaded();var E=this.getLayer(a);E?E.minzoom===h&&E.maxzoom===g||(h!=null&&(E.minzoom=h),g!=null&&(E.maxzoom=g),this._updateLayer(E)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var E=this.getLayer(a);if(E){if(!p.deepEqual(E.filter,h))return h==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(p.validateStyle.filter,"layers."+E.id+".filter",h,null,g)||(E.filter=p.clone$1(h),this._updateLayer(E)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(a){return p.clone$1(this.getLayer(a).filter)},u.prototype.setLayoutProperty=function(a,h,g,E){E===void 0&&(E={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getLayoutProperty(h),g)||(T.setLayoutProperty(h,g,E),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(a,h){var g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(a,h,g,E){E===void 0&&(E={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getPaintProperty(h),g)||(T.setPaintProperty(h,g,E)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},u.prototype.setFeatureState=function(a,h){this._checkLoaded();var g=a.source,E=a.sourceLayer,T=this.sourceCaches[g];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&E?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||E?(a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(E,a.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(a,h){this._checkLoaded();var g=a.source,E=this.sourceCaches[g];if(E!==void 0){var T=E.getSource().type,R=T==="vector"?a.sourceLayer:void 0;T!=="vector"||R?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):E.removeFeatureState(R,a.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,g=a.sourceLayer,E=this.sourceCaches[h];if(E!==void 0){if(E.getSource().type!=="vector"||g)return a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),E.getFeatureState(g,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},u.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,g=function(nn){return h._layers[nn].type==="fill-extrusion"},E={},T=[],R=this._order.length-1;R>=0;R--){var Z=this._order[R];if(g(Z)){E[Z]=R;for(var ee=0,ve=a;ee<ve.length;ee+=1){var _e=ve[ee][Z];if(_e)for(var Ee=0,We=_e;Ee<We.length;Ee+=1)T.push(We[Ee])}}}T.sort(function(nn,Qr){return Qr.intersectionZ-nn.intersectionZ});for(var He=[],lt=this._order.length-1;lt>=0;lt--){var Fe=this._order[lt];if(g(Fe))for(var st=T.length-1;st>=0;st--){var bt=T[st].feature;if(E[bt.layer.id]<lt)break;He.push(bt),T.pop()}else for(var Gt=0,ur=a;Gt<ur.length;Gt+=1){var or=ur[Gt][Fe];if(or)for(var lr=0,Rr=or;lr<Rr.length;lr+=1)He.push(Rr[lr].feature)}}return He},u.prototype.queryRenderedFeatures=function(a,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var E={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=h.layers;T<R.length;T+=1){var Z=R[T],ee=this._layers[Z];if(!ee)return this.fire(new p.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];E[ee.source]=!0}}var ve=[];for(var _e in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!E[_e]||ve.push(_r(this.sourceCaches[_e],this._layers,this._serializedLayers,a,h,g));return this.placement&&ve.push(function(Ee,We,He,lt,Fe,st,bt){for(var Gt={},ur=st.queryRenderedSymbols(lt),or=[],lr=0,Rr=Object.keys(ur).map(Number);lr<Rr.length;lr+=1)or.push(bt[Rr[lr]]);or.sort(Yr);for(var nn=function(){var Hn=yn[Qr],Ki=Hn.featureIndex.lookupSymbolFeatures(ur[Hn.bucketInstanceId],We,Hn.bucketIndex,Hn.sourceLayerIndex,Fe.filter,Fe.layers,Fe.availableImages,Ee);for(var bn in Ki){var ai=Gt[bn]=Gt[bn]||[],_i=Ki[bn];_i.sort(function(xi,ei){var Qn=Hn.featureSortOrder;if(Qn){var _o=Qn.indexOf(xi.featureIndex);return Qn.indexOf(ei.featureIndex)-_o}return ei.featureIndex-xi.featureIndex});for(var ii=0,ri=_i;ii<ri.length;ii+=1)ai.push(ri[ii])}},Qr=0,yn=or;Qr<yn.length;Qr+=1)nn();var jn=function(Hn){Gt[Hn].forEach(function(Ki){var bn=Ki.feature,ai=He[Ee[Hn].source].getFeatureState(bn.layer["source-layer"],bn.id);bn.source=bn.layer.source,bn.layer["source-layer"]&&(bn.sourceLayer=bn.layer["source-layer"]),bn.state=ai})};for(var Xn in Gt)jn(Xn);return Gt}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ve)},u.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[a];return g?function(E,T){for(var R=E.getRenderableIds().map(function(We){return E.getTileByID(We)}),Z=[],ee={},ve=0;ve<R.length;ve++){var _e=R[ve],Ee=_e.tileID.canonical.key;ee[Ee]||(ee[Ee]=!0,_e.querySourceFeatures(Z,T))}return Z}(g,h):[]},u.prototype.addSourceType=function(a,h,g){return u.getSourceType(a)?g(new Error('A source type called "'+a+'" already exists.')):(u.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),E=!1;for(var T in a)if(!p.deepEqual(a[T],g[T])){E=!0;break}if(E){var R={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(R)}},u.prototype._validate=function(a,h,g,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Rs(this,a.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},E)))},u.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},u.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},u.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},u.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},u.prototype._updatePlacement=function(a,h,g,E,T){T===void 0&&(T=!1);for(var R=!1,Z=!1,ee={},ve=0,_e=this._order;ve<_e.length;ve+=1){var Ee=this._layers[_e[ve]];if(Ee.type==="symbol"){if(!ee[Ee.source]){var We=this.sourceCaches[Ee.source];ee[Ee.source]=We.getRenderableIds(!0).map(function(bt){return We.getTileByID(bt)}).sort(function(bt,Gt){return Gt.tileID.overscaledZ-bt.tileID.overscaledZ||(bt.tileID.isLessThan(Gt.tileID)?-1:1)})}var He=this.crossTileSymbolIndex.addLayer(Ee,ee[Ee.source],a.center.lng);R=R||He}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),a.zoom))&&(this.pauseablePlacement=new Ss(a,this._order,T,h,g,E,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ee),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),Z=!0),R&&this.pauseablePlacement.placement.setStale()),Z||R)for(var lt=0,Fe=this._order;lt<Fe.length;lt+=1){var st=this._layers[Fe[lt]];st.type==="symbol"&&this.placement.updateLayerOpacities(st,ee[st.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},u.prototype.getImages=function(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var E=this.sourceCaches[h.source];E&&E.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(a,h,g){return p.makeRequest(h,g)},u}(p.Evented);xa.getSourceType=function(n){return Pt[n]},xa.setSourceType=function(n,u){Pt[n]=u},xa.registerForPluginStateChange=p.registerForPluginStateChange;var Nn=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ys=Ta(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Wl=Ta(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),fo=Ta(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ze=Ta(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Ot=Ta("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),br=Ta(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),On=Ta(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Hi=Ta("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ba=Ta("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Za=Ta("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),na=Ta(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Ra=Ta(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Fo=Ta(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Mo=Ta(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),yi=Ta(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Yu=Ta(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hu=Ta(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ko=Ta(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ll=Ta(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Eo=Ta(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Es=Ta(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Io=Ta(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),pu=Ta(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ds=Ta(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),lc=Ta(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),qc=Ta(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ta(n,u){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=E?E.concat(g):g,R={};return{fragmentSource:n=n.replace(a,function(Z,ee,ve,_e,Ee){return R[Ee]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
varying `+ve+" "+_e+" "+Ee+`;
#else
uniform `+ve+" "+_e+" u_"+Ee+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`}),vertexSource:u=u.replace(a,function(Z,ee,ve,_e,Ee){var We=_e==="float"?"vec2":"vec4",He=Ee.match(/color/)?"color":We;return R[Ee]?ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ve+" "+We+" a_"+Ee+`;
varying `+ve+" "+_e+" "+Ee+`;
#else
uniform `+ve+" "+_e+" u_"+Ee+`;
#endif
`:He==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = a_"+Ee+`;
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = unpack_mix_"+He+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ve+" "+We+" a_"+Ee+`;
#else
uniform `+ve+" "+_e+" u_"+Ee+`;
#endif
`:He==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+_e+" "+Ee+" = a_"+Ee+`;
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ve+" "+_e+" "+Ee+" = unpack_mix_"+He+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ve+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var bf=Object.freeze({__proto__:null,prelude:Ys,background:Wl,backgroundPattern:fo,circle:Ze,clippingMask:Ot,heatmap:br,heatmapTexture:On,collisionBox:Hi,collisionCircle:ba,debug:Za,fill:na,fillOutline:Ra,fillOutlinePattern:Fo,fillPattern:Mo,fillExtrusion:yi,fillExtrusionPattern:Yu,hillshadePrepare:hu,hillshade:Ko,line:ll,lineGradient:Eo,linePattern:Es,lineSDF:Io,raster:pu,symbolIcon:Ds,symbolSDF:lc,symbolTextAndIcon:qc}),ku=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Cl(n){for(var u=[],a=0;a<n.length;a++)if(n[a]!==null){var h=n[a].split(" ");u.push(h.pop())}return u}ku.prototype.bind=function(n,u,a,h,g,E,T,R){this.context=n;for(var Z=this.boundPaintVertexBuffers.length!==h.length,ee=0;!Z&&ee<h.length;ee++)this.boundPaintVertexBuffers[ee]!==h[ee]&&(Z=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===a&&!Z&&this.boundIndexBuffer===g&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(n.bindVertexArrayOES.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),R&&R.bind()):this.freshBind(u,a,h,g,E,T,R)},ku.prototype.freshBind=function(n,u,a,h,g,E,T){var R,Z=n.numAttributes,ee=this.context,ve=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=T;else{R=ee.currentNumAttributes||0;for(var _e=Z;_e<R;_e++)ve.disableVertexAttribArray(_e)}u.enableAttributes(ve,n);for(var Ee=0,We=a;Ee<We.length;Ee+=1)We[Ee].enableAttributes(ve,n);E&&E.enableAttributes(ve,n),T&&T.enableAttributes(ve,n),u.bind(),u.setVertexAttribPointers(ve,n,g);for(var He=0,lt=a;He<lt.length;He+=1){var Fe=lt[He];Fe.bind(),Fe.setVertexAttribPointers(ve,n,g)}E&&(E.bind(),E.setVertexAttribPointers(ve,n,g)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(ve,n,g)),ee.currentNumAttributes=Z},ku.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Lc=function(n,u,a,h,g,E){var T=n.gl;this.program=T.createProgram();for(var R=Cl(a.staticAttributes),Z=h?h.getBinderAttributes():[],ee=R.concat(Z),ve=a.staticUniforms?Cl(a.staticUniforms):[],_e=h?h.getBinderUniforms():[],Ee=[],We=0,He=ve.concat(_e);We<He.length;We+=1){var lt=He[We];Ee.indexOf(lt)<0&&Ee.push(lt)}var Fe=h?h.defines():[];E&&Fe.push("#define OVERDRAW_INSPECTOR;");var st=Fe.concat(Ys.fragmentSource,a.fragmentSource).join(`
`),bt=Fe.concat(Ys.vertexSource,a.vertexSource).join(`
`),Gt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Gt,st),T.compileShader(Gt),T.attachShader(this.program,Gt);var ur=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ur,bt),T.compileShader(ur),T.attachShader(this.program,ur),this.attributes={};var or={};this.numAttributes=ee.length;for(var lr=0;lr<this.numAttributes;lr++)ee[lr]&&(T.bindAttribLocation(this.program,lr,ee[lr]),this.attributes[ee[lr]]=lr);T.linkProgram(this.program),T.deleteShader(ur),T.deleteShader(Gt);for(var Rr=0;Rr<Ee.length;Rr++){var nn=Ee[Rr];if(nn&&!or[nn]){var Qr=T.getUniformLocation(this.program,nn);Qr&&(or[nn]=Qr)}}this.fixedUniforms=g(n,or),this.binderUniforms=h?h.getUniforms(n,or):[]}}};function cc(n,u,a){var h=1/oa(a,1,u.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),E=a.tileSize*Math.pow(2,u.transform.tileZoom)/g,T=E*(a.tileID.canonical.x+a.tileID.wrap*g),R=E*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}Lc.prototype.draw=function(n,u,a,h,g,E,T,R,Z,ee,ve,_e,Ee,We,He,lt){var Fe,st=n.gl;if(!this.failedToCreate){for(var bt in n.program.set(this.program),n.setDepthMode(a),n.setStencilMode(h),n.setColorMode(g),n.setCullFace(E),this.fixedUniforms)this.fixedUniforms[bt].set(T[bt]);We&&We.setUniforms(n,this.binderUniforms,_e,{zoom:Ee});for(var Gt=(Fe={},Fe[st.LINES]=2,Fe[st.TRIANGLES]=3,Fe[st.LINE_STRIP]=1,Fe)[u],ur=0,or=ve.get();ur<or.length;ur+=1){var lr=or[ur],Rr=lr.vaos||(lr.vaos={});(Rr[R]||(Rr[R]=new ku)).bind(n,this,Z,We?We.getPaintVertexBuffers():[],ee,lr.vertexOffset,He,lt),st.drawElements(u,lr.primitiveLength*Gt,st.UNSIGNED_SHORT,lr.primitiveOffset*Gt*2)}}};var ro=function(n,u,a,h){var g=u.style.light,E=g.properties.get("position"),T=[E.x,E.y,E.z],R=p.create$1();g.properties.get("anchor")==="viewport"&&p.fromRotation(R,-u.transform.angle),p.transformMat3(T,T,R);var Z=g.properties.get("color");return{u_matrix:n,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+a,u_opacity:h}},cl=function(n,u,a,h,g,E,T){return p.extend(ro(n,u,a,h),cc(E,u,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8})},fl=function(n){return{u_matrix:n}},rs=function(n,u,a,h){return p.extend(fl(n),cc(a,u,h))},fc=function(n,u){return{u_matrix:n,u_world:u}},Ku=function(n,u,a,h,g){return p.extend(rs(n,u,a,h),{u_world:g})},Ks=function(n,u,a,h){var g,E,T=n.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var R=oa(a,1,T.zoom);g=!0,E=[R,R]}else g=!1,E=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(u.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:E}},$o=function(n,u,a){var h=oa(a,1,u.zoom),g=Math.pow(2,u.zoom-a.tileID.overscaledZ),E=a.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:E}},Rc=function(n,u,a){return{u_matrix:n,u_inv_matrix:u,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},wu=function(n,u,a){return a===void 0&&(a=1),{u_matrix:n,u_color:u,u_overlay:0,u_overlay_scale:a}},$u=function(n){return{u_matrix:n}},Df=function(n,u,a,h){return{u_matrix:n,u_extrude_scale:oa(u,1,a),u_intensity:h}},hl=function(n,u,a){var h=n.transform;return{u_matrix:$s(n,u,a),u_ratio:1/oa(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Sa=function(n,u,a,h){return p.extend(hl(n,u,a),{u_image:0,u_image_height:h})},Ju=function(n,u,a,h){var g=n.transform,E=Yl(u,g);return{u_matrix:$s(n,u,a),u_texsize:u.imageAtlasTexture.size,u_ratio:1/oa(u,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[E,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Xl=function(n,u,a,h,g){var E=n.lineAtlas,T=Yl(u,n.transform),R=a.layout.get("line-cap")==="round",Z=E.getDash(h.from,R),ee=E.getDash(h.to,R),ve=Z.width*g.fromScale,_e=ee.width*g.toScale;return p.extend(hl(n,u,a),{u_patternscale_a:[T/ve,-Z.height/2],u_patternscale_b:[T/_e,-ee.height/2],u_sdfgamma:E.width/(256*Math.min(ve,_e)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:ee.y,u_mix:g.t})};function Yl(n,u){return 1/oa(n,1,u.tileZoom)}function $s(n,u,a){return n.translatePosMatrix(u.tileID.posMatrix,u,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var Dc=function(n,u,a,h,g){return{u_matrix:n,u_tl_parent:u,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(E=g.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Kl(g.paint.get("raster-hue-rotate"))};var E,T};function Kl(n){n*=Math.PI/180;var u=Math.sin(n),a=Math.cos(n);return[(2*a+1)/3,(-Math.sqrt(3)*u-a+1)/3,(Math.sqrt(3)*u-a+1)/3]}var $l,Qu=function(n,u,a,h,g,E,T,R,Z,ee){var ve=g.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:ve.cameraToCenterDistance,u_pitch:ve.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:ve.width/ve.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+Z,u_pitch_with_map:+h,u_texsize:ee,u_texture:0}},Tu=function(n,u,a,h,g,E,T,R,Z,ee,ve){var _e=g.transform;return p.extend(Qu(n,u,a,h,g,E,T,R,Z,ee),{u_gamma_scale:h?Math.cos(_e._pitch)*_e.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+ve})},Pl=function(n,u,a,h,g,E,T,R,Z,ee){return p.extend(Tu(n,u,a,h,g,E,T,R,!0,Z,!0),{u_texsize_icon:ee,u_texture_icon:1})},Ml=function(n,u,a){return{u_matrix:n,u_opacity:u,u_color:a}},pl=function(n,u,a,h,g,E){return p.extend(function(T,R,Z,ee){var ve=Z.imageManager.getPattern(T.from.toString()),_e=Z.imageManager.getPattern(T.to.toString()),Ee=Z.imageManager.getPixelSize(),We=Ee.width,He=Ee.height,lt=Math.pow(2,ee.tileID.overscaledZ),Fe=ee.tileSize*Math.pow(2,Z.transform.tileZoom)/lt,st=Fe*(ee.tileID.canonical.x+ee.tileID.wrap*lt),bt=Fe*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ve.tl,u_pattern_br_a:ve.br,u_pattern_tl_b:_e.tl,u_pattern_br_b:_e.br,u_texsize:[We,He],u_mix:R.t,u_pattern_size_a:ve.displaySize,u_pattern_size_b:_e.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/oa(ee,1,Z.transform.tileZoom),u_pixel_coord_upper:[st>>16,bt>>16],u_pixel_coord_lower:[65535&st,65535&bt]}}(h,E,a,g),{u_matrix:n,u_opacity:u})},kc={fillExtrusion:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fillExtrusionPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(n,u.u_height_factor),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fill:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},fillPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},fillOutline:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world)}},fillOutlinePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},circle:function(n,u){return{u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(n,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},collisionBox:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(n,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(n,u.u_overscale_factor)}},collisionCircle:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(n,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(n,u.u_viewport_size)}},debug:function(n,u){return{u_color:new p.UniformColor(n,u.u_color),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_overlay:new p.Uniform1i(n,u.u_overlay),u_overlay_scale:new p.Uniform1f(n,u.u_overlay_scale)}},clippingMask:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmap:function(n,u){return{u_extrude_scale:new p.Uniform1f(n,u.u_extrude_scale),u_intensity:new p.Uniform1f(n,u.u_intensity),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmapTexture:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_color_ramp:new p.Uniform1i(n,u.u_color_ramp),u_opacity:new p.Uniform1f(n,u.u_opacity)}},hillshade:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_latrange:new p.Uniform2f(n,u.u_latrange),u_light:new p.Uniform2f(n,u.u_light),u_shadow:new p.UniformColor(n,u.u_shadow),u_highlight:new p.UniformColor(n,u.u_highlight),u_accent:new p.UniformColor(n,u.u_accent)}},hillshadePrepare:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_dimension:new p.Uniform2f(n,u.u_dimension),u_zoom:new p.Uniform1f(n,u.u_zoom),u_unpack:new p.Uniform4f(n,u.u_unpack)}},line:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels)}},lineGradient:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_image:new p.Uniform1i(n,u.u_image),u_image_height:new p.Uniform1f(n,u.u_image_height)}},linePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_texsize:new p.Uniform2f(n,u.u_texsize),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_image:new p.Uniform1i(n,u.u_image),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},lineSDF:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(n,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(n,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(n,u.u_sdfgamma),u_image:new p.Uniform1i(n,u.u_image),u_tex_y_a:new p.Uniform1f(n,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(n,u.u_tex_y_b),u_mix:new p.Uniform1f(n,u.u_mix)}},raster:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_tl_parent:new p.Uniform2f(n,u.u_tl_parent),u_scale_parent:new p.Uniform1f(n,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(n,u.u_buffer_scale),u_fade_t:new p.Uniform1f(n,u.u_fade_t),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image0:new p.Uniform1i(n,u.u_image0),u_image1:new p.Uniform1i(n,u.u_image1),u_brightness_low:new p.Uniform1f(n,u.u_brightness_low),u_brightness_high:new p.Uniform1f(n,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(n,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(n,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(n,u.u_spin_weights)}},symbolIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture)}},symbolSDF:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},symbolTextAndIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texsize_icon:new p.Uniform2f(n,u.u_texsize_icon),u_texture:new p.Uniform1i(n,u.u_texture),u_texture_icon:new p.Uniform1i(n,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},background:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_color:new p.UniformColor(n,u.u_color)}},backgroundPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image:new p.Uniform1i(n,u.u_image),u_pattern_tl_a:new p.Uniform2f(n,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(n,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(n,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(n,u.u_pattern_br_b),u_texsize:new p.Uniform2f(n,u.u_texsize),u_mix:new p.Uniform1f(n,u.u_mix),u_pattern_size_a:new p.Uniform2f(n,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(n,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(n,u.u_scale_a),u_scale_b:new p.Uniform1f(n,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(n,u.u_tile_units_to_pixels)}}};function dl(n,u,a,h,g,E,T){for(var R=n.context,Z=R.gl,ee=n.useProgram("collisionBox"),ve=[],_e=0,Ee=0,We=0;We<h.length;We++){var He=h[We],lt=u.getTile(He),Fe=lt.getBucket(a);if(Fe){var st=He.posMatrix;g[0]===0&&g[1]===0||(st=n.translatePosMatrix(He.posMatrix,lt,g,E));var bt=T?Fe.textCollisionBox:Fe.iconCollisionBox,Gt=Fe.collisionCircleArray;if(Gt.length>0){var ur=p.create(),or=st;p.mul(ur,Fe.placementInvProjMatrix,n.transform.glCoordMatrix),p.mul(ur,ur,Fe.placementViewportMatrix),ve.push({circleArray:Gt,circleOffset:Ee,transform:or,invTransform:ur}),Ee=_e+=Gt.length/4}bt&&ee.draw(R,Z.LINES,we.disabled,je.disabled,n.colorModeForRenderPass(),xt.disabled,$o(st,n.transform,lt),a.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,n.transform.zoom,null,null,bt.collisionVertexBuffer)}}if(T&&ve.length){var lr=n.useProgram("collisionCircle"),Rr=new p.StructArrayLayout2f1f2i16;Rr.resize(4*_e),Rr._trim();for(var nn=0,Qr=0,yn=ve;Qr<yn.length;Qr+=1)for(var jn=yn[Qr],Xn=0;Xn<jn.circleArray.length/4;Xn++){var Hn=4*Xn,Ki=jn.circleArray[Hn+0],bn=jn.circleArray[Hn+1],ai=jn.circleArray[Hn+2],_i=jn.circleArray[Hn+3];Rr.emplace(nn++,Ki,bn,ai,_i,0),Rr.emplace(nn++,Ki,bn,ai,_i,1),Rr.emplace(nn++,Ki,bn,ai,_i,2),Rr.emplace(nn++,Ki,bn,ai,_i,3)}(!$l||$l.length<2*_e)&&($l=function(Ka){var as=2*Ka,No=new p.StructArrayLayout3ui6;No.resize(as),No._trim();for(var $a=0;$a<as;$a++){var io=6*$a;No.uint16[io+0]=4*$a+0,No.uint16[io+1]=4*$a+1,No.uint16[io+2]=4*$a+2,No.uint16[io+3]=4*$a+2,No.uint16[io+4]=4*$a+3,No.uint16[io+5]=4*$a+0}return No}(_e));for(var ii=R.createIndexBuffer($l,!0),ri=R.createVertexBuffer(Rr,p.collisionCircleLayout.members,!0),xi=0,ei=ve;xi<ei.length;xi+=1){var Qn=ei[xi],_o=Rc(Qn.transform,Qn.invTransform,n.transform);lr.draw(R,Z.TRIANGLES,we.disabled,je.disabled,n.colorModeForRenderPass(),xt.disabled,_o,a.id,ri,ii,p.SegmentVector.simpleSegment(0,2*Qn.circleOffset,Qn.circleArray.length,Qn.circleArray.length/2),null,n.transform.zoom,null,null,null)}ri.destroy(),ii.destroy()}}var Js=p.identity(new Float32Array(16));function Il(n,u,a,h,g,E){var T=p.getAnchorAlignment(n),R=-(T.horizontalAlign-.5)*u,Z=-(T.verticalAlign-.5)*a,ee=p.evaluateVariableOffset(n,h);return new p.Point((R/g+ee[0])*E,(Z/g+ee[1])*E)}function ef(n,u,a,h,g,E,T,R,Z,ee,ve){var _e=n.text.placedSymbolArray,Ee=n.text.dynamicLayoutVertexArray,We=n.icon.dynamicLayoutVertexArray,He={};Ee.clear();for(var lt=0;lt<_e.length;lt++){var Fe=_e.get(lt),st=Fe.hidden||!Fe.crossTileID||n.allowVerticalPlacement&&!Fe.placedOrientation?null:h[Fe.crossTileID];if(st){var bt=new p.Point(Fe.anchorX,Fe.anchorY),Gt=ui(bt,a?R:T),ur=Vn(E.cameraToCenterDistance,Gt.signedDistanceFromCamera),or=g.evaluateSizeForFeature(n.textSizeData,ee,Fe)*ur/p.ONE_EM;a&&(or*=n.tilePixelRatio/Z);for(var lr=Il(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale,or),Rr=a?ui(bt.add(lr),T).point:Gt.point.add(u?lr.rotate(-E.angle):lr),nn=n.allowVerticalPlacement&&Fe.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Qr=0;Qr<Fe.numGlyphs;Qr++)p.addDynamicAttributes(Ee,Rr,nn);ve&&Fe.associatedIconIndex>=0&&(He[Fe.associatedIconIndex]={shiftedAnchor:Rr,angle:nn})}else Ga(Fe.numGlyphs,Ee)}if(ve){We.clear();for(var yn=n.icon.placedSymbolArray,jn=0;jn<yn.length;jn++){var Xn=yn.get(jn);if(Xn.hidden)Ga(Xn.numGlyphs,We);else{var Hn=He[jn];if(Hn)for(var Ki=0;Ki<Xn.numGlyphs;Ki++)p.addDynamicAttributes(We,Hn.shiftedAnchor,Hn.angle);else Ga(Xn.numGlyphs,We)}}n.icon.dynamicLayoutVertexBuffer.updateData(We)}n.text.dynamicLayoutVertexBuffer.updateData(Ee)}function tf(n,u,a){return a.iconsInText&&u?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function pa(n,u,a,h,g,E,T,R,Z,ee,ve,_e){for(var Ee=n.context,We=Ee.gl,He=n.transform,lt=R==="map",Fe=Z==="map",st=lt&&a.layout.get("symbol-placement")!=="point",bt=lt&&!Fe&&!st,Gt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,ur=!1,or=n.depthModeForSublayer(0,we.ReadOnly),lr=a.layout.get("text-variable-anchor"),Rr=[],nn=0,Qr=h;nn<Qr.length;nn+=1){var yn=Qr[nn],jn=u.getTile(yn),Xn=jn.getBucket(a);if(Xn){var Hn=g?Xn.text:Xn.icon;if(Hn&&Hn.segments.get().length){var Ki=Hn.programConfigurations.get(a.id),bn=g||Xn.sdfIcons,ai=g?Xn.textSizeData:Xn.iconSizeData,_i=Fe||He.pitch!==0,ii=n.useProgram(tf(bn,g,Xn),Ki),ri=p.evaluateSizeForZoom(ai,He.zoom),xi=void 0,ei=[0,0],Qn=void 0,_o=void 0,Ka=null,as=void 0;if(g)Qn=jn.glyphAtlasTexture,_o=We.LINEAR,xi=jn.glyphAtlasTexture.size,Xn.iconsInText&&(ei=jn.imageAtlasTexture.size,Ka=jn.imageAtlasTexture,as=_i||n.options.rotating||n.options.zooming||ai.kind==="composite"||ai.kind==="camera"?We.LINEAR:We.NEAREST);else{var No=a.layout.get("icon-size").constantOr(0)!==1||Xn.iconsNeedLinear;Qn=jn.imageAtlasTexture,_o=bn||n.options.rotating||n.options.zooming||No||_i?We.LINEAR:We.NEAREST,xi=jn.imageAtlasTexture.size}var $a=oa(jn,1,n.transform.zoom),io=Rn(yn.posMatrix,Fe,lt,n.transform,$a),gs=Dn(yn.posMatrix,Fe,lt,n.transform,$a),Bo=lr&&Xn.hasTextData(),Iu=a.layout.get("icon-text-fit")!=="none"&&Bo&&Xn.hasIconData();st&&ds(Xn,yn.posMatrix,n,g,io,gs,Fe,ee);var os=n.translatePosMatrix(yn.posMatrix,jn,E,T),Gs=st||g&&lr||Iu?Js:io,Hs=n.translatePosMatrix(gs,jn,E,T,!0),Sl=bn&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,El={program:ii,buffers:Hn,uniformValues:bn?Xn.iconsInText?Pl(ai.kind,ri,bt,Fe,n,os,Gs,Hs,xi,ei):Tu(ai.kind,ri,bt,Fe,n,os,Gs,Hs,g,xi,!0):Qu(ai.kind,ri,bt,Fe,n,os,Gs,Hs,g,xi),atlasTexture:Qn,atlasTextureIcon:Ka,atlasInterpolation:_o,atlasInterpolationIcon:as,isSDF:bn,hasHalo:Sl};if(Gt&&Xn.canOverlap){ur=!0;for(var zs=0,Vu=Hn.segments.get();zs<Vu.length;zs+=1){var Bl=Vu[zs];Rr.push({segments:new p.SegmentVector([Bl]),sortKey:Bl.sortKey,state:El})}}else Rr.push({segments:Hn.segments,sortKey:0,state:El})}}}ur&&Rr.sort(function(yu,As){return yu.sortKey-As.sortKey});for(var gu=0,wl=Rr;gu<wl.length;gu+=1){var nu=wl[gu],ao=nu.state;if(Ee.activeTexture.set(We.TEXTURE0),ao.atlasTexture.bind(ao.atlasInterpolation,We.CLAMP_TO_EDGE),ao.atlasTextureIcon&&(Ee.activeTexture.set(We.TEXTURE1),ao.atlasTextureIcon&&ao.atlasTextureIcon.bind(ao.atlasInterpolationIcon,We.CLAMP_TO_EDGE)),ao.isSDF){var Ou=ao.uniformValues;ao.hasHalo&&(Ou.u_is_halo=1,Jl(ao.buffers,nu.segments,a,n,ao.program,or,ve,_e,Ou)),Ou.u_is_halo=0}Jl(ao.buffers,nu.segments,a,n,ao.program,or,ve,_e,ao.uniformValues)}}function Jl(n,u,a,h,g,E,T,R,Z){var ee=h.context;g.draw(ee,ee.gl.TRIANGLES,E,T,R,xt.disabled,Z,a.id,n.layoutVertexBuffer,n.indexBuffer,u,a.paint,h.transform.zoom,n.programConfigurations.get(a.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function hc(n,u,a,h,g,E,T){var R,Z,ee,ve,_e,Ee=n.context.gl,We=a.paint.get("fill-pattern"),He=We&&We.constantOr(1),lt=a.getCrossfadeParameters();T?(Z=He&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=Ee.LINES):(Z=He?"fillPattern":"fill",R=Ee.TRIANGLES);for(var Fe=0,st=h;Fe<st.length;Fe+=1){var bt=st[Fe],Gt=u.getTile(bt);if(!He||Gt.patternsLoaded()){var ur=Gt.getBucket(a);if(ur){var or=ur.programConfigurations.get(a.id),lr=n.useProgram(Z,or);He&&(n.context.activeTexture.set(Ee.TEXTURE0),Gt.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),or.updatePaintBuffers(lt));var Rr=We.constantOr(null);if(Rr&&Gt.imageAtlas){var nn=Gt.imageAtlas,Qr=nn.patternPositions[Rr.to.toString()],yn=nn.patternPositions[Rr.from.toString()];Qr&&yn&&or.setConstantPatternPositions(Qr,yn)}var jn=n.translatePosMatrix(bt.posMatrix,Gt,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(T){ve=ur.indexBuffer2,_e=ur.segments2;var Xn=[Ee.drawingBufferWidth,Ee.drawingBufferHeight];ee=Z==="fillOutlinePattern"&&He?Ku(jn,n,lt,Gt,Xn):fc(jn,Xn)}else ve=ur.indexBuffer,_e=ur.segments,ee=He?rs(jn,n,lt,Gt):fl(jn);lr.draw(n.context,R,g,n.stencilModeForClipping(bt),E,xt.disabled,ee,a.id,ur.layoutVertexBuffer,ve,_e,a.paint,n.transform.zoom,or)}}}}function qu(n,u,a,h,g,E,T){for(var R=n.context,Z=R.gl,ee=a.paint.get("fill-extrusion-pattern"),ve=ee.constantOr(1),_e=a.getCrossfadeParameters(),Ee=a.paint.get("fill-extrusion-opacity"),We=0,He=h;We<He.length;We+=1){var lt=He[We],Fe=u.getTile(lt),st=Fe.getBucket(a);if(st){var bt=st.programConfigurations.get(a.id),Gt=n.useProgram(ve?"fillExtrusionPattern":"fillExtrusion",bt);ve&&(n.context.activeTexture.set(Z.TEXTURE0),Fe.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),bt.updatePaintBuffers(_e));var ur=ee.constantOr(null);if(ur&&Fe.imageAtlas){var or=Fe.imageAtlas,lr=or.patternPositions[ur.to.toString()],Rr=or.patternPositions[ur.from.toString()];lr&&Rr&&bt.setConstantPatternPositions(lr,Rr)}var nn=n.translatePosMatrix(lt.posMatrix,Fe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Qr=a.paint.get("fill-extrusion-vertical-gradient"),yn=ve?cl(nn,n,Qr,Ee,lt,_e,Fe):ro(nn,n,Qr,Ee);Gt.draw(R,R.gl.TRIANGLES,g,E,T,xt.backCCW,yn,a.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,a.paint,n.transform.zoom,bt)}}}function Ol(n,u,a,h,g,E){var T=n.context,R=T.gl,Z=u.fbo;if(Z){var ee=n.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,Z.colorAttachment.get());var ve=function(_e,Ee,We){var He=We.paint.get("hillshade-shadow-color"),lt=We.paint.get("hillshade-highlight-color"),Fe=We.paint.get("hillshade-accent-color"),st=We.paint.get("hillshade-illumination-direction")*(Math.PI/180);We.paint.get("hillshade-illumination-anchor")==="viewport"&&(st-=_e.transform.angle);var bt,Gt,ur,or=!_e.options.moving;return{u_matrix:_e.transform.calculatePosMatrix(Ee.tileID.toUnwrapped(),or),u_image:0,u_latrange:(bt=Ee.tileID,Gt=Math.pow(2,bt.canonical.z),ur=bt.canonical.y,[new p.MercatorCoordinate(0,ur/Gt).toLngLat().lat,new p.MercatorCoordinate(0,(ur+1)/Gt).toLngLat().lat]),u_light:[We.paint.get("hillshade-exaggeration"),st],u_shadow:He,u_highlight:lt,u_accent:Fe}}(n,u,a);ee.draw(T,R.TRIANGLES,h,g,E,xt.disabled,ve,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function pc(n,u,a,h,g,E){var T=n.context,R=T.gl,Z=u.dem;if(Z&&Z.data){var ee=Z.dim,ve=Z.stride,_e=Z.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||n.getTileTexture(ve),u.demTexture){var Ee=u.demTexture;Ee.update(_e,{premultiply:!1}),Ee.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(T,_e,R.RGBA,{premultiply:!1}),u.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var We=u.fbo;if(!We){var He=new p.Texture(T,{width:ee,height:ee,data:null},R.RGBA);He.bind(R.LINEAR,R.CLAMP_TO_EDGE),(We=u.fbo=T.createFramebuffer(ee,ee,!0)).colorAttachment.set(He.texture)}T.bindFramebuffer.set(We.framebuffer),T.viewport.set([0,0,ee,ee]),n.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,h,g,E,xt.disabled,function(lt,Fe){var st=Fe.stride,bt=p.create();return p.ortho(bt,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(bt,bt,[0,-p.EXTENT,0]),{u_matrix:bt,u_image:1,u_dimension:[st,st],u_zoom:lt.overscaledZ,u_unpack:Fe.getUnpackVector()}}(u.tileID,Z),a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Fu(n,u,a,h,g){var E=h.paint.get("raster-fade-duration");if(E>0){var T=p.browser.now(),R=(T-n.timeAdded)/E,Z=u?(T-u.timeAdded)/E:-1,ee=a.getSource(),ve=g.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),_e=!u||Math.abs(u.tileID.overscaledZ-ve)>Math.abs(n.tileID.overscaledZ-ve),Ee=_e&&n.refreshedUponExpiration?1:p.clamp(_e?R:1-Z,0,1);return n.refreshedUponExpiration&&R>=1&&(n.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Ee}:{opacity:Ee,mix:0}}return{opacity:1,mix:0}}var Fc=new p.Color(1,0,0,1),rf=new p.Color(0,1,0,1),nf=new p.Color(0,0,1,1),Ll=new p.Color(1,0,1,1),zc=new p.Color(0,1,1,1);function Nc(n,u,a,h){vl(n,0,u+a/2,n.transform.width,a,h)}function Bc(n,u,a,h){vl(n,u-a/2,0,a,n.transform.height,h)}function vl(n,u,a,h,g,E){var T=n.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(u*p.browser.devicePixelRatio,a*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),T.clear({color:E}),R.disable(R.SCISSOR_TEST)}function Uc(n,u,a){var h=n.context,g=h.gl,E=a.posMatrix,T=n.useProgram("debug"),R=we.disabled,Z=je.disabled,ee=n.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),n.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.draw(h,g.LINE_STRIP,R,Z,ee,xt.disabled,wu(E,p.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var ve=u.getTileByID(a.key).latestRawTileData,_e=Math.floor((ve&&ve.byteLength||0)/1024),Ee=u.getTile(a).tileSize,We=512/Math.min(Ee,512)*(a.overscaledZ/n.transform.zoom)*.5,He=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(He+=" => "+a.overscaledZ),function(lt,Fe){lt.initDebugOverlayCanvas();var st=lt.debugOverlayCanvas,bt=lt.context.gl,Gt=lt.debugOverlayCanvas.getContext("2d");Gt.clearRect(0,0,st.width,st.height),Gt.shadowColor="white",Gt.shadowBlur=2,Gt.lineWidth=1.5,Gt.strokeStyle="white",Gt.textBaseline="top",Gt.font="bold 36px Open Sans, sans-serif",Gt.fillText(Fe,5,5),Gt.strokeText(Fe,5,5),lt.debugOverlayTexture.update(st),lt.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(n,He+" "+_e+"kb"),T.draw(h,g.TRIANGLES,R,Z,ht.alphaBlended,xt.disabled,wu(E,p.Color.transparent,We),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var zu={symbol:function(n,u,a,h,g){if(n.renderPass==="translucent"){var E=je.disabled,T=n.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(R,Z,ee,ve,_e,Ee,We){for(var He=Z.transform,lt=_e==="map",Fe=Ee==="map",st=0,bt=R;st<bt.length;st+=1){var Gt=bt[st],ur=ve.getTile(Gt),or=ur.getBucket(ee);if(or&&or.text&&or.text.segments.get().length){var lr=p.evaluateSizeForZoom(or.textSizeData,He.zoom),Rr=oa(ur,1,Z.transform.zoom),nn=Rn(Gt.posMatrix,Fe,lt,Z.transform,Rr),Qr=ee.layout.get("icon-text-fit")!=="none"&&or.hasIconData();if(lr){var yn=Math.pow(2,He.zoom-ur.tileID.overscaledZ);ef(or,lt,Fe,We,p.symbolSize,He,nn,Gt.posMatrix,yn,lr,Qr)}}}}(h,n,a,u,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&pa(n,u,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),E,T),a.paint.get("text-opacity").constantOr(1)!==0&&pa(n,u,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),E,T),u.map.showCollisionBoxes&&(dl(n,u,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),dl(n,u,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("circle-opacity"),E=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||E.constantOr(1)!==0&&T.constantOr(1)!==0){for(var Z=n.context,ee=Z.gl,ve=n.depthModeForSublayer(0,we.ReadOnly),_e=je.disabled,Ee=n.colorModeForRenderPass(),We=[],He=0;He<h.length;He++){var lt=h[He],Fe=u.getTile(lt),st=Fe.getBucket(a);if(st){var bt=st.programConfigurations.get(a.id),Gt={programConfiguration:bt,program:n.useProgram("circle",bt),layoutVertexBuffer:st.layoutVertexBuffer,indexBuffer:st.indexBuffer,uniformValues:Ks(n,lt,Fe,a)};if(R)for(var ur=0,or=st.segments.get();ur<or.length;ur+=1){var lr=or[ur];We.push({segments:new p.SegmentVector([lr]),sortKey:lr.sortKey,state:Gt})}else We.push({segments:st.segments,sortKey:0,state:Gt})}}R&&We.sort(function(jn,Xn){return jn.sortKey-Xn.sortKey});for(var Rr=0,nn=We;Rr<nn.length;Rr+=1){var Qr=nn[Rr],yn=Qr.state;yn.program.draw(Z,ee.TRIANGLES,ve,_e,Ee,xt.disabled,yn.uniformValues,a.id,yn.layoutVertexBuffer,yn.indexBuffer,Qr.segments,a.paint,n.transform.zoom,yn.programConfiguration)}}}},heatmap:function(n,u,a,h){if(a.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var g=n.context,E=g.gl,T=je.disabled,R=new ht([E.ONE,E.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(We,He,lt){var Fe=We.gl;We.activeTexture.set(Fe.TEXTURE1),We.viewport.set([0,0,He.width/4,He.height/4]);var st=lt.heatmapFbo;if(st)Fe.bindTexture(Fe.TEXTURE_2D,st.colorAttachment.get()),We.bindFramebuffer.set(st.framebuffer);else{var bt=Fe.createTexture();Fe.bindTexture(Fe.TEXTURE_2D,bt),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR),st=lt.heatmapFbo=We.createFramebuffer(He.width/4,He.height/4,!1),function(Gt,ur,or,lr){var Rr=Gt.gl;Rr.texImage2D(Rr.TEXTURE_2D,0,Rr.RGBA,ur.width/4,ur.height/4,0,Rr.RGBA,Gt.extRenderToTextureHalfFloat?Gt.extTextureHalfFloat.HALF_FLOAT_OES:Rr.UNSIGNED_BYTE,null),lr.colorAttachment.set(or)}(We,He,bt,st)}})(g,n,a),g.clear({color:p.Color.transparent});for(var Z=0;Z<h.length;Z++){var ee=h[Z];if(!u.hasRenderableParent(ee)){var ve=u.getTile(ee),_e=ve.getBucket(a);if(_e){var Ee=_e.programConfigurations.get(a.id);n.useProgram("heatmap",Ee).draw(g,E.TRIANGLES,we.disabled,T,R,xt.disabled,Df(ee.posMatrix,ve,n.transform.zoom,a.paint.get("heatmap-intensity")),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,a.paint,n.transform.zoom,Ee)}}}g.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(We,He){var lt=We.context,Fe=lt.gl,st=He.heatmapFbo;if(st){lt.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,st.colorAttachment.get()),lt.activeTexture.set(Fe.TEXTURE1);var bt=He.colorRampTexture;bt||(bt=He.colorRampTexture=new p.Texture(lt,He.colorRamp,Fe.RGBA)),bt.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),We.useProgram("heatmapTexture").draw(lt,Fe.TRIANGLES,we.disabled,je.disabled,We.colorModeForRenderPass(),xt.disabled,function(Gt,ur,or,lr){var Rr=p.create();p.ortho(Rr,0,Gt.width,Gt.height,0,0,1);var nn=Gt.context.gl;return{u_matrix:Rr,u_world:[nn.drawingBufferWidth,nn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ur.paint.get("heatmap-opacity")}}(We,He),He.id,We.viewportBuffer,We.quadTriangleIndexBuffer,We.viewportSegments,He.paint,We.transform.zoom)}}(n,a))},line:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("line-opacity"),E=a.paint.get("line-width");if(g.constantOr(1)!==0&&E.constantOr(1)!==0)for(var T=n.depthModeForSublayer(0,we.ReadOnly),R=n.colorModeForRenderPass(),Z=a.paint.get("line-dasharray"),ee=a.paint.get("line-pattern"),ve=ee.constantOr(1),_e=a.paint.get("line-gradient"),Ee=a.getCrossfadeParameters(),We=ve?"linePattern":Z?"lineSDF":_e?"lineGradient":"line",He=n.context,lt=He.gl,Fe=!0,st=0,bt=h;st<bt.length;st+=1){var Gt=bt[st],ur=u.getTile(Gt);if(!ve||ur.patternsLoaded()){var or=ur.getBucket(a);if(or){var lr=or.programConfigurations.get(a.id),Rr=n.context.program.get(),nn=n.useProgram(We,lr),Qr=Fe||nn.program!==Rr,yn=ee.constantOr(null);if(yn&&ur.imageAtlas){var jn=ur.imageAtlas,Xn=jn.patternPositions[yn.to.toString()],Hn=jn.patternPositions[yn.from.toString()];Xn&&Hn&&lr.setConstantPatternPositions(Xn,Hn)}var Ki=ve?Ju(n,ur,a,Ee):Z?Xl(n,ur,a,Z,Ee):_e?Sa(n,ur,a,or.lineClipsArray.length):hl(n,ur,a);if(ve)He.activeTexture.set(lt.TEXTURE0),ur.imageAtlasTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),lr.updatePaintBuffers(Ee);else if(Z&&(Qr||n.lineAtlas.dirty))He.activeTexture.set(lt.TEXTURE0),n.lineAtlas.bind(He);else if(_e){var bn=or.gradients[a.id],ai=bn.texture;if(a.gradientVersion!==bn.version){var _i=256;if(a.stepInterpolant){var ii=u.getSource().maxzoom,ri=Gt.canonical.z===ii?Math.ceil(1<<n.transform.maxZoom-Gt.canonical.z):1;_i=p.clamp(p.nextPowerOfTwo(or.maxLineLength/p.EXTENT*1024*ri),256,He.maxTextureSize)}bn.gradient=p.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:_i,image:bn.gradient||void 0,clips:or.lineClipsArray}),bn.texture?bn.texture.update(bn.gradient):bn.texture=new p.Texture(He,bn.gradient,lt.RGBA),bn.version=a.gradientVersion,ai=bn.texture}He.activeTexture.set(lt.TEXTURE0),ai.bind(a.stepInterpolant?lt.NEAREST:lt.LINEAR,lt.CLAMP_TO_EDGE)}nn.draw(He,lt.TRIANGLES,T,n.stencilModeForClipping(Gt),R,xt.disabled,Ki,a.id,or.layoutVertexBuffer,or.indexBuffer,or.segments,a.paint,n.transform.zoom,lr,or.layoutVertexBuffer2),Fe=!1}}}}},fill:function(n,u,a,h){var g=a.paint.get("fill-color"),E=a.paint.get("fill-opacity");if(E.constantOr(1)!==0){var T=n.colorModeForRenderPass(),R=a.paint.get("fill-pattern"),Z=n.opaquePassEnabledForLayer()&&!R.constantOr(1)&&g.constantOr(p.Color.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===Z){var ee=n.depthModeForSublayer(1,n.renderPass==="opaque"?we.ReadWrite:we.ReadOnly);hc(n,u,a,h,ee,T,!1)}if(n.renderPass==="translucent"&&a.paint.get("fill-antialias")){var ve=n.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,we.ReadOnly);hc(n,u,a,h,ve,T,!0)}}},"fill-extrusion":function(n,u,a,h){var g=a.paint.get("fill-extrusion-opacity");if(g!==0&&n.renderPass==="translucent"){var E=new we(n.context.gl.LEQUAL,we.ReadWrite,n.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))qu(n,u,a,h,E,je.disabled,ht.disabled),qu(n,u,a,h,E,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var T=n.colorModeForRenderPass();qu(n,u,a,h,E,je.disabled,T)}}},hillshade:function(n,u,a,h){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var g=n.context,E=n.depthModeForSublayer(0,we.ReadOnly),T=n.colorModeForRenderPass(),R=n.renderPass==="translucent"?n.stencilConfigForOverlap(h):[{},h],Z=R[0],ee=0,ve=R[1];ee<ve.length;ee+=1){var _e=ve[ee],Ee=u.getTile(_e);Ee.needsHillshadePrepare&&n.renderPass==="offscreen"?pc(n,Ee,a,E,je.disabled,T):n.renderPass==="translucent"&&Ol(n,Ee,a,E,Z[_e.overscaledZ],T)}g.viewport.set([0,0,n.width,n.height])}},raster:function(n,u,a,h){if(n.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var g=n.context,E=g.gl,T=u.getSource(),R=n.useProgram("raster"),Z=n.colorModeForRenderPass(),ee=T instanceof Pe?[{},h]:n.stencilConfigForOverlap(h),ve=ee[0],_e=ee[1],Ee=_e[_e.length-1].overscaledZ,We=!n.options.moving,He=0,lt=_e;He<lt.length;He+=1){var Fe=lt[He],st=n.depthModeForSublayer(Fe.overscaledZ-Ee,a.paint.get("raster-opacity")===1?we.ReadWrite:we.ReadOnly,E.LESS),bt=u.getTile(Fe),Gt=n.transform.calculatePosMatrix(Fe.toUnwrapped(),We);bt.registerFadeDuration(a.paint.get("raster-fade-duration"));var ur=u.findLoadedParent(Fe,0),or=Fu(bt,ur,u,a,n.transform),lr=void 0,Rr=void 0,nn=a.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;g.activeTexture.set(E.TEXTURE0),bt.texture.bind(nn,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(E.TEXTURE1),ur?(ur.texture.bind(nn,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),lr=Math.pow(2,ur.tileID.overscaledZ-bt.tileID.overscaledZ),Rr=[bt.tileID.canonical.x*lr%1,bt.tileID.canonical.y*lr%1]):bt.texture.bind(nn,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST);var Qr=Dc(Gt,Rr||[0,0],lr||1,or,a);T instanceof Pe?R.draw(g,E.TRIANGLES,st,je.disabled,Z,xt.disabled,Qr,a.id,T.boundsBuffer,n.quadTriangleIndexBuffer,T.boundsSegments):R.draw(g,E.TRIANGLES,st,ve[Fe.overscaledZ],Z,xt.disabled,Qr,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,u,a){var h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g!==0){var E=n.context,T=E.gl,R=n.transform,Z=R.tileSize,ee=a.paint.get("background-pattern");if(!n.isPatternMissing(ee)){var ve=!ee&&h.a===1&&g===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===ve){var _e=je.disabled,Ee=n.depthModeForSublayer(0,ve==="opaque"?we.ReadWrite:we.ReadOnly),We=n.colorModeForRenderPass(),He=n.useProgram(ee?"backgroundPattern":"background"),lt=R.coveringTiles({tileSize:Z});ee&&(E.activeTexture.set(T.TEXTURE0),n.imageManager.bind(n.context));for(var Fe=a.getCrossfadeParameters(),st=0,bt=lt;st<bt.length;st+=1){var Gt=bt[st],ur=n.transform.calculatePosMatrix(Gt.toUnwrapped()),or=ee?pl(ur,g,n,ee,{tileID:Gt,tileSize:Z},Fe):Ml(ur,g,h);He.draw(E,T.TRIANGLES,Ee,_e,We,xt.disabled,or,a.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,u,a){for(var h=0;h<a.length;h++)Uc(n,u,a[h])},custom:function(n,u,a){var h=n.context,g=a.implementation;if(n.renderPass==="offscreen"){var E=g.prerender;E&&(n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),E.call(g,h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),h.setStencilMode(je.disabled);var T=g.renderingMode==="3d"?new we(n.context.gl.LEQUAL,we.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,we.ReadOnly);h.setDepthMode(T),g.render(h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState(),h.bindFramebuffer.set(null)}}},Da=function(n,u){this.context=new ge(n),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Ke.maxUnderzooming+Ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new co,this.gpuTimers={}};Da.prototype.resize=function(n,u){if(this.width=n*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},Da.prototype.setup=function(){var n=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,Nn.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var a=new p.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(p.EXTENT,0),a.emplaceBack(0,p.EXTENT),a.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=n.createVertexBuffer(a,Nn.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(h,Ce.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,Nn.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var E=new p.StructArrayLayout1ui2;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(E);var T=new p.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new p.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new je({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Da.prototype.clearStencil=function(){var n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=p.create();p.ortho(a,0,this.width,this.height,0,0,1),p.scale(a,a,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,we.disabled,this.stencilClearMode,ht.disabled,xt.disabled,$u(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Da.prototype._renderTileClippingMasks=function(n,u){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&u&&u.length){this.currentStencilSource=n.source;var a=this.context,h=a.gl;this.nextStencilID+u.length>256&&this.clearStencil(),a.setColorMode(ht.disabled),a.setDepthMode(we.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var E=0,T=u;E<T.length;E+=1){var R=T[E],Z=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;g.draw(a,h.TRIANGLES,we.disabled,new je({func:h.ALWAYS,mask:0},Z,255,h.KEEP,h.KEEP,h.REPLACE),ht.disabled,xt.disabled,$u(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Da.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,u=this.context.gl;return new je({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)},Da.prototype.stencilModeForClipping=function(n){var u=this.context.gl;return new je({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)},Da.prototype.stencilConfigForOverlap=function(n){var u,a=this.context.gl,h=n.sort(function(Z,ee){return ee.overscaledZ-Z.overscaledZ}),g=h[h.length-1].overscaledZ,E=h[0].overscaledZ-g+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();for(var T={},R=0;R<E;R++)T[R+g]=new je({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=E,[T,h]}return[(u={},u[g]=je.disabled,u),h]},Da.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new ht([n.CONSTANT_COLOR,n.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ht.unblended:ht.alphaBlended},Da.prototype.depthModeForSublayer=function(n,u,a){if(!this.opaquePassEnabledForLayer())return we.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new we(a||this.context.gl.LEQUAL,u,[h,h])},Da.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Da.prototype.render=function(n,u){var a=this;this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var E in g){var T=g[E];T.used&&T.prepare(this.context)}var R,Z,ee={},ve={},_e={};for(var Ee in g){var We=g[Ee];ee[Ee]=We.getVisibleCoordinates(),ve[Ee]=ee[Ee].slice().reverse(),_e[Ee]=We.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var He=0;He<h.length;He++)if(this.style._layers[h[He]].is3D()){this.opaquePassCutoff=He;break}this.renderPass="offscreen";for(var lt=0,Fe=h;lt<Fe.length;lt+=1){var st=this.style._layers[Fe[lt]];if(st.hasOffscreenPass()&&!st.isHidden(this.transform.zoom)){var bt=ve[st.source];(st.type==="custom"||bt.length)&&this.renderLayer(this,g[st.source],st,bt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Gt=this.style._layers[h[this.currentLayer]],ur=g[Gt.source],or=ee[Gt.source];this._renderTileClippingMasks(Gt,or),this.renderLayer(this,ur,Gt,or)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var lr=this.style._layers[h[this.currentLayer]],Rr=g[lr.source],nn=(lr.type==="symbol"?_e:ve)[lr.source];this._renderTileClippingMasks(lr,ee[lr.source]),this.renderLayer(this,Rr,lr,nn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Qr){Qr.source&&!Qr.isHidden(a.transform.zoom)&&(Qr.source!==(Z&&Z.id)&&(Z=a.style.sourceCaches[Qr.source]),(!R||R.getSource().maxzoom<Z.getSource().maxzoom)&&(R=Z))}),R&&zu.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Qr){var yn=Qr.transform.padding;Nc(Qr,Qr.transform.height-(yn.top||0),3,Fc),Nc(Qr,yn.bottom||0,3,rf),Bc(Qr,yn.left||0,3,nf),Bc(Qr,Qr.transform.width-(yn.right||0),3,Ll);var jn=Qr.transform.centerPoint;(function(Xn,Hn,Ki,bn){vl(Xn,Hn-1,Ki-10,2,20,bn),vl(Xn,Hn-10,Ki-1,20,2,bn)})(Qr,jn.x,Qr.transform.height-jn.y,zc)}(this),this.context.setDefault()},Da.prototype.renderLayer=function(n,u,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),zu[a.type](n,u,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Da.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var u=this.context.extTimerQuery,a=this.gpuTimers[n.id];a||(a=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}},Da.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},Da.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},Da.prototype.queryGpuTimers=function(n){var u={};for(var a in n){var h=n[a],g=this.context.extTimerQuery,E=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[a]=E}return u},Da.prototype.translatePosMatrix=function(n,u,a,h,g){if(!a[0]&&!a[1])return n;var E=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(E){var T=Math.sin(E),R=Math.cos(E);a=[a[0]*R-a[1]*T,a[0]*T+a[1]*R]}var Z=[g?a[0]:oa(u,a[0],this.transform.zoom),g?a[1]:oa(u,a[1],this.transform.zoom),0],ee=new Float32Array(16);return p.translate(ee,n,Z),ee},Da.prototype.saveTileTexture=function(n){var u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]},Da.prototype.getTileTexture=function(n){var u=this._tileTextures[n];return u&&u.length>0?u.pop():null},Da.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var u=this.imageManager.getPattern(n.from.toString()),a=this.imageManager.getPattern(n.to.toString());return!u||!a},Da.prototype.useProgram=function(n,u){this.cache=this.cache||{};var a=""+n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new Lc(this.context,n,bf[n],u,kc[n],this._showOverdrawInspector)),this.cache[a]},Da.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Da.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},Da.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Da.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ql=function(n,u){this.points=n,this.planes=u};Ql.fromInvProjectionMatrix=function(n,u,a){var h=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return p.transformMat4([],T,n)}).map(function(T){return p.scale$1([],T,1/T[3]/u*h)}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=p.sub([],g[T[0]],g[T[1]]),Z=p.sub([],g[T[2]],g[T[1]]),ee=p.normalize([],p.cross([],R,Z)),ve=-p.dot(ee,g[T[1]]);return ee.concat(ve)});return new Ql(g,E)};var Nu=function(n,u){this.min=n,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Nu.prototype.quadrant=function(n){for(var u=[n%2==0,n<2],a=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<u.length;g++)a[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Nu(a,h)},Nu.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},Nu.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},Nu.prototype.intersects=function(n){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<n.planes.length;h++){for(var g=n.planes[h],E=0,T=0;T<u.length;T++)E+=p.dot$1(g,u[T])>=0;if(E===0)return 0;E!==u.length&&(a=!1)}if(a)return 2;for(var R=0;R<3;R++){for(var Z=Number.MAX_VALUE,ee=-Number.MAX_VALUE,ve=0;ve<n.points.length;ve++){var _e=n.points[ve][R]-this.min[R];Z=Math.min(Z,_e),ee=Math.max(ee,_e)}if(ee<0||Z>this.max[R]-this.min[R])return 0}return 1};var el=function(n,u,a,h){if(n===void 0&&(n=0),u===void 0&&(u=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(n)||n<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=a,this.right=h};el.prototype.interpolate=function(n,u,a){return u.top!=null&&n.top!=null&&(this.top=p.number(n.top,u.top,a)),u.bottom!=null&&n.bottom!=null&&(this.bottom=p.number(n.bottom,u.bottom,a)),u.left!=null&&n.left!=null&&(this.left=p.number(n.left,u.left,a)),u.right!=null&&n.right!=null&&(this.right=p.number(n.right,u.right,a)),this},el.prototype.getCenter=function(n,u){var a=p.clamp((this.left+n-this.right)/2,0,n),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(a,h)},el.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},el.prototype.clone=function(){return new el(this.top,this.bottom,this.left,this.right)},el.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var zi=function(n,u,a,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new el,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};zi.prototype.clone=function(){var n=new zi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new p.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(n){var u=-p.wrap(n,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(n){var u=p.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(n){var u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},zi.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},zi.prototype.interpolatePadding=function(n,u,a){this._unmodified=!1,this._edgeInsets.interpolate(n,u,a),this._constrain(),this._calcMatrices()},zi.prototype.coveringZoomLevel=function(n){var u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)},zi.prototype.getVisibleUnwrappedCoordinates=function(n){var u=[new p.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),E=this.pointCoordinate(new p.Point(0,this.height)),T=Math.floor(Math.min(a.x,h.x,g.x,E.x)),R=Math.floor(Math.max(a.x,h.x,g.x,E.x)),Z=T-1;Z<=R+1;Z++)Z!==0&&u.push(new p.UnwrappedTileID(Z,n));return u},zi.prototype.coveringTiles=function(n){var u=this.coveringZoomLevel(n),a=u;if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),E=[g*h.x,g*h.y,0],T=Ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),R=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=u);var Z=function(Qr){return{aabb:new Nu([Qr*g,0,0],[(Qr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Qr,fullyVisible:!1}},ee=[],ve=[],_e=u,Ee=n.reparseOverscaled?a:u;if(this._renderWorldCopies)for(var We=1;We<=3;We++)ee.push(Z(-We)),ee.push(Z(We));for(ee.push(Z(0));ee.length>0;){var He=ee.pop(),lt=He.x,Fe=He.y,st=He.fullyVisible;if(!st){var bt=He.aabb.intersects(T);if(bt===0)continue;st=bt===2}var Gt=He.aabb.distanceX(E),ur=He.aabb.distanceY(E),or=Math.max(Math.abs(Gt),Math.abs(ur));if(He.zoom===_e||or>3+(1<<_e-He.zoom)-2&&He.zoom>=R)ve.push({tileID:new p.OverscaledTileID(He.zoom===_e?Ee:He.zoom,He.wrap,He.zoom,lt,Fe),distanceSq:p.sqrLen([E[0]-.5-lt,E[1]-.5-Fe])});else for(var lr=0;lr<4;lr++){var Rr=(lt<<1)+lr%2,nn=(Fe<<1)+(lr>>1);ee.push({aabb:He.aabb.quadrant(lr),zoom:He.zoom+1,x:Rr,y:nn,wrap:He.wrap,fullyVisible:st})}}return ve.sort(function(Qr,yn){return Qr.distanceSq-yn.distanceSq}).map(function(Qr){return Qr.tileID})},zi.prototype.resize=function(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},zi.prototype.zoomScale=function(n){return Math.pow(2,n)},zi.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},zi.prototype.project=function(n){var u=p.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(n.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},zi.prototype.unproject=function(n){return new p.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},zi.prototype.setLocationAtPoint=function(n,u){var a=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(n),E=new p.MercatorCoordinate(g.x-(a.x-h.x),g.y-(a.y-h.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())},zi.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},zi.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},zi.prototype.locationCoordinate=function(n){return p.MercatorCoordinate.fromLngLat(n)},zi.prototype.coordinateLocation=function(n){return n.toLngLat()},zi.prototype.pointCoordinate=function(n){var u=[n.x,n.y,0,1],a=[n.x,n.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(a,a,this.pixelMatrixInverse);var h=u[3],g=a[3],E=u[1]/h,T=a[1]/g,R=u[2]/h,Z=a[2]/g,ee=R===Z?0:(0-R)/(Z-R);return new p.MercatorCoordinate(p.number(u[0]/h,a[0]/g,ee)/this.worldSize,p.number(E,T,ee)/this.worldSize)},zi.prototype.coordinatePoint=function(n){var u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},zi.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},zi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},zi.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},zi.prototype.calculatePosMatrix=function(n,u){u===void 0&&(u=!1);var a=n.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var g=n.canonical,E=this.worldSize/this.zoomScale(g.z),T=g.x+Math.pow(2,g.z)*n.wrap,R=p.identity(new Float64Array(16));return p.translate(R,R,[T*E,g.y*E,0]),p.scale(R,R,[E/p.EXTENT,E/p.EXTENT,1]),p.multiply(R,u?this.alignedProjMatrix:this.projMatrix,R),h[a]=new Float32Array(R),h[a]},zi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},zi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,u,a,h,g=-90,E=90,T=-180,R=180,Z=this.size,ee=this._unmodified;if(this.latRange){var ve=this.latRange;g=p.mercatorYfromLat(ve[1])*this.worldSize,n=(E=p.mercatorYfromLat(ve[0])*this.worldSize)-g<Z.y?Z.y/(E-g):0}if(this.lngRange){var _e=this.lngRange;T=p.mercatorXfromLng(_e[0])*this.worldSize,u=(R=p.mercatorXfromLng(_e[1])*this.worldSize)-T<Z.x?Z.x/(R-T):0}var Ee=this.point,We=Math.max(u||0,n||0);if(We)return this.center=this.unproject(new p.Point(u?(R+T)/2:Ee.x,n?(E+g)/2:Ee.y)),this.zoom+=this.scaleZoom(We),this._unmodified=ee,void(this._constraining=!1);if(this.latRange){var He=Ee.y,lt=Z.y/2;He-lt<g&&(h=g+lt),He+lt>E&&(h=E-lt)}if(this.lngRange){var Fe=Ee.x,st=Z.x/2;Fe-st<T&&(a=T+st),Fe+st>R&&(a=R-st)}a===void 0&&h===void 0||(this.center=this.unproject(new p.Point(a!==void 0?a:Ee.x,h!==void 0?h:Ee.y))),this._unmodified=ee,this._constraining=!1}},zi.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-a,.01,Math.PI-.01)),g=this.point,E=g.x,T=g.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),Z=this.height/50,ee=new Float64Array(16);p.perspective(ee,this._fov,this.width/this.height,Z,R),ee[8]=2*-n.x/this.width,ee[9]=2*n.y/this.height,p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[0,0,-this.cameraToCenterDistance]),p.rotateX(ee,ee,this._pitch),p.rotateZ(ee,ee,this.angle),p.translate(ee,ee,[-E,-T,0]),this.mercatorMatrix=p.scale([],ee,[this.worldSize,this.worldSize,this.worldSize]),p.scale(ee,ee,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ee,this.invProjMatrix=p.invert([],this.projMatrix);var ve=this.width%2/2,_e=this.height%2/2,Ee=Math.cos(this.angle),We=Math.sin(this.angle),He=E-Math.round(E)+Ee*ve+We*_e,lt=T-Math.round(T)+Ee*_e+We*ve,Fe=new Float64Array(ee);if(p.translate(Fe,Fe,[He>.5?He-1:He,lt>.5?lt-1:lt,0]),this.alignedProjMatrix=Fe,ee=p.create(),p.scale(ee,ee,[this.width/2,-this.height/2,1]),p.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=p.create(),p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[-1,-1,0]),p.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ee=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ee,this._posMatrixCache={},this._alignedPosMatrixCache={}}},zi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new p.Point(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},zi.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,n))},zi.prototype.getCameraQueryGeometry=function(n){var u=this.getCameraPoint();if(n.length===1)return[n[0],u];for(var a=u.x,h=u.y,g=u.x,E=u.y,T=0,R=n;T<R.length;T+=1){var Z=R[T];a=Math.min(a,Z.x),h=Math.min(h,Z.y),g=Math.max(g,Z.x),E=Math.max(E,Z.y)}return[new p.Point(a,h),new p.Point(g,h),new p.Point(g,E),new p.Point(a,E),new p.Point(a,h)]},Object.defineProperties(zi.prototype,Pa);var Ma=function(n){var u,a,h,g;this._hashName=n&&encodeURIComponent(n),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),a=!1,h=null,g=function(){h=null,a&&(u(),h=setTimeout(g,300),a=!1)},function(){return a=!0,h||g(),h})};Ma.prototype.addTo=function(n){return this._map=n,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ma.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ma.prototype.getHashString=function(n){var u=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),E=Math.round(u.lng*g)/g,T=Math.round(u.lat*g)/g,R=this._map.getBearing(),Z=this._map.getPitch(),ee="";if(ee+=n?"/"+E+"/"+T+"/"+a:a+"/"+T+"/"+E,(R||Z)&&(ee+="/"+Math.round(10*R)/10),Z&&(ee+="/"+Math.round(Z)),this._hashName){var ve=this._hashName,_e=!1,Ee=p.window.location.hash.slice(1).split("&").map(function(We){var He=We.split("=")[0];return He===ve?(_e=!0,He+"="+ee):We}).filter(function(We){return We});return _e||Ee.push(ve+"="+ee),"#"+Ee.join("&")}return"#"+ee},Ma.prototype._getCurrentHash=function(){var n,u=this,a=p.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(n=h)}),(n&&n[1]||"").split("/")):a.split("/")},Ma.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(a)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1},Ma.prototype._updateHashUnthrottled=function(){var n=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,n)}catch(u){}};var ql={linearity:.3,easing:p.bezier(0,0,.3,1)},Rl=p.extend({deceleration:2500,maxSpeed:1400},ql),ec=p.extend({deceleration:20,maxSpeed:1400},ql),Sf=p.extend({deceleration:1e3,maxSpeed:360},ql),Ef=p.extend({deceleration:1e3,maxSpeed:90},ql),Dl=function(n){this._map=n,this.clear()};function Bu(n,u){(!n.duration||n.duration<u.duration)&&(n.duration=u.duration,n.easing=u.easing)}function Uu(n,u,a){var h=a.maxSpeed,g=a.linearity,E=a.deceleration,T=p.clamp(n*g/(u/1e3),-h,h),R=Math.abs(T)/(E*g);return{easing:a.easing,duration:1e3*R,amount:T*(R/2)}}Dl.prototype.clear=function(){this._inertiaBuffer=[]},Dl.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:n})},Dl.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,u=p.browser.now();n.length>0&&u-n[0].time>160;)n.shift()},Dl.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var g=h[a].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var E=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var R=Uu(u.pan.mag(),E,p.extend({},Rl,n||{}));T.offset=u.pan.mult(R.amount/u.pan.mag()),T.center=this._map.transform.center,Bu(T,R)}if(u.zoom){var Z=Uu(u.zoom,E,ec);T.zoom=this._map.transform.zoom+Z.amount,Bu(T,Z)}if(u.bearing){var ee=Uu(u.bearing,E,Sf);T.bearing=this._map.transform.bearing+p.clamp(ee.amount,-179,179),Bu(T,ee)}if(u.pitch){var ve=Uu(u.pitch,E,Ef);T.pitch=this._map.transform.pitch+ve.amount,Bu(T,ve)}if(T.zoom||T.bearing){var _e=u.pinchAround===void 0?u.around:u.pinchAround;T.around=_e?this._map.unproject(_e):this._map.getCenter()}return this.clear(),p.extend(T,{noMoveStart:!0})}};var no=function(n){function u(h,g,E,T){T===void 0&&(T={});var R=L.mousePos(g.getCanvasContainer(),E),Z=g.unproject(R);n.call(this,h,p.extend({point:R,lngLat:Z,originalEvent:E},T)),this._defaultPrevented=!1,this.target=g}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),vs=function(n){function u(h,g,E){var T=h==="touchend"?E.changedTouches:E.touches,R=L.touchPos(g.getCanvasContainer(),T),Z=R.map(function(_e){return g.unproject(_e)}),ee=R.reduce(function(_e,Ee,We,He){return _e.add(Ee.div(He.length))},new p.Point(0,0)),ve=g.unproject(ee);n.call(this,h,{points:R,point:ee,lngLats:Z,lngLat:ve,originalEvent:E}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),ml=function(n){function u(h,g,E){n.call(this,h,{originalEvent:E}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),ho=function(n,u){this._map=n,this._clickTolerance=u.clickTolerance};ho.prototype.reset=function(){delete this._mousedownPos},ho.prototype.wheel=function(n){return this._firePreventable(new ml(n.type,this._map,n))},ho.prototype.mousedown=function(n,u){return this._mousedownPos=u,this._firePreventable(new no(n.type,this._map,n))},ho.prototype.mouseup=function(n){this._map.fire(new no(n.type,this._map,n))},ho.prototype.click=function(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new no(n.type,this._map,n))},ho.prototype.dblclick=function(n){return this._firePreventable(new no(n.type,this._map,n))},ho.prototype.mouseover=function(n){this._map.fire(new no(n.type,this._map,n))},ho.prototype.mouseout=function(n){this._map.fire(new no(n.type,this._map,n))},ho.prototype.touchstart=function(n){return this._firePreventable(new vs(n.type,this._map,n))},ho.prototype.touchmove=function(n){this._map.fire(new vs(n.type,this._map,n))},ho.prototype.touchend=function(n){this._map.fire(new vs(n.type,this._map,n))},ho.prototype.touchcancel=function(n){this._map.fire(new vs(n.type,this._map,n))},ho.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},ho.prototype.isEnabled=function(){return!0},ho.prototype.isActive=function(){return!1},ho.prototype.enable=function(){},ho.prototype.disable=function(){};var En=function(n){this._map=n};En.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},En.prototype.mousemove=function(n){this._map.fire(new no(n.type,this._map,n))},En.prototype.mousedown=function(){this._delayContextMenu=!0},En.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new no("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},En.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new no(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},En.prototype.isEnabled=function(){return!0},En.prototype.isActive=function(){return!1},En.prototype.enable=function(){},En.prototype.disable=function(){};var ks=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1};function tc(n,u){for(var a={},h=0;h<n.length;h++)a[n[h].identifier]=u[h];return a}ks.prototype.isEnabled=function(){return!!this._enabled},ks.prototype.isActive=function(){return!!this._active},ks.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ks.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ks.prototype.mousedown=function(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(L.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},ks.prototype.mousemoveWindow=function(n,u){if(this._active){var a=u;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=L.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var g=Math.min(h.x,a.x),E=Math.max(h.x,a.x),T=Math.min(h.y,a.y),R=Math.max(h.y,a.y);L.setTransform(this._box,"translate("+g+"px,"+T+"px)"),this._box.style.width=E-g+"px",this._box.style.height=R-T+"px"}}},ks.prototype.mouseupWindow=function(n,u){var a=this;if(this._active&&n.button===0){var h=this._startPos,g=u;if(this.reset(),L.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(E){return E.fitScreenCoordinates(h,g,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},ks.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},ks.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos},ks.prototype._fireEvent=function(n,u){return this._map.fire(new p.Event(n,{originalEvent:u}))};var gl=function(n){this.reset(),this.numTouches=n.numTouches};gl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},gl.prototype.touchstart=function(n,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),E=0,T=h;E<T.length;E+=1)g._add(T[E]);return g.div(h.length)}(u),this.touches=tc(a,u)))},gl.prototype.touchmove=function(n,u,a){if(!this.aborted&&this.centroid){var h=tc(a,u);for(var g in this.touches){var E=h[g];(!E||E.dist(this.touches[g])>30)&&(this.aborted=!0)}}},gl.prototype.touchend=function(n,u,a){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Qs=function(n){this.singleTap=new gl(n),this.numTaps=n.numTaps,this.reset()};Qs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Qs.prototype.touchstart=function(n,u,a){this.singleTap.touchstart(n,u,a)},Qs.prototype.touchmove=function(n,u,a){this.singleTap.touchmove(n,u,a)},Qs.prototype.touchend=function(n,u,a){var h=this.singleTap.touchend(n,u,a);if(h){var g=n.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(h)<30;if(g&&E||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Zs=function(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()};Zs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Zs.prototype.touchstart=function(n,u,a){this._zoomIn.touchstart(n,u,a),this._zoomOut.touchstart(n,u,a)},Zs.prototype.touchmove=function(n,u,a){this._zoomIn.touchmove(n,u,a),this._zoomOut.touchmove(n,u,a)},Zs.prototype.touchend=function(n,u,a){var h=this,g=this._zoomIn.touchend(n,u,a),E=this._zoomOut.touchend(n,u,a);return g?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:n})}}):E?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(E)},{originalEvent:n})}}):void 0},Zs.prototype.touchcancel=function(){this.reset()},Zs.prototype.enable=function(){this._enabled=!0},Zs.prototype.disable=function(){this._enabled=!1,this.reset()},Zs.prototype.isEnabled=function(){return this._enabled},Zs.prototype.isActive=function(){return this._active};var yl={0:1,2:2},Jr=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};Jr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Jr.prototype._correctButton=function(n,u){return!1},Jr.prototype._move=function(n,u){return{}},Jr.prototype.mousedown=function(n,u){if(!this._lastPoint){var a=L.mouseButton(n);this._correctButton(n,a)&&(this._lastPoint=u,this._eventButton=a)}},Jr.prototype.mousemoveWindow=function(n,u){var a=this._lastPoint;if(a){if(n.preventDefault(),function(h,g){var E=yl[g];return h.buttons===void 0||(h.buttons&E)!==E}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}},Jr.prototype.mouseupWindow=function(n){this._lastPoint&&L.mouseButton(n)===this._eventButton&&(this._moved&&L.suppressClick(),this.reset())},Jr.prototype.enable=function(){this._enabled=!0},Jr.prototype.disable=function(){this._enabled=!1,this.reset()},Jr.prototype.isEnabled=function(){return this._enabled},Jr.prototype.isActive=function(){return this._active};var jc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.mousedown=function(a,h){n.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},u.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},u}(Jr),dc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Jr),tl=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Jr),qs=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};qs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},qs.prototype.touchstart=function(n,u,a){return this._calculateTransform(n,u,a)},qs.prototype.touchmove=function(n,u,a){if(this._active&&!(a.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,u,a)},qs.prototype.touchend=function(n,u,a){this._calculateTransform(n,u,a),this._active&&a.length<this._minTouches&&this.reset()},qs.prototype.touchcancel=function(){this.reset()},qs.prototype._calculateTransform=function(n,u,a){a.length>0&&(this._active=!0);var h=tc(a,u),g=new p.Point(0,0),E=new p.Point(0,0),T=0;for(var R in h){var Z=h[R],ee=this._touches[R];ee&&(g._add(Z),E._add(Z.sub(ee)),T++,h[R]=Z)}if(this._touches=h,!(T<this._minTouches)&&E.mag()){var ve=E.div(T);if(this._sum._add(ve),!(this._sum.mag()<this._clickTolerance))return{around:g.div(T),panDelta:ve}}},qs.prototype.enable=function(){this._enabled=!0},qs.prototype.disable=function(){this._enabled=!1,this.reset()},qs.prototype.isEnabled=function(){return this._enabled},qs.prototype.isActive=function(){return this._active};var ws=function(){this.reset()};function vc(n,u,a){for(var h=0;h<n.length;h++)if(n[h].identifier===a)return u[h]}function mc(n,u){return Math.log(n/u)/Math.LN2}ws.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ws.prototype._start=function(n){},ws.prototype._move=function(n,u,a){return{}},ws.prototype.touchstart=function(n,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))},ws.prototype.touchmove=function(n,u,a){if(this._firstTwoTouches){n.preventDefault();var h=this._firstTwoTouches,g=h[1],E=vc(a,u,h[0]),T=vc(a,u,g);if(E&&T){var R=this._aroundCenter?null:E.add(T).div(2);return this._move([E,T],R,n)}}},ws.prototype.touchend=function(n,u,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],E=vc(a,u,h[0]),T=vc(a,u,g);E&&T||(this._active&&L.suppressClick(),this.reset())}},ws.prototype.touchcancel=function(){this.reset()},ws.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active};var Fs=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(mc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mc(this._distance,g),pinchAround:h}},u}(ws);function ju(n,u){return 180*n.angleWith(u)/Math.PI}var _l=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ju(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,g=ju(a,this._startVector);return Math.abs(g)<h},u}(ws);function kl(n){return Math.abs(n.y)>Math.abs(n.x)}var af=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(a){this._lastPoints=a,kl(a[0].sub(a[1]))&&(this._valid=!1)},u.prototype._move=function(a,h,g){var E=a[0].sub(this._lastPoints[0]),T=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(E,T,g.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(E.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(a,h,g){if(this._valid!==void 0)return this._valid;var E=a.mag()>=2,T=h.mag()>=2;if(E||T){if(!E||!T)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var R=a.y>0==h.y>0;return kl(a)&&kl(h)&&R}},u}(ws),Zc={panStep:100,bearingStep:15,pitchStep:10},Au=function(){var n=Zc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function eu(n){return n*(2-n)}Au.prototype.reset=function(){this._active=!1},Au.prototype.keydown=function(n){var u=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var a=0,h=0,g=0,E=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),E=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),E=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(R){var Z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:eu,zoom:a?Math.round(Z)+a*(n.shiftKey?2:1):Z,bearing:R.getBearing()+h*u._bearingStep,pitch:R.getPitch()+g*u._pitchStep,offset:[-E*u._panStep,-T*u._panStep],center:R.getCenter()},{originalEvent:n})}}}},Au.prototype.enable=function(){this._enabled=!0},Au.prototype.disable=function(){this._enabled=!1,this.reset()},Au.prototype.isEnabled=function(){return this._enabled},Au.prototype.isActive=function(){return this._active},Au.prototype.disableRotation=function(){this._rotationDisabled=!0},Au.prototype.enableRotation=function(){this._rotationDisabled=!1};var ki=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};ki.prototype.setZoomRate=function(n){this._defaultZoomRate=n},ki.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},ki.prototype.isEnabled=function(){return!!this._enabled},ki.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ki.prototype.isZooming=function(){return!!this._zooming},ki.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},ki.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ki.prototype.wheel=function(n){if(this.isEnabled()){var u=n.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,a=p.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}},ki.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},ki.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=L.mousePos(this._el,n);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ki.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var E,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,R=this._startZoom,Z=this._easing,ee=!1;if(this._type==="wheel"&&R&&Z){var ve=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),_e=Z(ve);E=p.number(R,T,_e),ve<1?this._frameId||(this._frameId=!0):ee=!0}else E=T,ee=!0;return this._active=!0,ee&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ee,zoomDelta:E-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ki.prototype._smoothOutEasing=function(n){var u=p.ease;if(this._prevEase){var a=this._prevEase,h=(p.browser.now()-a.start)/a.duration,g=a.easing(h+.01)-a.easing(h),E=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-E*E);u=p.bezier(E,T,.25,1)}return this._prevEase={start:p.browser.now(),duration:n,easing:u},u},ki.prototype.reset=function(){this._active=!1};var Zu=function(n,u){this._clickZoom=n,this._tapZoom=u};Zu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Zu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Zu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Zu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ns=function(){this.reset()};ns.prototype.reset=function(){this._active=!1},ns.prototype.dblclick=function(n,u){return n.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(n.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:n})}}},ns.prototype.enable=function(){this._enabled=!0},ns.prototype.disable=function(){this._enabled=!1,this.reset()},ns.prototype.isEnabled=function(){return this._enabled},ns.prototype.isActive=function(){return this._active};var Oo=function(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()};Oo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Oo.prototype.touchstart=function(n,u,a){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(n,u,a))},Oo.prototype.touchmove=function(n,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,u,a)},Oo.prototype.touchend=function(n,u,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(n,u,a)&&(this._tapTime=n.timeStamp)},Oo.prototype.touchcancel=function(){this.reset()},Oo.prototype.enable=function(){this._enabled=!0},Oo.prototype.disable=function(){this._enabled=!1,this.reset()},Oo.prototype.isEnabled=function(){return this._enabled},Oo.prototype.isActive=function(){return this._active};var xl=function(n,u,a){this._el=n,this._mousePan=u,this._touchPan=a};xl.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},xl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},xl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},xl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var rl=function(n,u,a){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a};rl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},rl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},rl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},rl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var du=function(n,u,a,h){this._el=n,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};du.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},du.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},du.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},du.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},du.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},du.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ms=function(n){return n.zoom||n.drag||n.pitch||n.rotate},nl=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u}(p.Event);function Un(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var Pn=function(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dl(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var E=g[h],T=E[0];L.addEventListener(T,E[1],T===p.window.document?this.handleWindowEvent:this.handleEvent,E[2])}};Pn.prototype.destroy=function(){for(var n=0,u=this._listeners;n<u.length;n+=1){var a=u[n],h=a[0];L.removeEventListener(h,a[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},Pn.prototype._addDefaultHandlers=function(n){var u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new ho(u,n));var h=u.boxZoom=new ks(u,n);this._add("boxZoom",h);var g=new Zs,E=new ns;u.doubleClickZoom=new Zu(E,g),this._add("tapZoom",g),this._add("clickZoom",E);var T=new Oo;this._add("tapDragZoom",T);var R=u.touchPitch=new af;this._add("touchPitch",R);var Z=new dc(n),ee=new tl(n);u.dragRotate=new rl(n,Z,ee),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);var ve=new jc(n),_e=new qs(n);u.dragPan=new xl(a,ve,_e),this._add("mousePan",ve),this._add("touchPan",_e,["touchZoom","touchRotate"]);var Ee=new _l,We=new Fs;u.touchZoomRotate=new du(a,We,Ee,T),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",We,["touchPan","touchRotate"]);var He=u.scrollZoom=new ki(u,this);this._add("scrollZoom",He,["mousePan"]);var lt=u.keyboard=new Au;this._add("keyboard",lt),this._add("blockableMapEvent",new En(u));for(var Fe=0,st=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Fe<st.length;Fe+=1){var bt=st[Fe];n.interactive&&n[bt]&&u[bt].enable(n[bt])}},Pn.prototype._add=function(n,u,a){this._handlers.push({handlerName:n,handler:u,allowed:a}),this._handlersById[n]=u},Pn.prototype.stop=function(n){if(!this._updatingCamera){for(var u=0,a=this._handlers;u<a.length;u+=1)a[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},Pn.prototype.isActive=function(){for(var n=0,u=this._handlers;n<u.length;n+=1)if(u[n].handler.isActive())return!0;return!1},Pn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Pn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Pn.prototype.isMoving=function(){return Boolean(ms(this._eventsInProgress))||this.isZooming()},Pn.prototype._blockedByActive=function(n,u,a){for(var h in n)if(h!==a&&(!u||u.indexOf(h)<0))return!0;return!1},Pn.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},Pn.prototype._getMapTouches=function(n){for(var u=[],a=0,h=n;a<h.length;a+=1){var g=h[a];this._el.contains(g.target)&&u.push(g)}return u},Pn.prototype.handleEvent=function(n,u){if(n.type!=="blur"){this._updatingCamera=!0;for(var a=n.type==="renderFrame"?void 0:n,h={needsRenderFrame:!1},g={},E={},T=n.touches?this._getMapTouches(n.touches):void 0,R=T?L.touchPos(this._el,T):L.mousePos(this._el,n),Z=0,ee=this._handlers;Z<ee.length;Z+=1){var ve=ee[Z],_e=ve.handlerName,Ee=ve.handler,We=ve.allowed;if(Ee.isEnabled()){var He=void 0;this._blockedByActive(E,We,_e)?Ee.reset():Ee[u||n.type]&&(He=Ee[u||n.type](n,R,T),this.mergeHandlerResult(h,g,He,_e,a),He&&He.needsRenderFrame&&this._triggerRenderFrame()),(He||Ee.isActive())&&(E[_e]=Ee)}}var lt={};for(var Fe in this._previousActiveHandlers)E[Fe]||(lt[Fe]=a);this._previousActiveHandlers=E,(Object.keys(lt).length||Un(h))&&(this._changes.push([h,g,lt]),this._triggerRenderFrame()),(Object.keys(E).length||Un(h))&&this._map._stop(!0),this._updatingCamera=!1;var st=h.cameraAnimation;st&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],st(this._map))}else this.stop(!0)},Pn.prototype.mergeHandlerResult=function(n,u,a,h,g){if(a){p.extend(n,a);var E={handlerName:h,originalEvent:a.originalEvent||g};a.zoomDelta!==void 0&&(u.zoom=E),a.panDelta!==void 0&&(u.drag=E),a.pitchDelta!==void 0&&(u.pitch=E),a.bearingDelta!==void 0&&(u.rotate=E)}},Pn.prototype._applyChanges=function(){for(var n={},u={},a={},h=0,g=this._changes;h<g.length;h+=1){var E=g[h],T=E[0],R=E[1],Z=E[2];T.panDelta&&(n.panDelta=(n.panDelta||new p.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(n.around=T.around),T.pinchAround!==void 0&&(n.pinchAround=T.pinchAround),T.noInertia&&(n.noInertia=T.noInertia),p.extend(u,R),p.extend(a,Z)}this._updateMapTransform(n,u,a),this._changes=[]},Pn.prototype._updateMapTransform=function(n,u,a){var h=this._map,g=h.transform;if(!Un(n))return this._fireEvents(u,a,!0);var E=n.panDelta,T=n.zoomDelta,R=n.bearingDelta,Z=n.pitchDelta,ee=n.around,ve=n.pinchAround;ve!==void 0&&(ee=ve),h._stop(!0),ee=ee||h.transform.centerPoint;var _e=g.pointLocation(E?ee.sub(E):ee);R&&(g.bearing+=R),Z&&(g.pitch+=Z),T&&(g.zoom+=T),g.setLocationAtPoint(_e,ee),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,a,!0)},Pn.prototype._fireEvents=function(n,u,a){var h=this,g=ms(this._eventsInProgress),E=ms(n),T={};for(var R in n)this._eventsInProgress[R]||(T[R+"start"]=n[R].originalEvent),this._eventsInProgress[R]=n[R];for(var Z in!g&&E&&this._fireEvent("movestart",E.originalEvent),T)this._fireEvent(Z,T[Z]);for(var ee in E&&this._fireEvent("move",E.originalEvent),n)this._fireEvent(ee,n[ee].originalEvent);var ve,_e={};for(var Ee in this._eventsInProgress){var We=this._eventsInProgress[Ee],He=We.handlerName,lt=We.originalEvent;this._handlersById[He].isActive()||(delete this._eventsInProgress[Ee],_e[Ee+"end"]=ve=u[He]||lt)}for(var Fe in _e)this._fireEvent(Fe,_e[Fe]);var st=ms(this._eventsInProgress);if(a&&(g||E)&&!st){this._updatingCamera=!0;var bt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Gt=function(ur){return ur!==0&&-h._bearingSnap<ur&&ur<h._bearingSnap};bt?(Gt(bt.bearing||this._map.getBearing())&&(bt.bearing=0),this._map.easeTo(bt,{originalEvent:ve})):(this._map.fire(new p.Event("moveend",{originalEvent:ve})),Gt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Pn.prototype._fireEvent=function(n,u){this._map.fire(new p.Event(n,u?{originalEvent:u}:{}))},Pn.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete n._frameId,n.handleEvent(new nl("renderFrame",{timeStamp:u})),n._applyChanges()})},Pn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var rc=function(n){function u(a,h){n.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},u.prototype.panBy=function(a,h,g){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},h),g)},u.prototype.panTo=function(a,h,g){return this.easeTo(p.extend({center:a},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},u.prototype.zoomTo=function(a,h,g){return this.easeTo(p.extend({zoom:a},h),g)},u.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},u.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},u.prototype.rotateTo=function(a,h,g){return this.easeTo(p.extend({bearing:a},h),g)},u.prototype.resetNorth=function(a,h){return this.rotateTo(0,p.extend({duration:1e3},a),h),this},u.prototype.resetNorthPitch=function(a,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),h),this},u.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},u.prototype.cameraForBounds=function(a,h){a=p.LngLatBounds.convert(a);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(a,h,g,E){var T={top:0,bottom:0,right:0,left:0};if(typeof(E=p.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},E)).padding=="number"){var R=E.padding;E.padding={top:R,bottom:R,right:R,left:R}}E.padding=p.extend(T,E.padding);var Z=this.transform,ee=Z.padding,ve=Z.project(p.LngLat.convert(a)),_e=Z.project(p.LngLat.convert(h)),Ee=ve.rotate(-g*Math.PI/180),We=_e.rotate(-g*Math.PI/180),He=new p.Point(Math.max(Ee.x,We.x),Math.max(Ee.y,We.y)),lt=new p.Point(Math.min(Ee.x,We.x),Math.min(Ee.y,We.y)),Fe=He.sub(lt),st=(Z.width-(ee.left+ee.right+E.padding.left+E.padding.right))/Fe.x,bt=(Z.height-(ee.top+ee.bottom+E.padding.top+E.padding.bottom))/Fe.y;if(!(bt<0||st<0)){var Gt=Math.min(Z.scaleZoom(Z.scale*Math.min(st,bt)),E.maxZoom),ur=typeof E.offset.x=="number"?new p.Point(E.offset.x,E.offset.y):p.Point.convert(E.offset),or=new p.Point((E.padding.left-E.padding.right)/2,(E.padding.top-E.padding.bottom)/2).rotate(g*Math.PI/180),lr=ur.add(or).mult(Z.scale/Z.zoomScale(Gt));return{center:Z.unproject(ve.add(_e).div(2).sub(lr)),zoom:Gt,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(a,h,g){return this._fitInternal(this.cameraForBounds(a,h),h,g)},u.prototype.fitScreenCoordinates=function(a,h,g,E,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(a)),this.transform.pointLocation(p.Point.convert(h)),g,E),E,T)},u.prototype._fitInternal=function(a,h,g){return a?(delete(h=p.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(a,h){this.stop();var g=this.transform,E=!1,T=!1,R=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(E=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=p.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(T=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(R=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),E&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),T&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(a,h){var g=this;this._stop(!1,a.easeId),((a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate===!1||!a.essential&&p.browser.prefersReducedMotion)&&(a.duration=0);var E=this.transform,T=this.getZoom(),R=this.getBearing(),Z=this.getPitch(),ee=this.getPadding(),ve="zoom"in a?+a.zoom:T,_e="bearing"in a?this._normalizeBearing(a.bearing,R):R,Ee="pitch"in a?+a.pitch:Z,We="padding"in a?a.padding:E.padding,He=p.Point.convert(a.offset),lt=E.centerPoint.add(He),Fe=E.pointLocation(lt),st=p.LngLat.convert(a.center||Fe);this._normalizeCenter(st);var bt,Gt,ur=E.project(Fe),or=E.project(st).sub(ur),lr=E.zoomScale(ve-T);a.around&&(bt=p.LngLat.convert(a.around),Gt=E.locationPoint(bt));var Rr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==T,this._rotating=this._rotating||R!==_e,this._pitching=this._pitching||Ee!==Z,this._padding=!E.isPaddingEqual(We),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Rr),this._ease(function(nn){if(g._zooming&&(E.zoom=p.number(T,ve,nn)),g._rotating&&(E.bearing=p.number(R,_e,nn)),g._pitching&&(E.pitch=p.number(Z,Ee,nn)),g._padding&&(E.interpolatePadding(ee,We,nn),lt=E.centerPoint.add(He)),bt)E.setLocationAtPoint(bt,Gt);else{var Qr=E.zoomScale(E.zoom-T),yn=ve>T?Math.min(2,lr):Math.max(.5,lr),jn=Math.pow(yn,1-nn),Xn=E.unproject(ur.add(or.mult(nn*jn)).mult(Qr));E.setLocationAtPoint(E.renderWorldCopies?Xn.wrap():Xn,lt)}g._fireMoveEvents(h)},function(nn){g._afterEase(h,nn)},a),this},u.prototype._prepareEase=function(a,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",a))},u.prototype._fireMoveEvents=function(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))},u.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,E=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",a)),E&&this.fire(new p.Event("rotateend",a)),T&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}},u.prototype.flyTo=function(a,h){var g=this;if(!a.essential&&p.browser.prefersReducedMotion){var E=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(E,h)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);var T=this.transform,R=this.getZoom(),Z=this.getBearing(),ee=this.getPitch(),ve=this.getPadding(),_e="zoom"in a?p.clamp(+a.zoom,T.minZoom,T.maxZoom):R,Ee="bearing"in a?this._normalizeBearing(a.bearing,Z):Z,We="pitch"in a?+a.pitch:ee,He="padding"in a?a.padding:T.padding,lt=T.zoomScale(_e-R),Fe=p.Point.convert(a.offset),st=T.centerPoint.add(Fe),bt=T.pointLocation(st),Gt=p.LngLat.convert(a.center||bt);this._normalizeCenter(Gt);var ur=T.project(bt),or=T.project(Gt).sub(ur),lr=a.curve,Rr=Math.max(T.width,T.height),nn=Rr/lt,Qr=or.mag();if("minZoom"in a){var yn=p.clamp(Math.min(a.minZoom,R,_e),T.minZoom,T.maxZoom),jn=Rr/T.zoomScale(yn-R);lr=Math.sqrt(jn/Qr*2)}var Xn=lr*lr;function Hn(ei){var Qn=(nn*nn-Rr*Rr+(ei?-1:1)*Xn*Xn*Qr*Qr)/(2*(ei?nn:Rr)*Xn*Qr);return Math.log(Math.sqrt(Qn*Qn+1)-Qn)}function Ki(ei){return(Math.exp(ei)-Math.exp(-ei))/2}function bn(ei){return(Math.exp(ei)+Math.exp(-ei))/2}var ai=Hn(0),_i=function(ei){return bn(ai)/bn(ai+lr*ei)},ii=function(ei){return Rr*((bn(ai)*(Ki(Qn=ai+lr*ei)/bn(Qn))-Ki(ai))/Xn)/Qr;var Qn},ri=(Hn(1)-ai)/lr;if(Math.abs(Qr)<1e-6||!isFinite(ri)){if(Math.abs(Rr-nn)<1e-6)return this.easeTo(a,h);var xi=nn<Rr?-1:1;ri=Math.abs(Math.log(nn/Rr))/lr,ii=function(){return 0},_i=function(ei){return Math.exp(xi*lr*ei)}}return a.duration="duration"in a?+a.duration:1e3*ri/("screenSpeed"in a?+a.screenSpeed/lr:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=Z!==Ee,this._pitching=We!==ee,this._padding=!T.isPaddingEqual(He),this._prepareEase(h,!1),this._ease(function(ei){var Qn=ei*ri,_o=1/_i(Qn);T.zoom=ei===1?_e:R+T.scaleZoom(_o),g._rotating&&(T.bearing=p.number(Z,Ee,ei)),g._pitching&&(T.pitch=p.number(ee,We,ei)),g._padding&&(T.interpolatePadding(ve,He,ei),st=T.centerPoint.add(Fe));var Ka=ei===1?Gt:T.unproject(ur.add(or.mult(ii(Qn))).mult(_o));T.setLocationAtPoint(T.renderWorldCopies?Ka.wrap():Ka,st),g._fireMoveEvents(h)},function(){return g._afterEase(h)},a),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!a){var E=this.handlers;E&&E.stop(!1)}return this},u.prototype._ease=function(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var a=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(a,h){a=p.wrap(a,-180,180);var g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a},u.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}},u}(p.Evented),is=function(n){n===void 0&&(n={}),this.options=n,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};is.prototype.getDefaultPosition=function(){return"bottom-right"},is.prototype.onAdd=function(n){var u=this.options&&this.options.compact;return this._map=n,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},is.prototype.onRemove=function(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},is.prototype._setElementTitle=function(n,u){var a=this._map._getUIString("AttributionControl."+u);n.title=a,n.setAttribute("aria-label",a)},is.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},is.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(n){var a=u.reduce(function(h,g,E){return g.value&&(h+=g.key+"="+g.value+(E<u.length-1?"&":"")),h},"?");n.href=p.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},is.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},is.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var a=this._map.style.sourceCaches;for(var h in a){var g=a[h];if(g.used){var E=g.getSource();E.attribution&&n.indexOf(E.attribution)<0&&n.push(E.attribution)}}n.sort(function(R,Z){return R.length-Z.length});var T=(n=n.filter(function(R,Z){for(var ee=Z+1;ee<n.length;ee++)if(n[ee].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,n.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},is.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var yo=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};yo.prototype.onAdd=function(n){this._map=n,this._container=L.create("div","mapboxgl-ctrl");var u=L.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},yo.prototype.onRemove=function(){L.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},yo.prototype.getDefaultPosition=function(){return"bottom-left"},yo.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},yo.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var u in n)if(n[u].getSource().mapbox_logo)return!0;return!1}},yo.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var zo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};zo.prototype.add=function(n){var u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u},zo.prototype.remove=function(n){for(var u=this._currentlyRunning,a=0,h=u?this._queue.concat(u):this._queue;a<h.length;a+=1){var g=h[a];if(g.id===n)return void(g.cancelled=!0)}},zo.prototype.run=function(n){n===void 0&&(n=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=u;a<h.length;a+=1){var g=h[a];if(!g.cancelled&&(g.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},zo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var vu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Vs=p.window.HTMLImageElement,Fl=p.window.HTMLElement,Yi=p.window.ImageBitmap,wo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},of=function(n){function u(h){var g=this;if((h=p.extend({},wo,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var E=new zi(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(n.call(this,E,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new zo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},vu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof Fl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Pn(this,h),this._hash=h.hash&&new Ma(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new is({customAttribution:h.customAttribution})),this.addControl(new yo,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(T){g._update(T.dataType==="style"),g.fire(new p.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){g.fire(new p.Event(T.dataType+"dataloading",T))})}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var E=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[g];return g.indexOf("bottom")!==-1?T.insertBefore(E,T.firstChild):T.appendChild(E),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),E=g[0],T=g[1];this._resizeCanvas(E,T),this.transform.resize(E,T),this.painter.resize(E,T);var R=!this._moving;return R&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),R&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,E){var T,R=this;if(h==="mouseenter"||h==="mouseover"){var Z=!1;return{layer:g,listener:E,delegates:{mousemove:function(ve){var _e=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];_e.length?Z||(Z=!0,E.call(R,new no(h,R,ve.originalEvent,{features:_e}))):Z=!1},mouseout:function(){Z=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ee=!1;return{layer:g,listener:E,delegates:{mousemove:function(ve){(R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[]).length?ee=!0:ee&&(ee=!1,E.call(R,new no(h,R,ve.originalEvent)))},mouseout:function(ve){ee&&(ee=!1,E.call(R,new no(h,R,ve.originalEvent)))}}}}return{layer:g,listener:E,delegates:(T={},T[h]=function(ve){var _e=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];_e.length&&(ve.features=_e,E.call(R,ve),delete ve.features)},T)}},u.prototype.on=function(h,g,E){if(E===void 0)return n.prototype.on.call(this,h,g);var T=this._createDelegatedListener(h,g,E);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(R,T.delegates[R]);return this},u.prototype.once=function(h,g,E){if(E===void 0)return n.prototype.once.call(this,h,g);var T=this._createDelegatedListener(h,g,E);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},u.prototype.off=function(h,g,E){var T=this;return E===void 0?n.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(R){for(var Z=R[h],ee=0;ee<Z.length;ee++){var ve=Z[ee];if(ve.layer===g&&ve.listener===E){for(var _e in ve.delegates)T.off(_e,ve.delegates[_e]);return Z.splice(ee,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var E;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")E=[p.Point.convert(h)];else{var T=p.Point.convert(h[0]),R=p.Point.convert(h[1]);E=[T,new p.Point(R.x,T.y),R,new p.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(E,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new xa(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new xa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var E=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),R=this._requestManager.transformRequest(T,p.ResourceType.Style);p.getJSON(R,function(Z,ee){Z?E.fire(new p.ErrorEvent(Z)):ee&&E._updateDiff(ee,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(E){p.warnOnce("Unable to perform style diff: "+(E.message||E.error||E)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var E=h[g]._tiles;for(var T in E){var R=E[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,E){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,E)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,E){E===void 0&&(E={});var T=E.pixelRatio;T===void 0&&(T=1);var R=E.sdf;R===void 0&&(R=!1);var Z=E.stretchX,ee=E.stretchY,ve=E.content;if(this._lazyInitEmptyStyle(),g instanceof Vs||Yi&&g instanceof Yi){var _e=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:_e.width,height:_e.height},_e.data),pixelRatio:T,stretchX:Z,stretchY:ee,content:ve,sdf:R,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ee=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:T,stretchX:Z,stretchY:ee,content:ve,sdf:R,version:0,userImage:Ee}),Ee.onAdd&&Ee.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var E=this.style.getImage(h);if(!E)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=g instanceof Vs||Yi&&g instanceof Yi?p.browser.getImageData(g):g,R=T.width,Z=T.height,ee=T.data;return R===void 0||Z===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==E.data.width||Z!==E.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(E.data.replace(ee,!(g instanceof Vs||Yi&&g instanceof Yi)),void this.style.updateImage(h,E))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,E){return this.style.setLayerZoomRange(h,g,E),this._update(!0)},u.prototype.setFilter=function(h,g,E){return E===void 0&&(E={}),this.style.setFilter(h,g,E),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,E,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,g,E,T),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,E,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,g,E,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=L.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=L.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=L.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var E=this._containerDimensions();this._resizeCanvas(E[0],E[1]);var T=this._controlContainer=L.create("div","mapboxgl-control-container",h),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){R[Z]=L.create("div","mapboxgl-ctrl-"+Z,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var E=p.browser.devicePixelRatio||1;this._canvas.width=E*h,this._canvas.height=E*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=p.extend({},S.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new Da(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,E=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,g),T=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ee=this.transform.zoom,ve=p.browser.now();this.style.zoomHistory.update(ee,ve);var _e=new p.EvaluationParameters(ee,{now:ve,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ee=_e.crossFadingFactor();Ee===1&&Ee===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=Ee),this.style.update(_e)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var We=p.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,g),setTimeout(function(){var Fe=R.getQueryObjectEXT(g,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(g),E.fire(new p.Event("gpu-timing-frame",{cpuTime:We,gpuTime:Fe}))},50)}if(this.listens("gpu-timing-layer")){var He=this.painter.collectGpuTimers();setTimeout(function(){var Fe=E.painter.queryGpuTimers(He);E.fire(new p.Event("gpu-timing-layer",{layerTimes:Fe}))},50)}var lt=this._sourcesDirty||this._styleDirty||this._placementDirty;return lt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||lt||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var E=this.painter.context.gl.getExtension("WEBGL_lose_context");E&&E.loseContext(),bl(this._canvasContainer),bl(this._controlContainer),bl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},a.version.get=function(){return p.version},Object.defineProperties(u.prototype,a),u}(rc);function bl(n){n.parentNode&&n.parentNode.removeChild(n)}var gc={showCompass:!0,showZoom:!0,visualizePitch:!1},Cu=function(n){var u=this;this.options=p.extend({},gc,n),this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return u._map.zoomIn({},{originalEvent:a})}),L.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return u._map.zoomOut({},{originalEvent:a})}),L.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:a}):u._map.resetNorth({},{originalEvent:a})}),this._compassIcon=L.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Cu.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),u=n===this._map.getMaxZoom(),a=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},Cu.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},Cu.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ts(this._map,this._compass,this.options.visualizePitch)),this._container},Cu.prototype.onRemove=function(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Cu.prototype._createButton=function(n,u){var a=L.create("button",n,this._container);return a.type="button",a.addEventListener("click",u),a},Cu.prototype._setButtonTitle=function(n,u){var a=this._map._getUIString("NavigationControl."+u);n.title=a,n.setAttribute("aria-label",a)};var Ts=function(n,u,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new dc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,a&&(this.mousePitch=new tl({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),L.addEventListener(u,"mousedown",this.mousedown),L.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(u,"touchmove",this.touchmove),L.addEventListener(u,"touchend",this.touchend),L.addEventListener(u,"touchcancel",this.reset)};function il(n,u,a){if(n=new p.LngLat(n.lng,n.lat),u){var h=new p.LngLat(n.lng-360,n.lat),g=new p.LngLat(n.lng+360,n.lat),E=a.locationPoint(n).distSqr(u);a.locationPoint(h).distSqr(u)<E?n=h:a.locationPoint(g).distSqr(u)<E&&(n=g)}for(;Math.abs(n.lng-a.center.lng)>180;){var T=a.locationPoint(n);if(T.x>=0&&T.y>=0&&T.x<=a.width&&T.y<=a.height)break;n.lng>a.center.lng?n.lng-=360:n.lng+=360}return n}Ts.prototype.down=function(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),L.disableDrag()},Ts.prototype.move=function(n,u){var a=this.map,h=this.mouseRotate.mousemoveWindow(n,u);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(n,u);g&&g.pitchDelta&&a.setPitch(a.getPitch()+g.pitchDelta)}},Ts.prototype.off=function(){var n=this.element;L.removeEventListener(n,"mousedown",this.mousedown),L.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(n,"touchmove",this.touchmove),L.removeEventListener(n,"touchend",this.touchend),L.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},Ts.prototype.offTemp=function(){L.enableDrag(),L.removeEventListener(p.window,"mousemove",this.mousemove),L.removeEventListener(p.window,"mouseup",this.mouseup)},Ts.prototype.mousedown=function(n){this.down(p.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),L.mousePos(this.element,n)),L.addEventListener(p.window,"mousemove",this.mousemove),L.addEventListener(p.window,"mouseup",this.mouseup)},Ts.prototype.mousemove=function(n){this.move(n,L.mousePos(this.element,n))},Ts.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},Ts.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},Ts.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},Ts.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ts.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Pu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yc(n,u,a){var h=n.classList;for(var g in Pu)h.remove("mapboxgl-"+a+"-anchor-"+g);h.add("mapboxgl-"+a+"-anchor-"+u)}var nc,_c=function(n){function u(a,h){if(n.call(this),(a instanceof p.window.HTMLElement||h)&&(a=p.extend({element:a},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div"),this._element.setAttribute("aria-label","Map marker");var g=L.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var E=L.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");var T=L.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=L.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var Z=0,ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<ee.length;Z+=1){var ve=ee[Z],_e=L.createNS("http://www.w3.org/2000/svg","ellipse");_e.setAttributeNS(null,"opacity","0.04"),_e.setAttributeNS(null,"cx","10.5"),_e.setAttributeNS(null,"cy","5.80029008"),_e.setAttributeNS(null,"rx",ve.rx),_e.setAttributeNS(null,"ry",ve.ry),R.appendChild(_e)}var Ee=L.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"fill",this._color);var We=L.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ee.appendChild(We);var He=L.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"opacity","0.25"),He.setAttributeNS(null,"fill","#000000");var lt=L.createNS("http://www.w3.org/2000/svg","path");lt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),He.appendChild(lt);var Fe=L.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Fe.setAttributeNS(null,"fill","#FFFFFF");var st=L.createNS("http://www.w3.org/2000/svg","g");st.setAttributeNS(null,"transform","translate(8.0, 8.0)");var bt=L.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#000000"),bt.setAttributeNS(null,"opacity","0.25"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962");var Gt=L.createNS("http://www.w3.org/2000/svg","circle");Gt.setAttributeNS(null,"fill","#FFFFFF"),Gt.setAttributeNS(null,"cx","5.5"),Gt.setAttributeNS(null,"cy","5.5"),Gt.setAttributeNS(null,"r","5.4999962"),st.appendChild(bt),st.appendChild(Gt),T.appendChild(R),T.appendChild(Ee),T.appendChild(He),T.appendChild(Fe),T.appendChild(st),g.appendChild(T),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(ur){ur.preventDefault()}),this._element.addEventListener("mousedown",function(ur){ur.preventDefault()}),yc(this._element,this._anchor,"marker"),this._popup=null}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(a){var h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(a){var h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},u.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=il(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,Pu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(a){return this._offset=p.Point.convert(a),this._update(),this},u.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),Vc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},zl=0,tu=!1,xc=function(n){function u(a){n.call(this),this.options=p.extend({},Vc,a),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){var h;return this._map=a,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,nc!==void 0?h(nc):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(nc=g.state!=="denied")}):h(nc=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zl=0,tu=!1},u.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),g=a.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",a)),this._finish()}},u.prototype._updateCamera=function(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude),g=a.coords.accuracy,E=this._map.getBearing(),T=p.extend({bearing:E},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),T,{geolocateSource:!0})},u.prototype._updateMarker=function(a){if(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),g=this._map.unproject([1,a]),E=h.distanceTo(g),T=Math.ceil(2*this._accuracy/E);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&tu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",a)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=L.create("button","mapboxgl-ctrl-geolocate",this._container),L.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var E=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new _c(this._dotElement),this._circleElement=L.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _c({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zl--,tu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++zl>1?(a={maximumAge:6e5,timeout:0},tu=!0):(a=this.options.positionOptions,tu=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),al={maxWidth:100,unit:"metric"},Mu=function(n){this.options=p.extend({},al,n),p.bindAll(["_onMove","setUnit"],this)};function Nl(n,u,a){var h=a&&a.maxWidth||100,g=n._container.clientHeight/2,E=n.unproject([0,g]),T=n.unproject([h,g]),R=E.distanceTo(T);if(a&&a.unit==="imperial"){var Z=3.2808*R;Z>5280?mu(u,h,Z/5280,n._getUIString("ScaleControl.Miles")):mu(u,h,Z,n._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?mu(u,h,R/1852,n._getUIString("ScaleControl.NauticalMiles")):R>=1e3?mu(u,h,R/1e3,n._getUIString("ScaleControl.Kilometers")):mu(u,h,R,n._getUIString("ScaleControl.Meters"))}function mu(n,u,a,h){var g,E,T,R=(g=a,(E=Math.pow(10,(""+Math.floor(g)).length-1))*(T=(T=g/E)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(Z){var ee=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*ee)/ee}(T)));n.style.width=u*(R/a)+"px",n.innerHTML=R+"&nbsp;"+h}Mu.prototype.getDefaultPosition=function(){return"bottom-left"},Mu.prototype._onMove=function(){Nl(this._map,this._container,this.options)},Mu.prototype.onAdd=function(n){return this._map=n,this._container=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Mu.prototype.onRemove=function(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Mu.prototype.setUnit=function(n){this.options.unit=n,Nl(this._map,this._container,this.options)};var ru=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof p.window.HTMLElement?this._container=n.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};ru.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ru.prototype.onRemove=function(){L.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},ru.prototype._setupUI=function(){var n=this._fullscreenButton=L.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ru.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},ru.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ru.prototype._isFullscreen=function(){return this._fullscreen},ru.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ru.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var bc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Sc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Gc=function(n){function u(a){n.call(this),this.options=p.extend(Object.create(bc),a),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(a){return this.setDOMContent(p.window.document.createTextNode(a))},u.prototype.setHTML=function(a){var h,g=p.window.document.createDocumentFragment(),E=p.window.document.createElement("body");for(E.innerHTML=a;h=E.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},u.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},u.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},u.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},u.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=L.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(a){this._update(a.point)},u.prototype._onMouseMove=function(a){this._update(a.point)},u.prototype._onDrag=function(a){this._update(a.point)},u.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=L.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=L.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(_e){return h._container.classList.add(_e)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=il(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var g=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),E=this.options.anchor,T=function _e(Ee){if(Ee){if(typeof Ee=="number"){var We=Math.round(Math.sqrt(.5*Math.pow(Ee,2)));return{center:new p.Point(0,0),top:new p.Point(0,Ee),"top-left":new p.Point(We,We),"top-right":new p.Point(-We,We),bottom:new p.Point(0,-Ee),"bottom-left":new p.Point(We,-We),"bottom-right":new p.Point(-We,-We),left:new p.Point(Ee,0),right:new p.Point(-Ee,0)}}if(Ee instanceof p.Point||Array.isArray(Ee)){var He=p.Point.convert(Ee);return{center:He,top:He,"top-left":He,"top-right":He,bottom:He,"bottom-left":He,"bottom-right":He,left:He,right:He}}return{center:p.Point.convert(Ee.center||[0,0]),top:p.Point.convert(Ee.top||[0,0]),"top-left":p.Point.convert(Ee["top-left"]||[0,0]),"top-right":p.Point.convert(Ee["top-right"]||[0,0]),bottom:p.Point.convert(Ee.bottom||[0,0]),"bottom-left":p.Point.convert(Ee["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Ee["bottom-right"]||[0,0]),left:p.Point.convert(Ee.left||[0,0]),right:p.Point.convert(Ee.right||[0,0])}}return _e(new p.Point(0,0))}(this.options.offset);if(!E){var R,Z=this._container.offsetWidth,ee=this._container.offsetHeight;R=g.y+T.bottom.y<ee?["top"]:g.y>this._map.transform.height-ee?["bottom"]:[],g.x<Z/2?R.push("left"):g.x>this._map.transform.width-Z/2&&R.push("right"),E=R.length===0?"bottom":R.join("-")}var ve=g.add(T[E]).round();L.setTransform(this._container,Pu[E]+" translate("+ve.x+"px,"+ve.y+"px)"),yc(this._container,E,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(Sc);a&&a.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),Ec={version:p.version,supported:S,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:of,NavigationControl:Cu,GeolocateControl:xc,AttributionControl:is,ScaleControl:Mu,FullscreenControl:ru,Popup:Gc,Marker:_c,Style:xa,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){gr().acquire(Xt)},clearPrewarmedResources:function(){var n=Hr;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Xt),Hr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(n){p.config.ACCESS_TOKEN=n},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(n){p.config.API_URL=n},get workerCount(){return mr.workerCount},set workerCount(n){mr.workerCount=n},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){p.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){p.clearTileCache(n)},workerUrl:""};return Ec}),G})},86387:function(ft,C,y){"use strict";Object.defineProperty(C,"__esModule",{value:!0}),C.default=function(Wt){return(0,b.default)((0,q.default)(Wt)&&Wt.length>=1,"Must merge at least 1 JSON schema."),S.default.apply(void 0,[{}].concat(zt(Wt),[function(Mt,wt,ot){if(!(0,X.default)(Mt)){if(ot==="required")return(0,ae.default)(Mt.concat(wt));if((0,se.default)(Mt)){if(!(0,se.default)(wt))throw new Error('Failed to merge schemas because "'+ot+'" has different values.');return}b.default.deepEqual(Mt,wt,'Failed to merge schemas because "'+ot+'" has different values: '+JSON.stringify(Mt)+" and "+JSON.stringify(wt)+".")}}]))};var G=y(48583),b=Ft(G),p=y(38554),S=Ft(p),L=y(59722),X=Ft(L),N=y(53778),q=Ft(N),K=y(97644),ae=Ft(K),xe=y(8146),se=Ft(xe);function Ft(Wt){return Wt&&Wt.__esModule?Wt:{default:Wt}}function zt(Wt){if(Array.isArray(Wt)){for(var Mt=0,wt=Array(Wt.length);Mt<Wt.length;Mt++)wt[Mt]=Wt[Mt];return wt}else return Array.from(Wt)}ft.exports=C.default},28660:function(ft,C,y){var G=y(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var b;(function(p){(function(S){var L=typeof y.g=="object"?y.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),X=N(p);typeof L.Reflect=="undefined"?L.Reflect=p:X=N(L.Reflect,X),S(X);function N(q,K){return function(ae,xe){typeof q[ae]!="function"&&Object.defineProperty(q,ae,{configurable:!0,writable:!0,value:xe}),K&&K(ae,xe)}}})(function(S){var L=Object.prototype.hasOwnProperty,X=typeof Symbol=="function",N=X&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",q=X&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",K=typeof Object.create=="function",ae={__proto__:[]}instanceof Array,xe=!K&&!ae,se={create:K?function(){return Or(Object.create(null))}:ae?function(){return Or({__proto__:null})}:function(){return Or({})},has:xe?function(Je,At){return L.call(Je,At)}:function(Je,At){return At in Je},get:xe?function(Je,At){return L.call(Je,At)?Je[At]:void 0}:function(Je,At){return Je[At]}},Ft=Object.getPrototypeOf(Function),zt=typeof G=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Wt=!zt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:wr(),Mt=!zt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Tr(),wt=!zt&&typeof WeakMap=="function"?WeakMap:Mr(),ot=new wt;function tt(Je,At,_t,pr){if(_r(_t)){if(!w(Je))throw new TypeError;if(!de(At))throw new TypeError;return it(Je,At)}else{if(!w(Je))throw new TypeError;if(!ne(At))throw new TypeError;if(!ne(pr)&&!_r(pr)&&!Yr(pr))throw new TypeError;return Yr(pr)&&(pr=void 0),_t=jt(_t),Jt(Je,At,_t,pr)}}S("decorate",tt);function Yt(Je,At){function _t(pr,en){if(!ne(pr))throw new TypeError;if(!_r(en)&&!Ue(en))throw new TypeError;et(Je,At,pr,en)}return _t}S("metadata",Yt);function ke(Je,At,_t,pr){if(!ne(_t))throw new TypeError;return _r(pr)||(pr=jt(pr)),et(Je,At,_t,pr)}S("defineMetadata",ke);function Ne(Je,At,_t){if(!ne(At))throw new TypeError;return _r(_t)||(_t=jt(_t)),$e(Je,At,_t)}S("hasMetadata",Ne);function Be(Je,At,_t){if(!ne(At))throw new TypeError;return _r(_t)||(_t=jt(_t)),Ae(Je,At,_t)}S("hasOwnMetadata",Be);function Ie(Je,At,_t){if(!ne(At))throw new TypeError;return _r(_t)||(_t=jt(_t)),Ce(Je,At,_t)}S("getMetadata",Ie);function pt(Je,At,_t){if(!ne(At))throw new TypeError;return _r(_t)||(_t=jt(_t)),Pe(Je,At,_t)}S("getOwnMetadata",pt);function oe(Je,At){if(!ne(Je))throw new TypeError;return _r(At)||(At=jt(At)),Se(Je,At)}S("getMetadataKeys",oe);function re(Je,At){if(!ne(Je))throw new TypeError;return _r(At)||(At=jt(At)),Pt(Je,At)}S("getOwnMetadataKeys",re);function ue(Je,At,_t){if(!ne(At))throw new TypeError;_r(_t)||(_t=jt(_t));var pr=ce(At,_t,!1);if(_r(pr)||!pr.delete(Je))return!1;if(pr.size>0)return!0;var en=ot.get(At);return en.delete(_t),en.size>0||ot.delete(At),!0}S("deleteMetadata",ue);function it(Je,At){for(var _t=Je.length-1;_t>=0;--_t){var pr=Je[_t],en=pr(At);if(!_r(en)&&!Yr(en)){if(!de(en))throw new TypeError;At=en}}return At}function Jt(Je,At,_t,pr){for(var en=Je.length-1;en>=0;--en){var mt=Je[en],Nt=mt(At,_t,pr);if(!_r(Nt)&&!Yr(Nt)){if(!ne(Nt))throw new TypeError;pr=Nt}}return pr}function ce(Je,At,_t){var pr=ot.get(Je);if(_r(pr)){if(!_t)return;pr=new Wt,ot.set(Je,pr)}var en=pr.get(At);if(_r(en)){if(!_t)return;en=new Wt,pr.set(At,en)}return en}function $e(Je,At,_t){var pr=Ae(Je,At,_t);if(pr)return!0;var en=$t(At);return Yr(en)?!1:$e(Je,en,_t)}function Ae(Je,At,_t){var pr=ce(At,_t,!1);return _r(pr)?!1:at(pr.has(Je))}function Ce(Je,At,_t){var pr=Ae(Je,At,_t);if(pr)return Pe(Je,At,_t);var en=$t(At);if(!Yr(en))return Ce(Je,en,_t)}function Pe(Je,At,_t){var pr=ce(At,_t,!1);if(!_r(pr))return pr.get(Je)}function et(Je,At,_t,pr){var en=ce(_t,pr,!0);en.set(Je,At)}function Se(Je,At){var _t=Pt(Je,At),pr=$t(Je);if(pr===null)return _t;var en=Se(pr,At);if(en.length<=0)return _t;if(_t.length<=0)return en;for(var mt=new Mt,Nt=[],ar=0,xr=_t;ar<xr.length;ar++){var xn=xr[ar],In=mt.has(xn);In||(mt.add(xn),Nt.push(xn))}for(var Ei=0,Ai=en;Ei<Ai.length;Ei++){var xn=Ai[Ei],In=mt.has(xn);In||(mt.add(xn),Nt.push(xn))}return Nt}function Pt(Je,At){var _t=[],pr=ce(Je,At,!1);if(_r(pr))return _t;for(var en=pr.keys(),mt=Tt(en),Nt=0;;){var ar=H(mt);if(!ar)return _t.length=Nt,_t;var xr=Dt(ar);try{_t[Nt]=xr}catch(xn){try{Qt(mt)}finally{throw xn}}Nt++}}function vr(Je){if(Je===null)return 1;switch(typeof Je){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Je===null?1:6;default:return 6}}function _r(Je){return Je===void 0}function Yr(Je){return Je===null}function tr(Je){return typeof Je=="symbol"}function ne(Je){return typeof Je=="object"?Je!==null:typeof Je=="function"}function be(Je,At){switch(vr(Je)){case 0:return Je;case 1:return Je;case 2:return Je;case 3:return Je;case 4:return Je;case 5:return Je}var _t=At===3?"string":At===5?"number":"default",pr=Qe(Je,N);if(pr!==void 0){var en=pr.call(Je,_t);if(ne(en))throw new TypeError;return en}return De(Je,_t==="default"?"number":_t)}function De(Je,At){if(At==="string"){var _t=Je.toString;if(F(_t)){var pr=_t.call(Je);if(!ne(pr))return pr}var en=Je.valueOf;if(F(en)){var pr=en.call(Je);if(!ne(pr))return pr}}else{var en=Je.valueOf;if(F(en)){var pr=en.call(Je);if(!ne(pr))return pr}var mt=Je.toString;if(F(mt)){var pr=mt.call(Je);if(!ne(pr))return pr}}throw new TypeError}function at(Je){return!!Je}function kt(Je){return""+Je}function jt(Je){var At=be(Je,3);return tr(At)?At:kt(At)}function w(Je){return Array.isArray?Array.isArray(Je):Je instanceof Object?Je instanceof Array:Object.prototype.toString.call(Je)==="[object Array]"}function F(Je){return typeof Je=="function"}function de(Je){return typeof Je=="function"}function Ue(Je){switch(vr(Je)){case 3:return!0;case 4:return!0;default:return!1}}function Qe(Je,At){var _t=Je[At];if(_t!=null){if(!F(_t))throw new TypeError;return _t}}function Tt(Je){var At=Qe(Je,q);if(!F(At))throw new TypeError;var _t=At.call(Je);if(!ne(_t))throw new TypeError;return _t}function Dt(Je){return Je.value}function H(Je){var At=Je.next();return At.done?!1:At}function Qt(Je){var At=Je.return;At&&At.call(Je)}function $t(Je){var At=Object.getPrototypeOf(Je);if(typeof Je!="function"||Je===Ft||At!==Ft)return At;var _t=Je.prototype,pr=_t&&Object.getPrototypeOf(_t);if(pr==null||pr===Object.prototype)return At;var en=pr.constructor;return typeof en!="function"||en===Je?At:en}function wr(){var Je={},At=[],_t=function(){function Nt(ar,xr,xn){this._index=0,this._keys=ar,this._values=xr,this._selector=xn}return Nt.prototype["@@iterator"]=function(){return this},Nt.prototype[q]=function(){return this},Nt.prototype.next=function(){var ar=this._index;if(ar>=0&&ar<this._keys.length){var xr=this._selector(this._keys[ar],this._values[ar]);return ar+1>=this._keys.length?(this._index=-1,this._keys=At,this._values=At):this._index++,{value:xr,done:!1}}return{value:void 0,done:!0}},Nt.prototype.throw=function(ar){throw this._index>=0&&(this._index=-1,this._keys=At,this._values=At),ar},Nt.prototype.return=function(ar){return this._index>=0&&(this._index=-1,this._keys=At,this._values=At),{value:ar,done:!0}},Nt}();return function(){function Nt(){this._keys=[],this._values=[],this._cacheKey=Je,this._cacheIndex=-2}return Object.defineProperty(Nt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Nt.prototype.has=function(ar){return this._find(ar,!1)>=0},Nt.prototype.get=function(ar){var xr=this._find(ar,!1);return xr>=0?this._values[xr]:void 0},Nt.prototype.set=function(ar,xr){var xn=this._find(ar,!0);return this._values[xn]=xr,this},Nt.prototype.delete=function(ar){var xr=this._find(ar,!1);if(xr>=0){for(var xn=this._keys.length,In=xr+1;In<xn;In++)this._keys[In-1]=this._keys[In],this._values[In-1]=this._values[In];return this._keys.length--,this._values.length--,ar===this._cacheKey&&(this._cacheKey=Je,this._cacheIndex=-2),!0}return!1},Nt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Je,this._cacheIndex=-2},Nt.prototype.keys=function(){return new _t(this._keys,this._values,pr)},Nt.prototype.values=function(){return new _t(this._keys,this._values,en)},Nt.prototype.entries=function(){return new _t(this._keys,this._values,mt)},Nt.prototype["@@iterator"]=function(){return this.entries()},Nt.prototype[q]=function(){return this.entries()},Nt.prototype._find=function(ar,xr){return this._cacheKey!==ar&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ar)),this._cacheIndex<0&&xr&&(this._cacheIndex=this._keys.length,this._keys.push(ar),this._values.push(void 0)),this._cacheIndex},Nt}();function pr(Nt,ar){return Nt}function en(Nt,ar){return ar}function mt(Nt,ar){return[Nt,ar]}}function Tr(){return function(){function Je(){this._map=new Wt}return Object.defineProperty(Je.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Je.prototype.has=function(At){return this._map.has(At)},Je.prototype.add=function(At){return this._map.set(At,At),this},Je.prototype.delete=function(At){return this._map.delete(At)},Je.prototype.clear=function(){this._map.clear()},Je.prototype.keys=function(){return this._map.keys()},Je.prototype.values=function(){return this._map.values()},Je.prototype.entries=function(){return this._map.entries()},Je.prototype["@@iterator"]=function(){return this.keys()},Je.prototype[q]=function(){return this.keys()},Je}()}function Mr(){var Je=16,At=se.create(),_t=pr();return function(){function xr(){this._key=pr()}return xr.prototype.has=function(xn){var In=en(xn,!1);return In!==void 0?se.has(In,this._key):!1},xr.prototype.get=function(xn){var In=en(xn,!1);return In!==void 0?se.get(In,this._key):void 0},xr.prototype.set=function(xn,In){var Ei=en(xn,!0);return Ei[this._key]=In,this},xr.prototype.delete=function(xn){var In=en(xn,!1);return In!==void 0?delete In[this._key]:!1},xr.prototype.clear=function(){this._key=pr()},xr}();function pr(){var xr;do xr="@@WeakMap@@"+ar();while(se.has(At,xr));return At[xr]=!0,xr}function en(xr,xn){if(!L.call(xr,_t)){if(!xn)return;Object.defineProperty(xr,_t,{value:se.create()})}return xr[_t]}function mt(xr,xn){for(var In=0;In<xn;++In)xr[In]=Math.random()*255|0;return xr}function Nt(xr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(xr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(xr)):mt(new Uint8Array(xr),xr):mt(new Array(xr),xr)}function ar(){var xr=Nt(Je);xr[6]=xr[6]&79|64,xr[8]=xr[8]&191|128;for(var xn="",In=0;In<Je;++In){var Ei=xr[In];(In===4||In===6||In===8)&&(xn+="-"),Ei<16&&(xn+="0"),xn+=Ei.toString(16).toLowerCase()}return xn}}function Or(Je){return Je.__=void 0,delete Je.__,Je}})})(b||(b={}))},81550:function(ft){(function(C,y){ft.exports=y()})(this,function(){"use strict";var C=function(U){return U instanceof Uint8Array||U instanceof Uint16Array||U instanceof Uint32Array||U instanceof Int8Array||U instanceof Int16Array||U instanceof Int32Array||U instanceof Float32Array||U instanceof Float64Array||U instanceof Uint8ClampedArray},y=function(U,Te){for(var ze=Object.keys(Te),nr=0;nr<ze.length;++nr)U[ze[nr]]=Te[ze[nr]];return U},G=`
`;function b(U){return typeof atob!="undefined"?atob(U):"base64:"+U}function p(U){var Te=new Error("(regl) "+U);throw console.error(Te),Te}function S(U,Te){U||p(Te)}function L(U){return U?": "+U:""}function X(U,Te,ze){U in Te||p("unknown parameter ("+U+")"+L(ze)+". possible values: "+Object.keys(Te).join())}function N(U,Te){C(U)||p("invalid parameter type"+L(Te)+". must be a typed array")}function q(U,Te){switch(Te){case"number":return typeof U=="number";case"object":return typeof U=="object";case"string":return typeof U=="string";case"boolean":return typeof U=="boolean";case"function":return typeof U=="function";case"undefined":return typeof U=="undefined";case"symbol":return typeof U=="symbol"}}function K(U,Te,ze){q(U,Te)||p("invalid parameter type"+L(ze)+". expected "+Te+", got "+typeof U)}function ae(U,Te){U>=0&&(U|0)===U||p("invalid parameter type, ("+U+")"+L(Te)+". must be a nonnegative integer")}function xe(U,Te,ze){Te.indexOf(U)<0&&p("invalid value"+L(ze)+". must be one of: "+Te)}var se=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ft(U){Object.keys(U).forEach(function(Te){se.indexOf(Te)<0&&p('invalid regl constructor argument "'+Te+'". must be one of '+se)})}function zt(U,Te){for(U=U+"";U.length<Te;)U=" "+U;return U}function Wt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Mt(U,Te){this.number=U,this.line=Te,this.errors=[]}function wt(U,Te,ze){this.file=U,this.line=Te,this.message=ze}function ot(){var U=new Error,Te=(U.stack||U).toString(),ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Te);if(ze)return ze[1];var nr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Te);return nr?nr[1]:"unknown"}function tt(){var U=new Error,Te=(U.stack||U).toString(),ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Te);if(ze)return ze[1];var nr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Te);return nr?nr[1]:"unknown"}function Yt(U,Te){var ze=U.split(`
`),nr=1,Ar=0,qt={unknown:new Wt,0:new Wt};qt.unknown.name=qt[0].name=Te||ot(),qt.unknown.lines.push(new Mt(0,""));for(var dr=0;dr<ze.length;++dr){var Zr=ze[dr],Kr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Zr);if(Kr)switch(Kr[1]){case"line":var qr=/(\d+)(\s+\d+)?/.exec(Kr[2]);qr&&(nr=qr[1]|0,qr[2]&&(Ar=qr[2]|0,Ar in qt||(qt[Ar]=new Wt)));break;case"define":var Wr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Kr[2]);Wr&&(qt[Ar].name=Wr[1]?b(Wr[2]):Wr[2]);break}qt[Ar].lines.push(new Mt(nr++,Zr))}return Object.keys(qt).forEach(function(on){var hn=qt[on];hn.lines.forEach(function(Vr){hn.index[Vr.number]=Vr})}),qt}function ke(U){var Te=[];return U.split(`
`).forEach(function(ze){if(!(ze.length<5)){var nr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ze);nr?Te.push(new wt(nr[1]|0,nr[2]|0,nr[3].trim())):ze.length>0&&Te.push(new wt("unknown",0,ze))}}),Te}function Ne(U,Te){Te.forEach(function(ze){var nr=U[ze.file];if(nr){var Ar=nr.index[ze.line];if(Ar){Ar.errors.push(ze),nr.hasErrors=!0;return}}U.unknown.hasErrors=!0,U.unknown.lines[0].errors.push(ze)})}function Be(U,Te,ze,nr,Ar){if(!U.getShaderParameter(Te,U.COMPILE_STATUS)){var qt=U.getShaderInfoLog(Te),dr=nr===U.FRAGMENT_SHADER?"fragment":"vertex";Jt(ze,"string",dr+" shader source must be a string",Ar);var Zr=Yt(ze,Ar),Kr=ke(qt);Ne(Zr,Kr),Object.keys(Zr).forEach(function(qr){var Wr=Zr[qr];if(!Wr.hasErrors)return;var on=[""],hn=[""];function Vr(sn,Zt){on.push(sn),hn.push(Zt||"")}Vr("file number "+qr+": "+Wr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Wr.lines.forEach(function(sn){if(sn.errors.length>0){Vr(zt(sn.number,4)+"|  ","background-color:yellow; font-weight:bold"),Vr(sn.line+G,"color:red; background-color:yellow; font-weight:bold");var Zt=0;sn.errors.forEach(function(cr){var Gr=cr.message,mn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Gr);if(mn){var Dr=mn[1];switch(Gr=mn[2],Dr){case"assign":Dr="=";break}Zt=Math.max(sn.line.indexOf(Dr,Zt),0)}else Zt=0;Vr(zt("| ",6)),Vr(zt("^^^",Zt+3)+G,"font-weight:bold"),Vr(zt("| ",6)),Vr(Gr+G,"font-weight:bold")}),Vr(zt("| ",6)+G)}else Vr(zt(sn.number,4)+"|  "),Vr(sn.line+G,"color:red")}),typeof document!="undefined"&&!window.chrome?(hn[0]=on.join("%c"),console.log.apply(console,hn)):console.log(on.join(""))}),S.raise("Error compiling "+dr+" shader, "+Zr[0].name)}}function Ie(U,Te,ze,nr,Ar){if(!U.getProgramParameter(Te,U.LINK_STATUS)){var qt=U.getProgramInfoLog(Te),dr=Yt(ze,Ar),Zr=Yt(nr,Ar),Kr='Error linking program with vertex shader, "'+Zr[0].name+'", and fragment shader "'+dr[0].name+'"';typeof document!="undefined"?console.log("%c"+Kr+G+"%c"+qt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Kr+G+qt),S.raise(Kr)}}function pt(U){U._commandRef=ot()}function oe(U,Te,ze,nr){pt(U);function Ar(Kr){return Kr?nr.id(Kr):0}U._fragId=Ar(U.static.frag),U._vertId=Ar(U.static.vert);function qt(Kr,qr){Object.keys(qr).forEach(function(Wr){Kr[nr.id(Wr)]=!0})}var dr=U._uniformSet={};qt(dr,Te.static),qt(dr,Te.dynamic);var Zr=U._attributeSet={};qt(Zr,ze.static),qt(Zr,ze.dynamic),U._hasCount="count"in U.static||"count"in U.dynamic||"elements"in U.static||"elements"in U.dynamic}function re(U,Te){var ze=tt();p(U+" in command "+(Te||ot())+(ze==="unknown"?"":" called from "+ze))}function ue(U,Te,ze){U||re(Te,ze||ot())}function it(U,Te,ze,nr){U in Te||re("unknown parameter ("+U+")"+L(ze)+". possible values: "+Object.keys(Te).join(),nr||ot())}function Jt(U,Te,ze,nr){q(U,Te)||re("invalid parameter type"+L(ze)+". expected "+Te+", got "+typeof U,nr||ot())}function ce(U){U()}function $e(U,Te,ze){U.texture?xe(U.texture._texture.internalformat,Te,"unsupported texture format for attachment"):xe(U.renderbuffer._renderbuffer.format,ze,"unsupported renderbuffer format for attachment")}var Ae=33071,Ce=9728,Pe=9984,et=9985,Se=9986,Pt=9987,vr=5120,_r=5121,Yr=5122,tr=5123,ne=5124,be=5125,De=5126,at=32819,kt=32820,jt=33635,w=34042,F=36193,de={};de[vr]=de[_r]=1,de[Yr]=de[tr]=de[F]=de[jt]=de[at]=de[kt]=2,de[ne]=de[be]=de[De]=de[w]=4;function Ue(U,Te){return U===kt||U===at||U===jt?2:U===w?4:de[U]*Te}function Qe(U){return!(U&U-1)&&!!U}function Tt(U,Te,ze){var nr,Ar=Te.width,qt=Te.height,dr=Te.channels;S(Ar>0&&Ar<=ze.maxTextureSize&&qt>0&&qt<=ze.maxTextureSize,"invalid texture shape"),(U.wrapS!==Ae||U.wrapT!==Ae)&&S(Qe(Ar)&&Qe(qt),"incompatible wrap mode for texture, both width and height must be power of 2"),Te.mipmask===1?Ar!==1&&qt!==1&&S(U.minFilter!==Pe&&U.minFilter!==Se&&U.minFilter!==et&&U.minFilter!==Pt,"min filter requires mipmap"):(S(Qe(Ar)&&Qe(qt),"texture must be a square power of 2 to support mipmapping"),S(Te.mipmask===(Ar<<1)-1,"missing or incomplete mipmap data")),Te.type===De&&(ze.extensions.indexOf("oes_texture_float_linear")<0&&S(U.minFilter===Ce&&U.magFilter===Ce,"filter not supported, must enable oes_texture_float_linear"),S(!U.genMipmaps,"mipmap generation not supported with float textures"));var Zr=Te.images;for(nr=0;nr<16;++nr)if(Zr[nr]){var Kr=Ar>>nr,qr=qt>>nr;S(Te.mipmask&1<<nr,"missing mipmap data");var Wr=Zr[nr];if(S(Wr.width===Kr&&Wr.height===qr,"invalid shape for mip images"),S(Wr.format===Te.format&&Wr.internalformat===Te.internalformat&&Wr.type===Te.type,"incompatible type for mip image"),!Wr.compressed)if(Wr.data){var on=Math.ceil(Ue(Wr.type,dr)*Kr/Wr.unpackAlignment)*Wr.unpackAlignment;S(Wr.data.byteLength===on*qr,"invalid data for image, buffer size is inconsistent with image format")}else Wr.element||Wr.copy}else U.genMipmaps||S((Te.mipmask&1<<nr)==0,"extra mipmap data");Te.compressed&&S(!U.genMipmaps,"mipmap generation for compressed images not supported")}function Dt(U,Te,ze,nr){var Ar=U.width,qt=U.height,dr=U.channels;S(Ar>0&&Ar<=nr.maxTextureSize&&qt>0&&qt<=nr.maxTextureSize,"invalid texture shape"),S(Ar===qt,"cube map must be square"),S(Te.wrapS===Ae&&Te.wrapT===Ae,"wrap mode not supported by cube map");for(var Zr=0;Zr<ze.length;++Zr){var Kr=ze[Zr];S(Kr.width===Ar&&Kr.height===qt,"inconsistent cube map face shape"),Te.genMipmaps&&(S(!Kr.compressed,"can not generate mipmap for compressed textures"),S(Kr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var qr=Kr.images,Wr=0;Wr<16;++Wr){var on=qr[Wr];if(on){var hn=Ar>>Wr,Vr=qt>>Wr;S(Kr.mipmask&1<<Wr,"missing mipmap data"),S(on.width===hn&&on.height===Vr,"invalid shape for mip images"),S(on.format===U.format&&on.internalformat===U.internalformat&&on.type===U.type,"incompatible type for mip image"),on.compressed||(on.data?S(on.data.byteLength===hn*Vr*Math.max(Ue(on.type,dr),on.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):on.element||on.copy)}}}}var H=y(S,{optional:ce,raise:p,commandRaise:re,command:ue,parameter:X,commandParameter:it,constructor:Ft,type:K,commandType:Jt,isTypedArray:N,nni:ae,oneOf:xe,shaderError:Be,linkError:Ie,callSite:tt,saveCommandRef:pt,saveDrawInfo:oe,framebufferFormat:$e,guessCommand:ot,texture2D:Tt,textureCube:Dt}),Qt=0,$t=0,wr=5,Tr=6;function Mr(U,Te){this.id=Qt++,this.type=U,this.data=Te}function Or(U){return U.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Je(U){if(U.length===0)return[];var Te=U.charAt(0),ze=U.charAt(U.length-1);if(U.length>1&&Te===ze&&(Te==='"'||Te==="'"))return['"'+Or(U.substr(1,U.length-2))+'"'];var nr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(U);if(nr)return Je(U.substr(0,nr.index)).concat(Je(nr[1])).concat(Je(U.substr(nr.index+nr[0].length)));var Ar=U.split(".");if(Ar.length===1)return['"'+Or(U)+'"'];for(var qt=[],dr=0;dr<Ar.length;++dr)qt=qt.concat(Je(Ar[dr]));return qt}function At(U){return"["+Je(U).join("][")+"]"}function _t(U,Te){return new Mr(U,At(Te+""))}function pr(U){return typeof U=="function"&&!U._reglType||U instanceof Mr}function en(U,Te){if(typeof U=="function")return new Mr($t,U);if(typeof U=="number"||typeof U=="boolean")return new Mr(wr,U);if(Array.isArray(U))return new Mr(Tr,U.map((ze,nr)=>en(ze,Te+"["+nr+"]")));if(U instanceof Mr)return U;H(!1,"invalid option type in uniform "+Te)}var mt={DynamicVariable:Mr,define:_t,isDynamic:pr,unbox:en,accessor:At},Nt={next:typeof requestAnimationFrame=="function"?function(U){return requestAnimationFrame(U)}:function(U){return setTimeout(U,16)},cancel:typeof cancelAnimationFrame=="function"?function(U){return cancelAnimationFrame(U)}:clearTimeout},ar=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function xr(){var U={"":0},Te=[""];return{id:function(ze){var nr=U[ze];return nr||(nr=U[ze]=Te.length,Te.push(ze),nr)},str:function(ze){return Te[ze]}}}function xn(U,Te,ze){var nr=document.createElement("canvas");y(nr.style,{border:0,margin:0,padding:0,top:0,left:0}),U.appendChild(nr),U===document.body&&(nr.style.position="absolute",y(U.style,{margin:0,padding:0}));function Ar(){var Zr=window.innerWidth,Kr=window.innerHeight;if(U!==document.body){var qr=U.getBoundingClientRect();Zr=qr.right-qr.left,Kr=qr.bottom-qr.top}nr.width=ze*Zr,nr.height=ze*Kr,y(nr.style,{width:Zr+"px",height:Kr+"px"})}var qt;U!==document.body&&typeof ResizeObserver=="function"?(qt=new ResizeObserver(function(){setTimeout(Ar)}),qt.observe(U)):window.addEventListener("resize",Ar,!1);function dr(){qt?qt.disconnect():window.removeEventListener("resize",Ar),U.removeChild(nr)}return Ar(),{canvas:nr,onDestroy:dr}}function In(U,Te){function ze(nr){try{return U.getContext(nr,Te)}catch(Ar){return null}}return ze("webgl")||ze("experimental-webgl")||ze("webgl-experimental")}function Ei(U){return typeof U.nodeName=="string"&&typeof U.appendChild=="function"&&typeof U.getBoundingClientRect=="function"}function Ai(U){return typeof U.drawArrays=="function"||typeof U.drawElements=="function"}function Bi(U){return typeof U=="string"?U.split():(H(Array.isArray(U),"invalid extension array"),U)}function aa(U){return typeof U=="string"?(H(typeof document!="undefined","not supported outside of DOM"),document.querySelector(U)):U}function hi(U){var Te=U||{},ze,nr,Ar,qt,dr={},Zr=[],Kr=[],qr=typeof window=="undefined"?1:window.devicePixelRatio,Wr=!1,on=function(sn){sn&&H.raise(sn)},hn=function(){};if(typeof Te=="string"?(H(typeof document!="undefined","selector queries only supported in DOM enviroments"),ze=document.querySelector(Te),H(ze,"invalid query string for element")):typeof Te=="object"?Ei(Te)?ze=Te:Ai(Te)?(qt=Te,Ar=qt.canvas):(H.constructor(Te),"gl"in Te?qt=Te.gl:"canvas"in Te?Ar=aa(Te.canvas):"container"in Te&&(nr=aa(Te.container)),"attributes"in Te&&(dr=Te.attributes,H.type(dr,"object","invalid context attributes")),"extensions"in Te&&(Zr=Bi(Te.extensions)),"optionalExtensions"in Te&&(Kr=Bi(Te.optionalExtensions)),"onDone"in Te&&(H.type(Te.onDone,"function","invalid or missing onDone callback"),on=Te.onDone),"profile"in Te&&(Wr=!!Te.profile),"pixelRatio"in Te&&(qr=+Te.pixelRatio,H(qr>0,"invalid pixel ratio"))):H.raise("invalid arguments to regl"),ze&&(ze.nodeName.toLowerCase()==="canvas"?Ar=ze:nr=ze),!qt){if(!Ar){H(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Vr=xn(nr||document.body,on,qr);if(!Vr)return null;Ar=Vr.canvas,hn=Vr.onDestroy}dr.premultipliedAlpha===void 0&&(dr.premultipliedAlpha=!0),qt=In(Ar,dr)}return qt?{gl:qt,canvas:Ar,container:nr,extensions:Zr,optionalExtensions:Kr,pixelRatio:qr,profile:Wr,onDone:on,onDestroy:hn}:(hn(),on("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function V(U,Te){var ze={};function nr(dr){H.type(dr,"string","extension name must be string");var Zr=dr.toLowerCase(),Kr;try{Kr=ze[Zr]=U.getExtension(Zr)}catch(qr){}return!!Kr}for(var Ar=0;Ar<Te.extensions.length;++Ar){var qt=Te.extensions[Ar];if(!nr(qt))return Te.onDestroy(),Te.onDone('"'+qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Te.optionalExtensions.forEach(nr),{extensions:ze,restore:function(){Object.keys(ze).forEach(function(dr){if(ze[dr]&&!nr(dr))throw new Error("(regl): error restoring extension "+dr)})}}}function te(U,Te){for(var ze=Array(U),nr=0;nr<U;++nr)ze[nr]=Te(nr);return ze}var le=5120,we=5121,je=5122,ht=5123,xt=5124,ge=5125,Ke=5126;function Ut(U){for(var Te=16;Te<=1<<28;Te*=16)if(U<=Te)return Te;return 0}function Fr(U){var Te,ze;return Te=(U>65535)<<4,U>>>=Te,ze=(U>255)<<3,U>>>=ze,Te|=ze,ze=(U>15)<<2,U>>>=ze,Te|=ze,ze=(U>3)<<1,U>>>=ze,Te|=ze,Te|U>>1}function jr(){var U=te(8,function(){return[]});function Te(qt){var dr=Ut(qt),Zr=U[Fr(dr)>>2];return Zr.length>0?Zr.pop():new ArrayBuffer(dr)}function ze(qt){U[Fr(qt.byteLength)>>2].push(qt)}function nr(qt,dr){var Zr=null;switch(qt){case le:Zr=new Int8Array(Te(dr),0,dr);break;case we:Zr=new Uint8Array(Te(dr),0,dr);break;case je:Zr=new Int16Array(Te(2*dr),0,dr);break;case ht:Zr=new Uint16Array(Te(2*dr),0,dr);break;case xt:Zr=new Int32Array(Te(4*dr),0,dr);break;case ge:Zr=new Uint32Array(Te(4*dr),0,dr);break;case Ke:Zr=new Float32Array(Te(4*dr),0,dr);break;default:return null}return Zr.length!==dr?Zr.subarray(0,dr):Zr}function Ar(qt){ze(qt.buffer)}return{alloc:Te,free:ze,allocType:nr,freeType:Ar}}var Xt=jr();Xt.zero=jr();var mr=3408,Hr=3410,gn=3411,gr=3412,vn=3413,$r=3414,cn=3415,pi=33901,fn=33902,gi=3379,Wi=3386,vi=34921,Ri=36347,Ii=36348,go=35661,ji=35660,Rn=34930,Dn=36349,ui=34076,Vn=34024,za=7936,ds=7937,Di=7938,Na=35724,Eu=34047,fu=36063,ya=34852,lo=3553,Ga=34067,Ha=34069,Xo=33984,oa=6408,Wa=5126,wa=5121,_a=36160,ra=36053,sl=36064,ts=16384,to=function(U,Te){var ze=1;Te.ext_texture_filter_anisotropic&&(ze=U.getParameter(Eu));var nr=1,Ar=1;Te.webgl_draw_buffers&&(nr=U.getParameter(ya),Ar=U.getParameter(fu));var qt=!!Te.oes_texture_float;if(qt){var dr=U.createTexture();U.bindTexture(lo,dr),U.texImage2D(lo,0,oa,1,1,0,oa,Wa,null);var Zr=U.createFramebuffer();if(U.bindFramebuffer(_a,Zr),U.framebufferTexture2D(_a,sl,lo,dr,0),U.bindTexture(lo,null),U.checkFramebufferStatus(_a)!==ra)qt=!1;else{U.viewport(0,0,1,1),U.clearColor(1,0,0,1),U.clear(ts);var Kr=Xt.allocType(Wa,4);U.readPixels(0,0,1,1,oa,Wa,Kr),U.getError()?qt=!1:(U.deleteFramebuffer(Zr),U.deleteTexture(dr),qt=Kr[0]===1),Xt.freeType(Kr)}}var qr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Wr=!0;if(!qr){var on=U.createTexture(),hn=Xt.allocType(wa,36);U.activeTexture(Xo),U.bindTexture(Ga,on),U.texImage2D(Ha,0,oa,3,3,0,oa,wa,hn),Xt.freeType(hn),U.bindTexture(Ga,null),U.deleteTexture(on),Wr=!U.getError()}return{colorBits:[U.getParameter(Hr),U.getParameter(gn),U.getParameter(gr),U.getParameter(vn)],depthBits:U.getParameter($r),stencilBits:U.getParameter(cn),subpixelBits:U.getParameter(mr),extensions:Object.keys(Te).filter(function(Vr){return!!Te[Vr]}),maxAnisotropic:ze,maxDrawbuffers:nr,maxColorAttachments:Ar,pointSizeDims:U.getParameter(pi),lineWidthDims:U.getParameter(fn),maxViewportDims:U.getParameter(Wi),maxCombinedTextureUnits:U.getParameter(go),maxCubeMapSize:U.getParameter(ui),maxRenderbufferSize:U.getParameter(Vn),maxTextureUnits:U.getParameter(Rn),maxTextureSize:U.getParameter(gi),maxAttributes:U.getParameter(vi),maxVertexUniforms:U.getParameter(Ri),maxVertexTextureUnits:U.getParameter(ji),maxVaryingVectors:U.getParameter(Ii),maxFragmentUniforms:U.getParameter(Dn),glsl:U.getParameter(Na),renderer:U.getParameter(ds),vendor:U.getParameter(za),version:U.getParameter(Di),readFloat:qt,npotTextureCube:Wr}};function Oa(U){return!!U&&typeof U=="object"&&Array.isArray(U.shape)&&Array.isArray(U.stride)&&typeof U.offset=="number"&&U.shape.length===U.stride.length&&(Array.isArray(U.data)||C(U.data))}var fa=function(U){return Object.keys(U).map(function(Te){return U[Te]})},he={shape:Zi,flatten:kn};function Oe(U,Te,ze){for(var nr=0;nr<Te;++nr)ze[nr]=U[nr]}function gt(U,Te,ze,nr){for(var Ar=0,qt=0;qt<Te;++qt)for(var dr=U[qt],Zr=0;Zr<ze;++Zr)nr[Ar++]=dr[Zr]}function fr(U,Te,ze,nr,Ar,qt){for(var dr=qt,Zr=0;Zr<Te;++Zr)for(var Kr=U[Zr],qr=0;qr<ze;++qr)for(var Wr=Kr[qr],on=0;on<nr;++on)Ar[dr++]=Wr[on]}function tn(U,Te,ze,nr,Ar){for(var qt=1,dr=ze+1;dr<Te.length;++dr)qt*=Te[dr];var Zr=Te[ze];if(Te.length-ze==4){var Kr=Te[ze+1],qr=Te[ze+2],Wr=Te[ze+3];for(dr=0;dr<Zr;++dr)fr(U[dr],Kr,qr,Wr,nr,Ar),Ar+=qt}else for(dr=0;dr<Zr;++dr)tn(U[dr],Te,ze+1,nr,Ar),Ar+=qt}function kn(U,Te,ze,nr){var Ar=1;if(Te.length)for(var qt=0;qt<Te.length;++qt)Ar*=Te[qt];else Ar=0;var dr=nr||Xt.allocType(ze,Ar);switch(Te.length){case 0:break;case 1:Oe(U,Te[0],dr);break;case 2:gt(U,Te[0],Te[1],dr);break;case 3:fr(U,Te[0],Te[1],Te[2],dr,0);break;default:tn(U,Te,0,dr,0)}return dr}function Zi(U){for(var Te=[],ze=U;ze.length;ze=ze[0])Te.push(ze.length);return Te}var Xi={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Xa=5120,Ya=5122,Yo=5124,Ss=5121,Hl=5123,Xu=5125,ko=5126,Ls=5126,co={int8:Xa,int16:Ya,int32:Yo,uint8:Ss,uint16:Hl,uint32:Xu,float:ko,float32:Ls},Rs=35048,La=35040,li={dynamic:Rs,stream:La,static:35044},ul=he.flatten,xa=he.shape,Nn=35044,Ys=35040,Wl=5121,fo=5126,Ze=[];Ze[5120]=1,Ze[5122]=2,Ze[5124]=4,Ze[5121]=1,Ze[5123]=2,Ze[5125]=4,Ze[5126]=4;function Ot(U){return Xi[Object.prototype.toString.call(U)]|0}function br(U,Te){for(var ze=0;ze<Te.length;++ze)U[ze]=Te[ze]}function On(U,Te,ze,nr,Ar,qt,dr){for(var Zr=0,Kr=0;Kr<ze;++Kr)for(var qr=0;qr<nr;++qr)U[Zr++]=Te[Ar*Kr+qt*qr+dr]}function Hi(U,Te,ze,nr){var Ar=0,qt={};function dr(Zt){this.id=Ar++,this.buffer=U.createBuffer(),this.type=Zt,this.usage=Nn,this.byteLength=0,this.dimension=1,this.dtype=Wl,this.persistentData=null,ze.profile&&(this.stats={size:0})}dr.prototype.bind=function(){U.bindBuffer(this.type,this.buffer)},dr.prototype.destroy=function(){hn(this)};var Zr=[];function Kr(Zt,cr){var Gr=Zr.pop();return Gr||(Gr=new dr(Zt)),Gr.bind(),on(Gr,cr,Ys,0,1,!1),Gr}function qr(Zt){Zr.push(Zt)}function Wr(Zt,cr,Gr){Zt.byteLength=cr.byteLength,U.bufferData(Zt.type,cr,Gr)}function on(Zt,cr,Gr,mn,Dr,wn){var Nr;if(Zt.usage=Gr,Array.isArray(cr)){if(Zt.dtype=mn||fo,cr.length>0){var un;if(Array.isArray(cr[0])){Nr=xa(cr);for(var kr=1,an=1;an<Nr.length;++an)kr*=Nr[an];Zt.dimension=kr,un=ul(cr,Nr,Zt.dtype),Wr(Zt,un,Gr),wn?Zt.persistentData=un:Xt.freeType(un)}else if(typeof cr[0]=="number"){Zt.dimension=Dr;var Kn=Xt.allocType(Zt.dtype,cr.length);br(Kn,cr),Wr(Zt,Kn,Gr),wn?Zt.persistentData=Kn:Xt.freeType(Kn)}else C(cr[0])?(Zt.dimension=cr[0].length,Zt.dtype=mn||Ot(cr[0])||fo,un=ul(cr,[cr.length,cr[0].length],Zt.dtype),Wr(Zt,un,Gr),wn?Zt.persistentData=un:Xt.freeType(un)):H.raise("invalid buffer data")}}else if(C(cr))Zt.dtype=mn||Ot(cr),Zt.dimension=Dr,Wr(Zt,cr,Gr),wn&&(Zt.persistentData=new Uint8Array(new Uint8Array(cr.buffer)));else if(Oa(cr)){Nr=cr.shape;var Wn=cr.stride,ln=cr.offset,zr=0,Lr=0,oi=0,ti=0;Nr.length===1?(zr=Nr[0],Lr=1,oi=Wn[0],ti=0):Nr.length===2?(zr=Nr[0],Lr=Nr[1],oi=Wn[0],ti=Wn[1]):H.raise("invalid shape"),Zt.dtype=mn||Ot(cr.data)||fo,Zt.dimension=Lr;var Ln=Xt.allocType(Zt.dtype,zr*Lr);On(Ln,cr.data,zr,Lr,oi,ti,ln),Wr(Zt,Ln,Gr),wn?Zt.persistentData=Ln:Xt.freeType(Ln)}else cr instanceof ArrayBuffer?(Zt.dtype=Wl,Zt.dimension=Dr,Wr(Zt,cr,Gr),wn&&(Zt.persistentData=new Uint8Array(new Uint8Array(cr)))):H.raise("invalid buffer data")}function hn(Zt){Te.bufferCount--,nr(Zt);var cr=Zt.buffer;H(cr,"buffer must not be deleted already"),U.deleteBuffer(cr),Zt.buffer=null,delete qt[Zt.id]}function Vr(Zt,cr,Gr,mn){Te.bufferCount++;var Dr=new dr(cr);qt[Dr.id]=Dr;function wn(kr){var an=Nn,Kn=null,Wn=0,ln=0,zr=1;return Array.isArray(kr)||C(kr)||Oa(kr)||kr instanceof ArrayBuffer?Kn=kr:typeof kr=="number"?Wn=kr|0:kr&&(H.type(kr,"object","buffer arguments must be an object, a number or an array"),"data"in kr&&(H(Kn===null||Array.isArray(Kn)||C(Kn)||Oa(Kn),"invalid data for buffer"),Kn=kr.data),"usage"in kr&&(H.parameter(kr.usage,li,"invalid buffer usage"),an=li[kr.usage]),"type"in kr&&(H.parameter(kr.type,co,"invalid buffer type"),ln=co[kr.type]),"dimension"in kr&&(H.type(kr.dimension,"number","invalid dimension"),zr=kr.dimension|0),"length"in kr&&(H.nni(Wn,"buffer length must be a nonnegative integer"),Wn=kr.length|0)),Dr.bind(),Kn?on(Dr,Kn,an,ln,zr,mn):(Wn&&U.bufferData(Dr.type,Wn,an),Dr.dtype=ln||Wl,Dr.usage=an,Dr.dimension=zr,Dr.byteLength=Wn),ze.profile&&(Dr.stats.size=Dr.byteLength*Ze[Dr.dtype]),wn}function Nr(kr,an){H(an+kr.byteLength<=Dr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+kr.byteLength+" starting from offset "+an+" to a buffer of size "+Dr.byteLength),U.bufferSubData(Dr.type,an,kr)}function un(kr,an){var Kn=(an||0)|0,Wn;if(Dr.bind(),C(kr)||kr instanceof ArrayBuffer)Nr(kr,Kn);else if(Array.isArray(kr)){if(kr.length>0)if(typeof kr[0]=="number"){var ln=Xt.allocType(Dr.dtype,kr.length);br(ln,kr),Nr(ln,Kn),Xt.freeType(ln)}else if(Array.isArray(kr[0])||C(kr[0])){Wn=xa(kr);var zr=ul(kr,Wn,Dr.dtype);Nr(zr,Kn),Xt.freeType(zr)}else H.raise("invalid buffer data")}else if(Oa(kr)){Wn=kr.shape;var Lr=kr.stride,oi=0,ti=0,Ln=0,Vi=0;Wn.length===1?(oi=Wn[0],ti=1,Ln=Lr[0],Vi=0):Wn.length===2?(oi=Wn[0],ti=Wn[1],Ln=Lr[0],Vi=Lr[1]):H.raise("invalid shape");var wi=Array.isArray(kr.data)?Dr.dtype:Ot(kr.data),Fi=Xt.allocType(wi,oi*ti);On(Fi,kr.data,oi,ti,Ln,Vi,kr.offset),Nr(Fi,Kn),Xt.freeType(Fi)}else H.raise("invalid data for buffer subdata");return wn}return Gr||wn(Zt),wn._reglType="buffer",wn._buffer=Dr,wn.subdata=un,ze.profile&&(wn.stats=Dr.stats),wn.destroy=function(){hn(Dr)},wn}function sn(){fa(qt).forEach(function(Zt){Zt.buffer=U.createBuffer(),U.bindBuffer(Zt.type,Zt.buffer),U.bufferData(Zt.type,Zt.persistentData||Zt.byteLength,Zt.usage)})}return ze.profile&&(Te.getTotalBufferSize=function(){var Zt=0;return Object.keys(qt).forEach(function(cr){Zt+=qt[cr].stats.size}),Zt}),{create:Vr,createStream:Kr,destroyStream:qr,clear:function(){fa(qt).forEach(hn),Zr.forEach(hn)},getBuffer:function(Zt){return Zt&&Zt._buffer instanceof dr?Zt._buffer:null},restore:sn,_initBuffer:on}}var ba=0,Za=0,na=1,Ra=1,Fo=4,Mo=4,yi={points:ba,point:Za,lines:na,line:Ra,triangles:Fo,triangle:Mo,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Yu=0,hu=1,Ko=4,ll=5120,Eo=5121,Es=5122,Io=5123,pu=5124,Ds=5125,lc=34963,qc=35040,Ta=35044;function bf(U,Te,ze,nr){var Ar={},qt=0,dr={uint8:Eo,uint16:Io};Te.oes_element_index_uint&&(dr.uint32=Ds);function Zr(sn){this.id=qt++,Ar[this.id]=this,this.buffer=sn,this.primType=Ko,this.vertCount=0,this.type=0}Zr.prototype.bind=function(){this.buffer.bind()};var Kr=[];function qr(sn){var Zt=Kr.pop();return Zt||(Zt=new Zr(ze.create(null,lc,!0,!1)._buffer)),on(Zt,sn,qc,-1,-1,0,0),Zt}function Wr(sn){Kr.push(sn)}function on(sn,Zt,cr,Gr,mn,Dr,wn){sn.buffer.bind();var Nr;if(Zt){var un=wn;!wn&&(!C(Zt)||Oa(Zt)&&!C(Zt.data))&&(un=Te.oes_element_index_uint?Ds:Io),ze._initBuffer(sn.buffer,Zt,cr,un,3)}else U.bufferData(lc,Dr,cr),sn.buffer.dtype=Nr||Eo,sn.buffer.usage=cr,sn.buffer.dimension=3,sn.buffer.byteLength=Dr;if(Nr=wn,!wn){switch(sn.buffer.dtype){case Eo:case ll:Nr=Eo;break;case Io:case Es:Nr=Io;break;case Ds:case pu:Nr=Ds;break;default:H.raise("unsupported type for element array")}sn.buffer.dtype=Nr}sn.type=Nr,H(Nr!==Ds||!!Te.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var kr=mn;kr<0&&(kr=sn.buffer.byteLength,Nr===Io?kr>>=1:Nr===Ds&&(kr>>=2)),sn.vertCount=kr;var an=Gr;if(Gr<0){an=Ko;var Kn=sn.buffer.dimension;Kn===1&&(an=Yu),Kn===2&&(an=hu),Kn===3&&(an=Ko)}sn.primType=an}function hn(sn){nr.elementsCount--,H(sn.buffer!==null,"must not double destroy elements"),delete Ar[sn.id],sn.buffer.destroy(),sn.buffer=null}function Vr(sn,Zt){var cr=ze.create(null,lc,!0),Gr=new Zr(cr._buffer);nr.elementsCount++;function mn(Dr){if(!Dr)cr(),Gr.primType=Ko,Gr.vertCount=0,Gr.type=Eo;else if(typeof Dr=="number")cr(Dr),Gr.primType=Ko,Gr.vertCount=Dr|0,Gr.type=Eo;else{var wn=null,Nr=Ta,un=-1,kr=-1,an=0,Kn=0;Array.isArray(Dr)||C(Dr)||Oa(Dr)?wn=Dr:(H.type(Dr,"object","invalid arguments for elements"),"data"in Dr&&(wn=Dr.data,H(Array.isArray(wn)||C(wn)||Oa(wn),"invalid data for element buffer")),"usage"in Dr&&(H.parameter(Dr.usage,li,"invalid element buffer usage"),Nr=li[Dr.usage]),"primitive"in Dr&&(H.parameter(Dr.primitive,yi,"invalid element buffer primitive"),un=yi[Dr.primitive]),"count"in Dr&&(H(typeof Dr.count=="number"&&Dr.count>=0,"invalid vertex count for elements"),kr=Dr.count|0),"type"in Dr&&(H.parameter(Dr.type,dr,"invalid buffer type"),Kn=dr[Dr.type]),"length"in Dr?an=Dr.length|0:(an=kr,Kn===Io||Kn===Es?an*=2:(Kn===Ds||Kn===pu)&&(an*=4))),on(Gr,wn,Nr,un,kr,an,Kn)}return mn}return mn(sn),mn._reglType="elements",mn._elements=Gr,mn.subdata=function(Dr,wn){return cr.subdata(Dr,wn),mn},mn.destroy=function(){hn(Gr)},mn}return{create:Vr,createStream:qr,destroyStream:Wr,getElements:function(sn){return typeof sn=="function"&&sn._elements instanceof Zr?sn._elements:null},clear:function(){fa(Ar).forEach(hn)}}}var ku=new Float32Array(1),Cl=new Uint32Array(ku.buffer),Lc=5123;function cc(U){for(var Te=Xt.allocType(Lc,U.length),ze=0;ze<U.length;++ze)if(isNaN(U[ze]))Te[ze]=65535;else if(U[ze]===Infinity)Te[ze]=31744;else if(U[ze]===-Infinity)Te[ze]=64512;else{ku[0]=U[ze];var nr=Cl[0],Ar=nr>>>31<<15,qt=(nr<<1>>>24)-127,dr=nr>>13&(1<<10)-1;if(qt<-24)Te[ze]=Ar;else if(qt<-14){var Zr=-14-qt;Te[ze]=Ar+(dr+(1<<10)>>Zr)}else qt>15?Te[ze]=Ar+31744:Te[ze]=Ar+(qt+15<<10)+dr}return Te}function ro(U){return Array.isArray(U)||C(U)}var cl=function(U){return!(U&U-1)&&!!U},fl=34467,rs=3553,fc=34067,Ku=34069,Ks=6408,$o=6406,Rc=6407,wu=6409,$u=6410,Df=32854,hl=32855,Sa=36194,Ju=32819,Xl=32820,Yl=33635,$s=34042,Dc=6402,Kl=34041,$l=35904,Qu=35906,Tu=36193,Pl=33776,Ml=33777,pl=33778,kc=33779,dl=35986,Js=35987,Il=34798,ef=35840,tf=35841,pa=35842,Jl=35843,hc=36196,qu=5121,Ol=5123,pc=5125,Fu=5126,Fc=10242,rf=10243,nf=10497,Ll=33071,zc=33648,Nc=10240,Bc=10241,vl=9728,Uc=9729,zu=9984,Da=9985,Ql=9986,Nu=9987,el=33170,zi=4352,Pa=4353,Ma=4354,ql=34046,Rl=3317,ec=37440,Sf=37441,Ef=37443,Dl=37444,Bu=33984,Uu=[zu,Ql,Da,Nu],no=[0,wu,$u,Rc,Ks],vs={};vs[wu]=vs[$o]=vs[Dc]=1,vs[Kl]=vs[$u]=2,vs[Rc]=vs[$l]=3,vs[Ks]=vs[Qu]=4;function ml(U){return"[object "+U+"]"}var ho=ml("HTMLCanvasElement"),En=ml("OffscreenCanvas"),ks=ml("CanvasRenderingContext2D"),tc=ml("ImageBitmap"),gl=ml("HTMLImageElement"),Qs=ml("HTMLVideoElement"),Zs=Object.keys(Xi).concat([ho,En,ks,tc,gl,Qs]),yl=[];yl[qu]=1,yl[Fu]=4,yl[Tu]=2,yl[Ol]=2,yl[pc]=4;var Jr=[];Jr[Df]=2,Jr[hl]=2,Jr[Sa]=2,Jr[Kl]=4,Jr[Pl]=.5,Jr[Ml]=.5,Jr[pl]=1,Jr[kc]=1,Jr[dl]=.5,Jr[Js]=1,Jr[Il]=1,Jr[ef]=.5,Jr[tf]=.25,Jr[pa]=.5,Jr[Jl]=.25,Jr[hc]=.5;function jc(U){return Array.isArray(U)&&(U.length===0||typeof U[0]=="number")}function dc(U){if(!Array.isArray(U))return!1;var Te=U.length;return!(Te===0||!ro(U[0]))}function tl(U){return Object.prototype.toString.call(U)}function qs(U){return tl(U)===ho}function ws(U){return tl(U)===En}function vc(U){return tl(U)===ks}function mc(U){return tl(U)===tc}function Fs(U){return tl(U)===gl}function ju(U){return tl(U)===Qs}function _l(U){if(!U)return!1;var Te=tl(U);return Zs.indexOf(Te)>=0?!0:jc(U)||dc(U)||Oa(U)}function kl(U){return Xi[Object.prototype.toString.call(U)]|0}function af(U,Te){var ze=Te.length;switch(U.type){case qu:case Ol:case pc:case Fu:var nr=Xt.allocType(U.type,ze);nr.set(Te),U.data=nr;break;case Tu:U.data=cc(Te);break;default:H.raise("unsupported texture type, must specify a typed array")}}function Zc(U,Te){return Xt.allocType(U.type===Tu?Fu:U.type,Te)}function Au(U,Te){U.type===Tu?(U.data=cc(Te),Xt.freeType(Te)):U.data=Te}function eu(U,Te,ze,nr,Ar,qt){for(var dr=U.width,Zr=U.height,Kr=U.channels,qr=dr*Zr*Kr,Wr=Zc(U,qr),on=0,hn=0;hn<Zr;++hn)for(var Vr=0;Vr<dr;++Vr)for(var sn=0;sn<Kr;++sn)Wr[on++]=Te[ze*Vr+nr*hn+Ar*sn+qt];Au(U,Wr)}function ki(U,Te,ze,nr,Ar,qt){var dr;if(typeof Jr[U]!="undefined"?dr=Jr[U]:dr=vs[U]*yl[Te],qt&&(dr*=6),Ar){for(var Zr=0,Kr=ze;Kr>=1;)Zr+=dr*Kr*Kr,Kr/=2;return Zr}else return dr*ze*nr}function Zu(U,Te,ze,nr,Ar,qt,dr){var Zr={"don't care":zi,"dont care":zi,nice:Ma,fast:Pa},Kr={repeat:nf,clamp:Ll,mirror:zc},qr={nearest:vl,linear:Uc},Wr=y({mipmap:Nu,"nearest mipmap nearest":zu,"linear mipmap nearest":Da,"nearest mipmap linear":Ql,"linear mipmap linear":Nu},qr),on={none:0,browser:Dl},hn={uint8:qu,rgba4:Ju,rgb565:Yl,"rgb5 a1":Xl},Vr={alpha:$o,luminance:wu,"luminance alpha":$u,rgb:Rc,rgba:Ks,rgba4:Df,"rgb5 a1":hl,rgb565:Sa},sn={};Te.ext_srgb&&(Vr.srgb=$l,Vr.srgba=Qu),Te.oes_texture_float&&(hn.float32=hn.float=Fu),Te.oes_texture_half_float&&(hn.float16=hn["half float"]=Tu),Te.webgl_depth_texture&&(y(Vr,{depth:Dc,"depth stencil":Kl}),y(hn,{uint16:Ol,uint32:pc,"depth stencil":$s})),Te.webgl_compressed_texture_s3tc&&y(sn,{"rgb s3tc dxt1":Pl,"rgba s3tc dxt1":Ml,"rgba s3tc dxt3":pl,"rgba s3tc dxt5":kc}),Te.webgl_compressed_texture_atc&&y(sn,{"rgb atc":dl,"rgba atc explicit alpha":Js,"rgba atc interpolated alpha":Il}),Te.webgl_compressed_texture_pvrtc&&y(sn,{"rgb pvrtc 4bppv1":ef,"rgb pvrtc 2bppv1":tf,"rgba pvrtc 4bppv1":pa,"rgba pvrtc 2bppv1":Jl}),Te.webgl_compressed_texture_etc1&&(sn["rgb etc1"]=hc);var Zt=Array.prototype.slice.call(U.getParameter(fl));Object.keys(sn).forEach(function(Ve){var ir=sn[Ve];Zt.indexOf(ir)>=0&&(Vr[Ve]=ir)});var cr=Object.keys(Vr);ze.textureFormats=cr;var Gr=[];Object.keys(Vr).forEach(function(Ve){var ir=Vr[Ve];Gr[ir]=Ve});var mn=[];Object.keys(hn).forEach(function(Ve){var ir=hn[Ve];mn[ir]=Ve});var Dr=[];Object.keys(qr).forEach(function(Ve){var ir=qr[Ve];Dr[ir]=Ve});var wn=[];Object.keys(Wr).forEach(function(Ve){var ir=Wr[Ve];wn[ir]=Ve});var Nr=[];Object.keys(Kr).forEach(function(Ve){var ir=Kr[Ve];Nr[ir]=Ve});var un=cr.reduce(function(Ve,ir){var er=Vr[ir];return er===wu||er===$o||er===wu||er===$u||er===Dc||er===Kl||Te.ext_srgb&&(er===$l||er===Qu)?Ve[er]=er:er===hl||ir.indexOf("rgba")>=0?Ve[er]=Ks:Ve[er]=Rc,Ve},{});function kr(){this.internalformat=Ks,this.format=Ks,this.type=qu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Dl,this.width=0,this.height=0,this.channels=0}function an(Ve,ir){Ve.internalformat=ir.internalformat,Ve.format=ir.format,Ve.type=ir.type,Ve.compressed=ir.compressed,Ve.premultiplyAlpha=ir.premultiplyAlpha,Ve.flipY=ir.flipY,Ve.unpackAlignment=ir.unpackAlignment,Ve.colorSpace=ir.colorSpace,Ve.width=ir.width,Ve.height=ir.height,Ve.channels=ir.channels}function Kn(Ve,ir){if(!(typeof ir!="object"||!ir)){if("premultiplyAlpha"in ir&&(H.type(ir.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ve.premultiplyAlpha=ir.premultiplyAlpha),"flipY"in ir&&(H.type(ir.flipY,"boolean","invalid texture flip"),Ve.flipY=ir.flipY),"alignment"in ir&&(H.oneOf(ir.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ve.unpackAlignment=ir.alignment),"colorSpace"in ir&&(H.parameter(ir.colorSpace,on,"invalid colorSpace"),Ve.colorSpace=on[ir.colorSpace]),"type"in ir){var er=ir.type;H(Te.oes_texture_float||!(er==="float"||er==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),H(Te.oes_texture_half_float||!(er==="half float"||er==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),H(Te.webgl_depth_texture||!(er==="uint16"||er==="uint32"||er==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(er,hn,"invalid texture type"),Ve.type=hn[er]}var An=Ve.width,Ui=Ve.height,Re=Ve.channels,ye=!1;"shape"in ir?(H(Array.isArray(ir.shape)&&ir.shape.length>=2,"shape must be an array"),An=ir.shape[0],Ui=ir.shape[1],ir.shape.length===3&&(Re=ir.shape[2],H(Re>0&&Re<=4,"invalid number of channels"),ye=!0),H(An>=0&&An<=ze.maxTextureSize,"invalid width"),H(Ui>=0&&Ui<=ze.maxTextureSize,"invalid height")):("radius"in ir&&(An=Ui=ir.radius,H(An>=0&&An<=ze.maxTextureSize,"invalid radius")),"width"in ir&&(An=ir.width,H(An>=0&&An<=ze.maxTextureSize,"invalid width")),"height"in ir&&(Ui=ir.height,H(Ui>=0&&Ui<=ze.maxTextureSize,"invalid height")),"channels"in ir&&(Re=ir.channels,H(Re>0&&Re<=4,"invalid number of channels"),ye=!0)),Ve.width=An|0,Ve.height=Ui|0,Ve.channels=Re|0;var ut=!1;if("format"in ir){var Lt=ir.format;H(Te.webgl_depth_texture||!(Lt==="depth"||Lt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Lt,Vr,"invalid texture format");var Vt=Ve.internalformat=Vr[Lt];Ve.format=un[Vt],Lt in hn&&("type"in ir||(Ve.type=hn[Lt])),Lt in sn&&(Ve.compressed=!0),ut=!0}!ye&&ut?Ve.channels=vs[Ve.format]:ye&&!ut?Ve.channels!==no[Ve.format]&&(Ve.format=Ve.internalformat=no[Ve.channels]):ut&&ye&&H(Ve.channels===vs[Ve.format],"number of channels inconsistent with specified format")}}function Wn(Ve){U.pixelStorei(ec,Ve.flipY),U.pixelStorei(Sf,Ve.premultiplyAlpha),U.pixelStorei(Ef,Ve.colorSpace),U.pixelStorei(Rl,Ve.unpackAlignment)}function ln(){kr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function zr(Ve,ir){var er=null;if(_l(ir)?er=ir:ir&&(H.type(ir,"object","invalid pixel data type"),Kn(Ve,ir),"x"in ir&&(Ve.xOffset=ir.x|0),"y"in ir&&(Ve.yOffset=ir.y|0),_l(ir.data)&&(er=ir.data)),H(!Ve.compressed||er instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ir.copy){H(!er,"can not specify copy and data field for the same texture");var An=Ar.viewportWidth,Ui=Ar.viewportHeight;Ve.width=Ve.width||An-Ve.xOffset,Ve.height=Ve.height||Ui-Ve.yOffset,Ve.needsCopy=!0,H(Ve.xOffset>=0&&Ve.xOffset<An&&Ve.yOffset>=0&&Ve.yOffset<Ui&&Ve.width>0&&Ve.width<=An&&Ve.height>0&&Ve.height<=Ui,"copy texture read out of bounds")}else if(!er)Ve.width=Ve.width||1,Ve.height=Ve.height||1,Ve.channels=Ve.channels||4;else if(C(er))Ve.channels=Ve.channels||4,Ve.data=er,!("type"in ir)&&Ve.type===qu&&(Ve.type=kl(er));else if(jc(er))Ve.channels=Ve.channels||4,af(Ve,er),Ve.alignment=1,Ve.needsFree=!0;else if(Oa(er)){var Re=er.data;!Array.isArray(Re)&&Ve.type===qu&&(Ve.type=kl(Re));var ye=er.shape,ut=er.stride,Lt,Vt,yt,dt,Ct,Le;ye.length===3?(yt=ye[2],Le=ut[2]):(H(ye.length===2,"invalid ndarray pixel data, must be 2 or 3D"),yt=1,Le=1),Lt=ye[0],Vt=ye[1],dt=ut[0],Ct=ut[1],Ve.alignment=1,Ve.width=Lt,Ve.height=Vt,Ve.channels=yt,Ve.format=Ve.internalformat=no[yt],Ve.needsFree=!0,eu(Ve,Re,dt,Ct,Le,er.offset)}else if(qs(er)||ws(er)||vc(er))qs(er)||ws(er)?Ve.element=er:Ve.element=er.canvas,Ve.width=Ve.element.width,Ve.height=Ve.element.height,Ve.channels=4;else if(mc(er))Ve.element=er,Ve.width=er.width,Ve.height=er.height,Ve.channels=4;else if(Fs(er))Ve.element=er,Ve.width=er.naturalWidth,Ve.height=er.naturalHeight,Ve.channels=4;else if(ju(er))Ve.element=er,Ve.width=er.videoWidth,Ve.height=er.videoHeight,Ve.channels=4;else if(dc(er)){var rt=Ve.width||er[0].length,Me=Ve.height||er.length,It=Ve.channels;ro(er[0][0])?It=It||er[0][0].length:It=It||1;for(var Ht=he.shape(er),Cr=1,rr=0;rr<Ht.length;++rr)Cr*=Ht[rr];var Er=Zc(Ve,Cr);he.flatten(er,Ht,"",Er),Au(Ve,Er),Ve.alignment=1,Ve.width=rt,Ve.height=Me,Ve.channels=It,Ve.format=Ve.internalformat=no[It],Ve.needsFree=!0}Ve.type===Fu?H(ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ve.type===Tu&&H(ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Lr(Ve,ir,er){var An=Ve.element,Ui=Ve.data,Re=Ve.internalformat,ye=Ve.format,ut=Ve.type,Lt=Ve.width,Vt=Ve.height;Wn(Ve),An?U.texImage2D(ir,er,ye,ye,ut,An):Ve.compressed?U.compressedTexImage2D(ir,er,Re,Lt,Vt,0,Ui):Ve.needsCopy?(nr(),U.copyTexImage2D(ir,er,ye,Ve.xOffset,Ve.yOffset,Lt,Vt,0)):U.texImage2D(ir,er,ye,Lt,Vt,0,ye,ut,Ui||null)}function oi(Ve,ir,er,An,Ui){var Re=Ve.element,ye=Ve.data,ut=Ve.internalformat,Lt=Ve.format,Vt=Ve.type,yt=Ve.width,dt=Ve.height;Wn(Ve),Re?U.texSubImage2D(ir,Ui,er,An,Lt,Vt,Re):Ve.compressed?U.compressedTexSubImage2D(ir,Ui,er,An,ut,yt,dt,ye):Ve.needsCopy?(nr(),U.copyTexSubImage2D(ir,Ui,er,An,Ve.xOffset,Ve.yOffset,yt,dt)):U.texSubImage2D(ir,Ui,er,An,yt,dt,Lt,Vt,ye)}var ti=[];function Ln(){return ti.pop()||new ln}function Vi(Ve){Ve.needsFree&&Xt.freeType(Ve.data),ln.call(Ve),ti.push(Ve)}function wi(){kr.call(this),this.genMipmaps=!1,this.mipmapHint=zi,this.mipmask=0,this.images=Array(16)}function Fi(Ve,ir,er){var An=Ve.images[0]=Ln();Ve.mipmask=1,An.width=Ve.width=ir,An.height=Ve.height=er,An.channels=Ve.channels=4}function sa(Ve,ir){var er=null;if(_l(ir))er=Ve.images[0]=Ln(),an(er,Ve),zr(er,ir),Ve.mipmask=1;else if(Kn(Ve,ir),Array.isArray(ir.mipmap))for(var An=ir.mipmap,Ui=0;Ui<An.length;++Ui)er=Ve.images[Ui]=Ln(),an(er,Ve),er.width>>=Ui,er.height>>=Ui,zr(er,An[Ui]),Ve.mipmask|=1<<Ui;else er=Ve.images[0]=Ln(),an(er,Ve),zr(er,ir),Ve.mipmask=1;an(Ve,Ve.images[0]),Ve.compressed&&(Ve.internalformat===Pl||Ve.internalformat===Ml||Ve.internalformat===pl||Ve.internalformat===kc)&&H(Ve.width%4==0&&Ve.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Go(Ve,ir){for(var er=Ve.images,An=0;An<er.length;++An){if(!er[An])return;Lr(er[An],ir,An)}}var Ps=[];function ea(){var Ve=Ps.pop()||new wi;kr.call(Ve),Ve.mipmask=0;for(var ir=0;ir<16;++ir)Ve.images[ir]=null;return Ve}function To(Ve){for(var ir=Ve.images,er=0;er<ir.length;++er)ir[er]&&Vi(ir[er]),ir[er]=null;Ps.push(Ve)}function Va(){this.minFilter=vl,this.magFilter=vl,this.wrapS=Ll,this.wrapT=Ll,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=zi}function Ho(Ve,ir){if("min"in ir){var er=ir.min;H.parameter(er,Wr),Ve.minFilter=Wr[er],Uu.indexOf(Ve.minFilter)>=0&&!("faces"in ir)&&(Ve.genMipmaps=!0)}if("mag"in ir){var An=ir.mag;H.parameter(An,qr),Ve.magFilter=qr[An]}var Ui=Ve.wrapS,Re=Ve.wrapT;if("wrap"in ir){var ye=ir.wrap;typeof ye=="string"?(H.parameter(ye,Kr),Ui=Re=Kr[ye]):Array.isArray(ye)&&(H.parameter(ye[0],Kr),H.parameter(ye[1],Kr),Ui=Kr[ye[0]],Re=Kr[ye[1]])}else{if("wrapS"in ir){var ut=ir.wrapS;H.parameter(ut,Kr),Ui=Kr[ut]}if("wrapT"in ir){var Lt=ir.wrapT;H.parameter(Lt,Kr),Re=Kr[Lt]}}if(Ve.wrapS=Ui,Ve.wrapT=Re,"anisotropic"in ir){var Vt=ir.anisotropic;H(typeof Vt=="number"&&Vt>=1&&Vt<=ze.maxAnisotropic,"aniso samples must be between 1 and "),Ve.anisotropic=ir.anisotropic}if("mipmap"in ir){var yt=!1;switch(typeof ir.mipmap){case"string":H.parameter(ir.mipmap,Zr,"invalid mipmap hint"),Ve.mipmapHint=Zr[ir.mipmap],Ve.genMipmaps=!0,yt=!0;break;case"boolean":yt=Ve.genMipmaps=ir.mipmap;break;case"object":H(Array.isArray(ir.mipmap),"invalid mipmap type"),Ve.genMipmaps=!1,yt=!0;break;default:H.raise("invalid mipmap type")}yt&&!("min"in ir)&&(Ve.minFilter=zu)}}function Qo(Ve,ir){U.texParameteri(ir,Bc,Ve.minFilter),U.texParameteri(ir,Nc,Ve.magFilter),U.texParameteri(ir,Fc,Ve.wrapS),U.texParameteri(ir,rf,Ve.wrapT),Te.ext_texture_filter_anisotropic&&U.texParameteri(ir,ql,Ve.anisotropic),Ve.genMipmaps&&(U.hint(el,Ve.mipmapHint),U.generateMipmap(ir))}var _s=0,Ms={},Ns=ze.maxTextureUnits,Wo=Array(Ns).map(function(){return null});function Oi(Ve){kr.call(this),this.mipmask=0,this.internalformat=Ks,this.id=_s++,this.refCount=1,this.target=Ve,this.texture=U.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Va,dr.profile&&(this.stats={size:0})}function Is(Ve){U.activeTexture(Bu),U.bindTexture(Ve.target,Ve.texture)}function ma(){var Ve=Wo[0];Ve?U.bindTexture(Ve.target,Ve.texture):U.bindTexture(rs,null)}function ni(Ve){var ir=Ve.texture;H(ir,"must not double destroy texture");var er=Ve.unit,An=Ve.target;er>=0&&(U.activeTexture(Bu+er),U.bindTexture(An,null),Wo[er]=null),U.deleteTexture(ir),Ve.texture=null,Ve.params=null,Ve.pixels=null,Ve.refCount=0,delete Ms[Ve.id],qt.textureCount--}y(Oi.prototype,{bind:function(){var Ve=this;Ve.bindCount+=1;var ir=Ve.unit;if(ir<0){for(var er=0;er<Ns;++er){var An=Wo[er];if(An){if(An.bindCount>0)continue;An.unit=-1}Wo[er]=Ve,ir=er;break}ir>=Ns&&H.raise("insufficient number of texture units"),dr.profile&&qt.maxTextureUnits<ir+1&&(qt.maxTextureUnits=ir+1),Ve.unit=ir,U.activeTexture(Bu+ir),U.bindTexture(Ve.target,Ve.texture)}return ir},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ni(this)}});function Gi(Ve,ir){var er=new Oi(rs);Ms[er.id]=er,qt.textureCount++;function An(ye,ut){var Lt=er.texInfo;Va.call(Lt);var Vt=ea();return typeof ye=="number"?typeof ut=="number"?Fi(Vt,ye|0,ut|0):Fi(Vt,ye|0,ye|0):ye?(H.type(ye,"object","invalid arguments to regl.texture"),Ho(Lt,ye),sa(Vt,ye)):Fi(Vt,1,1),Lt.genMipmaps&&(Vt.mipmask=(Vt.width<<1)-1),er.mipmask=Vt.mipmask,an(er,Vt),H.texture2D(Lt,Vt,ze),er.internalformat=Vt.internalformat,An.width=Vt.width,An.height=Vt.height,Is(er),Go(Vt,rs),Qo(Lt,rs),ma(),To(Vt),dr.profile&&(er.stats.size=ki(er.internalformat,er.type,Vt.width,Vt.height,Lt.genMipmaps,!1)),An.format=Gr[er.internalformat],An.type=mn[er.type],An.mag=Dr[Lt.magFilter],An.min=wn[Lt.minFilter],An.wrapS=Nr[Lt.wrapS],An.wrapT=Nr[Lt.wrapT],An}function Ui(ye,ut,Lt,Vt){H(!!ye,"must specify image data");var yt=ut|0,dt=Lt|0,Ct=Vt|0,Le=Ln();return an(Le,er),Le.width=0,Le.height=0,zr(Le,ye),Le.width=Le.width||(er.width>>Ct)-yt,Le.height=Le.height||(er.height>>Ct)-dt,H(er.type===Le.type&&er.format===Le.format&&er.internalformat===Le.internalformat,"incompatible format for texture.subimage"),H(yt>=0&&dt>=0&&yt+Le.width<=er.width&&dt+Le.height<=er.height,"texture.subimage write out of bounds"),H(er.mipmask&1<<Ct,"missing mipmap data"),H(Le.data||Le.element||Le.needsCopy,"missing image data"),Is(er),oi(Le,rs,yt,dt,Ct),ma(),Vi(Le),An}function Re(ye,ut){var Lt=ye|0,Vt=ut|0||Lt;if(Lt===er.width&&Vt===er.height)return An;An.width=er.width=Lt,An.height=er.height=Vt,Is(er);for(var yt=0;er.mipmask>>yt;++yt){var dt=Lt>>yt,Ct=Vt>>yt;if(!dt||!Ct)break;U.texImage2D(rs,yt,er.format,dt,Ct,0,er.format,er.type,null)}return ma(),dr.profile&&(er.stats.size=ki(er.internalformat,er.type,Lt,Vt,!1,!1)),An}return An(Ve,ir),An.subimage=Ui,An.resize=Re,An._reglType="texture2d",An._texture=er,dr.profile&&(An.stats=er.stats),An.destroy=function(){er.decRef()},An}function ia(Ve,ir,er,An,Ui,Re){var ye=new Oi(fc);Ms[ye.id]=ye,qt.cubeCount++;var ut=new Array(6);function Lt(dt,Ct,Le,rt,Me,It){var Ht,Cr=ye.texInfo;for(Va.call(Cr),Ht=0;Ht<6;++Ht)ut[Ht]=ea();if(typeof dt=="number"||!dt){var rr=dt|0||1;for(Ht=0;Ht<6;++Ht)Fi(ut[Ht],rr,rr)}else if(typeof dt=="object")if(Ct)sa(ut[0],dt),sa(ut[1],Ct),sa(ut[2],Le),sa(ut[3],rt),sa(ut[4],Me),sa(ut[5],It);else if(Ho(Cr,dt),Kn(ye,dt),"faces"in dt){var Er=dt.faces;for(H(Array.isArray(Er)&&Er.length===6,"cube faces must be a length 6 array"),Ht=0;Ht<6;++Ht)H(typeof Er[Ht]=="object"&&!!Er[Ht],"invalid input for cube map face"),an(ut[Ht],ye),sa(ut[Ht],Er[Ht])}else for(Ht=0;Ht<6;++Ht)sa(ut[Ht],dt);else H.raise("invalid arguments to cube map");for(an(ye,ut[0]),ze.npotTextureCube||H(cl(ye.width)&&cl(ye.height),"your browser does not support non power or two texture dimensions"),Cr.genMipmaps?ye.mipmask=(ut[0].width<<1)-1:ye.mipmask=ut[0].mipmask,H.textureCube(ye,Cr,ut,ze),ye.internalformat=ut[0].internalformat,Lt.width=ut[0].width,Lt.height=ut[0].height,Is(ye),Ht=0;Ht<6;++Ht)Go(ut[Ht],Ku+Ht);for(Qo(Cr,fc),ma(),dr.profile&&(ye.stats.size=ki(ye.internalformat,ye.type,Lt.width,Lt.height,Cr.genMipmaps,!0)),Lt.format=Gr[ye.internalformat],Lt.type=mn[ye.type],Lt.mag=Dr[Cr.magFilter],Lt.min=wn[Cr.minFilter],Lt.wrapS=Nr[Cr.wrapS],Lt.wrapT=Nr[Cr.wrapT],Ht=0;Ht<6;++Ht)To(ut[Ht]);return Lt}function Vt(dt,Ct,Le,rt,Me){H(!!Ct,"must specify image data"),H(typeof dt=="number"&&dt===(dt|0)&&dt>=0&&dt<6,"invalid face");var It=Le|0,Ht=rt|0,Cr=Me|0,rr=Ln();return an(rr,ye),rr.width=0,rr.height=0,zr(rr,Ct),rr.width=rr.width||(ye.width>>Cr)-It,rr.height=rr.height||(ye.height>>Cr)-Ht,H(ye.type===rr.type&&ye.format===rr.format&&ye.internalformat===rr.internalformat,"incompatible format for texture.subimage"),H(It>=0&&Ht>=0&&It+rr.width<=ye.width&&Ht+rr.height<=ye.height,"texture.subimage write out of bounds"),H(ye.mipmask&1<<Cr,"missing mipmap data"),H(rr.data||rr.element||rr.needsCopy,"missing image data"),Is(ye),oi(rr,Ku+dt,It,Ht,Cr),ma(),Vi(rr),Lt}function yt(dt){var Ct=dt|0;if(Ct!==ye.width){Lt.width=ye.width=Ct,Lt.height=ye.height=Ct,Is(ye);for(var Le=0;Le<6;++Le)for(var rt=0;ye.mipmask>>rt;++rt)U.texImage2D(Ku+Le,rt,ye.format,Ct>>rt,Ct>>rt,0,ye.format,ye.type,null);return ma(),dr.profile&&(ye.stats.size=ki(ye.internalformat,ye.type,Lt.width,Lt.height,!1,!0)),Lt}}return Lt(Ve,ir,er,An,Ui,Re),Lt.subimage=Vt,Lt.resize=yt,Lt._reglType="textureCube",Lt._texture=ye,dr.profile&&(Lt.stats=ye.stats),Lt.destroy=function(){ye.decRef()},Lt}function qo(){for(var Ve=0;Ve<Ns;++Ve)U.activeTexture(Bu+Ve),U.bindTexture(rs,null),Wo[Ve]=null;fa(Ms).forEach(ni),qt.cubeCount=0,qt.textureCount=0}dr.profile&&(qt.getTotalTextureSize=function(){var Ve=0;return Object.keys(Ms).forEach(function(ir){Ve+=Ms[ir].stats.size}),Ve});function Su(){for(var Ve=0;Ve<Ns;++Ve){var ir=Wo[Ve];ir&&(ir.bindCount=0,ir.unit=-1,Wo[Ve]=null)}fa(Ms).forEach(function(er){er.texture=U.createTexture(),U.bindTexture(er.target,er.texture);for(var An=0;An<32;++An)if((er.mipmask&1<<An)!=0)if(er.target===rs)U.texImage2D(rs,An,er.internalformat,er.width>>An,er.height>>An,0,er.internalformat,er.type,null);else for(var Ui=0;Ui<6;++Ui)U.texImage2D(Ku+Ui,An,er.internalformat,er.width>>An,er.height>>An,0,er.internalformat,er.type,null);Qo(er.texInfo,er.target)})}function sc(){for(var Ve=0;Ve<Ns;++Ve){var ir=Wo[Ve];ir&&(ir.bindCount=0,ir.unit=-1,Wo[Ve]=null),U.activeTexture(Bu+Ve),U.bindTexture(rs,null),U.bindTexture(fc,null)}}return{create2D:Gi,createCube:ia,clear:qo,getTexture:function(Ve){return null},restore:Su,refresh:sc}}var ns=36161,Oo=32854,xl=32855,rl=36194,du=33189,ms=36168,nl=34041,Un=35907,Pn=34836,rc=34842,is=34843,yo=[];yo[Oo]=2,yo[xl]=2,yo[rl]=2,yo[du]=2,yo[ms]=1,yo[nl]=4,yo[Un]=4,yo[Pn]=16,yo[rc]=8,yo[is]=6;function zo(U,Te,ze){return yo[U]*Te*ze}var vu=function(U,Te,ze,nr,Ar){var qt={rgba4:Oo,rgb565:rl,"rgb5 a1":xl,depth:du,stencil:ms,"depth stencil":nl};Te.ext_srgb&&(qt.srgba=Un),Te.ext_color_buffer_half_float&&(qt.rgba16f=rc,qt.rgb16f=is),Te.webgl_color_buffer_float&&(qt.rgba32f=Pn);var dr=[];Object.keys(qt).forEach(function(Vr){var sn=qt[Vr];dr[sn]=Vr});var Zr=0,Kr={};function qr(Vr){this.id=Zr++,this.refCount=1,this.renderbuffer=Vr,this.format=Oo,this.width=0,this.height=0,Ar.profile&&(this.stats={size:0})}qr.prototype.decRef=function(){--this.refCount<=0&&Wr(this)};function Wr(Vr){var sn=Vr.renderbuffer;H(sn,"must not double destroy renderbuffer"),U.bindRenderbuffer(ns,null),U.deleteRenderbuffer(sn),Vr.renderbuffer=null,Vr.refCount=0,delete Kr[Vr.id],nr.renderbufferCount--}function on(Vr,sn){var Zt=new qr(U.createRenderbuffer());Kr[Zt.id]=Zt,nr.renderbufferCount++;function cr(mn,Dr){var wn=0,Nr=0,un=Oo;if(typeof mn=="object"&&mn){var kr=mn;if("shape"in kr){var an=kr.shape;H(Array.isArray(an)&&an.length>=2,"invalid renderbuffer shape"),wn=an[0]|0,Nr=an[1]|0}else"radius"in kr&&(wn=Nr=kr.radius|0),"width"in kr&&(wn=kr.width|0),"height"in kr&&(Nr=kr.height|0);"format"in kr&&(H.parameter(kr.format,qt,"invalid renderbuffer format"),un=qt[kr.format])}else typeof mn=="number"?(wn=mn|0,typeof Dr=="number"?Nr=Dr|0:Nr=wn):mn?H.raise("invalid arguments to renderbuffer constructor"):wn=Nr=1;if(H(wn>0&&Nr>0&&wn<=ze.maxRenderbufferSize&&Nr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),!(wn===Zt.width&&Nr===Zt.height&&un===Zt.format))return cr.width=Zt.width=wn,cr.height=Zt.height=Nr,Zt.format=un,U.bindRenderbuffer(ns,Zt.renderbuffer),U.renderbufferStorage(ns,un,wn,Nr),H(U.getError()===0,"invalid render buffer format"),Ar.profile&&(Zt.stats.size=zo(Zt.format,Zt.width,Zt.height)),cr.format=dr[Zt.format],cr}function Gr(mn,Dr){var wn=mn|0,Nr=Dr|0||wn;return wn===Zt.width&&Nr===Zt.height||(H(wn>0&&Nr>0&&wn<=ze.maxRenderbufferSize&&Nr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),cr.width=Zt.width=wn,cr.height=Zt.height=Nr,U.bindRenderbuffer(ns,Zt.renderbuffer),U.renderbufferStorage(ns,Zt.format,wn,Nr),H(U.getError()===0,"invalid render buffer format"),Ar.profile&&(Zt.stats.size=zo(Zt.format,Zt.width,Zt.height))),cr}return cr(Vr,sn),cr.resize=Gr,cr._reglType="renderbuffer",cr._renderbuffer=Zt,Ar.profile&&(cr.stats=Zt.stats),cr.destroy=function(){Zt.decRef()},cr}Ar.profile&&(nr.getTotalRenderbufferSize=function(){var Vr=0;return Object.keys(Kr).forEach(function(sn){Vr+=Kr[sn].stats.size}),Vr});function hn(){fa(Kr).forEach(function(Vr){Vr.renderbuffer=U.createRenderbuffer(),U.bindRenderbuffer(ns,Vr.renderbuffer),U.renderbufferStorage(ns,Vr.format,Vr.width,Vr.height)}),U.bindRenderbuffer(ns,null)}return{create:on,clear:function(){fa(Kr).forEach(Wr)},restore:hn}},Vs=36160,Fl=36161,Yi=3553,wo=34069,of=36064,bl=36096,gc=36128,Cu=33306,Ts=36053,il=36054,Pu=36055,yc=36057,nc=36061,_c=36193,Vc=5121,zl=5126,tu=6407,xc=6408,al=6402,Mu=[tu,xc],Nl=[];Nl[xc]=4,Nl[tu]=3;var mu=[];mu[Vc]=1,mu[zl]=4,mu[_c]=2;var ru=32854,bc=32855,Sc=36194,Gc=33189,Ec=36168,n=34041,u=35907,a=34836,h=34842,g=34843,E=[ru,bc,Sc,u,h,g,a],T={};T[Ts]="complete",T[il]="incomplete attachment",T[yc]="incomplete dimensions",T[Pu]="incomplete, missing attachment",T[nc]="unsupported";function R(U,Te,ze,nr,Ar,qt){var dr={cur:null,next:null,dirty:!1,setFBO:null},Zr=["rgba"],Kr=["rgba4","rgb565","rgb5 a1"];Te.ext_srgb&&Kr.push("srgba"),Te.ext_color_buffer_half_float&&Kr.push("rgba16f","rgb16f"),Te.webgl_color_buffer_float&&Kr.push("rgba32f");var qr=["uint8"];Te.oes_texture_half_float&&qr.push("half float","float16"),Te.oes_texture_float&&qr.push("float","float32");function Wr(ln,zr,Lr){this.target=ln,this.texture=zr,this.renderbuffer=Lr;var oi=0,ti=0;zr?(oi=zr.width,ti=zr.height):Lr&&(oi=Lr.width,ti=Lr.height),this.width=oi,this.height=ti}function on(ln){ln&&(ln.texture&&ln.texture._texture.decRef(),ln.renderbuffer&&ln.renderbuffer._renderbuffer.decRef())}function hn(ln,zr,Lr){if(!!ln)if(ln.texture){var oi=ln.texture._texture,ti=Math.max(1,oi.width),Ln=Math.max(1,oi.height);H(ti===zr&&Ln===Lr,"inconsistent width/height for supplied texture"),oi.refCount+=1}else{var Vi=ln.renderbuffer._renderbuffer;H(Vi.width===zr&&Vi.height===Lr,"inconsistent width/height for renderbuffer"),Vi.refCount+=1}}function Vr(ln,zr){zr&&(zr.texture?U.framebufferTexture2D(Vs,ln,zr.target,zr.texture._texture.texture,0):U.framebufferRenderbuffer(Vs,ln,Fl,zr.renderbuffer._renderbuffer.renderbuffer))}function sn(ln){var zr=Yi,Lr=null,oi=null,ti=ln;typeof ln=="object"&&(ti=ln.data,"target"in ln&&(zr=ln.target|0)),H.type(ti,"function","invalid attachment data");var Ln=ti._reglType;return Ln==="texture2d"?(Lr=ti,H(zr===Yi)):Ln==="textureCube"?(Lr=ti,H(zr>=wo&&zr<wo+6,"invalid cube map target")):Ln==="renderbuffer"?(oi=ti,zr=Fl):H.raise("invalid regl object for attachment"),new Wr(zr,Lr,oi)}function Zt(ln,zr,Lr,oi,ti){if(Lr){var Ln=nr.create2D({width:ln,height:zr,format:oi,type:ti});return Ln._texture.refCount=0,new Wr(Yi,Ln,null)}else{var Vi=Ar.create({width:ln,height:zr,format:oi});return Vi._renderbuffer.refCount=0,new Wr(Fl,null,Vi)}}function cr(ln){return ln&&(ln.texture||ln.renderbuffer)}function Gr(ln,zr,Lr){ln&&(ln.texture?ln.texture.resize(zr,Lr):ln.renderbuffer&&ln.renderbuffer.resize(zr,Lr),ln.width=zr,ln.height=Lr)}var mn=0,Dr={};function wn(){this.id=mn++,Dr[this.id]=this,this.framebuffer=U.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Nr(ln){ln.colorAttachments.forEach(on),on(ln.depthAttachment),on(ln.stencilAttachment),on(ln.depthStencilAttachment)}function un(ln){var zr=ln.framebuffer;H(zr,"must not double destroy framebuffer"),U.deleteFramebuffer(zr),ln.framebuffer=null,qt.framebufferCount--,delete Dr[ln.id]}function kr(ln){var zr;U.bindFramebuffer(Vs,ln.framebuffer);var Lr=ln.colorAttachments;for(zr=0;zr<Lr.length;++zr)Vr(of+zr,Lr[zr]);for(zr=Lr.length;zr<ze.maxColorAttachments;++zr)U.framebufferTexture2D(Vs,of+zr,Yi,null,0);U.framebufferTexture2D(Vs,Cu,Yi,null,0),U.framebufferTexture2D(Vs,bl,Yi,null,0),U.framebufferTexture2D(Vs,gc,Yi,null,0),Vr(bl,ln.depthAttachment),Vr(gc,ln.stencilAttachment),Vr(Cu,ln.depthStencilAttachment);var oi=U.checkFramebufferStatus(Vs);!U.isContextLost()&&oi!==Ts&&H.raise("framebuffer configuration not supported, status = "+T[oi]),U.bindFramebuffer(Vs,dr.next?dr.next.framebuffer:null),dr.cur=dr.next,U.getError()}function an(ln,zr){var Lr=new wn;qt.framebufferCount++;function oi(Ln,Vi){var wi;H(dr.next!==Lr,"can not update framebuffer which is currently in use");var Fi=0,sa=0,Go=!0,Ps=!0,ea=null,To=!0,Va="rgba",Ho="uint8",Qo=1,_s=null,Ms=null,Ns=null,Wo=!1;if(typeof Ln=="number")Fi=Ln|0,sa=Vi|0||Fi;else if(!Ln)Fi=sa=1;else{H.type(Ln,"object","invalid arguments for framebuffer");var Oi=Ln;if("shape"in Oi){var Is=Oi.shape;H(Array.isArray(Is)&&Is.length>=2,"invalid shape for framebuffer"),Fi=Is[0],sa=Is[1]}else"radius"in Oi&&(Fi=sa=Oi.radius),"width"in Oi&&(Fi=Oi.width),"height"in Oi&&(sa=Oi.height);("color"in Oi||"colors"in Oi)&&(ea=Oi.color||Oi.colors,Array.isArray(ea)&&H(ea.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),ea||("colorCount"in Oi&&(Qo=Oi.colorCount|0,H(Qo>0,"invalid color buffer count")),"colorTexture"in Oi&&(To=!!Oi.colorTexture,Va="rgba4"),"colorType"in Oi&&(Ho=Oi.colorType,To?(H(Te.oes_texture_float||!(Ho==="float"||Ho==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),H(Te.oes_texture_half_float||!(Ho==="half float"||Ho==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ho==="half float"||Ho==="float16"?(H(Te.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Va="rgba16f"):(Ho==="float"||Ho==="float32")&&(H(Te.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Va="rgba32f"),H.oneOf(Ho,qr,"invalid color type")),"colorFormat"in Oi&&(Va=Oi.colorFormat,Zr.indexOf(Va)>=0?To=!0:Kr.indexOf(Va)>=0?To=!1:To?H.oneOf(Oi.colorFormat,Zr,"invalid color format for texture"):H.oneOf(Oi.colorFormat,Kr,"invalid color format for renderbuffer"))),("depthTexture"in Oi||"depthStencilTexture"in Oi)&&(Wo=!!(Oi.depthTexture||Oi.depthStencilTexture),H(!Wo||Te.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Oi&&(typeof Oi.depth=="boolean"?Go=Oi.depth:(_s=Oi.depth,Ps=!1)),"stencil"in Oi&&(typeof Oi.stencil=="boolean"?Ps=Oi.stencil:(Ms=Oi.stencil,Go=!1)),"depthStencil"in Oi&&(typeof Oi.depthStencil=="boolean"?Go=Ps=Oi.depthStencil:(Ns=Oi.depthStencil,Go=!1,Ps=!1))}var ma=null,ni=null,Gi=null,ia=null;if(Array.isArray(ea))ma=ea.map(sn);else if(ea)ma=[sn(ea)];else for(ma=new Array(Qo),wi=0;wi<Qo;++wi)ma[wi]=Zt(Fi,sa,To,Va,Ho);H(Te.webgl_draw_buffers||ma.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),H(ma.length<=ze.maxColorAttachments,"too many color attachments, not supported"),Fi=Fi||ma[0].width,sa=sa||ma[0].height,_s?ni=sn(_s):Go&&!Ps&&(ni=Zt(Fi,sa,Wo,"depth","uint32")),Ms?Gi=sn(Ms):Ps&&!Go&&(Gi=Zt(Fi,sa,!1,"stencil","uint8")),Ns?ia=sn(Ns):!_s&&!Ms&&Ps&&Go&&(ia=Zt(Fi,sa,Wo,"depth stencil","depth stencil")),H(!!_s+!!Ms+!!Ns<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var qo=null;for(wi=0;wi<ma.length;++wi)if(hn(ma[wi],Fi,sa),H(!ma[wi]||ma[wi].texture&&Mu.indexOf(ma[wi].texture._texture.format)>=0||ma[wi].renderbuffer&&E.indexOf(ma[wi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+wi+" is invalid"),ma[wi]&&ma[wi].texture){var Su=Nl[ma[wi].texture._texture.format]*mu[ma[wi].texture._texture.type];qo===null?qo=Su:H(qo===Su,"all color attachments much have the same number of bits per pixel.")}return hn(ni,Fi,sa),H(!ni||ni.texture&&ni.texture._texture.format===al||ni.renderbuffer&&ni.renderbuffer._renderbuffer.format===Gc,"invalid depth attachment for framebuffer object"),hn(Gi,Fi,sa),H(!Gi||Gi.renderbuffer&&Gi.renderbuffer._renderbuffer.format===Ec,"invalid stencil attachment for framebuffer object"),hn(ia,Fi,sa),H(!ia||ia.texture&&ia.texture._texture.format===n||ia.renderbuffer&&ia.renderbuffer._renderbuffer.format===n,"invalid depth-stencil attachment for framebuffer object"),Nr(Lr),Lr.width=Fi,Lr.height=sa,Lr.colorAttachments=ma,Lr.depthAttachment=ni,Lr.stencilAttachment=Gi,Lr.depthStencilAttachment=ia,oi.color=ma.map(cr),oi.depth=cr(ni),oi.stencil=cr(Gi),oi.depthStencil=cr(ia),oi.width=Lr.width,oi.height=Lr.height,kr(Lr),oi}function ti(Ln,Vi){H(dr.next!==Lr,"can not resize a framebuffer which is currently in use");var wi=Math.max(Ln|0,1),Fi=Math.max(Vi|0||wi,1);if(wi===Lr.width&&Fi===Lr.height)return oi;for(var sa=Lr.colorAttachments,Go=0;Go<sa.length;++Go)Gr(sa[Go],wi,Fi);return Gr(Lr.depthAttachment,wi,Fi),Gr(Lr.stencilAttachment,wi,Fi),Gr(Lr.depthStencilAttachment,wi,Fi),Lr.width=oi.width=wi,Lr.height=oi.height=Fi,kr(Lr),oi}return oi(ln,zr),y(oi,{resize:ti,_reglType:"framebuffer",_framebuffer:Lr,destroy:function(){un(Lr),Nr(Lr)},use:function(Ln){dr.setFBO({framebuffer:oi},Ln)}})}function Kn(ln){var zr=Array(6);function Lr(ti){var Ln;H(zr.indexOf(dr.next)<0,"can not update framebuffer which is currently in use");var Vi={color:null},wi=0,Fi=null,sa="rgba",Go="uint8",Ps=1;if(typeof ti=="number")wi=ti|0;else if(!ti)wi=1;else{H.type(ti,"object","invalid arguments for framebuffer");var ea=ti;if("shape"in ea){var To=ea.shape;H(Array.isArray(To)&&To.length>=2,"invalid shape for framebuffer"),H(To[0]===To[1],"cube framebuffer must be square"),wi=To[0]}else"radius"in ea&&(wi=ea.radius|0),"width"in ea?(wi=ea.width|0,"height"in ea&&H(ea.height===wi,"must be square")):"height"in ea&&(wi=ea.height|0);("color"in ea||"colors"in ea)&&(Fi=ea.color||ea.colors,Array.isArray(Fi)&&H(Fi.length===1||Te.webgl_draw_buffers,"multiple render targets not supported")),Fi||("colorCount"in ea&&(Ps=ea.colorCount|0,H(Ps>0,"invalid color buffer count")),"colorType"in ea&&(H.oneOf(ea.colorType,qr,"invalid color type"),Go=ea.colorType),"colorFormat"in ea&&(sa=ea.colorFormat,H.oneOf(ea.colorFormat,Zr,"invalid color format for texture"))),"depth"in ea&&(Vi.depth=ea.depth),"stencil"in ea&&(Vi.stencil=ea.stencil),"depthStencil"in ea&&(Vi.depthStencil=ea.depthStencil)}var Va;if(Fi)if(Array.isArray(Fi))for(Va=[],Ln=0;Ln<Fi.length;++Ln)Va[Ln]=Fi[Ln];else Va=[Fi];else{Va=Array(Ps);var Ho={radius:wi,format:sa,type:Go};for(Ln=0;Ln<Ps;++Ln)Va[Ln]=nr.createCube(Ho)}for(Vi.color=Array(Va.length),Ln=0;Ln<Va.length;++Ln){var Qo=Va[Ln];H(typeof Qo=="function"&&Qo._reglType==="textureCube","invalid cube map"),wi=wi||Qo.width,H(Qo.width===wi&&Qo.height===wi,"invalid cube map shape"),Vi.color[Ln]={target:wo,data:Va[Ln]}}for(Ln=0;Ln<6;++Ln){for(var _s=0;_s<Va.length;++_s)Vi.color[_s].target=wo+Ln;Ln>0&&(Vi.depth=zr[0].depth,Vi.stencil=zr[0].stencil,Vi.depthStencil=zr[0].depthStencil),zr[Ln]?zr[Ln](Vi):zr[Ln]=an(Vi)}return y(Lr,{width:wi,height:wi,color:Va})}function oi(ti){var Ln,Vi=ti|0;if(H(Vi>0&&Vi<=ze.maxCubeMapSize,"invalid radius for cube fbo"),Vi===Lr.width)return Lr;var wi=Lr.color;for(Ln=0;Ln<wi.length;++Ln)wi[Ln].resize(Vi);for(Ln=0;Ln<6;++Ln)zr[Ln].resize(Vi);return Lr.width=Lr.height=Vi,Lr}return Lr(ln),y(Lr,{faces:zr,resize:oi,_reglType:"framebufferCube",destroy:function(){zr.forEach(function(ti){ti.destroy()})}})}function Wn(){dr.cur=null,dr.next=null,dr.dirty=!0,fa(Dr).forEach(function(ln){ln.framebuffer=U.createFramebuffer(),kr(ln)})}return y(dr,{getFramebuffer:function(ln){if(typeof ln=="function"&&ln._reglType==="framebuffer"){var zr=ln._framebuffer;if(zr instanceof wn)return zr}return null},create:an,createCube:Kn,clear:function(){fa(Dr).forEach(un)},restore:Wn})}var Z=5126,ee=34962;function ve(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Z,this.offset=0,this.stride=0,this.divisor=0}function _e(U,Te,ze,nr,Ar){for(var qt=ze.maxAttributes,dr=new Array(qt),Zr=0;Zr<qt;++Zr)dr[Zr]=new ve;var Kr=0,qr={},Wr={Record:ve,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:hn()?Dr:function(){},createVAO:wn,getVAO:sn,destroyBuffer:on,setVAO:hn()?Zt:cr,clear:hn()?Gr:function(){}};function on(Nr){for(var un=0;un<dr.length;++un){var kr=dr[un];kr.buffer===Nr&&(U.disableVertexAttribArray(un),kr.buffer=null)}}function hn(){return Te.oes_vertex_array_object}function Vr(){return Te.angle_instanced_arrays}function sn(Nr){return typeof Nr=="function"&&Nr._vao?Nr._vao:null}function Zt(Nr){if(Nr!==Wr.currentVAO){var un=hn();Nr?un.bindVertexArrayOES(Nr.vao):un.bindVertexArrayOES(null),Wr.currentVAO=Nr}}function cr(Nr){if(Nr!==Wr.currentVAO){if(Nr)Nr.bindAttrs();else for(var un=Vr(),kr=0;kr<dr.length;++kr){var an=dr[kr];an.buffer?(U.enableVertexAttribArray(kr),U.vertexAttribPointer(kr,an.size,an.type,an.normalized,an.stride,an.offfset),un&&an.divisor&&un.vertexAttribDivisorANGLE(kr,an.divisor)):(U.disableVertexAttribArray(kr),U.vertexAttrib4f(kr,an.x,an.y,an.z,an.w))}Wr.currentVAO=Nr}}function Gr(){fa(qr).forEach(function(Nr){Nr.destroy()})}function mn(){this.id=++Kr,this.attributes=[];var Nr=hn();Nr?this.vao=Nr.createVertexArrayOES():this.vao=null,qr[this.id]=this,this.buffers=[]}mn.prototype.bindAttrs=function(){for(var Nr=Vr(),un=this.attributes,kr=0;kr<un.length;++kr){var an=un[kr];an.buffer?(U.enableVertexAttribArray(kr),U.bindBuffer(ee,an.buffer.buffer),U.vertexAttribPointer(kr,an.size,an.type,an.normalized,an.stride,an.offset),Nr&&an.divisor&&Nr.vertexAttribDivisorANGLE(kr,an.divisor)):(U.disableVertexAttribArray(kr),U.vertexAttrib4f(kr,an.x,an.y,an.z,an.w))}for(var Kn=un.length;Kn<qt;++Kn)U.disableVertexAttribArray(Kn)},mn.prototype.refresh=function(){var Nr=hn();Nr&&(Nr.bindVertexArrayOES(this.vao),this.bindAttrs(),Wr.currentVAO=this)},mn.prototype.destroy=function(){if(this.vao){var Nr=hn();this===Wr.currentVAO&&(Wr.currentVAO=null,Nr.bindVertexArrayOES(null)),Nr.deleteVertexArrayOES(this.vao),this.vao=null}qr[this.id]&&(delete qr[this.id],nr.vaoCount-=1)};function Dr(){var Nr=hn();Nr&&fa(qr).forEach(function(un){un.refresh()})}function wn(Nr){var un=new mn;nr.vaoCount+=1;function kr(an){H(Array.isArray(an),"arguments to vertex array constructor must be an array"),H(an.length<qt,"too many attributes"),H(an.length>0,"must specify at least one attribute");var Kn={},Wn=un.attributes;Wn.length=an.length;for(var ln=0;ln<an.length;++ln){var zr=an[ln],Lr=Wn[ln]=new ve,oi=zr.data||zr;if(Array.isArray(oi)||C(oi)||Oa(oi)){var ti;un.buffers[ln]&&(ti=un.buffers[ln],C(oi)&&ti._buffer.byteLength>=oi.byteLength?ti.subdata(oi):(ti.destroy(),un.buffers[ln]=null)),un.buffers[ln]||(ti=un.buffers[ln]=Ar.create(zr,ee,!1,!0)),Lr.buffer=Ar.getBuffer(ti),Lr.size=Lr.buffer.dimension|0,Lr.normalized=!1,Lr.type=Lr.buffer.dtype,Lr.offset=0,Lr.stride=0,Lr.divisor=0,Lr.state=1,Kn[ln]=1}else Ar.getBuffer(zr)?(Lr.buffer=Ar.getBuffer(zr),Lr.size=Lr.buffer.dimension|0,Lr.normalized=!1,Lr.type=Lr.buffer.dtype,Lr.offset=0,Lr.stride=0,Lr.divisor=0,Lr.state=1):Ar.getBuffer(zr.buffer)?(Lr.buffer=Ar.getBuffer(zr.buffer),Lr.size=(+zr.size||Lr.buffer.dimension)|0,Lr.normalized=!!zr.normalized||!1,"type"in zr?(H.parameter(zr.type,co,"invalid buffer type"),Lr.type=co[zr.type]):Lr.type=Lr.buffer.dtype,Lr.offset=(zr.offset||0)|0,Lr.stride=(zr.stride||0)|0,Lr.divisor=(zr.divisor||0)|0,Lr.state=1,H(Lr.size>=1&&Lr.size<=4,"size must be between 1 and 4"),H(Lr.offset>=0,"invalid offset"),H(Lr.stride>=0&&Lr.stride<=255,"stride must be between 0 and 255"),H(Lr.divisor>=0,"divisor must be positive"),H(!Lr.divisor||!!Te.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in zr?(H(ln>0,"first attribute must not be a constant"),Lr.x=+zr.x||0,Lr.y=+zr.y||0,Lr.z=+zr.z||0,Lr.w=+zr.w||0,Lr.state=2):H(!1,"invalid attribute spec for location "+ln)}for(var Ln=0;Ln<un.buffers.length;++Ln)!Kn[Ln]&&un.buffers[Ln]&&(un.buffers[Ln].destroy(),un.buffers[Ln]=null);return un.refresh(),kr}return kr.destroy=function(){for(var an=0;an<un.buffers.length;++an)un.buffers[an]&&un.buffers[an].destroy();un.buffers.length=0,un.destroy()},kr._vao=un,kr._reglType="vao",kr(Nr)}return Wr}var Ee=35632,We=35633,He=35718,lt=35721;function Fe(U,Te,ze,nr){var Ar={},qt={};function dr(Zt,cr,Gr,mn){this.name=Zt,this.id=cr,this.location=Gr,this.info=mn}function Zr(Zt,cr){for(var Gr=0;Gr<Zt.length;++Gr)if(Zt[Gr].id===cr.id){Zt[Gr].location=cr.location;return}Zt.push(cr)}function Kr(Zt,cr,Gr){var mn=Zt===Ee?Ar:qt,Dr=mn[cr];if(!Dr){var wn=Te.str(cr);Dr=U.createShader(Zt),U.shaderSource(Dr,wn),U.compileShader(Dr),H.shaderError(U,Dr,wn,Zt,Gr),mn[cr]=Dr}return Dr}var qr={},Wr=[],on=0;function hn(Zt,cr){this.id=on++,this.fragId=Zt,this.vertId=cr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,nr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Vr(Zt,cr,Gr){var mn,Dr,wn=Kr(Ee,Zt.fragId),Nr=Kr(We,Zt.vertId),un=Zt.program=U.createProgram();if(U.attachShader(un,wn),U.attachShader(un,Nr),Gr)for(mn=0;mn<Gr.length;++mn){var kr=Gr[mn];U.bindAttribLocation(un,kr[0],kr[1])}U.linkProgram(un),H.linkError(U,un,Te.str(Zt.fragId),Te.str(Zt.vertId),cr);var an=U.getProgramParameter(un,He);nr.profile&&(Zt.stats.uniformsCount=an);var Kn=Zt.uniforms;for(mn=0;mn<an;++mn)if(Dr=U.getActiveUniform(un,mn),Dr)if(Dr.size>1)for(var Wn=0;Wn<Dr.size;++Wn){var ln=Dr.name.replace("[0]","["+Wn+"]");Zr(Kn,new dr(ln,Te.id(ln),U.getUniformLocation(un,ln),Dr))}else Zr(Kn,new dr(Dr.name,Te.id(Dr.name),U.getUniformLocation(un,Dr.name),Dr));var zr=U.getProgramParameter(un,lt);nr.profile&&(Zt.stats.attributesCount=zr);var Lr=Zt.attributes;for(mn=0;mn<zr;++mn)Dr=U.getActiveAttrib(un,mn),Dr&&Zr(Lr,new dr(Dr.name,Te.id(Dr.name),U.getAttribLocation(un,Dr.name),Dr))}nr.profile&&(ze.getMaxUniformsCount=function(){var Zt=0;return Wr.forEach(function(cr){cr.stats.uniformsCount>Zt&&(Zt=cr.stats.uniformsCount)}),Zt},ze.getMaxAttributesCount=function(){var Zt=0;return Wr.forEach(function(cr){cr.stats.attributesCount>Zt&&(Zt=cr.stats.attributesCount)}),Zt});function sn(){Ar={},qt={};for(var Zt=0;Zt<Wr.length;++Zt)Vr(Wr[Zt],null,Wr[Zt].attributes.map(function(cr){return[cr.location,cr.name]}))}return{clear:function(){var Zt=U.deleteShader.bind(U);fa(Ar).forEach(Zt),Ar={},fa(qt).forEach(Zt),qt={},Wr.forEach(function(cr){U.deleteProgram(cr.program)}),Wr.length=0,qr={},ze.shaderCount=0},program:function(Zt,cr,Gr,mn){H.command(Zt>=0,"missing vertex shader",Gr),H.command(cr>=0,"missing fragment shader",Gr);var Dr=qr[cr];Dr||(Dr=qr[cr]={});var wn=Dr[Zt];if(wn&&(wn.refCount++,!mn))return wn;var Nr=new hn(cr,Zt);return ze.shaderCount++,Vr(Nr,Gr,mn),wn||(Dr[Zt]=Nr),Wr.push(Nr),y(Nr,{destroy:function(){if(Nr.refCount--,Nr.refCount<=0){U.deleteProgram(Nr.program);var un=Wr.indexOf(Nr);Wr.splice(un,1),ze.shaderCount--}Dr[Nr.vertId].refCount<=0&&(U.deleteShader(qt[Nr.vertId]),delete qt[Nr.vertId],delete qr[Nr.fragId][Nr.vertId]),Object.keys(qr[Nr.fragId]).length||(U.deleteShader(Ar[Nr.fragId]),delete Ar[Nr.fragId],delete qr[Nr.fragId])}})},restore:sn,shader:Kr,frag:-1,vert:-1}}var st=6408,bt=5121,Gt=3333,ur=5126;function or(U,Te,ze,nr,Ar,qt,dr){function Zr(Wr){var on;Te.next===null?(H(Ar.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),on=bt):(H(Te.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),on=Te.next.colorAttachments[0].texture._texture.type,qt.oes_texture_float?(H(on===bt||on===ur,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),on===ur&&H(dr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):H(on===bt,"Reading from a framebuffer is only allowed for the type 'uint8'"));var hn=0,Vr=0,sn=nr.framebufferWidth,Zt=nr.framebufferHeight,cr=null;C(Wr)?cr=Wr:Wr&&(H.type(Wr,"object","invalid arguments to regl.read()"),hn=Wr.x|0,Vr=Wr.y|0,H(hn>=0&&hn<nr.framebufferWidth,"invalid x offset for regl.read"),H(Vr>=0&&Vr<nr.framebufferHeight,"invalid y offset for regl.read"),sn=(Wr.width||nr.framebufferWidth-hn)|0,Zt=(Wr.height||nr.framebufferHeight-Vr)|0,cr=Wr.data||null),cr&&(on===bt?H(cr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):on===ur&&H(cr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),H(sn>0&&sn+hn<=nr.framebufferWidth,"invalid width for read pixels"),H(Zt>0&&Zt+Vr<=nr.framebufferHeight,"invalid height for read pixels"),ze();var Gr=sn*Zt*4;return cr||(on===bt?cr=new Uint8Array(Gr):on===ur&&(cr=cr||new Float32Array(Gr))),H.isTypedArray(cr,"data buffer for regl.read() must be a typedarray"),H(cr.byteLength>=Gr,"data buffer for regl.read() too small"),U.pixelStorei(Gt,4),U.readPixels(hn,Vr,sn,Zt,st,on,cr),cr}function Kr(Wr){var on;return Te.setFBO({framebuffer:Wr.framebuffer},function(){on=Zr(Wr)}),on}function qr(Wr){return!Wr||!("framebuffer"in Wr)?Zr(Wr):Kr(Wr)}return qr}function lr(U){return Array.prototype.slice.call(U)}function Rr(U){return lr(U).join("")}function nn(){var U=0,Te=[],ze=[];function nr(on){for(var hn=0;hn<ze.length;++hn)if(ze[hn]===on)return Te[hn];var Vr="g"+U++;return Te.push(Vr),ze.push(on),Vr}function Ar(){var on=[];function hn(){on.push.apply(on,lr(arguments))}var Vr=[];function sn(){var Zt="v"+U++;return Vr.push(Zt),arguments.length>0&&(on.push(Zt,"="),on.push.apply(on,lr(arguments)),on.push(";")),Zt}return y(hn,{def:sn,toString:function(){return Rr([Vr.length>0?"var "+Vr.join(",")+";":"",Rr(on)])}})}function qt(){var on=Ar(),hn=Ar(),Vr=on.toString,sn=hn.toString;function Zt(cr,Gr){hn(cr,Gr,"=",on.def(cr,Gr),";")}return y(function(){on.apply(on,lr(arguments))},{def:on.def,entry:on,exit:hn,save:Zt,set:function(cr,Gr,mn){Zt(cr,Gr),on(cr,Gr,"=",mn,";")},toString:function(){return Vr()+sn()}})}function dr(){var on=Rr(arguments),hn=qt(),Vr=qt(),sn=hn.toString,Zt=Vr.toString;return y(hn,{then:function(){return hn.apply(hn,lr(arguments)),this},else:function(){return Vr.apply(Vr,lr(arguments)),this},toString:function(){var cr=Zt();return cr&&(cr="else{"+cr+"}"),Rr(["if(",on,"){",sn(),"}",cr])}})}var Zr=Ar(),Kr={};function qr(on,hn){var Vr=[];function sn(){var Dr="a"+Vr.length;return Vr.push(Dr),Dr}hn=hn||0;for(var Zt=0;Zt<hn;++Zt)sn();var cr=qt(),Gr=cr.toString,mn=Kr[on]=y(cr,{arg:sn,toString:function(){return Rr(["function(",Vr.join(),"){",Gr(),"}"])}});return mn}function Wr(){var on=['"use strict";',Zr,"return {"];Object.keys(Kr).forEach(function(sn){on.push('"',sn,'":',Kr[sn].toString(),",")}),on.push("}");var hn=Rr(on).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Vr=Function.apply(null,Te.concat(hn));return Vr.apply(null,ze)}return{global:Zr,link:nr,block:Ar,proc:qr,scope:qt,cond:dr,compile:Wr}}var Qr="xyzw".split(""),yn=5121,jn=1,Xn=2,Hn=0,Ki=1,bn=2,ai=3,_i=4,ii=5,ri=6,xi="dither",ei="blend.enable",Qn="blend.color",_o="blend.equation",Ka="blend.func",as="depth.enable",No="depth.func",$a="depth.range",io="depth.mask",gs="colorMask",Bo="cull.enable",Iu="cull.face",os="frontFace",Gs="lineWidth",Hs="polygonOffset.enable",Sl="polygonOffset.offset",El="sample.alpha",zs="sample.enable",Vu="sample.coverage",Bl="stencil.enable",gu="stencil.mask",wl="stencil.func",nu="stencil.opFront",ao="stencil.opBack",Ou="scissor.enable",yu="scissor.box",As="viewport",$i="profile",Uo="framebuffer",xo="vert",Lu="frag",iu="elements",_u="primitive",Gu="count",Ru="offset",Ws="instances",au="vao",Tl="Width",sf="Height",xu=Uo+Tl,da=Uo+sf,vh=As+Tl,Hf=As+sf,Wf="drawingBuffer",Ul=Wf+Tl,kf=Wf+sf,mh=[Ka,_o,wl,nu,ao,Vu,As,yu,Sl],ic=34962,Ff=34963,wf=35632,Xf=35633,jl=3553,Hc=34067,zf=2884,Yf=3042,Kf=3024,$f=2960,Jf=2929,ou=3089,Nf=32823,Qf=32926,qf=32928,jo=5126,Tf=35664,oo=35665,uf=35666,lf=5124,Wc=35667,ac=35668,wc=35669,z=35670,B=35671,M=35672,O=35673,J=35674,me=35675,qe=35676,Et=35678,St=35680,yr=4,Br=1028,Mn=1029,Bn=2304,ci=2305,Si=32775,Ci=32776,va=519,Pi=7680,Ja=0,Zo=1,Vo=32774,ys=513,bo=36160,Aa=36064,Ea={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Lo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Qa={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},qa={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Jo={frag:wf,vert:Xf},ss={cw:Bn,ccw:ci};function Tc(U){return Array.isArray(U)||C(U)||Oa(U)}function oc(U){return U.sort(function(Te,ze){return Te===As?-1:ze===As?1:Te<ze?-1:1})}function Cs(U,Te,ze,nr){this.thisDep=U,this.contextDep=Te,this.propDep=ze,this.append=nr}function Xs(U){return U&&!(U.thisDep||U.contextDep||U.propDep)}function us(U){return new Cs(!1,!1,!1,U)}function su(U,Te){var ze=U.type;if(ze===Hn){var nr=U.data.length;return new Cs(!0,nr>=1,nr>=2,Te)}else if(ze===_i){var Ar=U.data;return new Cs(Ar.thisDep,Ar.contextDep,Ar.propDep,Te)}else{if(ze===ii)return new Cs(!1,!1,!1,Te);if(ze===ri){for(var qt=!1,dr=!1,Zr=!1,Kr=0;Kr<U.data.length;++Kr){var qr=U.data[Kr];if(qr.type===Ki)Zr=!0;else if(qr.type===bn)dr=!0;else if(qr.type===ai)qt=!0;else if(qr.type===Hn){qt=!0;var Wr=qr.data;Wr>=1&&(dr=!0),Wr>=2&&(Zr=!0)}else qr.type===_i&&(qt=qt||qr.data.thisDep,dr=dr||qr.data.contextDep,Zr=Zr||qr.data.propDep)}return new Cs(qt,dr,Zr,Te)}else return new Cs(ze===ai,ze===bn,ze===Ki,Te)}}var hp=new Cs(!1,!1,!1,function(){});function pp(U,Te,ze,nr,Ar,qt,dr,Zr,Kr,qr,Wr,on,hn,Vr,sn){var Zt=qr.Record,cr={add:32774,subtract:32778,"reverse subtract":32779};ze.ext_blend_minmax&&(cr.min=Si,cr.max=Ci);var Gr=ze.angle_instanced_arrays,mn=ze.webgl_draw_buffers,Dr={dirty:!0,profile:sn.profile},wn={},Nr=[],un={},kr={};function an(Re){return Re.replace(".","_")}function Kn(Re,ye,ut){var Lt=an(Re);Nr.push(Re),wn[Lt]=Dr[Lt]=!!ut,un[Lt]=ye}function Wn(Re,ye,ut){var Lt=an(Re);Nr.push(Re),Array.isArray(ut)?(Dr[Lt]=ut.slice(),wn[Lt]=ut.slice()):Dr[Lt]=wn[Lt]=ut,kr[Lt]=ye}Kn(xi,Kf),Kn(ei,Yf),Wn(Qn,"blendColor",[0,0,0,0]),Wn(_o,"blendEquationSeparate",[Vo,Vo]),Wn(Ka,"blendFuncSeparate",[Zo,Ja,Zo,Ja]),Kn(as,Jf,!0),Wn(No,"depthFunc",ys),Wn($a,"depthRange",[0,1]),Wn(io,"depthMask",!0),Wn(gs,gs,[!0,!0,!0,!0]),Kn(Bo,zf),Wn(Iu,"cullFace",Mn),Wn(os,os,ci),Wn(Gs,Gs,1),Kn(Hs,Nf),Wn(Sl,"polygonOffset",[0,0]),Kn(El,Qf),Kn(zs,qf),Wn(Vu,"sampleCoverage",[1,!1]),Kn(Bl,$f),Wn(gu,"stencilMask",-1),Wn(wl,"stencilFunc",[va,0,-1]),Wn(nu,"stencilOpSeparate",[Br,Pi,Pi,Pi]),Wn(ao,"stencilOpSeparate",[Mn,Pi,Pi,Pi]),Kn(Ou,ou),Wn(yu,"scissor",[0,0,U.drawingBufferWidth,U.drawingBufferHeight]),Wn(As,As,[0,0,U.drawingBufferWidth,U.drawingBufferHeight]);var ln={gl:U,context:hn,strings:Te,next:wn,current:Dr,draw:on,elements:qt,buffer:Ar,shader:Wr,attributes:qr.state,vao:qr,uniforms:Kr,framebuffer:Zr,extensions:ze,timer:Vr,isBufferArgs:Tc},zr={primTypes:yi,compareFuncs:Qa,blendFuncs:Ea,blendEquations:cr,stencilOps:qa,glTypes:co,orientationType:ss};H.optional(function(){ln.isArrayLike=ro}),mn&&(zr.backBuffer=[Mn],zr.drawBuffer=te(nr.maxDrawbuffers,function(Re){return Re===0?[0]:te(Re,function(ye){return Aa+ye})}));var Lr=0;function oi(){var Re=nn(),ye=Re.link,ut=Re.global;Re.id=Lr++,Re.batchId="0";var Lt=ye(ln),Vt=Re.shared={props:"a0"};Object.keys(ln).forEach(function(rt){Vt[rt]=ut.def(Lt,".",rt)}),H.optional(function(){Re.CHECK=ye(H),Re.commandStr=H.guessCommand(),Re.command=ye(Re.commandStr),Re.assert=function(rt,Me,It){rt("if(!(",Me,"))",this.CHECK,".commandRaise(",ye(It),",",this.command,");")},zr.invalidBlendCombinations=Lo});var yt=Re.next={},dt=Re.current={};Object.keys(kr).forEach(function(rt){Array.isArray(Dr[rt])&&(yt[rt]=ut.def(Vt.next,".",rt),dt[rt]=ut.def(Vt.current,".",rt))});var Ct=Re.constants={};Object.keys(zr).forEach(function(rt){Ct[rt]=ut.def(JSON.stringify(zr[rt]))}),Re.invoke=function(rt,Me){switch(Me.type){case Hn:var It=["this",Vt.context,Vt.props,Re.batchId];return rt.def(ye(Me.data),".call(",It.slice(0,Math.max(Me.data.length+1,4)),")");case Ki:return rt.def(Vt.props,Me.data);case bn:return rt.def(Vt.context,Me.data);case ai:return rt.def("this",Me.data);case _i:return Me.data.append(Re,rt),Me.data.ref;case ii:return Me.data.toString();case ri:return Me.data.map(function(Ht){return Re.invoke(rt,Ht)})}},Re.attribCache={};var Le={};return Re.scopeAttrib=function(rt){var Me=Te.id(rt);if(Me in Le)return Le[Me];var It=qr.scope[Me];It||(It=qr.scope[Me]=new Zt);var Ht=Le[Me]=ye(It);return Ht},Re}function ti(Re){var ye=Re.static,ut=Re.dynamic,Lt;if($i in ye){var Vt=!!ye[$i];Lt=us(function(dt,Ct){return Vt}),Lt.enable=Vt}else if($i in ut){var yt=ut[$i];Lt=su(yt,function(dt,Ct){return dt.invoke(Ct,yt)})}return Lt}function Ln(Re,ye){var ut=Re.static,Lt=Re.dynamic;if(Uo in ut){var Vt=ut[Uo];return Vt?(Vt=Zr.getFramebuffer(Vt),H.command(Vt,"invalid framebuffer object"),us(function(dt,Ct){var Le=dt.link(Vt),rt=dt.shared;Ct.set(rt.framebuffer,".next",Le);var Me=rt.context;return Ct.set(Me,"."+xu,Le+".width"),Ct.set(Me,"."+da,Le+".height"),Le})):us(function(dt,Ct){var Le=dt.shared;Ct.set(Le.framebuffer,".next","null");var rt=Le.context;return Ct.set(rt,"."+xu,rt+"."+Ul),Ct.set(rt,"."+da,rt+"."+kf),"null"})}else if(Uo in Lt){var yt=Lt[Uo];return su(yt,function(dt,Ct){var Le=dt.invoke(Ct,yt),rt=dt.shared,Me=rt.framebuffer,It=Ct.def(Me,".getFramebuffer(",Le,")");H.optional(function(){dt.assert(Ct,"!"+Le+"||"+It,"invalid framebuffer object")}),Ct.set(Me,".next",It);var Ht=rt.context;return Ct.set(Ht,"."+xu,It+"?"+It+".width:"+Ht+"."+Ul),Ct.set(Ht,"."+da,It+"?"+It+".height:"+Ht+"."+kf),It})}else return null}function Vi(Re,ye,ut){var Lt=Re.static,Vt=Re.dynamic;function yt(Le){if(Le in Lt){var rt=Lt[Le];H.commandType(rt,"object","invalid "+Le,ut.commandStr);var Me=!0,It=rt.x|0,Ht=rt.y|0,Cr,rr;return"width"in rt?(Cr=rt.width|0,H.command(Cr>=0,"invalid "+Le,ut.commandStr)):Me=!1,"height"in rt?(rr=rt.height|0,H.command(rr>=0,"invalid "+Le,ut.commandStr)):Me=!1,new Cs(!Me&&ye&&ye.thisDep,!Me&&ye&&ye.contextDep,!Me&&ye&&ye.propDep,function(Fn,bi){var zn=Fn.shared.context,si=Cr;"width"in rt||(si=bi.def(zn,".",xu,"-",It));var Ti=rr;return"height"in rt||(Ti=bi.def(zn,".",da,"-",Ht)),[It,Ht,si,Ti]})}else if(Le in Vt){var Er=Vt[Le],Xr=su(Er,function(Fn,bi){var zn=Fn.invoke(bi,Er);H.optional(function(){Fn.assert(bi,zn+"&&typeof "+zn+'==="object"',"invalid "+Le)});var si=Fn.shared.context,Ti=bi.def(zn,".x|0"),ua=bi.def(zn,".y|0"),eo=bi.def('"width" in ',zn,"?",zn,".width|0:","(",si,".",xu,"-",Ti,")"),ls=bi.def('"height" in ',zn,"?",zn,".height|0:","(",si,".",da,"-",ua,")");return H.optional(function(){Fn.assert(bi,eo+">=0&&"+ls+">=0","invalid "+Le)}),[Ti,ua,eo,ls]});return ye&&(Xr.thisDep=Xr.thisDep||ye.thisDep,Xr.contextDep=Xr.contextDep||ye.contextDep,Xr.propDep=Xr.propDep||ye.propDep),Xr}else return ye?new Cs(ye.thisDep,ye.contextDep,ye.propDep,function(Fn,bi){var zn=Fn.shared.context;return[0,0,bi.def(zn,".",xu),bi.def(zn,".",da)]}):null}var dt=yt(As);if(dt){var Ct=dt;dt=new Cs(dt.thisDep,dt.contextDep,dt.propDep,function(Le,rt){var Me=Ct.append(Le,rt),It=Le.shared.context;return rt.set(It,"."+vh,Me[2]),rt.set(It,"."+Hf,Me[3]),Me})}return{viewport:dt,scissor_box:yt(yu)}}function wi(Re,ye){var ut=Re.static,Lt=typeof ut[Lu]=="string"&&typeof ut[xo]=="string";if(Lt){if(Object.keys(ye.dynamic).length>0)return null;var Vt=ye.static,yt=Object.keys(Vt);if(yt.length>0&&typeof Vt[yt[0]]=="number"){for(var dt=[],Ct=0;Ct<yt.length;++Ct)H(typeof Vt[yt[Ct]]=="number","must specify all vertex attribute locations when using vaos"),dt.push([Vt[yt[Ct]]|0,yt[Ct]]);return dt}}return null}function Fi(Re,ye,ut){var Lt=Re.static,Vt=Re.dynamic;function yt(Me){if(Me in Lt){var It=Te.id(Lt[Me]);H.optional(function(){Wr.shader(Jo[Me],It,H.guessCommand())});var Ht=us(function(){return It});return Ht.id=It,Ht}else if(Me in Vt){var Cr=Vt[Me];return su(Cr,function(rr,Er){var Xr=rr.invoke(Er,Cr),Fn=Er.def(rr.shared.strings,".id(",Xr,")");return H.optional(function(){Er(rr.shared.shader,".shader(",Jo[Me],",",Fn,",",rr.command,");")}),Fn})}return null}var dt=yt(Lu),Ct=yt(xo),Le=null,rt;return Xs(dt)&&Xs(Ct)?(Le=Wr.program(Ct.id,dt.id,null,ut),rt=us(function(Me,It){return Me.link(Le)})):rt=new Cs(dt&&dt.thisDep||Ct&&Ct.thisDep,dt&&dt.contextDep||Ct&&Ct.contextDep,dt&&dt.propDep||Ct&&Ct.propDep,function(Me,It){var Ht=Me.shared.shader,Cr;dt?Cr=dt.append(Me,It):Cr=It.def(Ht,".",Lu);var rr;Ct?rr=Ct.append(Me,It):rr=It.def(Ht,".",xo);var Er=Ht+".program("+rr+","+Cr;return H.optional(function(){Er+=","+Me.command}),It.def(Er+")")}),{frag:dt,vert:Ct,progVar:rt,program:Le}}function sa(Re,ye){var ut=Re.static,Lt=Re.dynamic;function Vt(){if(iu in ut){var Me=ut[iu];Tc(Me)?Me=qt.getElements(qt.create(Me,!0)):Me&&(Me=qt.getElements(Me),H.command(Me,"invalid elements",ye.commandStr));var It=us(function(Cr,rr){if(Me){var Er=Cr.link(Me);return Cr.ELEMENTS=Er,Er}return Cr.ELEMENTS=null,null});return It.value=Me,It}else if(iu in Lt){var Ht=Lt[iu];return su(Ht,function(Cr,rr){var Er=Cr.shared,Xr=Er.isBufferArgs,Fn=Er.elements,bi=Cr.invoke(rr,Ht),zn=rr.def("null"),si=rr.def(Xr,"(",bi,")"),Ti=Cr.cond(si).then(zn,"=",Fn,".createStream(",bi,");").else(zn,"=",Fn,".getElements(",bi,");");return H.optional(function(){Cr.assert(Ti.else,"!"+bi+"||"+zn,"invalid elements")}),rr.entry(Ti),rr.exit(Cr.cond(si).then(Fn,".destroyStream(",zn,");")),Cr.ELEMENTS=zn,zn})}return null}var yt=Vt();function dt(){if(_u in ut){var Me=ut[_u];return H.commandParameter(Me,yi,"invalid primitve",ye.commandStr),us(function(Ht,Cr){return yi[Me]})}else if(_u in Lt){var It=Lt[_u];return su(It,function(Ht,Cr){var rr=Ht.constants.primTypes,Er=Ht.invoke(Cr,It);return H.optional(function(){Ht.assert(Cr,Er+" in "+rr,"invalid primitive, must be one of "+Object.keys(yi))}),Cr.def(rr,"[",Er,"]")})}else if(yt)return Xs(yt)?yt.value?us(function(Ht,Cr){return Cr.def(Ht.ELEMENTS,".primType")}):us(function(){return yr}):new Cs(yt.thisDep,yt.contextDep,yt.propDep,function(Ht,Cr){var rr=Ht.ELEMENTS;return Cr.def(rr,"?",rr,".primType:",yr)});return null}function Ct(Me,It){if(Me in ut){var Ht=ut[Me]|0;return H.command(!It||Ht>=0,"invalid "+Me,ye.commandStr),us(function(rr,Er){return It&&(rr.OFFSET=Ht),Ht})}else if(Me in Lt){var Cr=Lt[Me];return su(Cr,function(rr,Er){var Xr=rr.invoke(Er,Cr);return It&&(rr.OFFSET=Xr,H.optional(function(){rr.assert(Er,Xr+">=0","invalid "+Me)})),Xr})}else if(It&&yt)return us(function(rr,Er){return rr.OFFSET="0",0});return null}var Le=Ct(Ru,!0);function rt(){if(Gu in ut){var Me=ut[Gu]|0;return H.command(typeof Me=="number"&&Me>=0,"invalid vertex count",ye.commandStr),us(function(){return Me})}else if(Gu in Lt){var It=Lt[Gu];return su(It,function(rr,Er){var Xr=rr.invoke(Er,It);return H.optional(function(){rr.assert(Er,"typeof "+Xr+'==="number"&&'+Xr+">=0&&"+Xr+"===("+Xr+"|0)","invalid vertex count")}),Xr})}else if(yt)if(Xs(yt)){if(yt)return Le?new Cs(Le.thisDep,Le.contextDep,Le.propDep,function(rr,Er){var Xr=Er.def(rr.ELEMENTS,".vertCount-",rr.OFFSET);return H.optional(function(){rr.assert(Er,Xr+">=0","invalid vertex offset/element buffer too small")}),Xr}):us(function(rr,Er){return Er.def(rr.ELEMENTS,".vertCount")});var Ht=us(function(){return-1});return H.optional(function(){Ht.MISSING=!0}),Ht}else{var Cr=new Cs(yt.thisDep||Le.thisDep,yt.contextDep||Le.contextDep,yt.propDep||Le.propDep,function(rr,Er){var Xr=rr.ELEMENTS;return rr.OFFSET?Er.def(Xr,"?",Xr,".vertCount-",rr.OFFSET,":-1"):Er.def(Xr,"?",Xr,".vertCount:-1")});return H.optional(function(){Cr.DYNAMIC=!0}),Cr}return null}return{elements:yt,primitive:dt(),count:rt(),instances:Ct(Ws,!1),offset:Le}}function Go(Re,ye){var ut=Re.static,Lt=Re.dynamic,Vt={};return Nr.forEach(function(yt){var dt=an(yt);function Ct(Le,rt){if(yt in ut){var Me=Le(ut[yt]);Vt[dt]=us(function(){return Me})}else if(yt in Lt){var It=Lt[yt];Vt[dt]=su(It,function(Ht,Cr){return rt(Ht,Cr,Ht.invoke(Cr,It))})}}switch(yt){case Bo:case ei:case xi:case Bl:case as:case Ou:case Hs:case El:case zs:case io:return Ct(function(Le){return H.commandType(Le,"boolean",yt,ye.commandStr),Le},function(Le,rt,Me){return H.optional(function(){Le.assert(rt,"typeof "+Me+'==="boolean"',"invalid flag "+yt,Le.commandStr)}),Me});case No:return Ct(function(Le){return H.commandParameter(Le,Qa,"invalid "+yt,ye.commandStr),Qa[Le]},function(Le,rt,Me){var It=Le.constants.compareFuncs;return H.optional(function(){Le.assert(rt,Me+" in "+It,"invalid "+yt+", must be one of "+Object.keys(Qa))}),rt.def(It,"[",Me,"]")});case $a:return Ct(function(Le){return H.command(ro(Le)&&Le.length===2&&typeof Le[0]=="number"&&typeof Le[1]=="number"&&Le[0]<=Le[1],"depth range is 2d array",ye.commandStr),Le},function(Le,rt,Me){H.optional(function(){Le.assert(rt,Le.shared.isArrayLike+"("+Me+")&&"+Me+".length===2&&typeof "+Me+'[0]==="number"&&typeof '+Me+'[1]==="number"&&'+Me+"[0]<="+Me+"[1]","depth range must be a 2d array")});var It=rt.def("+",Me,"[0]"),Ht=rt.def("+",Me,"[1]");return[It,Ht]});case Ka:return Ct(function(Le){H.commandType(Le,"object","blend.func",ye.commandStr);var rt="srcRGB"in Le?Le.srcRGB:Le.src,Me="srcAlpha"in Le?Le.srcAlpha:Le.src,It="dstRGB"in Le?Le.dstRGB:Le.dst,Ht="dstAlpha"in Le?Le.dstAlpha:Le.dst;return H.commandParameter(rt,Ea,dt+".srcRGB",ye.commandStr),H.commandParameter(Me,Ea,dt+".srcAlpha",ye.commandStr),H.commandParameter(It,Ea,dt+".dstRGB",ye.commandStr),H.commandParameter(Ht,Ea,dt+".dstAlpha",ye.commandStr),H.command(Lo.indexOf(rt+", "+It)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+rt+", "+It+")",ye.commandStr),[Ea[rt],Ea[It],Ea[Me],Ea[Ht]]},function(Le,rt,Me){var It=Le.constants.blendFuncs;H.optional(function(){Le.assert(rt,Me+"&&typeof "+Me+'==="object"',"invalid blend func, must be an object")});function Ht(zn,si){var Ti=rt.def('"',zn,si,'" in ',Me,"?",Me,".",zn,si,":",Me,".",zn);return H.optional(function(){Le.assert(rt,Ti+" in "+It,"invalid "+yt+"."+zn+si+", must be one of "+Object.keys(Ea))}),Ti}var Cr=Ht("src","RGB"),rr=Ht("dst","RGB");H.optional(function(){var zn=Le.constants.invalidBlendCombinations;Le.assert(rt,zn+".indexOf("+Cr+'+", "+'+rr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Er=rt.def(It,"[",Cr,"]"),Xr=rt.def(It,"[",Ht("src","Alpha"),"]"),Fn=rt.def(It,"[",rr,"]"),bi=rt.def(It,"[",Ht("dst","Alpha"),"]");return[Er,Fn,Xr,bi]});case _o:return Ct(function(Le){if(typeof Le=="string")return H.commandParameter(Le,cr,"invalid "+yt,ye.commandStr),[cr[Le],cr[Le]];if(typeof Le=="object")return H.commandParameter(Le.rgb,cr,yt+".rgb",ye.commandStr),H.commandParameter(Le.alpha,cr,yt+".alpha",ye.commandStr),[cr[Le.rgb],cr[Le.alpha]];H.commandRaise("invalid blend.equation",ye.commandStr)},function(Le,rt,Me){var It=Le.constants.blendEquations,Ht=rt.def(),Cr=rt.def(),rr=Le.cond("typeof ",Me,'==="string"');return H.optional(function(){function Er(Xr,Fn,bi){Le.assert(Xr,bi+" in "+It,"invalid "+Fn+", must be one of "+Object.keys(cr))}Er(rr.then,yt,Me),Le.assert(rr.else,Me+"&&typeof "+Me+'==="object"',"invalid "+yt),Er(rr.else,yt+".rgb",Me+".rgb"),Er(rr.else,yt+".alpha",Me+".alpha")}),rr.then(Ht,"=",Cr,"=",It,"[",Me,"];"),rr.else(Ht,"=",It,"[",Me,".rgb];",Cr,"=",It,"[",Me,".alpha];"),rt(rr),[Ht,Cr]});case Qn:return Ct(function(Le){return H.command(ro(Le)&&Le.length===4,"blend.color must be a 4d array",ye.commandStr),te(4,function(rt){return+Le[rt]})},function(Le,rt,Me){return H.optional(function(){Le.assert(rt,Le.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","blend.color must be a 4d array")}),te(4,function(It){return rt.def("+",Me,"[",It,"]")})});case gu:return Ct(function(Le){return H.commandType(Le,"number",dt,ye.commandStr),Le|0},function(Le,rt,Me){return H.optional(function(){Le.assert(rt,"typeof "+Me+'==="number"',"invalid stencil.mask")}),rt.def(Me,"|0")});case wl:return Ct(function(Le){H.commandType(Le,"object",dt,ye.commandStr);var rt=Le.cmp||"keep",Me=Le.ref||0,It="mask"in Le?Le.mask:-1;return H.commandParameter(rt,Qa,yt+".cmp",ye.commandStr),H.commandType(Me,"number",yt+".ref",ye.commandStr),H.commandType(It,"number",yt+".mask",ye.commandStr),[Qa[rt],Me,It]},function(Le,rt,Me){var It=Le.constants.compareFuncs;H.optional(function(){function Er(){Le.assert(rt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Er(Me+"&&typeof ",Me,'==="object"'),Er('!("cmp" in ',Me,")||(",Me,".cmp in ",It,")")});var Ht=rt.def('"cmp" in ',Me,"?",It,"[",Me,".cmp]",":",Pi),Cr=rt.def(Me,".ref|0"),rr=rt.def('"mask" in ',Me,"?",Me,".mask|0:-1");return[Ht,Cr,rr]});case nu:case ao:return Ct(function(Le){H.commandType(Le,"object",dt,ye.commandStr);var rt=Le.fail||"keep",Me=Le.zfail||"keep",It=Le.zpass||"keep";return H.commandParameter(rt,qa,yt+".fail",ye.commandStr),H.commandParameter(Me,qa,yt+".zfail",ye.commandStr),H.commandParameter(It,qa,yt+".zpass",ye.commandStr),[yt===ao?Mn:Br,qa[rt],qa[Me],qa[It]]},function(Le,rt,Me){var It=Le.constants.stencilOps;H.optional(function(){Le.assert(rt,Me+"&&typeof "+Me+'==="object"',"invalid "+yt)});function Ht(Cr){return H.optional(function(){Le.assert(rt,'!("'+Cr+'" in '+Me+")||("+Me+"."+Cr+" in "+It+")","invalid "+yt+"."+Cr+", must be one of "+Object.keys(qa))}),rt.def('"',Cr,'" in ',Me,"?",It,"[",Me,".",Cr,"]:",Pi)}return[yt===ao?Mn:Br,Ht("fail"),Ht("zfail"),Ht("zpass")]});case Sl:return Ct(function(Le){H.commandType(Le,"object",dt,ye.commandStr);var rt=Le.factor|0,Me=Le.units|0;return H.commandType(rt,"number",dt+".factor",ye.commandStr),H.commandType(Me,"number",dt+".units",ye.commandStr),[rt,Me]},function(Le,rt,Me){H.optional(function(){Le.assert(rt,Me+"&&typeof "+Me+'==="object"',"invalid "+yt)});var It=rt.def(Me,".factor|0"),Ht=rt.def(Me,".units|0");return[It,Ht]});case Iu:return Ct(function(Le){var rt=0;return Le==="front"?rt=Br:Le==="back"&&(rt=Mn),H.command(!!rt,dt,ye.commandStr),rt},function(Le,rt,Me){return H.optional(function(){Le.assert(rt,Me+'==="front"||'+Me+'==="back"',"invalid cull.face")}),rt.def(Me,'==="front"?',Br,":",Mn)});case Gs:return Ct(function(Le){return H.command(typeof Le=="number"&&Le>=nr.lineWidthDims[0]&&Le<=nr.lineWidthDims[1],"invalid line width, must be a positive number between "+nr.lineWidthDims[0]+" and "+nr.lineWidthDims[1],ye.commandStr),Le},function(Le,rt,Me){return H.optional(function(){Le.assert(rt,"typeof "+Me+'==="number"&&'+Me+">="+nr.lineWidthDims[0]+"&&"+Me+"<="+nr.lineWidthDims[1],"invalid line width")}),Me});case os:return Ct(function(Le){return H.commandParameter(Le,ss,dt,ye.commandStr),ss[Le]},function(Le,rt,Me){return H.optional(function(){Le.assert(rt,Me+'==="cw"||'+Me+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),rt.def(Me+'==="cw"?'+Bn+":"+ci)});case gs:return Ct(function(Le){return H.command(ro(Le)&&Le.length===4,"color.mask must be length 4 array",ye.commandStr),Le.map(function(rt){return!!rt})},function(Le,rt,Me){return H.optional(function(){Le.assert(rt,Le.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","invalid color.mask")}),te(4,function(It){return"!!"+Me+"["+It+"]"})});case Vu:return Ct(function(Le){H.command(typeof Le=="object"&&Le,dt,ye.commandStr);var rt="value"in Le?Le.value:1,Me=!!Le.invert;return H.command(typeof rt=="number"&&rt>=0&&rt<=1,"sample.coverage.value must be a number between 0 and 1",ye.commandStr),[rt,Me]},function(Le,rt,Me){H.optional(function(){Le.assert(rt,Me+"&&typeof "+Me+'==="object"',"invalid sample.coverage")});var It=rt.def('"value" in ',Me,"?+",Me,".value:1"),Ht=rt.def("!!",Me,".invert");return[It,Ht]})}}),Vt}function Ps(Re,ye){var ut=Re.static,Lt=Re.dynamic,Vt={};return Object.keys(ut).forEach(function(yt){var dt=ut[yt],Ct;if(typeof dt=="number"||typeof dt=="boolean")Ct=us(function(){return dt});else if(typeof dt=="function"){var Le=dt._reglType;Le==="texture2d"||Le==="textureCube"?Ct=us(function(rt){return rt.link(dt)}):Le==="framebuffer"||Le==="framebufferCube"?(H.command(dt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+yt+'"',ye.commandStr),Ct=us(function(rt){return rt.link(dt.color[0])})):H.commandRaise('invalid data for uniform "'+yt+'"',ye.commandStr)}else ro(dt)?Ct=us(function(rt){var Me=rt.global.def("[",te(dt.length,function(It){return H.command(typeof dt[It]=="number"||typeof dt[It]=="boolean","invalid uniform "+yt,rt.commandStr),dt[It]}),"]");return Me}):H.commandRaise('invalid or missing data for uniform "'+yt+'"',ye.commandStr);Ct.value=dt,Vt[yt]=Ct}),Object.keys(Lt).forEach(function(yt){var dt=Lt[yt];Vt[yt]=su(dt,function(Ct,Le){return Ct.invoke(Le,dt)})}),Vt}function ea(Re,ye){var ut=Re.static,Lt=Re.dynamic,Vt={};return Object.keys(ut).forEach(function(yt){var dt=ut[yt],Ct=Te.id(yt),Le=new Zt;if(Tc(dt))Le.state=jn,Le.buffer=Ar.getBuffer(Ar.create(dt,ic,!1,!0)),Le.type=0;else{var rt=Ar.getBuffer(dt);if(rt)Le.state=jn,Le.buffer=rt,Le.type=0;else if(H.command(typeof dt=="object"&&dt,"invalid data for attribute "+yt,ye.commandStr),"constant"in dt){var Me=dt.constant;Le.buffer="null",Le.state=Xn,typeof Me=="number"?Le.x=Me:(H.command(ro(Me)&&Me.length>0&&Me.length<=4,"invalid constant for attribute "+yt,ye.commandStr),Qr.forEach(function(Fn,bi){bi<Me.length&&(Le[Fn]=Me[bi])}))}else{Tc(dt.buffer)?rt=Ar.getBuffer(Ar.create(dt.buffer,ic,!1,!0)):rt=Ar.getBuffer(dt.buffer),H.command(!!rt,'missing buffer for attribute "'+yt+'"',ye.commandStr);var It=dt.offset|0;H.command(It>=0,'invalid offset for attribute "'+yt+'"',ye.commandStr);var Ht=dt.stride|0;H.command(Ht>=0&&Ht<256,'invalid stride for attribute "'+yt+'", must be integer betweeen [0, 255]',ye.commandStr);var Cr=dt.size|0;H.command(!("size"in dt)||Cr>0&&Cr<=4,'invalid size for attribute "'+yt+'", must be 1,2,3,4',ye.commandStr);var rr=!!dt.normalized,Er=0;"type"in dt&&(H.commandParameter(dt.type,co,"invalid type for attribute "+yt,ye.commandStr),Er=co[dt.type]);var Xr=dt.divisor|0;"divisor"in dt&&(H.command(Xr===0||Gr,'cannot specify divisor for attribute "'+yt+'", instancing not supported',ye.commandStr),H.command(Xr>=0,'invalid divisor for attribute "'+yt+'"',ye.commandStr)),H.optional(function(){var Fn=ye.commandStr,bi=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(dt).forEach(function(zn){H.command(bi.indexOf(zn)>=0,'unknown parameter "'+zn+'" for attribute pointer "'+yt+'" (valid parameters are '+bi+")",Fn)})}),Le.buffer=rt,Le.state=jn,Le.size=Cr,Le.normalized=rr,Le.type=Er||rt.dtype,Le.offset=It,Le.stride=Ht,Le.divisor=Xr}}Vt[yt]=us(function(Fn,bi){var zn=Fn.attribCache;if(Ct in zn)return zn[Ct];var si={isStream:!1};return Object.keys(Le).forEach(function(Ti){si[Ti]=Le[Ti]}),Le.buffer&&(si.buffer=Fn.link(Le.buffer),si.type=si.type||si.buffer+".dtype"),zn[Ct]=si,si})}),Object.keys(Lt).forEach(function(yt){var dt=Lt[yt];function Ct(Le,rt){var Me=Le.invoke(rt,dt),It=Le.shared,Ht=Le.constants,Cr=It.isBufferArgs,rr=It.buffer;H.optional(function(){Le.assert(rt,Me+"&&(typeof "+Me+'==="object"||typeof '+Me+'==="function")&&('+Cr+"("+Me+")||"+rr+".getBuffer("+Me+")||"+rr+".getBuffer("+Me+".buffer)||"+Cr+"("+Me+'.buffer)||("constant" in '+Me+"&&(typeof "+Me+'.constant==="number"||'+It.isArrayLike+"("+Me+".constant))))",'invalid dynamic attribute "'+yt+'"')});var Er={isStream:rt.def(!1)},Xr=new Zt;Xr.state=jn,Object.keys(Xr).forEach(function(si){Er[si]=rt.def(""+Xr[si])});var Fn=Er.buffer,bi=Er.type;rt("if(",Cr,"(",Me,")){",Er.isStream,"=true;",Fn,"=",rr,".createStream(",ic,",",Me,");",bi,"=",Fn,".dtype;","}else{",Fn,"=",rr,".getBuffer(",Me,");","if(",Fn,"){",bi,"=",Fn,".dtype;",'}else if("constant" in ',Me,"){",Er.state,"=",Xn,";","if(typeof "+Me+'.constant === "number"){',Er[Qr[0]],"=",Me,".constant;",Qr.slice(1).map(function(si){return Er[si]}).join("="),"=0;","}else{",Qr.map(function(si,Ti){return Er[si]+"="+Me+".constant.length>"+Ti+"?"+Me+".constant["+Ti+"]:0;"}).join(""),"}}else{","if(",Cr,"(",Me,".buffer)){",Fn,"=",rr,".createStream(",ic,",",Me,".buffer);","}else{",Fn,"=",rr,".getBuffer(",Me,".buffer);","}",bi,'="type" in ',Me,"?",Ht.glTypes,"[",Me,".type]:",Fn,".dtype;",Er.normalized,"=!!",Me,".normalized;");function zn(si){rt(Er[si],"=",Me,".",si,"|0;")}return zn("size"),zn("offset"),zn("stride"),zn("divisor"),rt("}}"),rt.exit("if(",Er.isStream,"){",rr,".destroyStream(",Fn,");","}"),Er}Vt[yt]=su(dt,Ct)}),Vt}function To(Re,ye){var ut=Re.static,Lt=Re.dynamic;if(au in ut){var Vt=ut[au];return Vt!==null&&qr.getVAO(Vt)===null&&(Vt=qr.createVAO(Vt)),us(function(dt){return dt.link(qr.getVAO(Vt))})}else if(au in Lt){var yt=Lt[au];return su(yt,function(dt,Ct){var Le=dt.invoke(Ct,yt);return Ct.def(dt.shared.vao+".getVAO("+Le+")")})}return null}function Va(Re){var ye=Re.static,ut=Re.dynamic,Lt={};return Object.keys(ye).forEach(function(Vt){var yt=ye[Vt];Lt[Vt]=us(function(dt,Ct){return typeof yt=="number"||typeof yt=="boolean"?""+yt:dt.link(yt)})}),Object.keys(ut).forEach(function(Vt){var yt=ut[Vt];Lt[Vt]=su(yt,function(dt,Ct){return dt.invoke(Ct,yt)})}),Lt}function Ho(Re,ye,ut,Lt,Vt){var yt=Re.static,dt=Re.dynamic;H.optional(function(){var zn=[Uo,xo,Lu,iu,_u,Ru,Gu,Ws,$i,au].concat(Nr);function si(Ti){Object.keys(Ti).forEach(function(ua){H.command(zn.indexOf(ua)>=0,'unknown parameter "'+ua+'"',Vt.commandStr)})}si(yt),si(dt)});var Ct=wi(Re,ye),Le=Ln(Re,Vt),rt=Vi(Re,Le,Vt),Me=sa(Re,Vt),It=Go(Re,Vt),Ht=Fi(Re,Vt,Ct);function Cr(zn){var si=rt[zn];si&&(It[zn]=si)}Cr(As),Cr(an(yu));var rr=Object.keys(It).length>0,Er={framebuffer:Le,draw:Me,shader:Ht,state:It,dirty:rr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Er.profile=ti(Re,Vt),Er.uniforms=Ps(ut,Vt),Er.drawVAO=Er.scopeVAO=To(Re,Vt),!Er.drawVAO&&Ht.program&&!Ct&&ze.angle_instanced_arrays){var Xr=!0,Fn=Ht.program.attributes.map(function(zn){var si=ye.static[zn];return Xr=Xr&&!!si,si});if(Xr&&Fn.length>0){var bi=qr.getVAO(qr.createVAO(Fn));Er.drawVAO=new Cs(null,null,null,function(zn,si){return zn.link(bi)}),Er.useVAO=!0}}return Ct?Er.useVAO=!0:Er.attributes=ea(ye,Vt),Er.context=Va(Lt,Vt),Er}function Qo(Re,ye,ut){var Lt=Re.shared,Vt=Lt.context,yt=Re.scope();Object.keys(ut).forEach(function(dt){ye.save(Vt,"."+dt);var Ct=ut[dt],Le=Ct.append(Re,ye);Array.isArray(Le)?yt(Vt,".",dt,"=[",Le.join(),"];"):yt(Vt,".",dt,"=",Le,";")}),ye(yt)}function _s(Re,ye,ut,Lt){var Vt=Re.shared,yt=Vt.gl,dt=Vt.framebuffer,Ct;mn&&(Ct=ye.def(Vt.extensions,".webgl_draw_buffers"));var Le=Re.constants,rt=Le.drawBuffer,Me=Le.backBuffer,It;ut?It=ut.append(Re,ye):It=ye.def(dt,".next"),Lt||ye("if(",It,"!==",dt,".cur){"),ye("if(",It,"){",yt,".bindFramebuffer(",bo,",",It,".framebuffer);"),mn&&ye(Ct,".drawBuffersWEBGL(",rt,"[",It,".colorAttachments.length]);"),ye("}else{",yt,".bindFramebuffer(",bo,",null);"),mn&&ye(Ct,".drawBuffersWEBGL(",Me,");"),ye("}",dt,".cur=",It,";"),Lt||ye("}")}function Ms(Re,ye,ut){var Lt=Re.shared,Vt=Lt.gl,yt=Re.current,dt=Re.next,Ct=Lt.current,Le=Lt.next,rt=Re.cond(Ct,".dirty");Nr.forEach(function(Me){var It=an(Me);if(!(It in ut.state)){var Ht,Cr;if(It in dt){Ht=dt[It],Cr=yt[It];var rr=te(Dr[It].length,function(Xr){return rt.def(Ht,"[",Xr,"]")});rt(Re.cond(rr.map(function(Xr,Fn){return Xr+"!=="+Cr+"["+Fn+"]"}).join("||")).then(Vt,".",kr[It],"(",rr,");",rr.map(function(Xr,Fn){return Cr+"["+Fn+"]="+Xr}).join(";"),";"))}else{Ht=rt.def(Le,".",It);var Er=Re.cond(Ht,"!==",Ct,".",It);rt(Er),It in un?Er(Re.cond(Ht).then(Vt,".enable(",un[It],");").else(Vt,".disable(",un[It],");"),Ct,".",It,"=",Ht,";"):Er(Vt,".",kr[It],"(",Ht,");",Ct,".",It,"=",Ht,";")}}}),Object.keys(ut.state).length===0&&rt(Ct,".dirty=false;"),ye(rt)}function Ns(Re,ye,ut,Lt){var Vt=Re.shared,yt=Re.current,dt=Vt.current,Ct=Vt.gl;oc(Object.keys(ut)).forEach(function(Le){var rt=ut[Le];if(!(Lt&&!Lt(rt))){var Me=rt.append(Re,ye);if(un[Le]){var It=un[Le];Xs(rt)?Me?ye(Ct,".enable(",It,");"):ye(Ct,".disable(",It,");"):ye(Re.cond(Me).then(Ct,".enable(",It,");").else(Ct,".disable(",It,");")),ye(dt,".",Le,"=",Me,";")}else if(ro(Me)){var Ht=yt[Le];ye(Ct,".",kr[Le],"(",Me,");",Me.map(function(Cr,rr){return Ht+"["+rr+"]="+Cr}).join(";"),";")}else ye(Ct,".",kr[Le],"(",Me,");",dt,".",Le,"=",Me,";")}})}function Wo(Re,ye){Gr&&(Re.instancing=ye.def(Re.shared.extensions,".angle_instanced_arrays"))}function Oi(Re,ye,ut,Lt,Vt){var yt=Re.shared,dt=Re.stats,Ct=yt.current,Le=yt.timer,rt=ut.profile;function Me(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var It,Ht;function Cr(zn){It=ye.def(),zn(It,"=",Me(),";"),typeof Vt=="string"?zn(dt,".count+=",Vt,";"):zn(dt,".count++;"),Vr&&(Lt?(Ht=ye.def(),zn(Ht,"=",Le,".getNumPendingQueries();")):zn(Le,".beginQuery(",dt,");"))}function rr(zn){zn(dt,".cpuTime+=",Me(),"-",It,";"),Vr&&(Lt?zn(Le,".pushScopeStats(",Ht,",",Le,".getNumPendingQueries(),",dt,");"):zn(Le,".endQuery();"))}function Er(zn){var si=ye.def(Ct,".profile");ye(Ct,".profile=",zn,";"),ye.exit(Ct,".profile=",si,";")}var Xr;if(rt){if(Xs(rt)){rt.enable?(Cr(ye),rr(ye.exit),Er("true")):Er("false");return}Xr=rt.append(Re,ye),Er(Xr)}else Xr=ye.def(Ct,".profile");var Fn=Re.block();Cr(Fn),ye("if(",Xr,"){",Fn,"}");var bi=Re.block();rr(bi),ye.exit("if(",Xr,"){",bi,"}")}function Is(Re,ye,ut,Lt,Vt){var yt=Re.shared;function dt(Le){switch(Le){case Tf:case Wc:case B:return 2;case oo:case ac:case M:return 3;case uf:case wc:case O:return 4;default:return 1}}function Ct(Le,rt,Me){var It=yt.gl,Ht=ye.def(Le,".location"),Cr=ye.def(yt.attributes,"[",Ht,"]"),rr=Me.state,Er=Me.buffer,Xr=[Me.x,Me.y,Me.z,Me.w],Fn=["buffer","normalized","offset","stride"];function bi(){ye("if(!",Cr,".buffer){",It,".enableVertexAttribArray(",Ht,");}");var si=Me.type,Ti;if(Me.size?Ti=ye.def(Me.size,"||",rt):Ti=rt,ye("if(",Cr,".type!==",si,"||",Cr,".size!==",Ti,"||",Fn.map(function(eo){return Cr+"."+eo+"!=="+Me[eo]}).join("||"),"){",It,".bindBuffer(",ic,",",Er,".buffer);",It,".vertexAttribPointer(",[Ht,Ti,si,Me.normalized,Me.stride,Me.offset],");",Cr,".type=",si,";",Cr,".size=",Ti,";",Fn.map(function(eo){return Cr+"."+eo+"="+Me[eo]+";"}).join(""),"}"),Gr){var ua=Me.divisor;ye("if(",Cr,".divisor!==",ua,"){",Re.instancing,".vertexAttribDivisorANGLE(",[Ht,ua],");",Cr,".divisor=",ua,";}")}}function zn(){ye("if(",Cr,".buffer){",It,".disableVertexAttribArray(",Ht,");",Cr,".buffer=null;","}if(",Qr.map(function(si,Ti){return Cr+"."+si+"!=="+Xr[Ti]}).join("||"),"){",It,".vertexAttrib4f(",Ht,",",Xr,");",Qr.map(function(si,Ti){return Cr+"."+si+"="+Xr[Ti]+";"}).join(""),"}")}rr===jn?bi():rr===Xn?zn():(ye("if(",rr,"===",jn,"){"),bi(),ye("}else{"),zn(),ye("}"))}Lt.forEach(function(Le){var rt=Le.name,Me=ut.attributes[rt],It;if(Me){if(!Vt(Me))return;It=Me.append(Re,ye)}else{if(!Vt(hp))return;var Ht=Re.scopeAttrib(rt);H.optional(function(){Re.assert(ye,Ht+".state","missing attribute "+rt)}),It={},Object.keys(new Zt).forEach(function(Cr){It[Cr]=ye.def(Ht,".",Cr)})}Ct(Re.link(Le),dt(Le.info.type),It)})}function ma(Re,ye,ut,Lt,Vt){for(var yt=Re.shared,dt=yt.gl,Ct,Le=0;Le<Lt.length;++Le){var rt=Lt[Le],Me=rt.name,It=rt.info.type,Ht=ut.uniforms[Me],Cr=Re.link(rt),rr=Cr+".location",Er;if(Ht){if(!Vt(Ht))continue;if(Xs(Ht)){var Xr=Ht.value;if(H.command(Xr!==null&&typeof Xr!="undefined",'missing uniform "'+Me+'"',Re.commandStr),It===Et||It===St){H.command(typeof Xr=="function"&&(It===Et&&(Xr._reglType==="texture2d"||Xr._reglType==="framebuffer")||It===St&&(Xr._reglType==="textureCube"||Xr._reglType==="framebufferCube")),"invalid texture for uniform "+Me,Re.commandStr);var Fn=Re.link(Xr._texture||Xr.color[0]._texture);ye(dt,".uniform1i(",rr,",",Fn+".bind());"),ye.exit(Fn,".unbind();")}else if(It===J||It===me||It===qe){H.optional(function(){H.command(ro(Xr),"invalid matrix for uniform "+Me,Re.commandStr),H.command(It===J&&Xr.length===4||It===me&&Xr.length===9||It===qe&&Xr.length===16,"invalid length for matrix uniform "+Me,Re.commandStr)});var bi=Re.global.def("new Float32Array(["+Array.prototype.slice.call(Xr)+"])"),zn=2;It===me?zn=3:It===qe&&(zn=4),ye(dt,".uniformMatrix",zn,"fv(",rr,",false,",bi,");")}else{switch(It){case jo:H.commandType(Xr,"number","uniform "+Me,Re.commandStr),Ct="1f";break;case Tf:H.command(ro(Xr)&&Xr.length===2,"uniform "+Me,Re.commandStr),Ct="2f";break;case oo:H.command(ro(Xr)&&Xr.length===3,"uniform "+Me,Re.commandStr),Ct="3f";break;case uf:H.command(ro(Xr)&&Xr.length===4,"uniform "+Me,Re.commandStr),Ct="4f";break;case z:H.commandType(Xr,"boolean","uniform "+Me,Re.commandStr),Ct="1i";break;case lf:H.commandType(Xr,"number","uniform "+Me,Re.commandStr),Ct="1i";break;case B:H.command(ro(Xr)&&Xr.length===2,"uniform "+Me,Re.commandStr),Ct="2i";break;case Wc:H.command(ro(Xr)&&Xr.length===2,"uniform "+Me,Re.commandStr),Ct="2i";break;case M:H.command(ro(Xr)&&Xr.length===3,"uniform "+Me,Re.commandStr),Ct="3i";break;case ac:H.command(ro(Xr)&&Xr.length===3,"uniform "+Me,Re.commandStr),Ct="3i";break;case O:H.command(ro(Xr)&&Xr.length===4,"uniform "+Me,Re.commandStr),Ct="4i";break;case wc:H.command(ro(Xr)&&Xr.length===4,"uniform "+Me,Re.commandStr),Ct="4i";break}ye(dt,".uniform",Ct,"(",rr,",",ro(Xr)?Array.prototype.slice.call(Xr):Xr,");")}continue}else Er=Ht.append(Re,ye)}else{if(!Vt(hp))continue;Er=ye.def(yt.uniforms,"[",Te.id(Me),"]")}It===Et?(H(!Array.isArray(Er),"must specify a scalar prop for textures"),ye("if(",Er,"&&",Er,'._reglType==="framebuffer"){',Er,"=",Er,".color[0];","}")):It===St&&(H(!Array.isArray(Er),"must specify a scalar prop for cube maps"),ye("if(",Er,"&&",Er,'._reglType==="framebufferCube"){',Er,"=",Er,".color[0];","}")),H.optional(function(){function ls(ol,Cf){Re.assert(ye,ol,'bad data or missing for uniform "'+Me+'".  '+Cf)}function xh(ol){H(!Array.isArray(Er),"must not specify an array type for uniform"),ls("typeof "+Er+'==="'+ol+'"',"invalid type, expected "+ol)}function Hu(ol,Cf){Array.isArray(Er)?H(Er.length===ol,"must have length "+ol):ls(yt.isArrayLike+"("+Er+")&&"+Er+".length==="+ol,"invalid vector, should have length "+ol,Re.commandStr)}function Af(ol){H(!Array.isArray(Er),"must not specify a value type"),ls("typeof "+Er+'==="function"&&'+Er+'._reglType==="texture'+(ol===jl?"2d":"Cube")+'"',"invalid texture type",Re.commandStr)}switch(It){case lf:xh("number");break;case Wc:Hu(2,"number");break;case ac:Hu(3,"number");break;case wc:Hu(4,"number");break;case jo:xh("number");break;case Tf:Hu(2,"number");break;case oo:Hu(3,"number");break;case uf:Hu(4,"number");break;case z:xh("boolean");break;case B:Hu(2,"boolean");break;case M:Hu(3,"boolean");break;case O:Hu(4,"boolean");break;case J:Hu(4,"number");break;case me:Hu(9,"number");break;case qe:Hu(16,"number");break;case Et:Af(jl);break;case St:Af(Hc);break}});var si=1;switch(It){case Et:case St:var Ti=ye.def(Er,"._texture");ye(dt,".uniform1i(",rr,",",Ti,".bind());"),ye.exit(Ti,".unbind();");continue;case lf:case z:Ct="1i";break;case Wc:case B:Ct="2i",si=2;break;case ac:case M:Ct="3i",si=3;break;case wc:case O:Ct="4i",si=4;break;case jo:Ct="1f";break;case Tf:Ct="2f",si=2;break;case oo:Ct="3f",si=3;break;case uf:Ct="4f",si=4;break;case J:Ct="Matrix2fv";break;case me:Ct="Matrix3fv";break;case qe:Ct="Matrix4fv";break}if(ye(dt,".uniform",Ct,"(",rr,","),Ct.charAt(0)==="M"){var ua=Math.pow(It-J+2,2),eo=Re.global.def("new Float32Array(",ua,")");Array.isArray(Er)?ye("false,(",te(ua,function(ls){return eo+"["+ls+"]="+Er[ls]}),",",eo,")"):ye("false,(Array.isArray(",Er,")||",Er," instanceof Float32Array)?",Er,":(",te(ua,function(ls){return eo+"["+ls+"]="+Er+"["+ls+"]"}),",",eo,")")}else si>1?ye(te(si,function(ls){return Array.isArray(Er)?Er[ls]:Er+"["+ls+"]"})):(H(!Array.isArray(Er),"uniform value must not be an array"),ye(Er));ye(");")}}function ni(Re,ye,ut,Lt){var Vt=Re.shared,yt=Vt.gl,dt=Vt.draw,Ct=Lt.draw;function Le(){var Ti=Ct.elements,ua,eo=ye;return Ti?((Ti.contextDep&&Lt.contextDynamic||Ti.propDep)&&(eo=ut),ua=Ti.append(Re,eo)):ua=eo.def(dt,".",iu),ua&&eo("if("+ua+")"+yt+".bindBuffer("+Ff+","+ua+".buffer.buffer);"),ua}function rt(){var Ti=Ct.count,ua,eo=ye;return Ti?((Ti.contextDep&&Lt.contextDynamic||Ti.propDep)&&(eo=ut),ua=Ti.append(Re,eo),H.optional(function(){Ti.MISSING&&Re.assert(ye,"false","missing vertex count"),Ti.DYNAMIC&&Re.assert(eo,ua+">=0","missing vertex count")})):(ua=eo.def(dt,".",Gu),H.optional(function(){Re.assert(eo,ua+">=0","missing vertex count")})),ua}var Me=Le();function It(Ti){var ua=Ct[Ti];return ua?ua.contextDep&&Lt.contextDynamic||ua.propDep?ua.append(Re,ut):ua.append(Re,ye):ye.def(dt,".",Ti)}var Ht=It(_u),Cr=It(Ru),rr=rt();if(typeof rr=="number"){if(rr===0)return}else ut("if(",rr,"){"),ut.exit("}");var Er,Xr;Gr&&(Er=It(Ws),Xr=Re.instancing);var Fn=Me+".type",bi=Ct.elements&&Xs(Ct.elements);function zn(){function Ti(){ut(Xr,".drawElementsInstancedANGLE(",[Ht,rr,Fn,Cr+"<<(("+Fn+"-"+yn+")>>1)",Er],");")}function ua(){ut(Xr,".drawArraysInstancedANGLE(",[Ht,Cr,rr,Er],");")}Me?bi?Ti():(ut("if(",Me,"){"),Ti(),ut("}else{"),ua(),ut("}")):ua()}function si(){function Ti(){ut(yt+".drawElements("+[Ht,rr,Fn,Cr+"<<(("+Fn+"-"+yn+")>>1)"]+");")}function ua(){ut(yt+".drawArrays("+[Ht,Cr,rr]+");")}Me?bi?Ti():(ut("if(",Me,"){"),Ti(),ut("}else{"),ua(),ut("}")):ua()}Gr&&(typeof Er!="number"||Er>=0)?typeof Er=="string"?(ut("if(",Er,">0){"),zn(),ut("}else if(",Er,"<0){"),si(),ut("}")):zn():si()}function Gi(Re,ye,ut,Lt,Vt){var yt=oi(),dt=yt.proc("body",Vt);return H.optional(function(){yt.commandStr=ye.commandStr,yt.command=yt.link(ye.commandStr)}),Gr&&(yt.instancing=dt.def(yt.shared.extensions,".angle_instanced_arrays")),Re(yt,dt,ut,Lt),yt.compile().body}function ia(Re,ye,ut,Lt){Wo(Re,ye),ut.useVAO?ut.drawVAO?ye(Re.shared.vao,".setVAO(",ut.drawVAO.append(Re,ye),");"):ye(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(ye(Re.shared.vao,".setVAO(null);"),Is(Re,ye,ut,Lt.attributes,function(){return!0})),ma(Re,ye,ut,Lt.uniforms,function(){return!0}),ni(Re,ye,ye,ut)}function qo(Re,ye){var ut=Re.proc("draw",1);Wo(Re,ut),Qo(Re,ut,ye.context),_s(Re,ut,ye.framebuffer),Ms(Re,ut,ye),Ns(Re,ut,ye.state),Oi(Re,ut,ye,!1,!0);var Lt=ye.shader.progVar.append(Re,ut);if(ut(Re.shared.gl,".useProgram(",Lt,".program);"),ye.shader.program)ia(Re,ut,ye,ye.shader.program);else{ut(Re.shared.vao,".setVAO(null);");var Vt=Re.global.def("{}"),yt=ut.def(Lt,".id"),dt=ut.def(Vt,"[",yt,"]");ut(Re.cond(dt).then(dt,".call(this,a0);").else(dt,"=",Vt,"[",yt,"]=",Re.link(function(Ct){return Gi(ia,Re,ye,Ct,1)}),"(",Lt,");",dt,".call(this,a0);"))}Object.keys(ye.state).length>0&&ut(Re.shared.current,".dirty=true;")}function Su(Re,ye,ut,Lt){Re.batchId="a1",Wo(Re,ye);function Vt(){return!0}Is(Re,ye,ut,Lt.attributes,Vt),ma(Re,ye,ut,Lt.uniforms,Vt),ni(Re,ye,ye,ut)}function sc(Re,ye,ut,Lt){Wo(Re,ye);var Vt=ut.contextDep,yt=ye.def(),dt="a0",Ct="a1",Le=ye.def();Re.shared.props=Le,Re.batchId=yt;var rt=Re.scope(),Me=Re.scope();ye(rt.entry,"for(",yt,"=0;",yt,"<",Ct,";++",yt,"){",Le,"=",dt,"[",yt,"];",Me,"}",rt.exit);function It(Fn){return Fn.contextDep&&Vt||Fn.propDep}function Ht(Fn){return!It(Fn)}if(ut.needsContext&&Qo(Re,Me,ut.context),ut.needsFramebuffer&&_s(Re,Me,ut.framebuffer),Ns(Re,Me,ut.state,It),ut.profile&&It(ut.profile)&&Oi(Re,Me,ut,!1,!0),Lt)ut.useVAO?ut.drawVAO?It(ut.drawVAO)?Me(Re.shared.vao,".setVAO(",ut.drawVAO.append(Re,Me),");"):rt(Re.shared.vao,".setVAO(",ut.drawVAO.append(Re,rt),");"):rt(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(rt(Re.shared.vao,".setVAO(null);"),Is(Re,rt,ut,Lt.attributes,Ht),Is(Re,Me,ut,Lt.attributes,It)),ma(Re,rt,ut,Lt.uniforms,Ht),ma(Re,Me,ut,Lt.uniforms,It),ni(Re,rt,Me,ut);else{var Cr=Re.global.def("{}"),rr=ut.shader.progVar.append(Re,Me),Er=Me.def(rr,".id"),Xr=Me.def(Cr,"[",Er,"]");Me(Re.shared.gl,".useProgram(",rr,".program);","if(!",Xr,"){",Xr,"=",Cr,"[",Er,"]=",Re.link(function(Fn){return Gi(Su,Re,ut,Fn,2)}),"(",rr,");}",Xr,".call(this,a0[",yt,"],",yt,");")}}function Ve(Re,ye){var ut=Re.proc("batch",2);Re.batchId="0",Wo(Re,ut);var Lt=!1,Vt=!0;Object.keys(ye.context).forEach(function(Cr){Lt=Lt||ye.context[Cr].propDep}),Lt||(Qo(Re,ut,ye.context),Vt=!1);var yt=ye.framebuffer,dt=!1;yt?(yt.propDep?Lt=dt=!0:yt.contextDep&&Lt&&(dt=!0),dt||_s(Re,ut,yt)):_s(Re,ut,null),ye.state.viewport&&ye.state.viewport.propDep&&(Lt=!0);function Ct(Cr){return Cr.contextDep&&Lt||Cr.propDep}Ms(Re,ut,ye),Ns(Re,ut,ye.state,function(Cr){return!Ct(Cr)}),(!ye.profile||!Ct(ye.profile))&&Oi(Re,ut,ye,!1,"a1"),ye.contextDep=Lt,ye.needsContext=Vt,ye.needsFramebuffer=dt;var Le=ye.shader.progVar;if(Le.contextDep&&Lt||Le.propDep)sc(Re,ut,ye,null);else{var rt=Le.append(Re,ut);if(ut(Re.shared.gl,".useProgram(",rt,".program);"),ye.shader.program)sc(Re,ut,ye,ye.shader.program);else{ut(Re.shared.vao,".setVAO(null);");var Me=Re.global.def("{}"),It=ut.def(rt,".id"),Ht=ut.def(Me,"[",It,"]");ut(Re.cond(Ht).then(Ht,".call(this,a0,a1);").else(Ht,"=",Me,"[",It,"]=",Re.link(function(Cr){return Gi(sc,Re,ye,Cr,2)}),"(",rt,");",Ht,".call(this,a0,a1);"))}}Object.keys(ye.state).length>0&&ut(Re.shared.current,".dirty=true;")}function ir(Re,ye){var ut=Re.proc("scope",3);Re.batchId="a2";var Lt=Re.shared,Vt=Lt.current;Qo(Re,ut,ye.context),ye.framebuffer&&ye.framebuffer.append(Re,ut),oc(Object.keys(ye.state)).forEach(function(dt){var Ct=ye.state[dt],Le=Ct.append(Re,ut);ro(Le)?Le.forEach(function(rt,Me){ut.set(Re.next[dt],"["+Me+"]",rt)}):ut.set(Lt.next,"."+dt,Le)}),Oi(Re,ut,ye,!0,!0),[iu,Ru,Gu,Ws,_u].forEach(function(dt){var Ct=ye.draw[dt];!Ct||ut.set(Lt.draw,"."+dt,""+Ct.append(Re,ut))}),Object.keys(ye.uniforms).forEach(function(dt){var Ct=ye.uniforms[dt].append(Re,ut);Array.isArray(Ct)&&(Ct="["+Ct.join()+"]"),ut.set(Lt.uniforms,"["+Te.id(dt)+"]",Ct)}),Object.keys(ye.attributes).forEach(function(dt){var Ct=ye.attributes[dt].append(Re,ut),Le=Re.scopeAttrib(dt);Object.keys(new Zt).forEach(function(rt){ut.set(Le,"."+rt,Ct[rt])})}),ye.scopeVAO&&ut.set(Lt.vao,".targetVAO",ye.scopeVAO.append(Re,ut));function yt(dt){var Ct=ye.shader[dt];Ct&&ut.set(Lt.shader,"."+dt,Ct.append(Re,ut))}yt(xo),yt(Lu),Object.keys(ye.state).length>0&&(ut(Vt,".dirty=true;"),ut.exit(Vt,".dirty=true;")),ut("a1(",Re.shared.context,",a0,",Re.batchId,");")}function er(Re){if(!(typeof Re!="object"||ro(Re))){for(var ye=Object.keys(Re),ut=0;ut<ye.length;++ut)if(mt.isDynamic(Re[ye[ut]]))return!0;return!1}}function An(Re,ye,ut){var Lt=ye.static[ut];if(!Lt||!er(Lt))return;var Vt=Re.global,yt=Object.keys(Lt),dt=!1,Ct=!1,Le=!1,rt=Re.global.def("{}");yt.forEach(function(It){var Ht=Lt[It];if(mt.isDynamic(Ht)){typeof Ht=="function"&&(Ht=Lt[It]=mt.unbox(Ht));var Cr=su(Ht,null);dt=dt||Cr.thisDep,Le=Le||Cr.propDep,Ct=Ct||Cr.contextDep}else{switch(Vt(rt,".",It,"="),typeof Ht){case"number":Vt(Ht);break;case"string":Vt('"',Ht,'"');break;case"object":Array.isArray(Ht)&&Vt("[",Ht.join(),"]");break;default:Vt(Re.link(Ht));break}Vt(";")}});function Me(It,Ht){yt.forEach(function(Cr){var rr=Lt[Cr];if(!!mt.isDynamic(rr)){var Er=It.invoke(Ht,rr);Ht(rt,".",Cr,"=",Er,";")}})}ye.dynamic[ut]=new mt.DynamicVariable(_i,{thisDep:dt,contextDep:Ct,propDep:Le,ref:rt,append:Me}),delete ye.static[ut]}function Ui(Re,ye,ut,Lt,Vt){var yt=oi();yt.stats=yt.link(Vt),Object.keys(ye.static).forEach(function(Ct){An(yt,ye,Ct)}),mh.forEach(function(Ct){An(yt,Re,Ct)});var dt=Ho(Re,ye,ut,Lt,yt);return qo(yt,dt),ir(yt,dt),Ve(yt,dt),y(yt.compile(),{destroy:function(){dt.shader.program.destroy()}})}return{next:wn,current:Dr,procs:function(){var Re=oi(),ye=Re.proc("poll"),ut=Re.proc("refresh"),Lt=Re.block();ye(Lt),ut(Lt);var Vt=Re.shared,yt=Vt.gl,dt=Vt.next,Ct=Vt.current;Lt(Ct,".dirty=false;"),_s(Re,ye),_s(Re,ut,null,!0);var Le;Gr&&(Le=Re.link(Gr)),ze.oes_vertex_array_object&&ut(Re.link(ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var rt=0;rt<nr.maxAttributes;++rt){var Me=ut.def(Vt.attributes,"[",rt,"]"),It=Re.cond(Me,".buffer");It.then(yt,".enableVertexAttribArray(",rt,");",yt,".bindBuffer(",ic,",",Me,".buffer.buffer);",yt,".vertexAttribPointer(",rt,",",Me,".size,",Me,".type,",Me,".normalized,",Me,".stride,",Me,".offset);").else(yt,".disableVertexAttribArray(",rt,");",yt,".vertexAttrib4f(",rt,",",Me,".x,",Me,".y,",Me,".z,",Me,".w);",Me,".buffer=null;"),ut(It),Gr&&ut(Le,".vertexAttribDivisorANGLE(",rt,",",Me,".divisor);")}return ut(Re.shared.vao,".currentVAO=null;",Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"),Object.keys(un).forEach(function(Ht){var Cr=un[Ht],rr=Lt.def(dt,".",Ht),Er=Re.block();Er("if(",rr,"){",yt,".enable(",Cr,")}else{",yt,".disable(",Cr,")}",Ct,".",Ht,"=",rr,";"),ut(Er),ye("if(",rr,"!==",Ct,".",Ht,"){",Er,"}")}),Object.keys(kr).forEach(function(Ht){var Cr=kr[Ht],rr=Dr[Ht],Er,Xr,Fn=Re.block();if(Fn(yt,".",Cr,"("),ro(rr)){var bi=rr.length;Er=Re.global.def(dt,".",Ht),Xr=Re.global.def(Ct,".",Ht),Fn(te(bi,function(zn){return Er+"["+zn+"]"}),");",te(bi,function(zn){return Xr+"["+zn+"]="+Er+"["+zn+"];"}).join("")),ye("if(",te(bi,function(zn){return Er+"["+zn+"]!=="+Xr+"["+zn+"]"}).join("||"),"){",Fn,"}")}else Er=Lt.def(dt,".",Ht),Xr=Lt.def(Ct,".",Ht),Fn(Er,");",Ct,".",Ht,"=",Er,";"),ye("if(",Er,"!==",Xr,"){",Fn,"}");ut(Fn)}),Re.compile()}(),compile:Ui}}function Hp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Nh=34918,bu=34919,dp=35007,vp=function(U,Te){if(!Te.ext_disjoint_timer_query)return null;var ze=[];function nr(){return ze.pop()||Te.ext_disjoint_timer_query.createQueryEXT()}function Ar(Gr){ze.push(Gr)}var qt=[];function dr(Gr){var mn=nr();Te.ext_disjoint_timer_query.beginQueryEXT(dp,mn),qt.push(mn),Vr(qt.length-1,qt.length,Gr)}function Zr(){Te.ext_disjoint_timer_query.endQueryEXT(dp)}function Kr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var qr=[];function Wr(){return qr.pop()||new Kr}function on(Gr){qr.push(Gr)}var hn=[];function Vr(Gr,mn,Dr){var wn=Wr();wn.startQueryIndex=Gr,wn.endQueryIndex=mn,wn.sum=0,wn.stats=Dr,hn.push(wn)}var sn=[],Zt=[];function cr(){var Gr,mn,Dr=qt.length;if(Dr!==0){Zt.length=Math.max(Zt.length,Dr+1),sn.length=Math.max(sn.length,Dr+1),sn[0]=0,Zt[0]=0;var wn=0;for(Gr=0,mn=0;mn<qt.length;++mn){var Nr=qt[mn];Te.ext_disjoint_timer_query.getQueryObjectEXT(Nr,bu)?(wn+=Te.ext_disjoint_timer_query.getQueryObjectEXT(Nr,Nh),Ar(Nr)):qt[Gr++]=Nr,sn[mn+1]=wn,Zt[mn+1]=Gr}for(qt.length=Gr,Gr=0,mn=0;mn<hn.length;++mn){var un=hn[mn],kr=un.startQueryIndex,an=un.endQueryIndex;un.sum+=sn[an]-sn[kr];var Kn=Zt[kr],Wn=Zt[an];Wn===Kn?(un.stats.gpuTime+=un.sum/1e6,on(un)):(un.startQueryIndex=Kn,un.endQueryIndex=Wn,hn[Gr++]=un)}hn.length=Gr}}return{beginQuery:dr,endQuery:Zr,pushScopeStats:Vr,update:cr,getNumPendingQueries:function(){return qt.length},clear:function(){ze.push.apply(ze,qt);for(var Gr=0;Gr<ze.length;Gr++)Te.ext_disjoint_timer_query.deleteQueryEXT(ze[Gr]);qt.length=0,ze.length=0},restore:function(){qt.length=0,ze.length=0}}},gh=16384,Bh=256,Uh=1024,jh=34962,Zh="webglcontextlost",Vh="webglcontextrestored",yh=1,mp=2,gp=3;function cf(U,Te){for(var ze=0;ze<U.length;++ze)if(U[ze]===Te)return ze;return-1}function _h(U){var Te=hi(U);if(!Te)return null;var ze=Te.gl,nr=ze.getContextAttributes(),Ar=ze.isContextLost(),qt=V(ze,Te);if(!qt)return null;var dr=xr(),Zr=Hp(),Kr=qt.extensions,qr=vp(ze,Kr),Wr=ar(),on=ze.drawingBufferWidth,hn=ze.drawingBufferHeight,Vr={tick:0,time:0,viewportWidth:on,viewportHeight:hn,framebufferWidth:on,framebufferHeight:hn,drawingBufferWidth:on,drawingBufferHeight:hn,pixelRatio:Te.pixelRatio},sn={},Zt={elements:null,primitive:4,count:-1,offset:0,instances:-1},cr=to(ze,Kr),Gr=Hi(ze,Zr,Te,Dr),mn=_e(ze,Kr,cr,Zr,Gr);function Dr(ni){return mn.destroyBuffer(ni)}var wn=bf(ze,Kr,Gr,Zr),Nr=Fe(ze,dr,Zr,Te),un=Zu(ze,Kr,cr,function(){Kn.procs.poll()},Vr,Zr,Te),kr=vu(ze,Kr,cr,Zr,Te),an=R(ze,Kr,cr,un,kr,Zr),Kn=pp(ze,dr,Kr,cr,Gr,wn,un,an,sn,mn,Nr,Zt,Vr,qr,Te),Wn=or(ze,an,Kn.procs.poll,Vr,nr,Kr,cr),ln=Kn.next,zr=ze.canvas,Lr=[],oi=[],ti=[],Ln=[Te.onDestroy],Vi=null;function wi(){if(Lr.length===0){qr&&qr.update(),Vi=null;return}Vi=Nt.next(wi),Ns();for(var ni=Lr.length-1;ni>=0;--ni){var Gi=Lr[ni];Gi&&Gi(Vr,null,0)}ze.flush(),qr&&qr.update()}function Fi(){!Vi&&Lr.length>0&&(Vi=Nt.next(wi))}function sa(){Vi&&(Nt.cancel(wi),Vi=null)}function Go(ni){ni.preventDefault(),Ar=!0,sa(),oi.forEach(function(Gi){Gi()})}function Ps(ni){ze.getError(),Ar=!1,qt.restore(),Nr.restore(),Gr.restore(),un.restore(),kr.restore(),an.restore(),mn.restore(),qr&&qr.restore(),Kn.procs.refresh(),Fi(),ti.forEach(function(Gi){Gi()})}zr&&(zr.addEventListener(Zh,Go,!1),zr.addEventListener(Vh,Ps,!1));function ea(){Lr.length=0,sa(),zr&&(zr.removeEventListener(Zh,Go),zr.removeEventListener(Vh,Ps)),Nr.clear(),an.clear(),kr.clear(),un.clear(),wn.clear(),Gr.clear(),mn.clear(),qr&&qr.clear(),Ln.forEach(function(ni){ni()})}function To(ni){H(!!ni,"invalid args to regl({...})"),H.type(ni,"object","invalid args to regl({...})");function Gi(Vt){var yt=y({},Vt);delete yt.uniforms,delete yt.attributes,delete yt.context,delete yt.vao,"stencil"in yt&&yt.stencil.op&&(yt.stencil.opBack=yt.stencil.opFront=yt.stencil.op,delete yt.stencil.op);function dt(Ct){if(Ct in yt){var Le=yt[Ct];delete yt[Ct],Object.keys(Le).forEach(function(rt){yt[Ct+"."+rt]=Le[rt]})}}return dt("blend"),dt("depth"),dt("cull"),dt("stencil"),dt("polygonOffset"),dt("scissor"),dt("sample"),"vao"in Vt&&(yt.vao=Vt.vao),yt}function ia(Vt,yt){var dt={},Ct={};return Object.keys(Vt).forEach(function(Le){var rt=Vt[Le];if(mt.isDynamic(rt)){Ct[Le]=mt.unbox(rt,Le);return}else if(yt&&Array.isArray(rt)){for(var Me=0;Me<rt.length;++Me)if(mt.isDynamic(rt[Me])){Ct[Le]=mt.unbox(rt,Le);return}}dt[Le]=rt}),{dynamic:Ct,static:dt}}var qo=ia(ni.context||{},!0),Su=ia(ni.uniforms||{},!0),sc=ia(ni.attributes||{},!1),Ve=ia(Gi(ni),!1),ir={gpuTime:0,cpuTime:0,count:0},er=Kn.compile(Ve,sc,Su,qo,ir),An=er.draw,Ui=er.batch,Re=er.scope,ye=[];function ut(Vt){for(;ye.length<Vt;)ye.push(null);return ye}function Lt(Vt,yt){var dt;if(Ar&&H.raise("context lost"),typeof Vt=="function")return Re.call(this,null,Vt,0);if(typeof yt=="function")if(typeof Vt=="number")for(dt=0;dt<Vt;++dt)Re.call(this,null,yt,dt);else if(Array.isArray(Vt))for(dt=0;dt<Vt.length;++dt)Re.call(this,Vt[dt],yt,dt);else return Re.call(this,Vt,yt,0);else if(typeof Vt=="number"){if(Vt>0)return Ui.call(this,ut(Vt|0),Vt|0)}else if(Array.isArray(Vt)){if(Vt.length)return Ui.call(this,Vt,Vt.length)}else return An.call(this,Vt)}return y(Lt,{stats:ir,destroy:function(){er.destroy()}})}var Va=an.setFBO=To({framebuffer:mt.define.call(null,yh,"framebuffer")});function Ho(ni,Gi){var ia=0;Kn.procs.poll();var qo=Gi.color;qo&&(ze.clearColor(+qo[0]||0,+qo[1]||0,+qo[2]||0,+qo[3]||0),ia|=gh),"depth"in Gi&&(ze.clearDepth(+Gi.depth),ia|=Bh),"stencil"in Gi&&(ze.clearStencil(Gi.stencil|0),ia|=Uh),H(!!ia,"called regl.clear with no buffer specified"),ze.clear(ia)}function Qo(ni){if(H(typeof ni=="object"&&ni,"regl.clear() takes an object as input"),"framebuffer"in ni)if(ni.framebuffer&&ni.framebuffer_reglType==="framebufferCube")for(var Gi=0;Gi<6;++Gi)Va(y({framebuffer:ni.framebuffer.faces[Gi]},ni),Ho);else Va(ni,Ho);else Ho(null,ni)}function _s(ni){H.type(ni,"function","regl.frame() callback must be a function"),Lr.push(ni);function Gi(){var ia=cf(Lr,ni);H(ia>=0,"cannot cancel a frame twice");function qo(){var Su=cf(Lr,qo);Lr[Su]=Lr[Lr.length-1],Lr.length-=1,Lr.length<=0&&sa()}Lr[ia]=qo}return Fi(),{cancel:Gi}}function Ms(){var ni=ln.viewport,Gi=ln.scissor_box;ni[0]=ni[1]=Gi[0]=Gi[1]=0,Vr.viewportWidth=Vr.framebufferWidth=Vr.drawingBufferWidth=ni[2]=Gi[2]=ze.drawingBufferWidth,Vr.viewportHeight=Vr.framebufferHeight=Vr.drawingBufferHeight=ni[3]=Gi[3]=ze.drawingBufferHeight}function Ns(){Vr.tick+=1,Vr.time=Oi(),Ms(),Kn.procs.poll()}function Wo(){un.refresh(),Ms(),Kn.procs.refresh(),qr&&qr.update()}function Oi(){return(ar()-Wr)/1e3}Wo();function Is(ni,Gi){H.type(Gi,"function","listener callback must be a function");var ia;switch(ni){case"frame":return _s(Gi);case"lost":ia=oi;break;case"restore":ia=ti;break;case"destroy":ia=Ln;break;default:H.raise("invalid event, must be one of frame,lost,restore,destroy")}return ia.push(Gi),{cancel:function(){for(var qo=0;qo<ia.length;++qo)if(ia[qo]===Gi){ia[qo]=ia[ia.length-1],ia.pop();return}}}}var ma=y(To,{clear:Qo,prop:mt.define.bind(null,yh),context:mt.define.bind(null,mp),this:mt.define.bind(null,gp),draw:To({}),buffer:function(ni){return Gr.create(ni,jh,!1,!1)},elements:function(ni){return wn.create(ni,!1)},texture:un.create2D,cube:un.createCube,renderbuffer:kr.create,framebuffer:an.create,framebufferCube:an.createCube,vao:mn.createVAO,attributes:nr,frame:_s,on:Is,limits:cr,hasExtension:function(ni){return cr.extensions.indexOf(ni.toLowerCase())>=0},read:Wn,destroy:ea,_gl:ze,_refresh:Wo,poll:function(){Ns(),qr&&qr.update()},now:Oi,stats:Zr});return Te.onDone(null,ma),ma}return _h})},69848:function(ft){(function(C,y){ft.exports=y()})(this,function(){"use strict";function C(Be,Ie,pt,oe,re,ue){if(!(re-oe<=pt)){var it=oe+re>>1;y(Be,Ie,it,oe,re,ue%2),C(Be,Ie,pt,oe,it-1,ue+1),C(Be,Ie,pt,it+1,re,ue+1)}}function y(Be,Ie,pt,oe,re,ue){for(;re>oe;){if(re-oe>600){var it=re-oe+1,Jt=pt-oe+1,ce=Math.log(it),$e=.5*Math.exp(2*ce/3),Ae=.5*Math.sqrt(ce*$e*(it-$e)/it)*(Jt-it/2<0?-1:1),Ce=Math.max(oe,Math.floor(pt-Jt*$e/it+Ae)),Pe=Math.min(re,Math.floor(pt+(it-Jt)*$e/it+Ae));y(Be,Ie,pt,Ce,Pe,ue)}var et=Ie[2*pt+ue],Se=oe,Pt=re;for(G(Be,Ie,oe,pt),Ie[2*re+ue]>et&&G(Be,Ie,oe,re);Se<Pt;){for(G(Be,Ie,Se,Pt),Se++,Pt--;Ie[2*Se+ue]<et;)Se++;for(;Ie[2*Pt+ue]>et;)Pt--}Ie[2*oe+ue]===et?G(Be,Ie,oe,Pt):(Pt++,G(Be,Ie,Pt,re)),Pt<=pt&&(oe=Pt+1),pt<=Pt&&(re=Pt-1)}}function G(Be,Ie,pt,oe){b(Be,pt,oe),b(Ie,2*pt,2*oe),b(Ie,2*pt+1,2*oe+1)}function b(Be,Ie,pt){var oe=Be[Ie];Be[Ie]=Be[pt],Be[pt]=oe}function p(Be,Ie,pt,oe,re,ue,it){for(var Jt=[0,Be.length-1,0],ce=[],$e,Ae;Jt.length;){var Ce=Jt.pop(),Pe=Jt.pop(),et=Jt.pop();if(Pe-et<=it){for(var Se=et;Se<=Pe;Se++)$e=Ie[2*Se],Ae=Ie[2*Se+1],$e>=pt&&$e<=re&&Ae>=oe&&Ae<=ue&&ce.push(Be[Se]);continue}var Pt=Math.floor((et+Pe)/2);$e=Ie[2*Pt],Ae=Ie[2*Pt+1],$e>=pt&&$e<=re&&Ae>=oe&&Ae<=ue&&ce.push(Be[Pt]);var vr=(Ce+1)%2;(Ce===0?pt<=$e:oe<=Ae)&&(Jt.push(et),Jt.push(Pt-1),Jt.push(vr)),(Ce===0?re>=$e:ue>=Ae)&&(Jt.push(Pt+1),Jt.push(Pe),Jt.push(vr))}return ce}function S(Be,Ie,pt,oe,re,ue){for(var it=[0,Be.length-1,0],Jt=[],ce=re*re;it.length;){var $e=it.pop(),Ae=it.pop(),Ce=it.pop();if(Ae-Ce<=ue){for(var Pe=Ce;Pe<=Ae;Pe++)L(Ie[2*Pe],Ie[2*Pe+1],pt,oe)<=ce&&Jt.push(Be[Pe]);continue}var et=Math.floor((Ce+Ae)/2),Se=Ie[2*et],Pt=Ie[2*et+1];L(Se,Pt,pt,oe)<=ce&&Jt.push(Be[et]);var vr=($e+1)%2;($e===0?pt-re<=Se:oe-re<=Pt)&&(it.push(Ce),it.push(et-1),it.push(vr)),($e===0?pt+re>=Se:oe+re>=Pt)&&(it.push(et+1),it.push(Ae),it.push(vr))}return Jt}function L(Be,Ie,pt,oe){var re=Be-pt,ue=Ie-oe;return re*re+ue*ue}var X=function(Be){return Be[0]},N=function(Be){return Be[1]},q=function(Ie,pt,oe,re,ue){pt===void 0&&(pt=X),oe===void 0&&(oe=N),re===void 0&&(re=64),ue===void 0&&(ue=Float64Array),this.nodeSize=re,this.points=Ie;for(var it=Ie.length<65536?Uint16Array:Uint32Array,Jt=this.ids=new it(Ie.length),ce=this.coords=new ue(Ie.length*2),$e=0;$e<Ie.length;$e++)Jt[$e]=$e,ce[2*$e]=pt(Ie[$e]),ce[2*$e+1]=oe(Ie[$e]);C(Jt,ce,re,0,Jt.length-1,0)};q.prototype.range=function(Ie,pt,oe,re){return p(this.ids,this.coords,Ie,pt,oe,re,this.nodeSize)},q.prototype.within=function(Ie,pt,oe){return S(this.ids,this.coords,Ie,pt,oe,this.nodeSize)};var K={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Be){return Be}},ae=Math.fround||function(Be){return function(Ie){return Be[0]=+Ie,Be[0]}}(new Float32Array(1)),xe=function(Ie){this.options=Yt(Object.create(K),Ie),this.trees=new Array(this.options.maxZoom+1)};xe.prototype.load=function(Ie){var pt=this.options,oe=pt.log,re=pt.minZoom,ue=pt.maxZoom,it=pt.nodeSize;oe&&console.time("total time");var Jt="prepare "+Ie.length+" points";oe&&console.time(Jt),this.points=Ie;for(var ce=[],$e=0;$e<Ie.length;$e++)!Ie[$e].geometry||ce.push(Ft(Ie[$e],$e));this.trees[ue+1]=new q(ce,ke,Ne,it,Float32Array),oe&&console.timeEnd(Jt);for(var Ae=ue;Ae>=re;Ae--){var Ce=+Date.now();ce=this._cluster(ce,Ae),this.trees[Ae]=new q(ce,ke,Ne,it,Float32Array),oe&&console.log("z%d: %d clusters in %dms",Ae,ce.length,+Date.now()-Ce)}return oe&&console.timeEnd("total time"),this},xe.prototype.getClusters=function(Ie,pt){var oe=((Ie[0]+180)%360+360)%360-180,re=Math.max(-90,Math.min(90,Ie[1])),ue=Ie[2]===180?180:((Ie[2]+180)%360+360)%360-180,it=Math.max(-90,Math.min(90,Ie[3]));if(Ie[2]-Ie[0]>=360)oe=-180,ue=180;else if(oe>ue){var Jt=this.getClusters([oe,re,180,it],pt),ce=this.getClusters([-180,re,ue,it],pt);return Jt.concat(ce)}for(var $e=this.trees[this._limitZoom(pt)],Ae=$e.range(Mt(oe),wt(it),Mt(ue),wt(re)),Ce=[],Pe=0,et=Ae;Pe<et.length;Pe+=1){var Se=et[Pe],Pt=$e.points[Se];Ce.push(Pt.numPoints?zt(Pt):this.points[Pt.index])}return Ce},xe.prototype.getChildren=function(Ie){var pt=this._getOriginId(Ie),oe=this._getOriginZoom(Ie),re="No cluster with the specified id.",ue=this.trees[oe];if(!ue)throw new Error(re);var it=ue.points[pt];if(!it)throw new Error(re);for(var Jt=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ce=ue.within(it.x,it.y,Jt),$e=[],Ae=0,Ce=ce;Ae<Ce.length;Ae+=1){var Pe=Ce[Ae],et=ue.points[Pe];et.parentId===Ie&&$e.push(et.numPoints?zt(et):this.points[et.index])}if($e.length===0)throw new Error(re);return $e},xe.prototype.getLeaves=function(Ie,pt,oe){pt=pt||10,oe=oe||0;var re=[];return this._appendLeaves(re,Ie,pt,oe,0),re},xe.prototype.getTile=function(Ie,pt,oe){var re=this.trees[this._limitZoom(Ie)],ue=Math.pow(2,Ie),it=this.options,Jt=it.extent,ce=it.radius,$e=ce/Jt,Ae=(oe-$e)/ue,Ce=(oe+1+$e)/ue,Pe={features:[]};return this._addTileFeatures(re.range((pt-$e)/ue,Ae,(pt+1+$e)/ue,Ce),re.points,pt,oe,ue,Pe),pt===0&&this._addTileFeatures(re.range(1-$e/ue,Ae,1,Ce),re.points,ue,oe,ue,Pe),pt===ue-1&&this._addTileFeatures(re.range(0,Ae,$e/ue,Ce),re.points,-1,oe,ue,Pe),Pe.features.length?Pe:null},xe.prototype.getClusterExpansionZoom=function(Ie){for(var pt=this._getOriginZoom(Ie)-1;pt<=this.options.maxZoom;){var oe=this.getChildren(Ie);if(pt++,oe.length!==1)break;Ie=oe[0].properties.cluster_id}return pt},xe.prototype._appendLeaves=function(Ie,pt,oe,re,ue){for(var it=this.getChildren(pt),Jt=0,ce=it;Jt<ce.length;Jt+=1){var $e=ce[Jt],Ae=$e.properties;if(Ae&&Ae.cluster?ue+Ae.point_count<=re?ue+=Ae.point_count:ue=this._appendLeaves(Ie,Ae.cluster_id,oe,re,ue):ue<re?ue++:Ie.push($e),Ie.length===oe)break}return ue},xe.prototype._addTileFeatures=function(Ie,pt,oe,re,ue,it){for(var Jt=0,ce=Ie;Jt<ce.length;Jt+=1){var $e=ce[Jt],Ae=pt[$e],Ce=Ae.numPoints,Pe=void 0,et=void 0,Se=void 0;if(Ce)Pe=Wt(Ae),et=Ae.x,Se=Ae.y;else{var Pt=this.points[Ae.index];Pe=Pt.properties,et=Mt(Pt.geometry.coordinates[0]),Se=wt(Pt.geometry.coordinates[1])}var vr={type:1,geometry:[[Math.round(this.options.extent*(et*ue-oe)),Math.round(this.options.extent*(Se*ue-re))]],tags:Pe},_r=void 0;Ce?_r=Ae.id:this.options.generateId?_r=Ae.index:this.points[Ae.index].id&&(_r=this.points[Ae.index].id),_r!==void 0&&(vr.id=_r),it.features.push(vr)}},xe.prototype._limitZoom=function(Ie){return Math.max(this.options.minZoom,Math.min(+Ie,this.options.maxZoom+1))},xe.prototype._cluster=function(Ie,pt){for(var oe=[],re=this.options,ue=re.radius,it=re.extent,Jt=re.reduce,ce=re.minPoints,$e=ue/(it*Math.pow(2,pt)),Ae=0;Ae<Ie.length;Ae++){var Ce=Ie[Ae];if(!(Ce.zoom<=pt)){Ce.zoom=pt;for(var Pe=this.trees[pt+1],et=Pe.within(Ce.x,Ce.y,$e),Se=Ce.numPoints||1,Pt=Se,vr=0,_r=et;vr<_r.length;vr+=1){var Yr=_r[vr],tr=Pe.points[Yr];tr.zoom>pt&&(Pt+=tr.numPoints||1)}if(Pt>=ce){for(var ne=Ce.x*Se,be=Ce.y*Se,De=Jt&&Se>1?this._map(Ce,!0):null,at=(Ae<<5)+(pt+1)+this.points.length,kt=0,jt=et;kt<jt.length;kt+=1){var w=jt[kt],F=Pe.points[w];if(!(F.zoom<=pt)){F.zoom=pt;var de=F.numPoints||1;ne+=F.x*de,be+=F.y*de,F.parentId=at,Jt&&(De||(De=this._map(Ce,!0)),Jt(De,this._map(F)))}}Ce.parentId=at,oe.push(se(ne/Pt,be/Pt,at,Pt,De))}else if(oe.push(Ce),Pt>1)for(var Ue=0,Qe=et;Ue<Qe.length;Ue+=1){var Tt=Qe[Ue],Dt=Pe.points[Tt];Dt.zoom<=pt||(Dt.zoom=pt,oe.push(Dt))}}}return oe},xe.prototype._getOriginId=function(Ie){return Ie-this.points.length>>5},xe.prototype._getOriginZoom=function(Ie){return(Ie-this.points.length)%32},xe.prototype._map=function(Ie,pt){if(Ie.numPoints)return pt?Yt({},Ie.properties):Ie.properties;var oe=this.points[Ie.index].properties,re=this.options.map(oe);return pt&&re===oe?Yt({},re):re};function se(Be,Ie,pt,oe,re){return{x:ae(Be),y:ae(Ie),zoom:Infinity,id:pt,parentId:-1,numPoints:oe,properties:re}}function Ft(Be,Ie){var pt=Be.geometry.coordinates,oe=pt[0],re=pt[1];return{x:ae(Mt(oe)),y:ae(wt(re)),zoom:Infinity,index:Ie,parentId:-1}}function zt(Be){return{type:"Feature",id:Be.id,properties:Wt(Be),geometry:{type:"Point",coordinates:[ot(Be.x),tt(Be.y)]}}}function Wt(Be){var Ie=Be.numPoints,pt=Ie>=1e4?Math.round(Ie/1e3)+"k":Ie>=1e3?Math.round(Ie/100)/10+"k":Ie;return Yt(Yt({},Be.properties),{cluster:!0,cluster_id:Be.id,point_count:Ie,point_count_abbreviated:pt})}function Mt(Be){return Be/360+.5}function wt(Be){var Ie=Math.sin(Be*Math.PI/180),pt=.5-.25*Math.log((1+Ie)/(1-Ie))/Math.PI;return pt<0?0:pt>1?1:pt}function ot(Be){return(Be-.5)*360}function tt(Be){var Ie=(180-Be*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ie))/Math.PI-90}function Yt(Be,Ie){for(var pt in Ie)Be[pt]=Ie[pt];return Be}function ke(Be){return Be.x}function Ne(Be){return Be.y}return xe})},75752:function(ft){ft.exports.RADIUS=6378137,ft.exports.FLATTENING=1/298.257223563,ft.exports.POLAR_RADIUS=63567523142e-4}}]);
